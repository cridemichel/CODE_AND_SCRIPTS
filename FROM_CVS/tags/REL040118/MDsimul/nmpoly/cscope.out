cscope 15 $HOME/MDsimul/laponite               0000206145
	@corutil.c

1 
	~<mdsimul.h
>

4 
	goutFûe
[
NAME_LENGTH
];

5 
	göputFûe
[
NAME_LENGTH
];

6 
	gposFûe
[
NAME_LENGTH
];

7 
	gSEGSIZE
, 
	gc‹Boﬁ
 = 0, 
	gtBoﬁ
 = 0, 
	gihdr
 = 1, 
	gohdr
 = 1, 
	gposBoﬁ
 = 0, 
	gNm
,

8 
	gboxcmBoﬁ
 = 0;

9 
	goutBoﬁ
 = 0;

10 
	göfoBoﬁ
 = 0;

13 
COORD_TYPE
 
	gT
;

14 
COORD_TYPE
 
	gDECL_LIST
;

15 
COORD_TYPE
 
	gEXT_DLST
;

18 
¨gs
(
¨gc
, **
¨gv
);

19 
lﬂdC‹
(
cfd
);

20 
ßveC‹
(* 
fûeName
);

24 
	$öfo
()

26 
	`¥ötf
("InformationsáboutÅhe coordinate file:\n");

27 
	`¥ötf
("PartclesÇumber: %d Atoms distance d = %f\n",

28 
O∑øms
.
∑∫um
, O∑øms.
d
);

29 
	`¥ötf
("Exã∫ÆÖªssuª P = %f\n", 
O∑øms
.
P
);

30 
	`¥ötf
("Exã∫ÆÅem≥øtuª T = %f\n", 
O∑øms
.
T
);

31 
	`¥ötf
("mas†o‡©om 0:%‡o‡©om 1 %f\n", 
O∑øms
.
m
[0], Oparams.m[1]);

32 
	`¥ötf
("TotalÇumber of steps: %d steplength: %.10f\n",

33 
O∑øms
.
tŸSãp
, O∑øms.
°ïÀngth
);

34 
	`¥ötf
("Sigma00:%f Sigma11:%f Sigma10:%f\n",

35 
O∑øms
.
sigab
[0][0], Oparams.sigab[1][1], Oparams.sigab[1][0]);

36 
	`¥ötf
("Epsab00:%f Epsab11:%f Epsab10:%f\n",

37 
O∑øms
.
ïßb
[0][0], Oparams.epsab[1][1], Oparams.epsab[1][0]);

38 
	`¥ötf
("Löked Cñ»M = %d\n", 
O∑øms
.
M
);

39 
	}
}

42 
	$maö
(
¨gc
, * 
¨gv
[])

55 
cfd
, 
i
, 
a
, 
Nm
;

56 
COORD_TYPE
 
K
, 
Tcur
, 
Rx
, 
Ry
, 
Rz
, 
RCMx
, 
RCMy
, 
RCMz
, 
Drx
, 
Dry
, 
Drz
;

57 
COORD_TYPE
 
m
[
NA
], 
sˇlFa˘
, 
MtŸ
, 
Rxc
, 
Ryc
, 
Rzc
, 
Rxa
, 
Rya
, 
Rza
;

58 
COORD_TYPE
 
L
, 
övL
;

59 
FILE
* 
posf
;

61 
	`¨gs
(
¨gc
, 
¨gv
);

62 
O∑øms
.
∑∫um
 = 0;

64 i‡–(
cfd
 = 
	`›í
(
öputFûe
, 
O_RDONLY
)) == -1)

66 
	`¥ötf
("ERROR: UnableÅo openÅhe coordinate file!\n");

67 
	`exô
(-1);

71 
	`¥ötf
("Loading coordinates...\n");

72 
	`lﬂdC‹
(
cfd
);

73 
	`˛o£
(
cfd
);

74 if(
O∑øms
.
∑∫um
 != 0)

76 
Nm
 = 
O∑øms
.
∑∫um
;

80 
Nm
 =0.0;

83 
L
 = 
	`cbπ
(
Vﬁ
);

84 
övL
 = 1.0 / 
L
;

86 
K
 = 0.0;

88 
	`lo›
(
a
, 1, 
NA
)

90 
m
[
a
] = 
O∑øms
.m[a];

93 
MtŸ
 = 
m
[0] + m[1];

95 i‡(
tBoﬁ
 == 1)

98 
	`lo›
(
i
, 1, 
Nm
)

100 
	`lo›
(
a
, 1, 
NA
)

102 
K
 = K + 0.5 * 
m
[
a
] *

103 –
	`Sqr
(
vx
[
a
][
i
]Ë+ Sqr(
vy
[a][i]Ë+ Sqr(
vz
[a][i]) );

106 
Tcur
 = 2.0 * 
K
 / (5.0 * 
Nm
 - 3.0);

108 
	`¥ötf
("Scaling velocities...\n");

109 
sˇlFa˘
 = 
	`sqπ
(
T
 / 
Tcur
);

110 
	`lo›
(
i
, 1,
Nm
)

112 
	`lo›
(
a
, 1, 
NA
)

114 
vx
[
a
][
i
] = vx[a][i] * 
sˇlFa˘
;

115 
vy
[
a
][
i
] = vy[a][i] * 
sˇlFa˘
;

116 
vz
[
a
][
i
] = vz[a][i] * 
sˇlFa˘
;

122 i‡–
c‹Boﬁ
 == 1)

124 
	`¥ötf
("Reducing coordinatesÅo first box...\n");

125 
	`lo›
(
i
, 1, 
Nm
)

128 
Rx
 = (
m
[0] * 
rx
[0][
i
] + m[1] *Ñx[1][i]Ë/ 
MtŸ
;

129 
Ry
 = (
m
[0] * 
ry
[0][
i
] + m[1] *Ñy[1][i]Ë/ 
MtŸ
;

130 
Rz
 = (
m
[0] * 
rz
[0][
i
] + m[1] *Ñz[1][i]Ë/ 
MtŸ
;

131 
Drx
 = - 
L
 * 
	`röt
(
Rx
 * 
övL
);

132 
Dry
 = - 
L
 * 
	`röt
(
Ry
 * 
övL
);

133 
Drz
 = - 
L
 * 
	`röt
(
Rz
 * 
övL
);

135 
	`lo›
(
a
, 1, 
NA
)

138 
rx
[
a
][
i
] =Ñx[a][i] + 
Drx
;

139 
ry
[
a
][
i
] =Ñy[a][i] + 
Dry
;

140 
rz
[
a
][
i
] =Ñz[a][i] + 
Drz
;

147 i‡(
boxcmBoﬁ
 == 1)

150 
RCMx
 = 0.0;

151 
RCMy
 = 0.0;

152 
RCMz
 = 0.0;

154 
	`lo›
(
i
, 1, 
Nm
)

156 
Rx
 = (
m
[0] * 
rx
[0][
i
] + m[1] *Ñx[1][i]Ë/ 
MtŸ
;

157 
Ry
 = (
m
[0] * 
ry
[0][
i
] + m[1] *Ñy[1][i]Ë/ 
MtŸ
;

158 
Rz
 = (
m
[0] * 
rz
[0][
i
] + m[1] *Ñz[1][i]Ë/ 
MtŸ
;

159 
RCMx
 +
Rx
;

160 
RCMy
 +
Ry
;

161 
RCMz
 +
Rz
;

163 
	`¥ötf
("Thêa˘uÆ box cíã∏o‡mas†(%f, %f, %fËi†now sëÅÿthê‹igö\n", 
RCMx
, 
RCMy
, 
RCMz
);

165 
RCMx
 /(
COORD_TYPE
Ë
Nm
;

166 
RCMy
 /(
COORD_TYPE
Ë
Nm
;

167 
RCMz
 /(
COORD_TYPE
Ë
Nm
;

169 
	`lo›
(
i
, 1, 
Nm
)

171 
	`lo›
(
a
, 1, 
NA
)

173 
rx
[
a
][
i
] -
RCMx
;

174 
ry
[
a
][
i
] -
RCMy
;

175 
rz
[
a
][
i
] -
RCMz
;

180 i‡(
posBoﬁ
 == 1)

182 
	`¥ötf
("WritingÖositions...\n");

183 
posf
 = 
	`f›í
(
posFûe
, "w");

184 
	`lo›
(
i
, 1, 
Nm
)

187 
Rxa
=(
rx
[0][
i
]+rx[1][i])/2;

188 
Rya
=(
ry
[0][
i
]+ry[1][i])/2;

189 
Rza
=(
rz
[0][
i
]+rz[1][i])/2;

193 
	`Ârötf
(
posf
, "%.8‡%.8‡%.8f\n", 
rx
[0][
i
], 
ry
[0][i],

194 
rz
[0][
i
]);

195 
	`Ârötf
(
posf
, "%.8‡%.8‡%.8f\n", 
rx
[1][
i
], 
ry
[1][i],

196 
rz
[1][
i
]);

199 
	`f˛o£
(
posf
);

203 i‡(
outBoﬁ
 == 1)

206 
	`ßveC‹
(
outFûe
);

207 
	`¥ötf
("Coordinates file saved\n");

210 i‡(
öfoBoﬁ
 == 1)

211 
	`öfo
();

213 
	}
}

	@forces.c

1 
	~<mdsimul.h
>

2 
	#SIMUL


	)

12 
ENDSIM
;

13 
msgSåA
[
MSG_LEN
];

14 **
øŒx
, **
øŒy
, **
øŒz
, **
FÆlx
, **
FÆly
, **
FÆlz
,

15 **
øŒx_ﬁd
, **
øŒy_ﬁd
, **
øŒz_ﬁd
, *
©ch¨ge
;

16 **
ncut
;

17 *
Fc€ff
[3];

23 
COORD_TYPE
 
pi
, 
s1t
, 
Vﬁ1t
, 
L
, 
övL
, 
s1p
, 
EÃc
, 
PÃc
;

24 
COORD_TYPE
 
W
, 
K
, 
WC
, 
T1xx
, 
T1yy
, 
T1zz
,

25 
T1xx
, 
T1yy
, 
T1zz
, 
T1xy
, 
T1yz
, 
T1zx
, 
WCxy
, 
WCyz
, 
WCzx
,

26 
WCxx
, 
WCyy
, 
WCzz
, 
Wxx
, 
Wyy
, 
Wzz
,

27 
Wxy
, 
Wyz
, 
Wzx
, 
Pxx
, 
Pyy
, 
Pzz
, 
Pxy
, 
Pyz
, 
Pzx
, 
Wm
, 
Wmxx
, 
Wmyy
, 
Wmzz
,

28 
Wmxy
, 
Wmyz
, 
Wmzx
, 
Pmxx
, 
Pmyy
, 
Pmzz
, 
Pmxy
, 
Pmyz
, 
Pmzx
, 
T1mxy
,

29 
P©xy
, 
P©yz
, 
P©zx
, 
P©xx
, 
P©yy
, 
P©zz
,

30 
T1myz
, 
T1mzx
, 
T1mxx
, 
T1myy
, 
T1mzz
;

31 
COORD_TYPE
 
MtŸ
;

33 *
hód
, *
li°
, *
m≠
;

34 
NCñl
, 
m≠Size
, 
M
;

37 
COORD_TYPE
 
di•Hi
;

38 **
√brTab
, 
√brNow
, 
√brTabLí
, 
√brTabMax
;

41 
COORD_TYPE
 *
ox
, *
oy
, *
oz
;

43 
COORD_TYPE
 *
ux
, *
uy
, *
uz
;

44 
COORD_TYPE
 *
Rmx
, *
Rmy
, *
Rmz
;

49 
	$iCñl
(
ix
, 
iy
, 
iz
)

51  ((
ix
 + 
M
Ë% MË+ ((
iy
 + MË% MË* M + ( (
iz
 + M) % M )* M * M;

52 
	}
}

55 
	$m≠s
()

74 
ix
, 
iy
, 
iz
, 
iM≠
;

76 
	`lo›
(
iz
, 1, 
M
)

78 
	`lo›
(
iy
, 1, 
M
)

80 
	`lo›
(
ix
, 1, 
M
)

82 
iM≠
 = 
	`iCñl
(
ix
, 
iy
, 
iz
) * 13;

88 
m≠
[
iM≠
 + 0] = 
	`iCñl
(
ix
 + 1, 
iy
, 
iz
);

89 
m≠
[
iM≠
 + 1] = 
	`iCñl
(
ix
 + 1, 
iy
 + 1, 
iz
);

90 
m≠
[
iM≠
 + 2] = 
	`iCñl
(
ix
, 
iy
 + 1, 
iz
);

91 
m≠
[
iM≠
 + 3] = 
	`iCñl
(
ix
 - 1, 
iy
 + 1, 
iz
);

92 
m≠
[
iM≠
 + 4] = 
	`iCñl
(
ix
 + 1, 
iy
, 
iz
 - 1);

93 
m≠
[
iM≠
 + 5] = 
	`iCñl
(
ix
 + 1, 
iy
 + 1, 
iz
 - 1);

94 
m≠
[
iM≠
 + 6] = 
	`iCñl
(
ix
, 
iy
 + 1, 
iz
 - 1);

95 
m≠
[
iM≠
 + 7] = 
	`iCñl
(
ix
 - 1, 
iy
 + 1, 
iz
 - 1);

96 
m≠
[
iM≠
 + 8] = 
	`iCñl
(
ix
 + 1, 
iy
, 
iz
 + 1);

97 
m≠
[
iM≠
 + 9] = 
	`iCñl
(
ix
 + 1, 
iy
 + 1, 
iz
 + 1);

98 
m≠
[
iM≠
 + 10] = 
	`iCñl
(
ix
, 
iy
 + 1, 
iz
 + 1);

99 
m≠
[
iM≠
 + 11] = 
	`iCñl
(
ix
 - 1, 
iy
 + 1, 
iz
 + 1);

100 
m≠
[
iM≠
 + 12] = 
	`iCñl
(
ix
, 
iy
, 
iz
 + 1);

104 
	}
}

106 
	$löks
(
Nm
, 
COORD_TYPE
 
rcut
)

128 
COORD_TYPE
 
˚Œi
, 
˚Œ
, 
rxc
, 
ryc
, 
rzc
;

129 
iCñl
, 
i
, 
a
, 
b
;

131 
L
 = 
	`cbπ
(
Vﬁ
);

132 
övL
 = 1.0 / 
L
;

134 
iCñl
=0; iCñ»< 
NCñl
; iCell++)

136 
hód
[
iCñl
] = -1;

138 
poﬁ
;

140 
˚Œi
 = (
COORD_TYPE
Ë
M
;

141 
˚Œ
 = 1.0 / 
˚Œi
;

143 
a
=0;á < 
O∑øms
.
nsôes
;á++)

145 
b
 = 0; b < 
O∑øms
.
nsôes
; b++)

147 i‡(
L
 * 
˚Œ
 < (
O¥ogSètus
.
rNebrShñl
 + 
rcut
 * 
O∑øms
.
œmbdaD
) )

150 
	`¥ötf
("¸ôiˇ»cutoff: %f\n", 
O¥ogSètus
.
rNebrShñl
 +

151 
rcut
 * 
O∑øms
.
œmbdaD
);

152 
	`mdMsg
(
ALL
, 
NOSYS
, 
NULL
, "ERROR", NULL,

154 
NULL
);

155 
	`exô
(-1);

161 
i
=0; i < 
Nm
; i++)

163 
a
=0;á < 
O∑øms
.
nsôes
;á++)

174 
rxc
 = 
øŒx
[
a
][
i
] - 
L
 * 
	`röt
(
övL
 *Ñallx[a][i]);

175 
ryc
 = 
øŒy
[
a
][
i
] - 
L
 * 
	`röt
(
övL
 *Ñally[a][i]);

176 
rzc
 = 
øŒz
[
a
][
i
] - 
L
 * 
	`röt
(
övL
 *Ñallz[a][i]);

177 
rxc
 /
L
;

178 
ryc
 /
L
;

179 
rzc
 /
L
;

180 
iCñl
 = ( (Ë(–
rxc
 + 0.5 ) * 
˚Œi
) )

181 + ( (Ë((
ryc
 + 0.5Ë* 
˚Œi
ËË* 
M


182 + ( (Ë((
rzc
 + 0.5Ë* 
˚Œi
ËË* 
M
 * M;

188 
li°
[
O∑øms
.
nsôes
*
i
 + 
a
] = 
hód
[
iCñl
];

190 
hód
[
iCñl
] = 
O∑øms
.
nsôes
*
i
 + 
a
;

195 
	}
}

198 
	$BuûdNebrLi°NoLöked
(
Nm
, 
COORD_TYPE
 
rCut
)

200 
a
, 
b
, 
i
, 
j
;

201 
COORD_TYPE
 
rcuèb
, 
rcuèbSq
;

202 
COORD_TYPE
 
ºNebr
;

203 
COORD_TYPE
 
rxa
, 
rya
, 
rza
, 
øbSq
, 
rxab
, 
ryab
, 
rzab
;

205 
L
 = 
	`cbπ
(
Vﬁ
);

206 
övL
 = 1.0 / 
L
;

207 
i
 = 0; i < 
O∑øms
.
∑∫um
; i++)

208 
a
 = 0;á < 
O∑øms
.
nsôes
;á++)

210 
øŒx_ﬁd
[
a
][
i
] = 
øŒx
[a][i];

211 
øŒy_ﬁd
[
a
][
i
] = 
øŒy
[a][i];

212 
øŒz_ﬁd
[
a
][
i
] = 
øŒz
[a][i];

216 
rcuèb
 = 
rCut
 * 
O∑øms
.
œmbdaD
;

217 
rcuèbSq
 = 
	`Sqr
(
rcuèb
);

218 
ºNebr
 = 
	`Sqr
(
rcuèb
 + 
O¥ogSètus
.
rNebrShñl
);

219 i‡(
ºNebr
 > 
	`Sqr
(
L
 / 2.0))

221 
	`¥ötf
("(rcutoff +ÑNebrShell)=%f isÅooÜarge, itÉxceeds L/2 = %f\n",

222 
	`sqπ
(
ºNebr
), 
L
/2.0);

223 
	`exô
(-1);

226 
√brTabLí
 = 0;

227 
i
=0; i < 
Nm
 - 1; i++)

229 
a
=0;á < 
O∑øms
.
nsôes
;á++)

231 
rxa
 = 
øŒx
[
a
][
i
];

232 
rya
 = 
øŒy
[
a
][
i
];

233 
rza
 = 
øŒz
[
a
][
i
];

234 
b
=0; b < 
O∑øms
.
nsôes
; b++)

237 
j

i
 + 1; j < 
Nm
; j++)

242 
rxab
 = 
rxa
 - 
øŒx
[
b
][
j
];

243 
ryab
 = 
rya
 - 
øŒy
[
b
][
j
];

244 
rzab
 = 
rza
 - 
øŒz
[
b
][
j
];

245 
rxab
 =Ñxab - 
L
 * 
	`röt
‘xab * 
övL
);

246 
ryab
 =Ñyab - 
L
 * 
	`röt
‘yab * 
övL
);

247 
rzab
 =Ñzab - 
L
 * 
	`röt
‘zab * 
övL
);

248 
øbSq
 = 
	`Sqr
(
rxab
Ë+ Sqr(
ryab
Ë+ Sqr(
rzab
);

250 i‡–
øbSq
 < 
ºNebr
 )

252 i‡(
√brTabLí
 >
√brTabMax
)

254 
	`¥ötf
("√brTabMax: %dÇebrTabLí: %d\n", 
√brTabMax
,

255 
√brTabLí
);

256 
	`¥ötf
("∑πi˛es: (%d,%d)-(%d,%d)\n",
i
,
a
,
j
,
b
);

257 
	`¥ötf
("ERROR: Neighbourlist overflow!\n");

258 
	`exô
(-1);

260 
√brTab
[0][
√brTabLí
] = 
O∑øms
.
nsôes
*
i
 + 
a
;

261 
√brTab
[1][
√brTabLí
] = 
O∑øms
.
nsôes
*
j
 + 
b
;

262 ++
√brTabLí
;

270 
	`¥ötf
("°ï N. %d:ÇebrTabLí: %d\n", 
O∑øms
.
curSãp
, 
√brTabLí
);

271 
	}
}

274 
	$BuûdNebrLi°
(
Nm
, 
COORD_TYPE
 
rCut
)

276 
a
, 
b
, 
i
, 
j
;

277 
COORD_TYPE
 
rcuèb
, 
rcuèbSq
;

278 
COORD_TYPE
 
ºNebr
;

279 
iCñl
, 
jCñl0
, 
jCñl
, 
«b‹
, 
hd
, 
l°
, 
nsôes
;

280 
COORD_TYPE
 
rxa
, 
rya
, 
rza
, 
øbSq
, 
rxab
, 
ryab
, 
rzab
;

282 
nsôes

O∑øms
.nsites;

283 
i
 = 0; i < 
O∑øms
.
∑∫um
; i++)

284 
a
 = 0;á < 
O∑øms
.
nsôes
;á++)

286 
øŒx_ﬁd
[
a
][
i
] = 
øŒx
[a][i];

287 
øŒy_ﬁd
[
a
][
i
] = 
øŒy
[a][i];

288 
øŒz_ﬁd
[
a
][
i
] = 
øŒz
[a][i];

291 
rcuèb
 = 
rCut
 * 
O∑øms
.
œmbdaD
;

292 
rcuèbSq
 = 
	`Sqr
(
rcuèb
);

293 
ºNebr
 = 
	`Sqr
(
rcuèb
 + 
O¥ogSètus
.
rNebrShñl
);

295 
L
 = 
	`cbπ
(
Vﬁ
);

296 
övL
 = 1.0 / 
L
;

297 
√brTabLí
 = 0;

299 
iCñl
=0; iCñ»< 
NCñl
; iCell++)

302 
hd
 = 
hód
[
iCñl
];

304 
hd
 > -1)

306 
i
 = 
hd
 / 
nsôes
;

307 
a
 = 
hd
 % 
nsôes
;

308 
rxa
 = 
øŒx
[
a
][
i
];

309 
rya
 = 
øŒy
[
a
][
i
];

310 
rza
 = 
øŒz
[
a
][
i
];

313 
l°
 = 
li°
[
hd
];

315 
l°
 > -1)

318 
j
 = 
l°
 / 
nsôes
;

319 
b
 = 
l°
 % 
nsôes
;

321 i‡(
j
 =
i
)

324 
l°
 = 
li°
[lst];

328 
rxab
 = 
rxa
 - 
øŒx
[
b
][
j
];

329 
ryab
 = 
rya
 - 
øŒy
[
b
][
j
];

330 
rzab
 = 
rza
 - 
øŒz
[
b
][
j
];

332 
rxab
 =Ñxab - 
L
 * 
	`röt
(
övL
 *Ñxab);

333 
ryab
 =Ñyab - 
L
 * 
	`röt
(
övL
 *Ñyab);

334 
rzab
 =Ñzab - 
L
 * 
	`röt
(
övL
 *Ñzab);

336 
øbSq
 = 
	`Sqr
(
rxab
Ë+ Sqr(
ryab
Ë+ Sqr(
rzab
);

338 i‡–
øbSq
 < 
ºNebr
 )

340 i‡(
√brTabLí
 >
√brTabMax
)

342 
	`¥ötf
("√brTabMax: %dÇebrTabLí: %d\n", 
√brTabMax
,

343 
√brTabLí
);

344 
	`¥ötf
("∑πi˛es: (%d,%d)-(%d,%d)\n",
i
,
a
,
j
,
b
);

345 
	`¥ötf
("ERROR: Neighbourlist overflow!\n");

346 
	`exô
(-1);

348 
√brTab
[0][
√brTabLí
] = 
nsôes
*
i
 + 
a
;

349 
√brTab
[1][
√brTabLí
] = 
nsôes
*
j
 + 
b
;

350 ++
√brTabLí
;

353 
l°
 = 
li°
[lst];

356 
jCñl0
 = 13 * 
iCñl
;

357 
«b‹
=0;Çabor < 13;Çabor++)

359 
jCñl
 = 
m≠
[
jCñl0
 + 
«b‹
];

360 
l°
 = 
hód
[
jCñl
];

361 
l°
 != -1)

363 
j
 = 
l°
 / 
nsôes
;

364 
b
 = 
l°
 % 
nsôes
;

365 i‡–
j
 =
i
)

367 
l°
 = 
li°
[lst];

371 
rxab
 = 
rxa
 - 
øŒx
[
b
][
j
];

372 
ryab
 = 
rya
 - 
øŒy
[
b
][
j
];

373 
rzab
 = 
rza
 - 
øŒz
[
b
][
j
];

375 
rxab
 =Ñxab - 
L
 * 
	`röt
(
övL
 *Ñxab);

376 
ryab
 =Ñyab - 
L
 * 
	`röt
(
övL
 *Ñyab);

377 
rzab
 =Ñzab - 
L
 * 
	`röt
(
övL
 *Ñzab);

378 
øbSq
 = 
	`Sqr
(
rxab
Ë+ Sqr(
ryab
Ë+ Sqr(
rzab
);

380 i‡–
øbSq
 < 
ºNebr
 )

382 i‡(
√brTabLí
 >
√brTabMax
)

384 
	`¥ötf
("√brTabMax: %dÇebrTabLí: %d\n", 
√brTabMax
,

385 
√brTabLí
);

386 
	`¥ötf
("ERROR: Neighbourlist overflow!\n");

387 
	`¥ötf
("∑πi˛es: (%d,%d)-(%d,%d)\n",
i
,
a
,
j
,
b
);

388 
	`exô
(-1);

390 
√brTab
[0][
√brTabLí
] = 
nsôes
*
i
 + 
a
;

391 
√brTab
[1][
√brTabLí
] = 
nsôes
*
j
 + 
b
;

392 ++
√brTabLí
;

395 
l°
 = 
li°
[lst];

399 
hd
 = 
li°
[hd];

403 
	}
}

406 
	$CoM
(
i
, 
COORD_TYPE
* 
rxcm
, COORD_TYPE* 
rycm
, COORD_TYPE* 
rzcm
)

408 *
m
, 
MtŸ
;

409 
j
;

411 
L
 = 
	`cbπ
(
Vﬁ
);

412 
övL
 = 1.0 / 
L
;

413 
MtŸ
 = 0.0;

414 
m
 = 
O∑øms
.m;

415 
j
=0; j < 
NA
; j++)

416 
MtŸ
 +
m
[
j
];

417 *
rxcm
 = (
rx
[0][
i
]*
m
[0] +Ñx[1][i]*m[1] +Ñx[2][i]*m[2]Ë/ 
MtŸ
;

418 *
rycm
 = (
ry
[0][
i
]*
m
[0] +Ñy[1][i]*m[1] +Ñy[2][i]*m[2]Ë/ 
MtŸ
;

419 *
rzcm
 = (
rz
[0][
i
]*
m
[0] +Ñz[1][i]*m[1] +Ñz[2][i]*m[2]Ë/ 
MtŸ
;

421 
	}
}

424 
	$CoMV
(
i
, 
COORD_TYPE
* 
vxcm
, COORD_TYPE* 
vycm
, COORD_TYPE* 
vzcm
)

426 
COORD_TYPE
* 
m
, 
MtŸ
;

427 
j
;

432 
m
 = 
O∑øms
.m;

433 
MtŸ
=0.0;

434 
j
=0; j < 
NA
; j++)

435 
MtŸ
 +
m
[
j
];

437 *
vxcm
 = (
vx
[0][
i
]*
m
[0] + vx[1][i]*m[1] + vx[2][i]*m[2]Ë/ 
MtŸ
;

438 *
vycm
 = (
vy
[0][
i
]*
m
[0] + vy[1][i]*m[1] + vy[2][i]*m[2]Ë/ 
MtŸ
;

439 *
vzcm
 = (
vz
[0][
i
]*
m
[0] + vz[1][i]*m[1] + vz[2][i]*m[2]Ë/ 
MtŸ
;

440 
	}
}

442 
	$köë
(
Nm
, 
COORD_TYPE
** 
vñx
, COORD_TYPE** 
vñy
, COORD_TYPE** 
vñz
,

443 
COORD_TYPE
 
VOL1
)

449 
i
, 
a
;

450 
COORD_TYPE
 
d V
, 
px
, 
py
, 
pz
;

453 
K
 = 0.0;

454 
L
 = 
	`cbπ
(
Vﬁ
);

455 
övL
 = 1.0 / 
L
;

457 
d V
 = 
VOL1
 / 
Vﬁ
;

458 
d V
 /= 3.0;

460 
i
=0; i < 
Nm
; i++)

462 
a
=0;á < 
NA
;á++)

464 
px
 = 
vñx
[
a
][
i
] - 
d V
 * 
Rx
[i];

465 
py
 = 
vñy
[
a
][
i
] - 
d V
 * 
Ry
[i];

466 
pz
 = 
vñz
[
a
][
i
] - 
d V
 * 
Rz
[i];

467 
K
 = K + 
O∑øms
.
m
[
a
] * (
	`Sqr
(
px
Ë+ Sqr(
py
Ë+ Sqr(
pz
));

473 
K
 *= 0.5;

474 
	}
}

476 
	$checkNebrRebuûd
()

478 
i
, 
a
, 
Nm
 = 
O∑øms
.
∑∫um
;

479 
rNebrShñlSq
;

483 
rNebrShñlSq
 = 
	`Sqr
(0.5*
O¥ogSètus
.
rNebrShñl
);

484 
i
=0; i < 
Nm
 && !
√brNow
 ; i++)

488 
a
=0;á < 
O∑øms
.
nsôes
;á++)

494 i‡(
	`Sqr
(
øŒx
[
a
][
i
]-
øŒx_ﬁd
[a][i])+Sqr(
øŒy
[a][i]-
øŒy_ﬁd
[a][i])+

495 
	`Sqr
(
øŒz
[
a
][
i
]-
øŒz_ﬁd
[a][i]Ë> 
rNebrShñlSq
)

497 
	`¥ötf
("STEP N. %dÑebuûdögÇeghbouæi°s!\n", 
O∑øms
.
curSãp
);

498 
	`¥ötf
("(%f,%f,%f)-(%f,%f,%f)\n", 
øŒx
[
a
][
i
], 
øŒy
[a][i],
øŒz
[a][i],

499 
øŒx_ﬁd
[
a
][
i
], 
øŒy_ﬁd
[a][i],
øŒz_ﬁd
[a][i]);

500 
√brNow
=1;

515 
	}
}

516 c⁄° 
	göv4põps0
=1.43999;

519 
	$LJF‹˚
(
Nm
, 
rcut
)

522 
a
, 
b
, 
i
, 
j
;

524 
COORD_TYPE
 
rcuèb
, 
rcuèbSq
;

525 
COORD_TYPE
 
rxab
, 
ryab
, 
rzab
, 
øbSq
, 
fxab
, 
fyab
, 
fzab
, 
øb
;

526 
COORD_TYPE
 
§ab2
, 
§ab6
, 
§ab12
, 
Áb
, 
vabhc
, 
wab
, 
vabyu
, 
vab
;

527 
COORD_TYPE
 
Fxa
, 
Fya
, 
Fza
, 
rxa
, 
rya
, 
rza
;

528 
COORD_TYPE
 
vabCut
, 
Vˇb
;

529 
COORD_TYPE
 
Vab
, 
Wab
, 
dvdr
;

530 
COORD_TYPE
 
rho
, 
DRmx
, 
DRmy
, 
DRmz
;

532 
n
, 
√brTab0
, 
√brTab1
;

533 
COORD_TYPE
 
Wmyx
, 
Wmzy
, 
Wmxz
, 
kD
;

541 
rcuèb
 = 
rcut
 * 
O∑øms
.
œmbdaD
;

542 
rcuèbSq
 = 
	`Sqr
(
rcuèb
);

543 
Vab
 = 0.0;

544 
Wab
 = 0.0;

545 
kD
 = 1.0/
O∑øms
.
œmbdaD
;

546 
L
 = 
	`cbπ
(
Vﬁ
);

547 
övL
 = 1.0 / 
L
;

548 
a
=0;á < 
O∑øms
.
nsôes
;á++)

549 
b
=0; b < 
O∑øms
.
nsôes
; b++)

550 
ncut
[
a
][
b
] = 0;

552 
i
=0;ò< 
Nm
; i++)

554 #ifde‡
MOLPTENS


555 
	`CoM
(
i
, &
Rmx
[i], &
Rmy
[i], &
Rmz
[i]);

558 
a
=0;á < 
O∑øms
.
nsôes
;á++)

560 
FÆlx
[
a
][
i
] = 0.0;

561 
FÆly
[
a
][
i
] = 0.0;

562 
FÆlz
[
a
][
i
] = 0.0;

566 
V
 = 0.0;

567 
W
 = 0.0;

568 #ifde‡
ATPTENS


569 
Wxy
 = 0.0;

570 
Wyz
 = 0.0;

571 
Wzx
 = 0.0;

572 
Wxx
 = 
Wyy
 = 
Wzz
 = 0.0;

574 #ifde‡
MOLPTENS


575 
Wm
 = 0.0;

576 
Wmxx
 = 
Wmyy
 = 
Wmzz
 = 0.0;

577 
Wmxy
 = 
Wmyz
 = 
Wmzx
 = 0.0;

578 
Wmyx
 = 
Wmzy
 = 
Wmxz
 = 0.0;

581 
Vc
 = 0.0;

583 
n
=0;Ç < 
√brTabLí
;Ç++)

585 
√brTab0
 = 
√brTab
[0][
n
];

586 
√brTab1
 = 
√brTab
[1][
n
];

588 
i
 = 
√brTab0
 / 
O∑øms
.
nsôes
;

589 
a
 = 
√brTab0
 % 
O∑øms
.
nsôes
;

590 
j
 = 
√brTab1
 / 
O∑øms
.
nsôes
;

591 
b
 = 
√brTab1
 % 
O∑øms
.
nsôes
;

593 
rxa
 = 
øŒx
[
a
][
i
];

594 
rya
 = 
øŒy
[
a
][
i
];

595 
rza
 = 
øŒz
[
a
][
i
];

597 
Fxa
 = 
FÆlx
[
a
][
i
];

598 
Fya
 = 
FÆly
[
a
][
i
];

599 
Fza
 = 
FÆlz
[
a
][
i
];

601 
rxab
 = 
rxa
 - 
øŒx
[
b
][
j
];

602 
ryab
 = 
rya
 - 
øŒy
[
b
][
j
];

603 
rzab
 = 
rza
 - 
øŒz
[
b
][
j
];

605 
rxab
 =Ñxab - 
L
 * 
	`röt
(
övL
 *Ñxab);

606 
ryab
 =Ñyab - 
L
 * 
	`röt
(
övL
 *Ñyab);

607 
rzab
 =Ñzab - 
L
 * 
	`röt
(
övL
 *Ñzab);

609 
øbSq
 = 
	`Sqr
(
rxab
Ë+ Sqr(
ryab
Ë+ Sqr(
rzab
);

610 i‡–
øbSq
 < 
rcuèbSq
 )

612 
øb
 = 
	`sqπ
(
øbSq
);

613 
§ab2
 = 1.0 / 
øbSq
;

614 
§ab6
 = 
§ab2
 * srab2 * srab2;

616 
vabhc
 = 
O∑øms
.
¸ï
 * 
§ab6
;

617 
vabyu
 = 
öv4põps0
*
©ch¨ge
[
a
]*©ch¨ge[
b
]*
	`exp
(-
øb
*
kD
)/‘ab*
O∑øms
.
ïsû⁄
);

619 
	`¥ötf
("(%d,%d)-(%d,%dËvabhc:%.15‡vabyu:%.15f\n", 
i
, 
a
, 
j
, 
b
, 
vabhc
, 
vabyu
);

623 
vab
 = 
vabhc
 + 
vabyu
;

624 
wab
 = 6.0*
vabhc
 + 
vabyu
 * (1.0 + 
øb
*
kD
);

626 i‡(
øb
 < 1.0)

628 
Ø
;

629 
øex
, 
øey
, 
øez
;

630 
	`¥ötf
("vabhc:%‡vabyu:%f\n", 
vabhc
, 
vabyu
);

631 
	`¥ötf
("(%d,%d)-(%d,%dËøb=%f\n", 
i
, 
a
, 
j
, 
b
, 
øb
);

632 
øex
 = 
øŒx
[
a
][
i
]-ÑÆlx[
b
][
j
];

633 
øey
 = 
øŒy
[
a
][
i
] -ÑÆly[
b
][
j
];

634 
øez
 = 
øŒz
[
a
][
i
] -ÑÆlz[
b
][
j
];

635 
	`¥ötf
("Di°™z®£«®MI: %‡(%f,%f,%f)\n", 
	`sqπ
(
	`Sqr
(
øex
)+Sqr(
øey
)+Sqr(
øez
)),

636 
øex
, 
øey
, 
øez
);

637 
Ø
=0;áa < 3;áa++)

639 
	`¥ötf
("[vñ] i=%d: (%f,%f,%f), j=%d (%f,%f,%f)\n", 
i
,

640 
vx
[
Ø
][
i
], 
vy
[Ø][i], 
vz
[aa][i],

641 
j
, 
vx
[
Ø
][j], 
vy
[Ø][j], 
vz
[aa][j]);

642 
	`¥ötf
("[pos] i=%d: (%f,%f,%f), j=%d (%f,%f,%f)\n", 
i
,

643 
rx
[
Ø
][
i
], 
ry
[Ø][i], 
rz
[aa][i],

644 
j
, 
rx
[
Ø
][j], 
ry
[Ø][j], 
rz
[aa][j]);

650 
V
 = V + 
vab
;

652 
W
 = W + 
wab
;

655 
Áb
 = 
wab
 / 
øbSq
;

657 
fxab
 = 
Áb
 * 
rxab
;

658 
fyab
 = 
Áb
 * 
ryab
;

659 
fzab
 = 
Áb
 * 
rzab
;

662 #ifde‡
ATPTENS


664 
Wxy
 +
rxab
 * 
fyab
;

665 
Wyz
 +
ryab
 * 
fzab
;

666 
Wzx
 +
rzab
 * 
fxab
;

667 
Wxx
 +
rxab
 * 
fxab
;

668 
Wyy
 +
ryab
 * 
fyab
;

669 
Wzz
 +
rzab
 * 
fzab
;

674 #ifde‡
MOLPTENS


675 
DRmx
 = (
Rmx
[
i
] - Rmx[
j
]);

676 
DRmx
 = DRmx - 
L
 * 
	`röt
(
övL
 * DRmx);

677 
DRmy
 = (
Rmy
[
i
] - Rmy[
j
]);

678 
DRmy
 = DRmy - 
L
 * 
	`röt
(
övL
 * DRmy);

679 
DRmz
 = (
Rmz
[
i
] - Rmz[
j
]);

680 
DRmz
 = DRmz - 
L
 * 
	`röt
(
övL
 * DRmz);

682 
Wmxx
 +
DRmx
 * 
fxab
;

683 
Wmyy
 +
DRmy
 * 
fyab
;

684 
Wmzz
 +
DRmz
 * 
fzab
;

686 
Wmyx
 +
DRmy
 * 
fxab
;

687 
Wmzy
 +
DRmz
 * 
fyab
;

688 
Wmxz
 +
DRmx
 * 
fzab
;

690 
Wmxy
 +
DRmx
 * 
fyab
;

691 
Wmyz
 +
DRmy
 * 
fzab
;

692 
Wmzx
 +
DRmz
 * 
fxab
;

694 
Fxa
 = Fx®+ 
fxab
;

695 
Fya
 = Fy®+ 
fyab
;

696 
Fza
 = Fz®+ 
fzab
;

698 
FÆlx
[
b
][
j
] = FÆlx[b][j] - 
fxab
;

699 
FÆly
[
b
][
j
] = FÆly[b][j] - 
fyab
;

700 
FÆlz
[
b
][
j
] = FÆlz[b][j] - 
fzab
;

701 ++
ncut
[
a
][
b
];

704 
FÆlx
[
a
][
i
] = 
Fxa
;

705 
FÆly
[
a
][
i
] = 
Fya
;

706 
FÆlz
[
a
][
i
] = 
Fza
;

708 i‡(
O∑øms
.
curSãp
==1)

711 
FILE
* 
f
;

712 
ii
;

713 
r
;

714 
f
 = 
	`f›í
 ("potentialRimFace.dat","w");

715 
ii
=0; ii < 300; ii++)

717 
r
 = 0.2 + ((2.5 - 0.2)/300)*
ii
;

718 
	`Ârötf
(
f
, "%.15‡%.15f\n", 
r
, 
O∑øms
.
¸ï
 / 
	`pow
(r,6) +

719 
öv4põps0
*
©ch¨ge
[0]*©ch¨ge[60]*
	`exp
(-
r
*
kD
)/‘*
O∑øms
.
ïsû⁄
));

721 
	`f˛o£
(
f
);

722 
f
 = 
	`f›í
 ("potentialRimRim.dat","w");

723 
ii
=0; ii < 300; ii++)

725 
r
 = 0.2 + ((5 - 0.2)/300)*
ii
;

726 
	`Ârötf
(
f
, "%.15‡%.15f\n", 
r
, 
O∑øms
.
¸ï
 / 
	`pow
(r,6) +

727 
öv4põps0
*
©ch¨ge
[0]*©ch¨ge[0]*
	`exp
(-
r
*
kD
)/‘*
O∑øms
.
ïsû⁄
));

729 
	`f˛o£
(
f
);

730 
f
 = 
	`f›í
 ("potentialFaceFace.dat","w");

731 
ii
=0; ii < 300; ii++)

733 
r
 = 0.2 + ((5 - 0.2)/300)*
ii
;

734 
	`Ârötf
(
f
, "%.15‡%.15f\n", 
r
, 
O∑øms
.
¸ï
 / 
	`pow
(r,6) +

735 
öv4põps0
*
©ch¨ge
[60]*©ch¨ge[60]*
	`exp
(-
r
*
kD
)/‘*
O∑øms
.
ïsû⁄
));

737 
	`f˛o£
(
f
);

745 
Vˇb
 = 0.0;

746 
a
=0;á < 
O∑øms
.
nsôes
;á++)

748 
b
=0; b < 
O∑øms
.
nsôes
; b++)

750 
øb
 = 
rcut
*
O∑øms
.
œmbdaD
;

751 
øbSq
 = 
	`Sqr
(
øb
);

752 
§ab2
 = 1.0 / 
øbSq
;

753 
§ab6
 = 
§ab2
 * srab2 * srab2;

754 
vabhc
 = 
O∑øms
.
¸ï
 * 
§ab6
;

755 
vabyu
 = 
öv4põps0
*
©ch¨ge
[
a
]*©ch¨ge[
b
]*
	`exp
(-
øb
*
kD
)/‘ab*
O∑øms
.
ïsû⁄
);

757 
vabCut
 = 
vabhc
 + 
vabyu
;

758 
Vˇb
 +
ncut
[
a
][
b
] * 
vabCut
;

764 
Vc
 = 
V
 - 
Vˇb
;

777 #ifde‡
MOLPTENS


778 
Wm
 = 
Wmxx
 + 
Wmyy
 + 
Wmzz
;

789 
	}
}

792 
	$F‹˚On123
()

794 
i
, 
a
;

795 
i
 = 0; i < 
O∑øms
.
∑∫um
; i++)

797 
Fx
[0][
i
] = 
FÆlx
[0][i];

798 
Fy
[0][
i
] = 
FÆly
[0][i];

799 
Fz
[0][
i
] = 
FÆlz
[0][i];

800 
Fx
[1][
i
] = 
FÆlx
[1][i];

801 
Fy
[1][
i
] = 
FÆly
[1][i];

802 
Fz
[1][
i
] = 
FÆlz
[1][i];

803 
Fx
[2][
i
] = 
FÆlx
[2][i];

804 
Fy
[2][
i
] = 
FÆly
[2][i];

805 
Fz
[2][
i
] = 
FÆlz
[2][i];

807 
a
 = 3;á < 
O∑øms
.
nsôes
;á++)

809 
Fx
[0][
i
] +
Fc€ff
[0][
a
]*
FÆlx
[a][i];

810 
Fy
[0][
i
] +
Fc€ff
[0][
a
]*
FÆly
[a][i];

811 
Fz
[0][
i
] +
Fc€ff
[0][
a
]*
FÆlz
[a][i];

812 
Fx
[1][
i
] +
Fc€ff
[1][
a
]*
FÆlx
[a][i];

813 
Fy
[1][
i
] +
Fc€ff
[1][
a
]*
FÆly
[a][i];

814 
Fz
[1][
i
] +
Fc€ff
[1][
a
]*
FÆlz
[a][i];

815 
Fx
[2][
i
] +
Fc€ff
[2][
a
]*
FÆlx
[a][i];

816 
Fy
[2][
i
] +
Fc€ff
[2][
a
]*
FÆly
[a][i];

817 
Fz
[2][
i
] +
Fc€ff
[2][
a
]*
FÆlz
[a][i];

821 
	}
}

	@hetero.c

1 
	~<mdsimul.h
>

2 
	~<hëîoc⁄°r.h
>

4 
xvaHód
 
	gOxvaH
;

6 
COORD_TYPE
 
	gXVA_DLST
;

9 
	$xvaP¨sög
(
°rögA
[
NAME_LENGTH
], 
°rögB
[NAME_LENGTH])

11 
i
;

12 
msgSåA
[512];

15 
i
=0; 
OxvaP¨
[i].
±r
 !
NULL
; ++i)

17 i‡(!
	`°rcmp
(
OxvaP¨
[
i
].
∑rName
, 
°rögA
))

19 
OxvaP¨
[
i
].
ty≥
)

21 
STR
 :

22 
	`°r˝y
((*Ë
OxvaP¨
[
i
].
±r
, 
°rögB
);

24 
INT
 :

25 *((*Ë
OxvaP¨
[
i
].
±r
Ë
	`©oi
(
°rögB
);

27 
CT
 :

28 –*((
COORD_TYPE
*)
OxvaP¨
[
i
].
±r
) ) =

29 (
COORD_TYPE
Ë
	`©of
(
°rögB
);

32 
	`¥ötf
("Not validÖarameterÅype in singleParárray(in mdsimdep.h).");

33 
	`exô
(-1);

41 
	`•rötf
(
msgSåA
, "P¨am©î %†i†nŸ vÆid", 
°rögA
);

42 
	`¥ötf
–"%s\n", 
msgSåA
);

43 
	`exô
(-1);

44 
	}
}

47 
	$ªadP¨s
(* 
fûeName
)

49 
FILE
* 
pfs
;

50 
°r1
[255], 
°r2
[255];

51 
löe
[2048];

53 i‡–(
pfs
 = 
	`f›í
(
fûeName
, "r")Ë=
NULL
)

55 
	`¥ötf
("ERROR: U«bÀÅÿ›íÅhê∑ømëî†fûê%s\n", 
fûeName
);

56 
	`exô
(-1);

59 
	`°r˝y
(
°r1
, "");

60 
	`°r˝y
(
°r2
, "");

62 !
	`„of
(
pfs
))

64 
	`fsˇnf
(
pfs
, "%[^\n] ", 
löe
);

66 i‡(!
	`°rcmp
(
löe
, ""))

69 i‡(
	`ssˇnf
(
löe
, "%[^:# ] : %[^\n# ] ", 
°r1
, 
°r2
) < 2)

73 i‡(!
	`°rcmp
(
°r2
, "*")) ;

74 
	`xvaP¨sög
(
°r1
, 
°r2
);

76 
	`f˛o£
(
pfs
);

77 
	}
}

80 
	$ve˘Prod
(
COORD_TYPE
 
r1x
, COORD_TYPE 
r1y
, COORD_TYPE 
r1z
,

81 
COORD_TYPE
 
r2x
, COORD_TYPE 
r2y
, COORD_TYPE 
r2z
,

82 
COORD_TYPE
* 
r3x
, COORD_TYPE* 
r3y
, COORD_TYPE* 
r3z
)

86 *
r3x
 = 
r1y
 * 
r2z
 - 
r1z
 * 
r2y
;

87 *
r3y
 = 
r1z
 * 
r2x
 - 
r1x
 * 
r2z
;

88 *
r3z
 = 
r1x
 * 
r2y
 - 
r1y
 * 
r2x
;

89 
	}
}

92 
	$£tFœgs
()

94 i‡(!
	`°rcmp
(
hëîoTøFûe
, "!"))

95 
hëîoTøFœg
 = 0;

96 i‡(!
	`°rcmp
(
hëîoAngFûe
, "!"))

97 
hëîoAngFœg
 = 0;

98 
	}
}

101 
	$övÆArg
()

105 
	`¥ötf
("Syntax: heteroutil [-mathematica] [-p <precision>] -f <hetero_parameters_file>\n");

106 
	`¥ötf
("Invalidárgument!\n");

107 
	`exô
(-1);

108 
	}
}

111 
	$deÁu…s
()

113 
pi
 = 
	`acos
(-1);

114 
	`°r˝y
(
xv≠¨sFûe
, "xva.par");

115 
DtTø_món
 = 0;

116 
DtAng_món
 = 0;

117 
m0
 = 1.0;

118 
m1
 = 1.0;

119 
d
 = 0.5;

120 
T
 = 1.0;

121 
¥ötEvîy
 = 10;

122 
	`°r˝y
(
hëîoTøFûe
, "!");

123 
	`°r˝y
(
hëîoAngFûe
, "!");

124 
	`°r˝y
(
¥ecisi⁄
,"6");

125 
	}
}

128 
	$¨gs
(
¨gc
,**
¨gv
)

130 
i
;

133 
i
 = 0;

136 i‡(
i
+1 =
¨gc
)

138 
	`övÆArg
();

141 ++
i
;

143 i‡(!
	`°rcmp
(
¨gv
[
i
], "-p"))

145 i‡–
i
+1 =
¨gc
 )

147 
	`övÆArg
();

149 ++
i
;

150 
	`°r˝y
(
¥ecisi⁄
, 
¨gv
[
i
]);

152 i‡(!
	`°rcmp
(
¨gv
[
i
], "-mathematica"))

154 i‡–
i
+1 =
¨gc
 )

156 
	`övÆArg
();

158 
m©hFœg
 = 1;

161 if(!
	`°rcmp
(
¨gv
[
i
], "-f"))

163 i‡–(
i
+1Ë=
¨gc
 )

165 
	`övÆArg
();

167 ++
i
;

168 
	`°r˝y
(
xv≠¨sFûe
, 
¨gv
[
i
]);

172 
	`övÆArg
();

174 }  
i
 < (
¨gc
 - 1) );

179 i‡(++
i
 =
¨gc
)

181 
	`övÆArg
();

185 
	`°r˝y
(
öputFûe
, 
¨gv
[
i
]);

186 
	}
}

189 
	$›íMósFûe
(* 
FûeName
)

191 
mfd
;

195 i‡–(
mfd
 = 
	`›í
(
FûeName
,
O_RDONLY
)) == -1 )

197 
	`≥º‹
("open measures file");

198 
	`¥ötf
("ERROR: U«bÀÅÿ›í i≈uàfûê%s\n", 
FûeName
);

199 
	`exô
(-1);

203 i‡(
	`ªad
(
mfd
, &
OxvaH
, (
xvaHód
)) == -1)

205 
	`≥º‹
("read header");

206 
	`exô
(-1);

209  
mfd
;

210 
	}
}

213 
	$˛o£MósFûe
(
fd
)

215 
	`˛o£
(
fd
);

216 
	}
}

219 
	$ªadMós
(
fd
, 
nmós
, 
COORD_TYPE
* 
fú°På
, ...)

223 
begByã
, 
rs
;

224 
COORD_TYPE
* 
•å
;

225 
va_li°
 
≠
;

226 
	`va_°¨t
(
≠
, 
fú°På
);

228 
begByã
 = (
xvaHód
);

229 
	`l£ek
(
fd
, 
begByã
 + 
nmós
 * 
OxvaH
.
size
, 
SEEK_SET
);

231 
rs
 = 
	`ªad
(
fd
, 
fú°På
, 
OxvaH
.
size
 / 
XVA_NUM
);

233 i‡(
rs
 == -1)

235 
	`¥ötf
("ERROR: UnableÅoÑead xva file\n");

236 
	`≥º‹
("read");

237 
	`exô
(-1);

239 i‡(
rs
 < (
OxvaH
.
size
 / 
XVA_NUM
))

244  (
•å
 = 
	`va_¨g
(
≠
, 
COORD_TYPE
*)Ë!
NULL
 )

246 
rs
 = 
	`ªad
(
fd
, 
•å
, 
OxvaH
.
size
 / 
XVA_NUM
);

248 i‡(
rs
 == -1)

250 
	`¥ötf
("ERROR: UnableÅoÑead xva file\n");

251 
	`≥º‹
("read");

252 
	`exô
(-1);

254 i‡(
rs
 < (
OxvaH
.
size
 / 
XVA_NUM
))

260 
	`va_íd
(
≠
);

262 
	}
}

265 
	$AŒoˇã
(
tŸSize
, 
COORD_TYPE
** 
poöãr
, ...)

267 
va_li°
 
≠
;

268 
COORD_TYPE
** 
•å
;

269 
size
;

271 
size
 = 
tŸSize
 / 
XVA_NUM
;

275 
	`va_°¨t
(
≠
, 
poöãr
);

276 *
poöãr
 = 
	`mÆloc
(
size
);

278 (
•å
 = 
	`va_¨g
(
≠
, 
COORD_TYPE
**)Ë!
NULL
)

280 *
•å
 = 
	`mÆloc
(
size
);

282 
	`va_íd
(
≠
);

283 
	}
}

286 
FILE
* 
	$a›í
(*
fûeName
)

288 
FILE
 *
ofs
;

289 i‡–(
ofs
 = 
	`f›í
(
fûeName
, "w")Ë=
NULL
)

291 
	`≥º‹
("open file");

292 
	`¥ötf
("ERROR: u«bÀÅÿ›í %†fûe\n", 
fûeName
);

293 
	`exô
(-1);

295  
ofs
;

296 
	}
}

299 
	$a˛o£
(
FILE
* 
ofs
)

301 
	`f˛o£
(
ofs
);

302 
	}
}

305 
	$ˇlcCMVñ
(
COORD_TYPE
 *
vxCM
, COORD_TYPE *
vyCM
, COORD_TYPE *
vzCM
)

307 
i
;

309 
i
 = 0; i < 
Nm
; ++i)

311 
vxCM
[
i
] = (
m0
 * 
vx
[0][i] + 
m1
 * vx[1][i]Ë/ 
MtŸ
;

312 
vyCM
[
i
] = (
m0
 * 
vy
[0][i] + 
m1
 * vy[1][i]Ë/ 
MtŸ
;

313 
vzCM
[
i
] = (
m0
 * 
vz
[0][i] + 
m1
 * vz[1][i]Ë/ 
MtŸ
;

315 
	}
}

318 
	$ˇlcAngVñ
(
COORD_TYPE
* 
ox
, COORD_TYPE* 
oy
, COORD_TYPE *
oz
)

320 
i
;

321 
COORD_TYPE
 
r01x
, 
r01y
, 
r01z
, 
v01x
, 
v01y
, 
v01z
, 
dSq
;

323 
dSq
 = 
	`Sqr
(
d
);

325 
i
 = 0; i < 
Nm
; ++i)

328 
r01x
 = 
rx
[0][
i
] -Ñx[1][i];

329 
r01y
 = 
ry
[0][
i
] -Ñy[1][i];

330 
r01z
 = 
rz
[0][
i
] -Ñz[1][i];

337 
v01x
 = 
vx
[0][
i
] - vx[1][i];

338 
v01y
 = 
vy
[0][
i
] - vy[1][i];

339 
v01z
 = 
vz
[0][
i
] - vz[1][i];

341 
	`ve˘Prod
(
r01x
, 
r01y
, 
r01z
, 
v01x
, 
v01y
, 
v01z
, &
ox
[
i
], &
oy
[i], &
oz
[i]);

346 
ox
[
i
] = ox[i] / 
dSq
;

347 
oy
[
i
] = oy[i] / 
dSq
;

348 
oz
[
i
] = oz[i] / 
dSq
;

351 
	}
}

354 
	$ˇlcOrõ¡Ve˘
(
COORD_TYPE
* 
u01x
, COORD_TYPE* 
u01y
, COORD_TYPE *
u01z
)

358 
i
;

360 
i
 = 0; i < 
Nm
; ++i)

362 
u01x
[
i
] = 
rx
[0][i] -Ñx[1][i];

363 
u01y
[
i
] = 
ry
[0][i] -Ñy[1][i];

364 
u01z
[
i
] = 
rz
[0][i] -Ñz[1][i];

372 
u01x
[
i
] /
d
;

373 
u01y
[
i
] /
d
;

374 
u01z
[
i
] /
d
;

376 
	}
}

378 
	$ˇlcCM
(
COORD_TYPE
* 
rCMx
, COORD_TYPE* 
rCMy
, COORD_TYPE* 
rCMz
)

383 
i
;

384 
i
 = 0; i < 
Nm
; ++i)

386 
rCMx
[
i
] = 
m0
 * 
rx
[0][i] + 
m1
 *Ñx[1][i];

387 
rCMy
[
i
] = 
m0
 * 
ry
[0][i] + 
m1
 *Ñy[1][i];

388 
rCMz
[
i
] = 
m0
 * 
rz
[0][i] + 
m1
 *Ñz[1][i];

389 
rCMx
[
i
] /
MtŸ
;

390 
rCMy
[
i
] /
MtŸ
;

391 
rCMz
[
i
] /
MtŸ
;

393 
	}
}

395 
	$ˇlcCMi
(
i
, 
COORD_TYPE
 *
Rx
, COORD_TYPE *
Ry
, COORD_TYPE *
Rz
)

397 *
Rx
 = 
m0
 * 
rx
[0][
i
] + 
m1
 *Ñx[1][i];

398 *
Ry
 = 
m0
 * 
ry
[0][
i
] + 
m1
 *Ñy[1][i];

399 *
Rz
 = 
m0
 * 
rz
[0][
i
] + 
m1
 *Ñz[1][i];

400 *
Rx
 /
MtŸ
;

401 *
Ry
 /
MtŸ
;

402 *
Rz
 /
MtŸ
;

403 
	}
}

406 
	$gëPhii
(
i
, 
COORD_TYPE
* 
fix
, COORD_TYPE* 
fiy
, COORD_TYPE* 
fiz
)

408 *
fix
 = 
Dphix
[
i
];

409 *
fiy
 = 
Dphiy
[
i
];

410 *
fiz
 = 
Dphiz
[
i
];

411 
	}
}

414 
	$mkF‹m©
(* 
fmtSå
)

416 
	`°r˝y
(
fmtSå
, "%.");

417 
	`°rˇt
(
fmtSå
, 
¥ecisi⁄
);

418 
	`°rˇt
(
fmtSå
, "f");

419 
	`°rˇt
(
fmtSå
, " ");

420 
	`°rˇt
(
fmtSå
, "%.");

421 
	`°rˇt
(
fmtSå
, 
¥ecisi⁄
);

422 
	`°rˇt
(
fmtSå
, "f");

423 
	`°rˇt
(
fmtSå
, " ");

424 
	`°rˇt
(
fmtSå
, "%.");

425 
	`°rˇt
(
fmtSå
, 
¥ecisi⁄
);

426 
	`°rˇt
(
fmtSå
, "f");

427 
	`°rˇt
(
fmtSå
, " ");

428 
	`°rˇt
(
fmtSå
, " @ ");

429 
	`°rˇt
(
fmtSå
, "%.");

430 
	`°rˇt
(
fmtSå
, 
¥ecisi⁄
);

431 
	`°rˇt
(
fmtSå
, "f");

432 
	`°rˇt
(
fmtSå
, " $ ");

433 
	`°rˇt
(
fmtSå
, "%d\n");

435 
	}
}

438 
	$mkF‹m©M©h
(* 
fmtSå
)

440 
	`°r˝y
(
fmtSå
, "%.");

441 
	`°rˇt
(
fmtSå
, 
¥ecisi⁄
);

442 
	`°rˇt
(
fmtSå
, "f");

443 
	`°rˇt
(
fmtSå
, " ");

444 
	`°rˇt
(
fmtSå
, "%.");

445 
	`°rˇt
(
fmtSå
, 
¥ecisi⁄
);

446 
	`°rˇt
(
fmtSå
, "f");

447 
	`°rˇt
(
fmtSå
, " ");

448 
	`°rˇt
(
fmtSå
, "%.");

449 
	`°rˇt
(
fmtSå
, 
¥ecisi⁄
);

450 
	`°rˇt
(
fmtSå
, "f");

451 
	`°rˇt
(
fmtSå
, " ");

452 
	`°rˇt
(
fmtSå
, "%.");

453 
	`°rˇt
(
fmtSå
, 
¥ecisi⁄
);

454 
	`°rˇt
(
fmtSå
, "f\n");

456 
	}
}

459 
	$ßve_hëîo
(* 
fûeName
, 
COORD_TYPE
* 
sqπDi•
, * 
mobûeL°
,

460 
mobûes
, 
COORD_TYPE
 
Dt
)

462 
i
, 
mobp
, 
gªyLvl
;

463 
COORD_TYPE
 
L
, 
övL
, 
mónSqr
, 
mónSqπ
, 
ødius
, 
Rmx
, 
Rmy
, 
Rmz
;

464 
fmtSå
[128];

465 
FILE
* 
afs
;

467 
	`¥ötf
("fûeName:%s\n", 
fûeName
);

469 
	`¥ötf
("t0 (chunks): %d\n", 
t0
);

470 
	`¥ötf
("t0 (ªdu˚d unôs)%‡t1 = %f\n", ((
COORD_TYPE
Ë
t0
)*
xvadt
,

471 ((
COORD_TYPE
Ë
t0
 + 
Dt
)*
xvadt
);

474 i‡(!
	`°rcmp
(
fûeName
, "!") || !strcmp(fileName, ""))

478 i‡(
m©hFœg
)

479 
	`mkF‹m©M©h
(
fmtSå
);

481 
	`mkF‹m©
(
fmtSå
);

483 
	`¥ötf
("fmt°r---> %s\n",
fmtSå
);

484 
mónSqr
 = 0.0;

485 
i
 = 0; i < 
Nm
; ++i)

487 
mónSqr
 +
	`Sqr
(
sqπDi•
[
i
]);

490 
mónSqr
 /
Nm
;

491 
mónSqπ
 = 
	`sqπ
(
mónSqr
);

495 
afs
 = 
	`a›í
(
fûeName
);

496 i‡(!
m©hFœg
)

498 
	`Ârötf
(
afs
, ".numAt: 1\n");

500 
	`Ârötf
(
afs
, ".Vﬁ: %f\n", 
Vﬁ
);

502 
L
 = 
	`cbπ
(
Vﬁ
);

503 
övL
 = 1.0 / 
L
;

505 
i
 = 0; i < 
mobûes
; ++i)

510 
mobp
 = 
mobûeL°
[
i
];

511 
Rmx
 = (
rCMt0x
[
mobp
] + 
rCMt1x
[mobp]) / 2.0;

512 
Rmy
 = (
rCMt0y
[
mobp
] + 
rCMt1y
[mobp]) / 2.0;;

513 
Rmz
 = (
rCMt0z
[
mobp
] + 
rCMt1z
[mobp]) / 2.0; ;

515 
Rmx
 = Rmx - 
L
 * 
	`röt
(
övL
 * Rmx);

516 
Rmy
 = Rmy - 
L
 * 
	`röt
(
övL
 * Rmy);

517 
Rmz
 = Rmz - 
L
 * 
	`röt
(
övL
 * Rmz);

518 
ødius
 = 
sqπDi•
[
mobp
] / 
mónSqπ
;

519 
gªyLvl
 = 
ba£Gªy
 + 
	`röt
((
maxGªy
-baseGrey)

520 * ( 1.0 - ((
Rmz
 + 
L
 / 2.0) / L) ));

521 i‡(
m©hFœg
)

522 
	`Ârötf
(
afs
, 
fmtSå
, 
Rmx
, 
Rmy
, 
Rmz
, 
ødius
/
RADFACT
);

524 
	`Ârötf
(
afs
, 
fmtSå
, 
Rmx
, 
Rmy
, 
Rmz
, 
ødius
/
RADFACT
, 
gªyLvl
);

527 
	`a˛o£
(
afs
);

529 
	}
}

532 
	$gëMónPosôi⁄
(
mfd
, 
Nm
, 
t_cur
,

533 
COORD_TYPE
* 
Rx
, COORD_TYPE* 
Ry
, COORD_TYPE* 
Rz
)

539 
i
, 
¬
;

540 
COORD_TYPE
 
Rxtmp
, 
Rytmp
, 
Rztmp
;

541 
NMP
 = 2*
DtTø_món
 + 1;

543 
	`lo›
(
i
, 1, 
Nm
)

545 
Rx
[
i
] = 0.0;

546 
Ry
[
i
] = 0.0;

547 
Rz
[
i
] = 0.0;

550 
¬
 = 
t_cur
 - 
DtTø_món
;Çn <=Å_cur + DtTra_mean; ++nn)

554 i‡(
	`ªadMós
(
mfd
, 
¬
, 
XVA_LIST
, 
NULL
) == 0)

556 
	`¥ötf
("ERROR: UnexpectedÉnd of file\n");

557 
	`¥ötf
("¬:%dÅ_cur: %d\n", 
¬
, 
t_cur
);

558 
	`exô
(-1);

560 
	`lo›
(
i
, 1, 
Nm
)

562 
	`ˇlcCMi
(
i
, &
Rxtmp
, &
Rytmp
, &
Rztmp
);

566 
Rx
[
i
] +
Rxtmp
;

567 
Ry
[
i
] +
Rytmp
;

568 
Rz
[
i
] +
Rztmp
;

572 
	`lo›
(
i
, 1, 
Nm
)

574 
Rx
[
i
] /
NMP
;

575 
Ry
[
i
] /
NMP
;

576 
Rz
[
i
] /
NMP
;

580 
	}
}

583 
	$gëMónAngPos
(
mfd
, 
Nm
, 
t_cur
,

584 
COORD_TYPE
* 
phix
, COORD_TYPE* 
phiy
, COORD_TYPE* 
phiz
)

590 
i
, 
¬
;

591 
COORD_TYPE
 
phixtmp
, 
phiytmp
, 
phiztmp
;

592 
NMP
 = 2*
DtAng_món
 + 1;

594 
	`lo›
(
i
, 1, 
Nm
)

596 
phix
[
i
] = 0.0;

597 
phiy
[
i
] = 0.0;

598 
phiz
[
i
] = 0.0;

601 
¬
 = 
t_cur
 - 
DtAng_món
;Çn <=Å_cur + DtAng_mean; ++nn)

605 i‡(
	`ªadMós
(
mfd
, 
¬
, 
XVA_LIST
, 
NULL
) == 0)

607 
	`¥ötf
("ERROR: UnexpectedÉnd of file\n");

608 
	`¥ötf
("¬:%dÅ_cur: %d\n", 
¬
, 
t_cur
);

609 
	`exô
(-1);

611 
	`lo›
(
i
, 1, 
Nm
)

613 
	`gëPhii
(
i
, &
phixtmp
, &
phiytmp
, &
phiztmp
);

617 
phix
[
i
] +
phixtmp
;

618 
phiy
[
i
] +
phiytmp
;

619 
phiz
[
i
] +
phiztmp
;

623 
	`lo›
(
i
, 1, 
Nm
)

625 
phix
[
i
] /
NMP
;

626 
phiy
[
i
] /
NMP
;

627 
phiz
[
i
] /
NMP
;

631 
	}
}

634 
COORD_TYPE
 
	$sumSqu¨ed
(
COORD_TYPE
* 
sqπDi•
, 
Nm
)

636 
i
;

637 
COORD_TYPE
 
sum
 = 0.0;

638 
i
 = 0; i < 
Nm
; ++i)

640 
sum
 +
	`Sqr
(
sqπDi•
[
i
]);

642  
sum
;

643 
	}
}

645 
	$maö
(
¨gc
, ** 
¨gv
)

647 
mfd
, 
nmbyãs
;

648 
i
, 
t1
, 
k
 = 0;

649 
mobûesTø
 = 0, 
mobûesAng
 = 0;

651 
COORD_TYPE
 *
uxt0
, *
uyt0
, *
uzt0
, *
uxt1
, *
uyt1
, *
uzt1
, 
lc
 = 0.0;

652 
COORD_TYPE
 *
phô0x
, *
phô0y
, *
phô0z
, *
phô1x
, *
phô1y
, *
phô1z
;

653 
COORD_TYPE
 *
DR
, *
DPhi
, 
sumSqrMob
 = 0.0;

654 
COORD_TYPE
 
mobûeSqrDi•
 = 0.0;

655 *
mobûeTøL°
, *
mobûeAngL°
;

659 
	`deÁu…s
();

662 
	`¨gs
(
¨gc
,
¨gv
);

664 
	`ªadP¨s
(
xv≠¨sFûe
);

666 
	`¥ötf
("Ród fﬁlowög vÆue†‰om %s:\n", 
xv≠¨sFûe
);

667 
	`¥ötf
("m0:%‡m1:%‡d:%f\n", 
m0
, 
m1
, 
d
);

668 
	`¥ötf
("Vﬁ:%‡T:%f\n", 
Vﬁ
, 
T
);

669 
	`¥ötf
("Usög %†a†xv®fûe\n", 
öputFûe
);

671 
	`£tFœgs
();

673 
mfd
 = 
	`›íMósFûe
(
öputFûe
);

675 
	`¥ötf
("dt: %‡xva°ïs: %d\n", 
dt
, 
OxvaH
.
ßveSãps
);

678 
	`¥ötf
("size: %d\n", 
OxvaH
.
size
);

679 
Nm
 = 
OxvaH
.
size
 / 
XVA_NUM
 / (
COORD_TYPE
);

680 
MtŸ
 = 
m0
 + 
m1
;

681 
xvadt
 = 
OxvaH
.
ßveSãps
 * 
dt
;

683 
	`¥ötf
("Nm: %d MtŸ: %f\n", 
Nm
, 
MtŸ
);

685 
	`AŒoˇã
(
OxvaH
.
size
, 
XVA_ALST
, 
NULL
);

706 
nmbyãs
 = (
COORD_TYPE
)*
Nm
;

710 
uxt0
 = 
	`mÆloc
(
nmbyãs
);

711 
uyt0
 = 
	`mÆloc
(
nmbyãs
);

712 
uzt0
 = 
	`mÆloc
(
nmbyãs
);

713 
uxt1
 = 
	`mÆloc
(
nmbyãs
);

714 
uyt1
 = 
	`mÆloc
(
nmbyãs
);

715 
uzt1
 = 
	`mÆloc
(
nmbyãs
);

718 
rCMt0x
 = 
	`mÆloc
(
nmbyãs
);

719 
rCMt0y
 = 
	`mÆloc
(
nmbyãs
);

720 
rCMt0z
 = 
	`mÆloc
(
nmbyãs
);

721 
rCMt1x
 = 
	`mÆloc
(
nmbyãs
);

722 
rCMt1y
 = 
	`mÆloc
(
nmbyãs
);

723 
rCMt1z
 = 
	`mÆloc
(
nmbyãs
);

726 
phô0x
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

727 
phô0y
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

728 
phô0z
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

729 
phô1x
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

730 
phô1y
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

731 
phô1z
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

735 
DR
 = 
	`mÆloc
(
nmbyãs
);

736 
DPhi
 = 
	`mÆloc
(
nmbyãs
);

741 
mobûeTøL°
 = 
	`mÆloc
(
nmbyãs
);

742 
mobûeAngL°
 = 
	`mÆloc
(
nmbyãs
);

745 
i
=0; i < 
Nm
; ++i)

747 
mobûeTøL°
[
i
] = 0;

748 
mobûeAngL°
[
i
] = 0;

751 
	`¥ötf
("Begin...\n");

758 i‡(
hëîoTøFœg
)

767 
	`gëMónPosôi⁄
(
mfd
, 
Nm
, 
t0
, 
rCMt0x
, 
rCMt0y
, 
rCMt0z
);

769 
t1
 = 
t0
 + 
DtTø
;

779 
	`gëMónPosôi⁄
(
mfd
, 
Nm
, 
t1
, 
rCMt1x
, 
rCMt1y
, 
rCMt1z
);

783 
i
 = 0; i < 
Nm
; ++i)

786 
DR
[
i
] = 
	`sqπ
(
	`Sqr
(
rCMt0x
[i] - 
rCMt1x
[i]) +

787 
	`Sqr
(
rCMt0y
[
i
] - 
rCMt1y
[i]) +

788 
	`Sqr
(
rCMt0z
[
i
] - 
rCMt1z
[i]));

792 
sumSqrMob
 = 0.0;

793 
mobûeSqrDi•
 = 
mobTøPîc
 * 
	`sumSqu¨ed
(
DR
, 
Nm
);

794 
k
 = 1; k <
Nm
; ++k)

796 
lc
 = 
	`sqπ
(
mobûeSqrDi•
 / ((Ë
k
));

797 
mobûesTø
 = 0;

798 
sumSqrMob
 = 0.0;

799 
i
 = 0; i < 
Nm
; ++i)

801 i‡(
DR
[
i
] > 
lc
)

803 
mobûeTøL°
[
mobûesTø
] = 
i
;

804 
sumSqrMob
 +
	`Sqr
(
DR
[
i
]);

805 ++
mobûesTø
;

806 i‡(
sumSqrMob
 > 
mobûeSqrDi•
)

810 i‡(
sumSqrMob
 > 
mobûeSqrDi•
)

814 i‡(
sumSqrMob
 < 
mobûeSqrDi•
)

815 
	`¥ötf
("FAILED: Thereáren'tÉnough mobileÖarticles\n");

818 
	`¥ötf
("n. o‡mobûê∑πi˛es(k=%d): %d\n",
k
, 
mobûesTø
);

819 
	`¥ötf
("mobTraPerc: %f sumSqrMob: %f mobilrSqrDisp: %f\n",

820 
mobTøPîc
, 
sumSqrMob
, 
mobûeSqrDi•
);

821 
	`¥ötf
("lc: %f\n", 
lc
);

822 
	`ßve_hëîo
(
hëîoTøFûe
, 
DR
, 
mobûeTøL°
, 
mobûesTø
, 
DtTø
);

829 i‡(
hëîoAngFœg
)

831 
	`gëMónAngPos
(
mfd
, 
Nm
, 
t0
, 
phô0x
, 
phô0y
, 
phô0z
);

834 
t1
 = 
t0
 + 
DtAng
;

843 
	`gëMónAngPos
(
mfd
, 
Nm
, 
t1
, 
phô1x
, 
phô1y
, 
phô1z
);

845 
i
 = 0; i < 
Nm
; ++i)

848 
DPhi
[
i
] = (180.0/
pi
)*
	`sqπ
(
	`Sqr
(
phô0x
[i] - 
phô1x
[i]) +

849 
	`Sqr
(
phô0y
[
i
] - 
phô1y
[i]) +

850 
	`Sqr
(
phô0z
[
i
] - 
phô1z
[i]));

852 
sumSqrMob
 = 0.0;

853 
mobûeSqrDi•
 = 
mobAngPîc
 * 
	`sumSqu¨ed
(
DPhi
, 
Nm
);

854 
k
 = 1; k <
Nm
; ++k)

856 
lc
 = 
	`sqπ
(
mobûeSqrDi•
 / ((Ë
k
));

857 
mobûesAng
 = 0;

858 
sumSqrMob
 = 0.0;

859 
i
 = 0; i < 
Nm
; ++i)

861 i‡(
DPhi
[
i
] > 
lc
)

863 
mobûeAngL°
[
mobûesAng
] = 
i
;

864 
sumSqrMob
 +
	`Sqr
(
DPhi
[
i
]);

865 ++
mobûesAng
;

866 i‡(
sumSqrMob
 > 
mobûeSqrDi•
)

870 i‡(
sumSqrMob
 > 
mobûeSqrDi•
)

878 i‡(
sumSqrMob
 < 
mobûeSqrDi•
)

879 
	`¥ötf
("FAILED: Thereáren'tÉnough mobileÖarticles\n");

882 
	`¥ötf
("n. o‡™guœ∏mobûê∑πi˛es(k=%d): %d\n",
k
, 
mobûesAng
);

883 
	`¥ötf
("mobAngPerc: %f sumSqrMob: %f mobilrSqrDisp: %f\n",

884 
mobAngPîc
, 
sumSqrMob
, 
mobûeSqrDi•
);

885 
	`¥ötf
("lc: %f\n", 
lc
);

886 
	`ßve_hëîo
(
hëîoAngFûe
, 
DPhi
, 
mobûeAngL°
, 
mobûesAng
, 
DtAng
);

896 
	`˛o£
(
mfd
);

897 
	}
}

	@hetero.h

2 
	ghëîoAngFûe
[128], 
	ghëîoTøFûe
[128];

4 
	ghëîoTøFœg
 = 1, 
	ghëîoAngFœg
 = 1, 
	gm©hFœg
 = 0;

7 
	gba£Gªy
 = 20, 
	gmaxGªy
 = 225;

8 
	ggªyLevñ
 = 20, 
	g¥ötEvîy
, 
	gtRun
, 
	gDtTø
, 
	gDtAng
, 
	gDtTø_món
 = 0, 
	gDtAng_món
 = 0;

10 
	gt0
;

11 
COORD_TYPE
 
	gm0
, 
	gm1
, 
	gd
, 
	gVﬁ
, 
	gmobTøPîc
, 
	gmobAngPîc
;

12 
COORD_TYPE
 
	gMtŸ
, 
	gxvadt
, 
	gdt
, 
	gdãè
, 
	gT
;

14 
COORD_TYPE
 
	gRADFACT
 = 4.0, *
	grCMt0x
, *
	grCMt0y
,

15 *
	grCMt0z
, *
	grCMt1x
, *
	grCMt1y
, *
	grCMt1z
;

19 
	göputFûe
[
NAME_LENGTH
], 
	gxv≠¨sFûe
[NAME_LENGTH];

22 * 
	gœ°Jump
;

23 
	g¥ecisi⁄
[64];

24 
	gNm
;

26 
COORD_TYPE
 
	gpi
;

29 
sögÀP¨
 
	gOxvaP¨
[] = {

44 {"ba£Gªy", &
ba£Gªy
, 
INT
},

45 {"maxGªy", &
maxGªy
, 
INT
},

46 {"ødFa˘", &
RADFACT
, 
CT
},

47 {"gªyLevñ", &
gªyLevñ
, 
INT
},

48 {"öputFûe", &
öputFûe
, 
STR
},

49 {"hëîoTø", 
hëîoTøFûe
, 
STR
},

50 {"hëîoAng", 
hëîoAngFûe
, 
STR
},

51 {"t0", &
t0
, 
INT
},

52 {"DtAng",&
DtAng
, 
INT
},

53 {"DtTø",&
DtTø
, 
INT
},

54 {"mobTøPîc", &
mobTøPîc
, 
CT
},

55 {"mobAngPîc", &
mobAngPîc
, 
CT
},

56 {"DtTø_món", &
DtTø_món
, 
INT
},

57 {"DtAng_món", &
DtAng_món
, 
INT
},

58 {"¥ec", 
¥ecisi⁄
, 
STR
},

59 {"m0", &
m0
, 
CT
},

60 {"m1", &
m1
, 
CT
},

61 {"d", &
d
, 
CT
},

62 {"dt", &
dt
, 
CT
},

63 {"Vﬁ", &
Vﬁ
, 
CT
},

64 {"¥ötEvîy", &
¥ötEvîy
, 
INT
},

67 {"", 
NULL
, 0}

	@init.c

1 
	~<mdsimul.h
>

2 
	#SIMUL


	)

9 #ifde‡
MD_LOADMESH


10 
	gmesh
[100][150][3];

11 
	g¡rùl
[100];

15 
f‹˚C€ff
();

17 
ENDSIM
;

18 
msgSåA
[
MSG_LEN
];

21 **
	gøŒx
, **
	gøŒy
, **
	gøŒz
, **
	gFÆlx
, **
	gFÆly
, **
	gFÆlz
,

22 **
	gøŒx_ﬁd
, **
	gøŒy_ﬁd
, **
	gøŒz_ﬁd
, *
	g©ch¨ge
, **
	gvxﬁd
, **
	gvyﬁd
, **
	gvzﬁd
;

23 **
	gncut
;

24 *
	gFc€ff
[3];

33 
COORD_TYPE
 
pi
, 
s1t
, 
Vﬁ1t
, 
L
, 
övL
, 
s1p
, 
EÃc
, 
PÃc
;

34 
COORD_TYPE
 
Vc
, 
V
, 
W
, 
K
, 
WC
, 
T1xx
, 
T1yy
, 
T1zz
,

35 
T1xx
, 
T1yy
, 
T1zz
, 
T1xy
, 
T1yz
, 
T1zx
, 
WCxy
, 
WCyz
, 
WCzx
,

36 
WCxx
, 
WCyy
, 
WCzz
, 
Wxx
, 
Wyy
, 
Wzz
,

37 
Wxy
, 
Wyz
, 
Wzx
, 
Pxx
, 
Pyy
, 
Pzz
, 
Pxy
, 
Pyz
, 
Pzx
, 
Wm
, 
Wmxx
, 
Wmyy
, 
Wmzz
,

38 
Wmxy
, 
Wmyz
, 
Wmzx
, 
Pmxx
, 
Pmyy
, 
Pmzz
, 
Pmxy
, 
Pmyz
, 
Pmzx
, 
T1mxy
,

39 
P©xy
, 
P©yz
, 
P©zx
, 
P©xx
, 
P©yy
, 
P©zz
,

40 
T1myz
, 
T1mzx
, 
T1mxx
, 
T1myy
, 
T1mzz
;

41 
COORD_TYPE
 
MtŸ
;

43 *
hód
, *
li°
, *
m≠
;

44 
NCñl
, 
m≠Size
, 
M
;

47 
COORD_TYPE
 
di•Hi
;

48 **
√brTab
, 
√brNow
, 
√brTabLí
, 
√brTabMax
;

51 
COORD_TYPE
 *
ox
, *
oy
, *
oz
;

53 
COORD_TYPE
 *
ux
, *
uy
, *
uz
;

54 
COORD_TYPE
 *
Rmx
, *
Rmy
, *
Rmz
;

57 
	$ve˘Prod
(
COORD_TYPE
 
r1x
, COORD_TYPE 
r1y
, COORD_TYPE 
r1z
,

58 
COORD_TYPE
 
r2x
, COORD_TYPE 
r2y
, COORD_TYPE 
r2z
,

59 
COORD_TYPE
* 
r3x
, COORD_TYPE* 
r3y
, COORD_TYPE* 
r3z
)

63 *
r3x
 = 
r1y
 * 
r2z
 - 
r1z
 * 
r2y
;

64 *
r3y
 = 
r1z
 * 
r2x
 - 
r1x
 * 
r2z
;

65 *
r3z
 = 
r1x
 * 
r2y
 - 
r1y
 * 
r2x
;

66 
	}
}

67 
	$check_di°™˚s
()

69 
di°
;

70 
i
, 
a
, 
«
, 
baddi°
=0;

71 
i
=0; i < 
O∑øms
.
∑∫um
; i++)

73 
a
=0;á < 
NA
;á++)

75 
«
 = (
a
+1==
NA
)?0:a+1;

76 
di°
 = 
	`sqπ
–
	`Sqr
(
rx
[
a
][
i
] -Ñx[
«
][i]Ë+ Sqr(
ry
[a][i] -Ñy[na][i]) +

77 
	`Sqr
(
rz
[
a
][
i
] -Ñz[
«
][i]) );

78 i‡(
	`Ábs
(
di°
 - 
O∑øms
.
Düm
*
	`sqπ
(3.0)*0.5) > 1E-8)

80 
	`¥ötf
("WRONG DISTANCE di°: %‡i=%d bëwì¿©om†%dánd %d\n", 
di°
, 
i
, 
a
, 
«
);

81 
baddi°
 = 1;

86 i‡(!
baddi°
)

87 
	`¥ötf
("[Sã∞N.%d] TuâêÀ di°™zês⁄ÿc‹ªâe\n", 
O∑øms
.
curSãp
);

88 
	}
}

90 
	$FCC
(
Nm
, 
COORD_TYPE
 
D
, COORD_TYPE* 
m
)

107 
Nc
;

108 
COORD_TYPE
 
di°
, 
n‹m
, 
d0x
, 
d0y
, 
d0z
, 
d1x
, 
d1y
, 
d1z
, 
d2x
, 
d2y
, 
d2z
;

109 
COORD_TYPE
 
iRoŸ3
, 
sRoŸ3
;

110 
COORD_TYPE
 
Cñl
, 
Cñl2
, 
rxCm
, 
ryCm
, 
rzCm
, 
MtŸ
, 
Á˘
, 
Á˘2
;

111 
a
, 
i
, 
ix
, 
iy
, 
iz
, 
úef
, 
ii
;

112 
COORD_TYPE
 
bx
[4], 
by
[4], 
bz
[4];

113 
COORD_TYPE
 
ex
[4], 
ey
[4], 
ez
[4];

115 
COORD_TYPE
 
e2x
[4], 
e2y
[4], 
e2z
[4];

122 
L
 = 
	`cbπ
(
Vﬁ
);

123 
Nc
 = 
	`˚û
–
	`pow
–((
COORD_TYPE
)
Nm
)/4.0, 1.0/3.0 ) );

124 
MtŸ
 = 
m
[0] + m[1];

127 
Cñl
 = 
L
 / ((
COORD_TYPE
Ë
Nc
);

128 
Cñl2
 = 0.5 * 
Cñl
;

131 
iRoŸ3
 = 1.0 / 
	`sqπ
(3.0);

132 
sRoŸ3
 = 
	`sqπ
(3.0);

136 
bx
[0] = 0.0;

137 
by
[0] = 0.0;

138 
bz
[0] = 0.0;

139 
ex
[0] = 
iRoŸ3
;

140 
ey
[0] = 
iRoŸ3
;

141 
ez
[0] = 
iRoŸ3
;

144 
e2x
[0] = 
iRoŸ3
 * (
	`Sqr
(iRoot3) + 1);

145 
e2y
[0] = 
iRoŸ3
 * (
	`Sqr
(iRoot3) - 1);

146 
e2z
[0] = 
iRoŸ3
 * (
	`Sqr
(iRoot3) - 1);

147 
n‹m
 = 
	`sqπ
(
	`Sqr
(
e2x
[0]Ë+ Sqr(
e2y
[0]Ë+ Sqr(
e2z
[0]));

148 
e2x
[0] /
n‹m
;

149 
e2y
[0] /
n‹m
;

150 
e2z
[0] /
n‹m
;

153 
bx
[1] = 
Cñl2
;

154 
by
[1] = 
Cñl2
;

155 
bz
[1] = 0.0;

156 
ex
[1] = 
iRoŸ3
;

157 
ey
[1] = -
iRoŸ3
;

158 
ez
[1] = -
iRoŸ3
;

160 
e2x
[1] = 
iRoŸ3
*–
	`Sqr
(iRoot3) - 1);

161 
e2y
[1] = 
iRoŸ3
*(-
	`Sqr
(iRoot3) + 1);

162 
e2z
[1] = 
iRoŸ3
*(-
	`Sqr
(iRoot3) - 1);

163 
n‹m
 = 
	`sqπ
(
	`Sqr
(
e2x
[1]Ë+ Sqr(
e2y
[1]Ë+ Sqr(
e2z
[1]));

164 
e2x
[1] /
n‹m
;

165 
e2y
[1] /
n‹m
;

166 
e2z
[1] /
n‹m
;

169 
bx
[2] = 0.0;

170 
by
[2] = 
Cñl2
;

171 
bz
[2] = 
Cñl2
;

172 
ex
[2] = -
iRoŸ3
;

173 
ey
[2] = 
iRoŸ3
;

174 
ez
[2] = -
iRoŸ3
;

175 
e2x
[2] = -
iRoŸ3
*(
	`Sqr
(iRoot3)+1);

176 
e2y
[2] = 
iRoŸ3
*(
	`Sqr
(iRoot3)-1);

177 
e2z
[2] = 
iRoŸ3
*(-
	`Sqr
(iRoot3)+1);

178 
n‹m
 = 
	`sqπ
(
	`Sqr
(
e2x
[2]Ë+ Sqr(
e2y
[2]Ë+ Sqr(
e2z
[2]));

179 
e2x
[2] /
n‹m
;

180 
e2y
[2] /
n‹m
;

181 
e2z
[2] /
n‹m
;

185 
bx
[3] = 
Cñl2
;

186 
by
[3] = 0.0;

187 
bz
[3] = 
Cñl2
;

188 
ex
[3] = -
iRoŸ3
;

189 
ey
[3] = -
iRoŸ3
;

190 
ez
[3] = 
iRoŸ3
;

191 
e2x
[3] = (1 - 
	`Sqr
(
iRoŸ3
)) * iRoot3;

192 
e2y
[3] = (1 - 
	`Sqr
(
iRoŸ3
)) * iRoot3;

193 
e2z
[3] = (1 + 
	`Sqr
(
iRoŸ3
)) * iRoot3;

194 
n‹m
 = 
	`sqπ
(
	`Sqr
(
e2x
[3]Ë+ Sqr(
e2y
[3]Ë+ Sqr(
e2z
[3]));

195 
e2x
[3] /
n‹m
;

196 
e2y
[3] /
n‹m
;

197 
e2z
[3] /
n‹m
;

200 
úef
=0; iref < 4 ; iref++)

202 
	`¥ötf
("úef=%d sˇœr:%f\n", 
úef
, 
ex
[úef]*
e2x
[úef]+ 
ey
[úef]*
e2y
[iref] +

203 
ez
[
úef
]*
e2z
[iref]);

207 
ii
 = 0;

209 
iz
 = 0; iz < 
Nc
; iz++)

211 
iy
 = 0; iy < 
Nc
; iy++)

213 
ix
 = 0; ix < 
Nc
; ix++)

215 
úef
 = 0; iref < 4; iref++)

218 i‡((
ii
 + 
úef
Ë>
Nm
) ;

226 
rxCm
 = 
bx
[
úef
] + 
Cñl
 * ((
COORD_TYPE
Ë
ix
);

227 
ryCm
 = 
by
[
úef
] + 
Cñl
 * ((
COORD_TYPE
Ë
iy
);

228 
rzCm
 = 
bz
[
úef
] + 
Cñl
 * ((
COORD_TYPE
Ë
iz
);

232 
Á˘
 = - 
D
 * 0.5;

234 
d0x
 = 
ex
[
úef
] * 
Á˘
;

235 
d0y
 = 
ey
[
úef
] * 
Á˘
;

236 
d0z
 = 
ez
[
úef
] * 
Á˘
;

240 
Á˘
 = 
D
 * 0.25;

241 
Á˘2
 = 
D
 * 
sRoŸ3
 * 0.25;

242 
d1x
 = 
ex
[
úef
] * 
Á˘
 + 
e2x
[úef] * 
Á˘2
;

243 
d1y
 = 
ey
[
úef
] * 
Á˘
 + 
e2y
[úef] * 
Á˘2
;

244 
d1z
 = 
ez
[
úef
] * 
Á˘
 + 
e2z
[úef] * 
Á˘2
;

248 
Á˘2
 = -
D
 * 
sRoŸ3
 * 0.25;

249 
d2x
 = 
ex
[
úef
] * 
Á˘
 + 
e2x
[úef] * 
Á˘2
;

250 
d2y
 = 
ey
[
úef
] * 
Á˘
 + 
e2y
[úef] * 
Á˘2
;

251 
d2z
 = 
ez
[
úef
] * 
Á˘
 + 
e2z
[úef] * 
Á˘2
;

256 
rx
[0][
ii
 + 
úef
] = 
rxCm
 + 
d0x
;

257 
rx
[1][
ii
 + 
úef
] = 
rxCm
 + 
d1x
;

258 
rx
[2][
ii
 + 
úef
] = 
rxCm
 + 
d2x
;

260 
ry
[0][
ii
 + 
úef
] = 
ryCm
 + 
d0y
;

261 
ry
[1][
ii
 + 
úef
] = 
ryCm
 + 
d1y
;

262 
ry
[2][
ii
 + 
úef
] = 
ryCm
 + 
d2y
;

264 
rz
[0][
ii
 + 
úef
] = 
rzCm
 + 
d0z
;

265 
rz
[1][
ii
 + 
úef
] = 
rzCm
 + 
d1z
;

266 
rz
[2][
ii
 + 
úef
] = 
rzCm
 + 
d2z
;

269 
ii
 = ii + 4;

279 
i
=0; i < 
Nm
; i++)

281 
a
=0;á < 
NA
;á++)

284 
rx
[
a
][
i
] =Ñx[a][i] - 0.5 * 
L
;

285 
ry
[
a
][
i
] =Ñy[a][i] - 0.5 * 
L
;

286 
rz
[
a
][
i
] =Ñz[a][i] - 0.5 * 
L
;

293 
i
=0; i < 
Nm
; i++)

295 
di°
 = 
	`sqπ
–
	`Sqr
(
rx
[0][
i
] -Ñx[1][i]Ë+ Sqr(
ry
[0][i] -Ñy[1][i]) +

296 
	`Sqr
(
rz
[0][
i
] -Ñz[1][i]) );

297 
	`¥ötf
("di°1: %f\n", 
di°
);

298 
di°
 = 
	`sqπ
–
	`Sqr
(
rx
[1][
i
] -Ñx[2][i]Ë+ Sqr(
ry
[1][i] -Ñy[2][i]) +

299 
	`Sqr
(
rz
[1][
i
] -Ñz[2][i]) );

300 
	`¥ötf
("di°2: %f\n", 
di°
);

301 
di°
 = 
	`sqπ
–
	`Sqr
(
rx
[2][
i
] -Ñx[0][i]Ë+ Sqr(
ry
[2][i] -Ñy[0][i]) +

302 
	`Sqr
(
rz
[2][
i
] -Ñz[0][i]) );

303 
	`¥ötf
("di°3: %f\n", 
di°
);

305 
	`exô
(1);

306 
	}
}

342 
COORD_TYPE
 
	$ønf
()

347  
	`ønd
(Ë/ ( (
COORD_TYPE
Ë
RAND_MAX
 );

348 
	}
}

351 
COORD_TYPE
 
	$gauss
()

369 
COORD_TYPE
 
a1
=3.949846138, 
a3
 = 0.252408784, 
a5
 = 0.076542912,

370 
a7
 = 0.008355968, 
a9
 = 0.029899776;

371 
COORD_TYPE
 
sum
, 
r
, 
r2
;

372 
i
;

374 
sum
 = 0.0;

376 
i
=0; i < 12; i++)

378 
sum
 = sum + 
	`ønf
();

381 
r
 = ( 
sum
 - 6.0 ) / 4.0;

382 
r2
 = 
r
 *Ñ;

384  (((–
a9
 * 
r2
 + 
a7
 ) *Ñ2 + 
a5
 ) *Ñ2 + 
a3
 ) *Ñ2 + 
a1
 ) * 
r
;

385 
	}
}

387 
	$bigauss
(
sigma1
, 
sigma2
, 
c12
, * 
chsi1p
, * 
chsi2p
)

393 
chsi1
, 
chsi2
;

395 
chsi1
 = 
	`gauss
();

396 
chsi2
 = 
	`gauss
();

397 *
chsi1p
 = 
sigma1
 * 
chsi1
;

398 *
chsi2p
 = 
sigma2
 * ( 
c12
 * 
chsi1
 + 
	`sqπ
(1 - 
	`Sqr
(c12))*
chsi2
);

399 
	}
}

401 
CoM
(
i
, 
COORD_TYPE
* 
rxcm
, COORD_TYPE* 
rycm
, COORD_TYPE* 
rzcm
);

402 
CoMV
(
i
, 
COORD_TYPE
* 
vxcm
, COORD_TYPE* 
vycm
, COORD_TYPE* 
vzcm
);

404 
	$ª£tCM
(
Nm
)

406 
COORD_TYPE
 
sumx
, 
sumy
, 
sumz
, 
RCMx
, 
RCMy
, 
RCMz
, 
Rx
, 
Ry
, 
Rz
;

407 
COORD_TYPE
 
Vx
, 
Vy
, 
Vz
, *
m
;

408 
i
, 
a
;

410 
m
 = 
O∑øms
.m;

412 
sumx
 = 0.0;

413 
sumy
 = 0.0;

414 
sumz
 = 0.0;

416 
i
=0; i < 
Nm
; i++)

419 
	`CoMV
(
i
, &
Vx
, &
Vy
, &
Vz
);

420 
sumx
 = sumx + 
Vx
;

421 
sumy
 = sumy + 
Vy
;

422 
sumz
 = sumz + 
Vz
;

425 
sumx
 = sumx / ((
COORD_TYPE
Ë
Nm
 );

426 
sumy
 = sumy / ((
COORD_TYPE
Ë
Nm
 );

427 
sumz
 = sumz / ((
COORD_TYPE
Ë
Nm
 );

429 
	`¥ötf
("SUM (Nm=%d %.15f,%.15f,%.15f\n)\n", 
Nm
, 
sumx
, 
sumy
, 
sumz
);

430 
Px
=0.0; 
Py
=0.0; 
Pz
=0.0;

433 
i
=0; i < 
Nm
; i++)

435 
vx
[0][
i
] = vx[0][i] - 
sumx
;

436 
vx
[1][
i
] = vx[1][i] - 
sumx
;

437 
vx
[2][
i
] = vx[2][i] - 
sumx
;

438 
vy
[0][
i
] = vy[0][i] - 
sumy
;

439 
vy
[1][
i
] = vy[1][i] - 
sumy
;

440 
vy
[2][
i
] = vy[2][i] - 
sumy
;

441 
vz
[0][
i
] = vz[0][i] - 
sumz
;

442 
vz
[1][
i
] = vz[1][i] - 
sumz
;

443 
vz
[2][
i
] = vz[2][i] - 
sumz
;

451 
RCMx
 = 0.0;

452 
RCMy
 = 0.0;

453 
RCMz
 = 0.0;

455 
i
=0; i < 
Nm
; i++)

457 
	`CoM
(
i
, &
Rx
, &
Ry
, &
Rz
);

458 
RCMx
 +
Rx
;

459 
RCMy
 +
Ry
;

460 
RCMz
 +
Rz
;

463 
RCMx
 /(
COORD_TYPE
Ë
Nm
;

464 
RCMy
 /(
COORD_TYPE
Ë
Nm
;

465 
RCMz
 /(
COORD_TYPE
Ë
Nm
;

467 
i
=0; i < 
Nm
; i++)

469 
a
=0;á < 
NA
;á++)

471 
rx
[
a
][
i
] -
RCMx
;

472 
ry
[
a
][
i
] -
RCMy
;

473 
rz
[
a
][
i
] -
RCMz
;

476 
√brNow
=1;

477 
	}
}

480 
	$comvñ
 (
Nm
, 
COORD_TYPE
 
ãmp
, COORD_TYPE 
m
[
NA
])

502 
COORD_TYPE
 
rTemp
, 
sumx
, 
sumy
, 
sumz
, 
MtŸ
, 
RCMx
, 
RCMy
, 
RCMz
, 
Rx
, 
Ry
, 
Rz
;

504 
i
, 
a
;

506 
MtŸ
 = 
m
[0] + m[1] + m[2];

507 
rTemp
 = 
	`sqπ
(
ãmp
 / 
MtŸ
);

510 
i
=0; i < 
Nm
; i++)

523 
vx
[0][
i
] = 
rTemp
 * 
	`gauss
();

524 
vx
[1][
i
] = vx[0][i];

525 
vx
[2][
i
] = vx[0][i];

526 
vy
[0][
i
] = 
rTemp
 * 
	`gauss
();

527 
vy
[1][
i
] = vy[0][i];

528 
vy
[2][
i
] = vy[0][i];

529 
vz
[0][
i
] = 
rTemp
 * 
	`gauss
();

530 
vz
[1][
i
] = vz[0][i];

531 
vz
[2][
i
] = vz[0][i];

540 
sumx
 = 0.0;

541 
sumy
 = 0.0;

542 
sumz
 = 0.0;

544 
i
=0; i < 
Nm
; i++)

547 
sumx
 = sumx + 
vx
[0][
i
];

548 
sumy
 = sumy + 
vy
[0][
i
];

549 
sumz
 = sumz + 
vz
[0][
i
];

552 
sumx
 = sumx / ((
COORD_TYPE
Ë
Nm
 );

553 
sumy
 = sumy / ((
COORD_TYPE
Ë
Nm
 );

554 
sumz
 = sumz / ((
COORD_TYPE
Ë
Nm
 );

558 
i
=0; i < 
Nm
; i++)

560 
vx
[0][
i
] = vx[0][i] - 
sumx
;

561 
vx
[1][
i
] = vx[1][i] - 
sumx
;

562 
vx
[2][
i
] = vx[2][i] - 
sumx
;

563 
vy
[0][
i
] = vy[0][i] - 
sumy
;

564 
vy
[1][
i
] = vy[1][i] - 
sumy
;

565 
vy
[2][
i
] = vy[2][i] - 
sumy
;

566 
vz
[0][
i
] = vz[0][i] - 
sumz
;

567 
vz
[1][
i
] = vz[1][i] - 
sumz
;

568 
vz
[2][
i
] = vz[2][i] - 
sumz
;

576 
RCMx
 = 0.0;

577 
RCMy
 = 0.0;

578 
RCMz
 = 0.0;

580 
i
=0; i < 
Nm
; i++)

582 
	`CoM
(
i
, &
Rx
, &
Ry
, &
Rz
);

583 
RCMx
 +
Rx
;

584 
RCMy
 +
Ry
;

585 
RCMz
 +
Rz
;

588 
RCMx
 /(
COORD_TYPE
Ë
Nm
;

589 
RCMy
 /(
COORD_TYPE
Ë
Nm
;

590 
RCMz
 /(
COORD_TYPE
Ë
Nm
;

592 
i
=0; i < 
Nm
; i++)

594 
a
=0;á < 
NA
;á++)

596 
rx
[
a
][
i
] -
RCMx
;

597 
ry
[
a
][
i
] -
RCMy
;

598 
rz
[
a
][
i
] -
RCMz
;

601 
	`köë
(
O∑øms
.
∑∫um
, 
vx
, 
vy
, 
vz
, 0);

602 
	`¥ötf
("ãmp:%‡íîgü cöëiˇ:%‡ãmp_mós:%f\n",
ãmp
, 
K
, 2.0 * K / (6.0 * 
O∑øms
.
∑∫um
 - 3.0));

606 
	}
}

609 
	$™gvñ
 (
Nm
, 
COORD_TYPE
 
ãmp
, COORD_TYPE 
m
[
NA
], COORD_TYPE 
d
)

634 
COORD_TYPE
 
öît
;

636 
COORD_TYPE
 
n‹m
, 
dŸ
, 
osq
, 
o
, 
món
;

637 
COORD_TYPE
 
xisq
, 
xi1
, 
xi2
, 
xi
;

638 
COORD_TYPE
 
d01x
, 
d01y
, 
d01z
;

639 
COORD_TYPE
 
d0x
, 
d0y
, 
d0z
, 
d1x
, 
d1y
, 
d1z
;

640 
COORD_TYPE
 
d0Sq
, 
d1Sq
, 
MtŸ
;

641 
COORD_TYPE
 
oVd0_x
, 
oVd0_y
, 
oVd0_z
, 
oVd1_x
, 
oVd1_y
, 
oVd1_z
;

642 
COORD_TYPE
 
ox
, 
oy
, 
oz
;

643 
COORD_TYPE
 
øb
, 
øbSq
, 
rx0
, 
ry0
, 
rz0
;

644 
COORD_TYPE
 
rx1
, 
ry1
, 
rz1
;

645 
COORD_TYPE
 
rx01
, 
ry01
, 
rz01
;

646 
i
;

650 
L
 = 
	`cbπ
(
Vﬁ
);

651 
övL
 = 1.0 / 
L
;

653 
MtŸ
 = 
m
[0] + m[1] + m[2];

656 
d0Sq
 = 
	`Sqr
(
d
 * 
m
[1] / 
MtŸ
);

659 
d1Sq
 = 
	`Sqr
(
d
 * 
m
[0] / 
MtŸ
);

661 
öît
 = 
m
[0] * 
d0Sq
 + m[1] * 
d1Sq
;

663 
món
 = 2.0 * 
ãmp
 / 
öît
;

665 
	`lo›
(
i
, 1, 
Nm
)

667 
rx0
 = 
rx
[0][
i
];

668 
ry0
 = 
ry
[0][
i
];

669 
rz0
 = 
rz
[0][
i
];

670 
rx1
 = 
rx
[1][
i
];

671 
ry1
 = 
ry
[1][
i
];

672 
rz1
 = 
rz
[1][
i
];

674 
rx01
 = 
rx0
 - 
rx1
;

675 
rx01
 =Ñx01 - 
L
 * 
	`röt
(
övL
 *Ñx01);

676 
ry01
 = 
ry0
 - 
ry1
;

677 
ry01
 =Ñy01 - 
L
 * 
	`röt
(
övL
 *Ñy01);

678 
rz01
 = 
rz0
 - 
rz1
;

679 
rz01
 =Ñz01 - 
L
 * 
	`röt
(
övL
 *Ñz01);

681 
øbSq
 = 
	`Sqr
(
rx01
Ë+ Sqr(
ry01
Ë+ Sqr(
rz01
);

682 
øb
 = 
	`sqπ
(
øbSq
);

686 
d01x
 = 
rx01
 / 
øb
;

687 
d01y
 = 
ry01
 / 
øb
;

688 
d01z
 = 
rz01
 / 
øb
;

694 
d0x
 = 
rx01
 * 
m
[1] / 
MtŸ
;

695 
d1x
 = - 
rx01
 * 
m
[0] / 
MtŸ
;

696 
d0y
 = 
ry01
 * 
m
[1] / 
MtŸ
;

697 
d1y
 = - 
ry01
 * 
m
[0] / 
MtŸ
; ;

698 
d0z
 = 
rz01
 * 
m
[1] / 
MtŸ
;

699 
d1z
 = - 
rz01
 * 
m
[0] / 
MtŸ
;

708 
xisq
 = 1.0;

710 
xisq
 >= 1.0)

712 
xi1
 = 
	`ønf
() * 2.0 - 1.0;

713 
xi2
 = 
	`ønf
() * 2.0 - 1.0;

714 
xisq
 = 
xi1
 * xi1 + 
xi2
 * xi2;

717 
xi
 = 
	`sqπ
 (
	`Ábs
(1.0 - 
xisq
));

718 
ox
 = 2.0 * 
xi1
 * 
xi
;

719 
oy
 = 2.0 * 
xi2
 * 
xi
;

720 
oz
 = 1.0 - 2.0 * 
xisq
;

724 
dŸ
 = 
ox
 * 
d01x
 + 
oy
 * 
d01y
 + 
oz
 * 
d01z
;

725 
ox
 = ox - 
dŸ
 * 
d01x
;

726 
oy
 = oy - 
dŸ
 * 
d01y
;

727 
oz
 = oz - 
dŸ
 * 
d01z
;

731 
osq
 = 
ox
 * ox + 
oy
 * oy + 
oz
 * oz;

732 
n‹m
 = 
	`sqπ
(
	`Ábs
(
osq
));

733 
ox
 = ox / 
n‹m
;

734 
oy
 = oy / 
n‹m
;

735 
oz
 = oz / 
n‹m
;

741 
osq
 = - 
món
 * 
	`log
(
	`ønf
());

742 
o
 = 
	`sqπ
(
	`Ábs
(
osq
));

743 
ox
 = 
o
 * ox;

744 
oy
 = 
o
 * oy;

745 
oz
 = 
o
 * oz;

749 
oVd0_x
 = 
oy
 * 
d0z
 - 
oz
 * 
d0y
;

750 
oVd0_y
 = 
oz
 * 
d0x
 - 
ox
 * 
d0z
;

751 
oVd0_z
 = 
ox
 * 
d0y
 - 
oy
 * 
d0x
;

755 
oVd1_x
 = 
oy
 * 
d1z
 - 
oz
 * 
d1y
;

756 
oVd1_y
 = 
oz
 * 
d1x
 - 
ox
 * 
d1z
;

757 
oVd1_z
 = 
ox
 * 
d1y
 - 
oy
 * 
d1x
;

759 
vx
[0][
i
] = vx[0][i] + 
oVd0_x
;

760 
vx
[1][
i
] = vx[1][i] + 
oVd1_x
;

761 
vy
[0][
i
] = vy[0][i] + 
oVd0_y
;

762 
vy
[1][
i
] = vy[1][i] + 
oVd1_y
;

763 
vz
[0][
i
] = vz[0][i] + 
oVd0_z
;

764 
vz
[1][
i
] = vz[1][i] + 
oVd1_z
;

767 
	}
}

770 
	$öôCo‹d
()

772 
	`£tToZîo
(
SAVE_LIST
,

773 
NULL
);

775 
	`FCC
(
O∑øms
.
∑∫um
, O∑øms.
Düm
, O∑øms.
m
);

780 
	`comvñ
(
O∑øms
.
∑∫um
, O∑øms.
T
, O∑øms.
m
);

784 
	}
}

787 
	$u§InôBef
()

799 
i
, 
a
, 
b
;

800 
Då™s
 = 0.0;

802 
Vﬁ
 = 1400.0;

803 
Vﬁ1
 = 0.0;

804 
Vﬁ2
 = 0.0;

805 
Vﬁ1o1
 = 0.0;

806 
Vﬁ1o2
 = 0.0;

809 
s
 = 1.0;

810 
s1
 = 0.0;

811 
s2
 = 0.0;

813 
O∑øms
.
T
 = 2.0;

814 
O∑øms
.
P
 = 1.0;

815 
O∑øms
.
M
 = 5;

817 
O∑øms
.
d
 = 0.025;

819 
O∑øms
.
tﬁ
 = 0.0000001;

821 
O¥ogSètus
.
Q
 = 1.0;

822 
O¥ogSètus
.
No£
 = 1;

823 
O¥ogSètus
.
W
 = 0.0027;

824 
O¥ogSètus
.
avVﬁ
 = 0.0;

825 
O¥ogSètus
.
avs
 = 0.0;

826 
O¥ogSètus
.
tﬁVﬁ
 = 0.0001;

827 
O¥ogSètus
.
tﬁs
 = 0.001;

828 
O¥ogSètus
.
tﬁVﬁ1
 = 0.1;

829 
O¥ogSètus
.
sRe£tSãps
 = 0;

830 
O¥ogSètus
.
√brTabFac
 = 150;

831 
O¥ogSètus
.
rNebrShñl
 = 0.4;

832 
O¥ogSètus
.
noLökedLi°
 = 0;

835 
O¥ogSètus
.
avnggr
 = 0;

836 
O¥ogSètus
.
avngS
 = 0;

837 
O¥ogSètus
.
avngPªss
 = 0;

838 
O¥ogSètus
.
avngTemp
 = 0;

839 
O¥ogSètus
.
avngEè
 = 0;

840 
O¥ogSètus
.
¢≠Sãps
 = 0;

841 
O¥ogSètus
.
¢≠mode
 = 0;

842 
i
=0; i<
NA
; ++i)

844 
O∑øms
.
m
[
i
] = 1.0;

847 
O∑øms
.
rcut
 = 2.7;

850 
	}
}

853 
	$u§InôA·
()

859 #ifde‡
MD_LOADMESH


860 
i1
, 
i2
;

861 
FILE
* 
f
;

862 c⁄° 
numk
 = 98;

863 c⁄° 
numk2av
 = 150;

866 
Nm
, 
i
, 
s˘
;

867 
COORD_TYPE
 
övMtŸ
, 
m0
, 
m1
, 
m2
, 
r01x
, 
r01y
, 
r01z
, 
v01x
, 
v01y
, 
v01z
, 
d
, 
dSq
;

868 
COORD_TYPE
 
vcmx
, 
vcmy
, 
vcmz
;

869 
COORD_TYPE
* 
m
;

870 
a
, 
b
, 
n
;

872 
u1x
, 
u1y
, 
u1z
, 
u2x
, 
u2y
, 
u2z
;

873 
COORD_TYPE
 
RCMx
, 
RCMy
, 
RCMz
, 
Rx
, 
Ry
, 
Rz
;

878 
pi
 = 2.0 * 
	`acos
(0);

880 
M
 = 
O∑øms
.M;

883 
O∑øms
.
nsôes
 = 0;

884 
n
=(
O∑øms
.
öv•
/2)-1;Ç >= 0;Ç--)

886 
O∑øms
.
nsôes
 +6*(
n
+1);

889 
O∑øms
.
nsôes
++;

890 
	`¥ötf
("Numbî o‡sôe†≥∏disk is: %d\n", 
O∑øms
.
nsôes
);

891 i‡(
M
<=2)

893 
	`¥ötf
("ERROR: cellNum must be > 2 !!!\n");

894 
	`exô
(-1);

896 
NCñl
 = 
M
 * M * M;

897 
m≠Size
 = 13 * 
NCñl
;

899 i‡(
O¥ogSètus
.
noLökedLi°
)

901 
	`mdMsg
(
ALL
, 
NOSYS
, "u§InôA·", "NOTICE", 
NULL
,

903 
NULL
);

907 
	`mdMsg
(
ALL
, 
NOSYS
, "u§InôA·", "NOTICE", 
NULL
,

909 
NULL
);

939 
hód
 = 
	`mÆloc
(()*
NCñl
);

940 
li°
 = 
	`mÆloc
(()*
NA
*
O∑øms
.
∑∫um
);

941 
m≠
 = 
	`mÆloc
(()*
m≠Size
);

943 
Nm
 = 
O∑øms
.
∑∫um
;

945 
s˘
 = (
COORD_TYPE
);

946 #ifde‡
MD_LOADMESH


947 
	`¥ötf
("ªadög mesh fûes:%s\n",
MD_MESHDIR
 "/ntripl.dat");

948 
f
 = 
	`f›í
(
MD_MESHDIR
 "/ntripl.dat", "r");

949 i‡(!
f
)

950 
	`exô
(-1);

952 
i1
 = 0; i1 < 
numk
; i1++)

954 
¡rùl
[
i1
] = 0;

955 
i2
 = 0; i2 < 
numk2av
; i2++)

957 
mesh
[
i1
][
i2
][0] = mesh[i1][i2][1] = mesh[i1][i2][2] = 0;

961 
i1
 = 0; i1 < 
numk
; i1++)

963 i‡(
	`fsˇnf
(
f
, "%d ", &
¡rùl
[
i1
]) < 1)

967 
	`¥ötf
("[%d]=%d ", 
i1
, 
¡rùl
[i1]);

969 
	`f˛o£
(
f
);

970 
f
 = 
	`f›í
(
MD_MESHDIR
 "/kmesh.dat", "r");

971 
i1
 = 0; i1 < 
numk
; i1++)

973 
i2
 = 0; i2 < 
numk2av
; i2++)

975 i‡(
	`fsˇnf
(
f
, "%d %d %d ",

976 &
mesh
[
i1
][
i2
][0], &mesh[i1][i2][1], &mesh[i1][i2][2])<3)

984 
	`f˛o£
(
f
);

989 
O∑øms
.
œmbdaD
 = 
	`sqπ
––O∑øms.
T
 * O∑øms.
ïsû⁄
 ) /

990 –4.0 * 
pi
 * (
O∑øms
.
≈lus
 * 
	`Sqr
(O∑øms.
z∂us
Ë+ O∑øms.
nmöus
 * Sqr(O∑øms.
zmöus
)) ) );

992 
FÆlx
 = 
	`mÆloc
((*)*
O∑øms
.
nsôes
);

993 
FÆly
 = 
	`mÆloc
((*)*
O∑øms
.
nsôes
);

994 
FÆlz
 = 
	`mÆloc
((*)*
O∑øms
.
nsôes
);

995 
øŒx
 = 
	`mÆloc
((*)*
O∑øms
.
nsôes
);

996 
øŒy
 = 
	`mÆloc
((*)*
O∑øms
.
nsôes
);

997 
øŒz
 = 
	`mÆloc
((*)*
O∑øms
.
nsôes
);

998 
vxﬁd
 = 
	`mÆloc
((*)*
NA
);

999 
vyﬁd
 = 
	`mÆloc
((*)*
NA
);

1000 
vzﬁd

	`mÆloc
((*)*
NA
);

1001 
øŒx_ﬁd
 = 
	`mÆloc
((*)*
O∑øms
.
nsôes
);

1002 
øŒy_ﬁd
 = 
	`mÆloc
((*)*
O∑øms
.
nsôes
);

1003 
øŒz_ﬁd
 = 
	`mÆloc
((*)*
O∑øms
.
nsôes
);

1004 
Fc€ff
[0] = 
	`mÆloc
(()*
O∑øms
.
nsôes
);

1005 
Fc€ff
[1] = 
	`mÆloc
(()*
O∑øms
.
nsôes
);

1006 
Fc€ff
[2] = 
	`mÆloc
(()*
O∑øms
.
nsôes
);

1008 
ncut
 = 
	`mÆloc
((*)*
O∑øms
.
nsôes
);

1009 
©ch¨ge
 = 
	`mÆloc
(()*
O∑øms
.
nsôes
);

1010 
a
 = 0;á < 
NA
;á++)

1012 
vxﬁd
[
a
] = 
	`mÆloc
(()*
O∑øms
.
∑∫um
);

1013 
vyﬁd
[
a
] = 
	`mÆloc
(()*
O∑øms
.
∑∫um
);

1014 
vzﬁd
[
a
] = 
	`mÆloc
(()*
O∑øms
.
∑∫um
);

1016 
a
=0;á < 
O∑øms
.
nsôes
;á++)

1018 
FÆlx
[
a
] = 
	`mÆloc
(()*
O∑øms
.
∑∫um
);

1019 
FÆly
[
a
] = 
	`mÆloc
(()*
O∑øms
.
∑∫um
);

1020 
FÆlz
[
a
] = 
	`mÆloc
(()*
O∑øms
.
∑∫um
);

1021 
øŒx
[
a
] = 
	`mÆloc
(()*
O∑øms
.
∑∫um
);

1022 
øŒy
[
a
] = 
	`mÆloc
(()*
O∑øms
.
∑∫um
);

1023 
øŒz
[
a
] = 
	`mÆloc
(()*
O∑øms
.
∑∫um
);

1024 
øŒx_ﬁd
[
a
] = 
	`mÆloc
(()*
O∑øms
.
∑∫um
);

1025 
øŒy_ﬁd
[
a
] = 
	`mÆloc
(()*
O∑øms
.
∑∫um
);

1026 
øŒz_ﬁd
[
a
] = 
	`mÆloc
(()*
O∑øms
.
∑∫um
);

1027 
ncut
[
a
] = 
	`mÆloc
(()*
O∑øms
.
nsôes
);

1028 i‡(
a
 < 
O∑øms
.
öv•
/2 * 6)

1029 
©ch¨ge
[
a
] = 
O∑øms
.
ch¨gîim
;

1031 
©ch¨ge
[
a
] = 
O∑øms
.
ch¨geÁ˚
;

1035 
	`f‹˚C€ff
();

1037 
Rmx
 = 
	`mÆloc
(
s˘
*
Nm
);

1038 
Rmy
 = 
	`mÆloc
(
s˘
*
Nm
);

1039 
Rmz
 = 
	`mÆloc
(
s˘
*
Nm
);

1040 
Dphix
 = 
	`mÆloc
(
s˘
*
Nm
);

1041 
Dphiy
 = 
	`mÆloc
(
s˘
*
Nm
);

1042 
Dphiz
 = 
	`mÆloc
(
s˘
*
Nm
);

1044 
ox
 = 
	`mÆloc
(
s˘
*
Nm
);

1045 
oy
 = 
	`mÆloc
(
s˘
*
Nm
);

1046 
oz
 = 
	`mÆloc
(
s˘
*
Nm
);

1048 
u1x
 = 
	`mÆloc
(
s˘
*
Nm
);

1049 
u1y
 = 
	`mÆloc
(
s˘
*
Nm
);

1050 
u1z
 = 
	`mÆloc
(
s˘
*
Nm
);

1051 
u2x
 = 
	`mÆloc
(
s˘
*
Nm
);

1052 
u2y
 = 
	`mÆloc
(
s˘
*
Nm
);

1053 
u2z
 = 
	`mÆloc
(
s˘
*
Nm
);

1060 
	`m≠s
();

1063 
√brTabMax
 = 
O¥ogSètus
.
√brTabFac
 * 
Nm
 * 
NA
;

1064 
	`¥ötf
("INITÇebrTabMax: %d\n", 
√brTabMax
);

1065 
√brNow
 = 1;

1066 
√brTab
 = 
	`AŒocM©I
(2, 
√brTabMax
);

1070 
m0
 = 
O∑øms
.
m
[0];

1071 
m1
 = 
O∑øms
.
m
[1];

1072 
m2
 = 
O∑øms
.
m
[2];

1073 
m
 = 
O∑øms
.m;

1075 
MtŸ
 = 0.0;

1076 
a
=0;á < 
NA
;á++)

1078 
MtŸ
 +
m
[
a
];

1080 
övMtŸ
 = 1.0 / 
MtŸ
;

1084 i‡(
√wSim
 == 1)

1086 i‡(
O¥ogSètus
.
No£
 == 0 || OprogStatus.Nose == -1)

1090 
Vﬁ1
 = 0.0;

1091 
Vﬁ2
 = 0.0;

1092 
Vﬁ1o1
 = 0.0;

1093 
Vﬁ1o2
 = 0.0;

1094 
s1
 = 0.0;

1095 
s2
 = 0.0;

1098 i‡(
O¥ogSètus
.
No£
 == 2)

1100 
Vﬁ1
 = 0.0;

1101 
Vﬁ2
 = 0.0;

1102 
Vﬁ1o1
 = 0.0;

1103 
Vﬁ1o2
 = 0.0;

1112 i‡(
O¥ogSètus
.
No£
 == -2)

1114 
s
 = 1.0;

1115 
s1
 = 0.0;

1116 
s2
 = 0.0;

1119 
O¥ogSètus
.
DQxy
 = 0.0;

1120 
O¥ogSètus
.
DQyz
 = 0.0;

1121 
O¥ogSètus
.
DQzx
 = 0.0;

1123 
i
=0; i < 
O∑øms
.
∑∫um
; i++)

1127 
r01x
 = 
rx
[0][
i
] -Ñx[1][i];

1128 
r01y
 = 
ry
[0][
i
] -Ñy[1][i];

1129 
r01z
 = 
rz
[0][
i
] -Ñz[1][i];

1131 
u1x
[
i
] = 
r01x
 / 
d
;

1132 
u1y
[
i
] = 
r01y
 / 
d
;

1133 
u1z
[
i
] = 
r01z
 / 
d
;

1134 
v01x
 = 
vx
[0][
i
] - vx[1][i];

1135 
v01y
 = 
vy
[0][
i
] - vy[1][i];

1136 
v01z
 = 
vz
[0][
i
] - vz[1][i];

1138 
	`ve˘Prod
(
r01x
, 
r01y
, 
r01z
, 
v01x
, 
v01y
, 
v01z
, &
ox
[
i
], &
oy
[i], &
oz
[i]);

1142 
ox
[
i
] = ox[i] / 
dSq
;

1143 
oy
[
i
] = oy[i] / 
dSq
;

1144 
oz
[
i
] = oz[i] / 
dSq
;

1148 
i
=0; i < 
O∑øms
.
∑∫um
; i++)

1152 
O¥ogSètus
.
rxCMi
[
i
] = (
m0
 * 
rx
[0][i] + 
m1
 *Ñx[1][i] + 
m2
 *Ñx[2][i]Ë* 
övMtŸ
;

1153 
O¥ogSètus
.
ryCMi
[
i
] = (
m0
 * 
ry
[0][i] + 
m1
 *Ñy[1][i] + 
m2
 *Ñy[2][i]Ë* 
övMtŸ
;

1154 
O¥ogSètus
.
rzCMi
[
i
] = (
m0
 * 
rz
[0][i] + 
m1
 *Ñz[1][i] + 
m2
 *Ñz[2][i]Ë* 
övMtŸ
;

1158 
O¥ogSètus
.
sumox
[
i
] = 0.0;

1159 
O¥ogSètus
.
sumoy
[
i
] = 0.0;

1160 
O¥ogSètus
.
sumoz
[
i
] = 0.0;

1162 
O¥ogSètus
.
ox0
[
i
] = 
ox
[i];

1163 
O¥ogSètus
.
oy0
[
i
] = 
oy
[i];

1164 
O¥ogSètus
.
oz0
[
i
] = 
oz
[i];

1166 
O¥ogSètus
.
ux0
[
i
] = 
ux
[i];

1167 
O¥ogSètus
.
uy0
[
i
] = 
uy
[i];

1168 
O¥ogSètus
.
uz0
[
i
] = 
uz
[i];

1171 
vcmx
 = (
m0
 * 
vx
[0][
i
] + 
m1
 * vx[1][i] + 
m2
 * vx[2][i]Ë* 
övMtŸ
;

1172 
vcmy
 = (
m0
 * 
vy
[0][
i
] + 
m1
 * vy[1][i] + 
m2
 * vy[2][i]Ë* 
övMtŸ
;

1173 
vcmz
 = (
m0
 * 
vz
[0][
i
] + 
m1
 * vz[1][i] + 
m2
 * vz[2][i]Ë* 
övMtŸ
;

1175 
O¥ogSètus
.
vcmx0
[
i
] = 
vcmx
;

1176 
O¥ogSètus
.
vcmy0
[
i
] = 
vcmy
;

1177 
O¥ogSètus
.
vcmz0
[
i
] = 
vcmz
;

1181 
O¥ogSètus
.
sumEè
 = 0.0;

1182 
O¥ogSètus
.
sumTemp
 = 0.0;

1183 
O¥ogSètus
.
sumPªss
 = 0.0;

1185 
i
=0; i < 
NUMK
; i++)

1187 
O¥ogSètus
.
sumS
[
i
] = 0.0;

1190 
i
=0; i < 
MAXBIN
; i++)

1192 
O¥ogSètus
.
hi°
[
i
] = 0;

1195 
	`¥ötf
("Vﬁ: %.15‡Vﬁ1: %.15‡s: %.15‡s1: %.15f\n", 
Vﬁ
, 
Vﬁ1
, 
s
, 
s1
);

1196 
	}
}

1198 
	$f‹˚C€ff
()

1200 *
øŒx
, *
øŒy
, 
tmpx
, 
tmpy
, 
tmpz
, 
n‹m12
, 
n‹m3
, 
c1
, 
c2
, 
c3
;

1201 
•e
, 
n
, 
a
, 
≈
=0, 
ù
;

1202 
øŒx
 = 
	`mÆloc
(()*
O∑øms
.
nsôes
);

1203 
øŒy
 = 
	`mÆloc
(()*
O∑øms
.
nsôes
);

1204 i‡(
O∑øms
.
öv•
 >= 2)

1205 
n
=(
O∑øms
.
öv•
/2)-1;Ç >= 0;Ç--)

1206 
	`buûdhexag⁄
(2.0*(
n
+1)*(
O∑øms
.
Düm
 / O∑øms.
öv•
),Ç, 
øŒx
, 
øŒy
, &
≈
);

1208 
•e
 = 
O∑øms
.
öv•
 / 2;

1210 
c1
 = 
c2
 = 
c3
 = 1.0/3.0;

1211 
a
 = 0;á < 3;á++)

1213 
tmpx
 = 
øŒx
[
a
];

1214 
tmpy
 = 
øŒy
[
a
];

1216 
ù
 = (
a
*2+1)*
•e
;

1217 
øŒx
[
a
] =ÑÆlx[
ù
];

1218 
øŒy
[
a
] =ÑÆly[
ù
];

1219 
øŒx
[
ù
] = 
tmpx
;

1220 
øŒy
[
ù
] = 
tmpy
;

1222 
øŒx
[
O∑øms
.
nsôes
-1] = 0.0;

1223 
øŒy
[
O∑øms
.
nsôes
-1] = 0.0;

1225 
n‹m3
 = 
	`sqπ
(
	`Sqr
(
øŒx
[2])+Sqr(
øŒy
[2]));

1226 
n‹m12
 = 
	`sqπ
(
	`Sqr
(
øŒx
[0]-øŒx[1])+Sqr(
øŒy
[0]-rally[1]));

1228 
a
=3;á < 
O∑øms
.
nsôes
;á++)

1230 
Fc€ff
[0][
a
] = 
øŒy
[a]/
n‹m12
 + 
c1
 + (1.0/3.0)*
øŒx
[a]/
n‹m3
;

1231 
Fc€ff
[1][
a
] = -
øŒy
[a]/
n‹m12
 + 
c2
 + (1.0/3.0)*
øŒx
[a]/
n‹m3
;

1232 
Fc€ff
[2][
a
] = -(2.0/3.0)*
øŒx
[a]/
n‹m3
 + 
c3
;

1235 
	`‰ì
(
øŒx
);

1236 
	`‰ì
(
øŒy
);

1238 
	}
}

1241 
	$wrôeAŒC‹
(
FILE
* 
fs
)

1243 
i
, 
a
;

1244 
i
 = 0; i < 
O∑øms
.
∑∫um
; i++)

1246 
a
 = 0;á < 
NA
;á++)

1248 
	`Ârötf
(
fs
, "%.15G %.15G %.15G\n", 
rx
[
a
][
i
], 
ry
[a][i], 
rz
[a][i]);

1251 
i
 = 0; i < 
O∑øms
.
∑∫um
; i++)

1253 
a
 = 0;á < 
NA
;á++)

1255 
	`Ârötf
(
fs
, "%.15G %.15G %.15G\n", 
vx
[
a
][
i
], 
vy
[a][i], 
vz
[a][i]);

1259 
a
 = 0;á < 
NA
;á++)

1261 
i
 = 0; i < 
O∑øms
.
∑∫um
[
a
]; i++)

1263 
	`Ârötf
(
fs
, "%.15G %.15G %.15G\n", 
Fx
[
a
][
i
], 
Fy
[a][i], 
Fz
[a][i]);

1267 
	`Ârötf
(
fs
, "%.15G %.15G %.15G %.15G %.15G\n", 
Vﬁ
, 
Vﬁ1
, 
Vﬁ2
, 
Vﬁ1o1
, 
Vﬁ1o2
);

1268 
	`Ârötf
(
fs
, "%.15G %.15G %.15G %.15G %.15G", 
s
, 
s1
, 
s2
, 
s1o1
, 
s1o2
);

1270 
	}
}

1273 
	$ªadAŒC‹
(
FILE
* 
fs
)

1275 
i
, 
a
;

1277 
i
 = 0; i < 
O∑øms
.
∑∫um
; i++)

1279 
a
 = 0;á < 3;á++)

1281 i‡(
	`fsˇnf
(
fs
, "%l‡%l‡%lf\n", &
rx
[
a
][
i
], &
ry
[a][i], &
rz
[a][i]) < 3)

1283 
	`mdPrötf
(
STD
, "ERROR[pos]Ñódögásciòfûe\n", 
NULL
);

1284 
	`exô
(-1);

1288 
i
 = 0; i < 
O∑øms
.
∑∫um
; i++)

1290 
a
 = 0;á < 
NA
;á++)

1292 i‡(
	`fsˇnf
(
fs
, "%l‡%l‡%lf\n", &
vx
[
a
][
i
], &
vy
[a][i], &
vz
[a][i]) < 3)

1294 
	`mdPrötf
(
STD
, "ERROR[vñ]Ñódögásciòfûe\n", 
NULL
);

1295 
	`exô
(-1);

1300 
a
 = 0;á < 
NA
;á++)

1302 
i
 = 0; i < 
O∑øms
.
∑∫um
[
a
]; i++)

1304 i‡(
	`fsˇnf
(
fs
, "%l‡%l‡%lf\n", &
Fx
[
a
][
i
], &
Fy
[a][i], &
Fz
[a][i]) < 3)

1306 
	`mdPrötf
(
STD
, "ERROR[vñ]Ñódögásciòfûe\n", 
NULL
);

1307 
	`exô
(-1);

1313 i‡(
	`fsˇnf
(
fs
, "%l‡%l‡%l‡%l‡%lf", &
Vﬁ
, &
Vﬁ1
, &
Vﬁ2
, &
Vﬁ1o1
, &
Vﬁ1o2
) < 5)

1315 
	`mdPrötf
(
STD
, "ERROR[exåa]Ñódögásciòfûe\n", 
NULL
);

1316 
	`exô
(-1);

1319 i‡(
	`fsˇnf
(
fs
, "%l‡%l‡%l‡%l‡%lf", &
s
, &
s1
, &
s2
, &
s1o1
, &
s1o2
) < 5)

1321 
	`mdPrötf
(
STD
, "ERROR[exåa]Ñódögásciòfûe\n", 
NULL
);

1322 
	`exô
(-1);

1325 
	}
}

	@jumps.c

2 
	~<mdsimul.h
>

3 
	~<jumputû.h
>

4 
COORD_TYPE
 
	gXVA_DLST
;

6 
xvaHód
 
	gOxvaH
;

9 
	$övÆArg
()

13 
	`¥ötf
("Syntax: jump [-p <precision>] -f <xva_parameters_file>\n");

14 
	`¥ötf
("Invalidárgument!\n");

15 
	`exô
(-1);

16 
	}
}

19 
	$xvaP¨sög
(
°rögA
[
NAME_LENGTH
], 
°rögB
[NAME_LENGTH])

21 
i
;

22 
msgSåA
[512];

25 
i
=0; 
OxvaP¨
[i].
±r
 !
NULL
; ++i)

27 i‡(!
	`°rcmp
(
OxvaP¨
[
i
].
∑rName
, 
°rögA
))

29 
OxvaP¨
[
i
].
ty≥
)

31 
STR
 :

32 
	`°r˝y
((*Ë
OxvaP¨
[
i
].
±r
, 
°rögB
);

34 
INT
 :

35 *((*Ë
OxvaP¨
[
i
].
±r
Ë
	`©oi
(
°rögB
);

37 
CT
 :

38 –*((
COORD_TYPE
*)
OxvaP¨
[
i
].
±r
) ) =

39 (
COORD_TYPE
Ë
	`©of
(
°rögB
);

42 
	`¥ötf
("Not validÖarameterÅype in singleParárray(in mdsimdep.h).");

43 
	`exô
(-1);

51 
	`•rötf
(
msgSåA
, "P¨am©î %†i†nŸ vÆid", 
°rögA
);

52 
	`¥ötf
–"%s\n", 
msgSåA
);

53 
	`exô
(-1);

54 
	}
}

57 
	$ªadP¨s
(* 
fûeName
)

59 
FILE
* 
pfs
;

60 
°r1
[255], 
°r2
[255];

61 
löe
[2048];

63 i‡–(
pfs
 = 
	`f›í
(
fûeName
, "r")Ë=
NULL
)

65 
	`¥ötf
("ERROR: U«bÀÅÿ›íÅhê∑ømëî†fûê%s\n", 
fûeName
);

66 
	`exô
(-1);

69 
	`°r˝y
(
°r1
, "");

70 
	`°r˝y
(
°r2
, "");

72 !
	`„of
(
pfs
))

74 
	`fsˇnf
(
pfs
, "%[^\n] ", 
löe
);

76 i‡(!
	`°rcmp
(
löe
, ""))

79 i‡(
	`ssˇnf
(
löe
, "%[^:# ] : %[^\n# ] ", 
°r1
, 
°r2
) < 2)

83 i‡(!
	`°rcmp
(
°r2
, "*")) ;

84 
	`xvaP¨sög
(
°r1
, 
°r2
);

86 
	`f˛o£
(
pfs
);

87 
	}
}

90 
	$deÁu…s
()

92 
	`°r˝y
(
wp
,"0,1");

93 
dt
 = 0.001;

94 
d
 = 0.5;

95 
m0
 = 1.0;

96 
m1
 = 1.0;

97 
tg≠
 =1;

98 
tBeg
 = 0;

99 
tTŸ
 = -1;

100 
	`°r˝y
(
¥ecisi⁄
,"6");

101 
pi
 = 
	`acos
(-1);

102 
	}
}

105 
	$¨gs
(
¨gc
,**
¨gv
)

107 
i
;

110 
i
 = 0;

113 i‡(
i
+1 =
¨gc
)

115 
	`övÆArg
();

118 ++
i
;

120 i‡(!
	`°rcmp
(
¨gv
[
i
], "-p"))

122 i‡–
i
+1 =
¨gc
 )

124 
	`övÆArg
();

126 ++
i
;

127 
	`°r˝y
(
¥ecisi⁄
, 
¨gv
[
i
]);

130 if(!
	`°rcmp
(
¨gv
[
i
], "-f"))

132 i‡–(
i
+1Ë=
¨gc
 )

134 
	`övÆArg
();

136 ++
i
;

137 
	`°r˝y
(
xv≠¨sFûe
, 
¨gv
[
i
]);

141 
	`övÆArg
();

143 }  
i
 < (
¨gc
 - 1) );

148 i‡(++
i
 =
¨gc
)

150 
	`övÆArg
();

154 
	`°r˝y
(
öputFûe
, 
¨gv
[
i
]);

155 
	`¥ötf
("readÖarameter file!\n");

156 
	}
}

161 
	$›íMósFûe
(* 
FûeName
)

163 
mfd
;

167 i‡–(
mfd
 = 
	`›í
(
FûeName
,
O_RDONLY
)) == -1 )

169 
	`≥º‹
("open measures file");

170 
	`¥ötf
("ERROR: U«bÀÅÿ›í i≈uàfûê%s\n", 
FûeName
);

171 
	`exô
(-1);

175 i‡(
	`ªad
(
mfd
, &
OxvaH
, (
xvaHód
)) == -1)

177 
	`≥º‹
("read header");

178 
	`exô
(-1);

181  
mfd
;

182 
	}
}

185 
	$ªadMós
(
fd
, 
nmós
, 
COORD_TYPE
* 
fú°På
, ...)

189 
begByã
, 
rs
;

190 
COORD_TYPE
* 
•å
;

191 
va_li°
 
≠
;

192 
	`va_°¨t
(
≠
, 
fú°På
);

194 
begByã
 = (
xvaHód
);

195 
	`l£ek
(
fd
, 
begByã
 + 
nmós
 * 
OxvaH
.
size
, 
SEEK_SET
);

197 
rs
 = 
	`ªad
(
fd
, 
fú°På
, 
OxvaH
.
size
 / 
XVA_NUM
);

199 i‡(
rs
 == -1)

201 
	`¥ötf
("ERROR: UnableÅoÑead xva file\n");

202 
	`≥º‹
("read");

203 
	`exô
(-1);

205 i‡(
rs
 < (
OxvaH
.
size
 / 
XVA_NUM
))

210  (
•å
 = 
	`va_¨g
(
≠
, 
COORD_TYPE
*)Ë!
NULL
 )

212 
rs
 = 
	`ªad
(
fd
, 
•å
, 
OxvaH
.
size
 / 
XVA_NUM
);

214 i‡(
rs
 == -1)

216 
	`¥ötf
("ERROR: UnableÅoÑead xva file\n");

217 
	`≥º‹
("read");

218 
	`exô
(-1);

220 i‡(
rs
 < (
OxvaH
.
size
 / 
XVA_NUM
))

226 
	`va_íd
(
≠
);

228 
	}
}

231 
	$AŒoˇã
(
tŸSize
, 
COORD_TYPE
** 
poöãr
, ...)

233 
va_li°
 
≠
;

234 
COORD_TYPE
** 
•å
;

235 
size
;

237 
size
 = 
tŸSize
 / 
XVA_NUM
;

241 
	`va_°¨t
(
≠
, 
poöãr
);

242 *
poöãr
 = 
	`mÆloc
(
size
);

244 (
•å
 = 
	`va_¨g
(
≠
, 
COORD_TYPE
**)Ë!
NULL
)

246 *
•å
 = 
	`mÆloc
(
size
);

248 
	`va_íd
(
≠
);

249 
	}
}

252 
FILE
* 
	$a›í
(*
fûeName
)

254 
FILE
 *
ofs
;

255 i‡–(
ofs
 = 
	`f›í
(
fûeName
, "w")Ë=
NULL
)

257 
	`≥º‹
("open file");

258 
	`¥ötf
("ERROR: u«bÀÅÿ›í %†fûe\n", 
fûeName
);

259 
	`exô
(-1);

261  
ofs
;

262 
	}
}

265 
	$a˛o£
(
FILE
* 
ofs
)

267 
	`f˛o£
(
ofs
);

268 
	}
}

271 
	$ˇlcCMi
(
ii
, 
COORD_TYPE
* 
rCMx
, COORD_TYPE* 
rCMy
, COORD_TYPE* 
rCMz
)

275 *
rCMx
 = 
m0
 * 
rx
[0][
ii
] + 
m1
 *Ñx[1][ii];

276 *
rCMy
 = 
m0
 * 
ry
[0][
ii
] + 
m1
 *Ñy[1][ii];

277 *
rCMz
 = 
m0
 * 
rz
[0][
ii
] + 
m1
 *Ñz[1][ii];

278 *
rCMx
 /
MtŸ
;

279 *
rCMy
 /
MtŸ
;

280 *
rCMz
 /
MtŸ
;

283 
	}
}

285 
	$ˇlcOrõ¡Ve˘i
(
ii
,

286 
COORD_TYPE
* 
u01x
, COORD_TYPE* 
u01y
, COORD_TYPE *
u01z
)

292 *
u01x
 = 
rx
[0][
ii
] -Ñx[1][ii];

293 *
u01y
 = 
ry
[0][
ii
] -Ñy[1][ii];

294 *
u01z
 = 
rz
[0][
ii
] -Ñz[1][ii];

295 *
u01x
 /
d
;

296 *
u01y
 /
d
;

297 *
u01z
 /
d
;

298 
	}
}

301 
	$mkF‹m©
(* 
fmtSå
)

303 
	`°r˝y
(
fmtSå
, "%.");

304 
	`°rˇt
(
fmtSå
, 
¥ecisi⁄
);

305 
	`°rˇt
(
fmtSå
, "f");

306 
	`°rˇt
(
fmtSå
, " ");

307 
	`°rˇt
(
fmtSå
, "%.");

308 
	`°rˇt
(
fmtSå
, 
¥ecisi⁄
);

309 
	`°rˇt
(
fmtSå
, "f\n");

310 
	}
}

313 
	$ßveFunc
(* 
fûeName
, 
COORD_TYPE
* 
acf
, 
mShi·
)

315 
t
;

316 
fmtSå
[128];

317 
FILE
* 
afs
;

320 i‡(!
	`°rcmp
(
fûeName
, "!") || !strcmp(fileName, ""))

325 
	`mkF‹m©
(
fmtSå
);

329 
afs
 = 
	`a›í
(
fûeName
);

330 
t
 = 
tBeg
 + 
mShi·
;Å < 
tTŸ
-mShi·;ÅÒ+
tg≠
)

332 
	`Ârötf
(
afs
, 
fmtSå
, ((
COORD_TYPE
)
t
)*
xvadt
, 
acf
[t]);

335 
	`a˛o£
(
afs
);

336 
	}
}

339 
	$gëMónPosôi⁄s
(
mfd
, 
Np
, 
t_cur
,

340 
COORD_TYPE
* 
Rx
, COORD_TYPE* 
Ry
, COORD_TYPE* 
Rz
)

346 
i
, 
¬
;

347 
COORD_TYPE
 
Rxtmp
, 
Rytmp
, 
Rztmp
;

348 
NMP
 = 2*
DtTø_món
 + 1;

350 
	`lo›
(
i
, 1, 
Np
)

352 
Rx
[
i
] = 0.0;

353 
Ry
[
i
] = 0.0;

354 
Rz
[
i
] = 0.0;

357 
¬
 = 
t_cur
 - 
DtTø_món
;Çn <=Å_cur + DtTra_mean; ++nn)

361 i‡(
	`ªadMós
(
mfd
, 
¬
, 
XVA_LIST
, 
NULL
) == 0)

363 
	`¥ötf
("ERROR: UnexpectedÉnd of file\n");

364 
	`¥ötf
("¬:%dÅ_cur: %d\n", 
¬
, 
t_cur
);

365 
	`exô
(-1);

367 
	`lo›
(
i
, 1, 
Np
)

369 
	`ˇlcCMi
(
≈
[
i
], &
Rxtmp
, &
Rytmp
, &
Rztmp
);

373 
Rx
[
i
] +
Rxtmp
;

374 
Ry
[
i
] +
Rytmp
;

375 
Rz
[
i
] +
Rztmp
;

379 
	`lo›
(
i
, 1, 
Nm
)

381 
Rx
[
i
] /
NMP
;

382 
Ry
[
i
] /
NMP
;

383 
Rz
[
i
] /
NMP
;

387 
	}
}

390 
	$gëMónAngPos
(
mfd
, 
Np
, 
t_cur
,

391 
COORD_TYPE
* 
ux
, COORD_TYPE* 
uy
, COORD_TYPE* 
uz
)

398 
i
, 
¬
;

399 
COORD_TYPE
 
uxtmp
, 
uytmp
, 
uztmp
;

400 
NMP
 = 2*
DtTø_món
 + 1;

402 
	`lo›
(
i
, 1, 
Np
)

404 
ux
[
i
] = 0.0;

405 
uy
[
i
] = 0.0;

406 
uz
[
i
] = 0.0;

409 
¬
 = 
t_cur
 - 
DtTø_món
;Çn <=Å_cur + DtTra_mean; ++nn)

413 i‡(
	`ªadMós
(
mfd
, 
¬
, 
XVA_LIST
, 
NULL
) == 0)

415 
	`¥ötf
("ERROR: UnexpectedÉnd of file\n");

416 
	`¥ötf
("¬:%dÅ_cur: %d\n", 
¬
, 
t_cur
);

417 
	`exô
(-1);

419 
	`lo›
(
i
, 1, 
Np
)

421 
	`ˇlcOrõ¡Ve˘i
(
≈
[
i
], &
uxtmp
, &
uytmp
, &
uztmp
);

425 
ux
[
i
] +
uxtmp
;

426 
uy
[
i
] +
uytmp
;

427 
uz
[
i
] +
uztmp
;

431 
	`lo›
(
i
, 1, 
Nm
)

433 
ux
[
i
] /
NMP
;

434 
uy
[
i
] /
NMP
;

435 
uz
[
i
] /
NMP
;

439 
	}
}

442 
	$maö
(
¨gc
, * 
¨gv
[])

444 
COORD_TYPE
 **
sqπdr2
, 
xx0
[
MP
], 
yy0
[MP],

445 
zz0
[
MP
], 
xx
[MP], 
yy
[MP], 
zz
[MP];

446 
COORD_TYPE
 
ux
[
MP
], 
uy
[MP], 
uz
[MP], 
ux0
[MP], 
uy0
[MP], 
uz0
[MP];

447 
COORD_TYPE
 
dŸu
, **
ãè
;

448 
wp°rög
[128];

449 
‚am
[1024];

450 * 
≈s
, 
≈ss
[128];

451 
tRun
, 
t
, 
nmbyãs
, 
tbyãs
, 
jj
;

452 
mfd
;

453 
n
;

455 
FILE
* 
ffs
;

457 
	`deÁu…s
();

459 
	`¨gs
(
¨gc
, 
¨gv
);

461 
	`ªadP¨s
(
xv≠¨sFûe
);

462 
mfd
 = 
	`›íMósFûe
(
öputFûe
);

464 
Nm
 = 
OxvaH
.
size
 / 
XVA_NUM
 / (
COORD_TYPE
);

465 
MtŸ
 = 
m0
 + 
m1
;

466 
	`¥ötf
("MtŸ: %f\n", 
MtŸ
);

467 
xvadt
 = 
OxvaH
.
ßveSãps
 * 
dt
;

470 
	`AŒoˇã
(
OxvaH
.
size
, 
XVA_ALST
, 
NULL
);

473 
≈s
 = 
	`°πok
(
wp
,",");

474 
≈
[0] = 
	`©oi
(
≈s
);

475 
jj
=1; (
≈s
 = 
	`°πok
(
NULL
,","))!= NULL; ++jj)

477 
≈
[
jj
] = 
	`©oi
(
≈s
);

480 
≈
[
jj
] = -1;

481 
numP¨ts
 = 
jj
;

484 
tRun
 = 0;

485 
	`ªadMós
(
mfd
, 
tRun
, 
XVA_LIST
, 
NULL
) > 0)

487 ++
tRun
;

489 
	`¥ötf
("BeginÅo follow molecules:");

490 
jj
 = 0; jj < 
numP¨ts
; ++jjË
	`¥ötf
(" %d ", 
≈
[jj]);

491 
	`¥ötf
("\n");

492 i‡(
tTŸ
 == -1)

493 
tTŸ
 = 
tRun
;

494 
	`¥ötf
("tTŸ> %d\n", 
tTŸ
);

495 
nmbyãs
 = (
COORD_TYPE
)*
Nm
;

496 
tbyãs
 = (
COORD_TYPE
)*
tRun
;

498 
sqπdr2
 = (
COORD_TYPE
**Ë
	`mÆloc
((COORD_TYPE*)*
numP¨ts
);

499 
ãè
 = (
COORD_TYPE
**Ë
	`mÆloc
((COORD_TYPE*)*
numP¨ts
);

502 
jj
=0; jj < 
numP¨ts
; ++jj)

504 
sqπdr2
[
jj
] = 
	`mÆloc
(
tbyãs
);

505 
ãè
[
jj
] = 
	`mÆloc
(
tbyãs
);

515 
	`gëMónPosôi⁄s
(
mfd
, 
numP¨ts
, 
tBeg
+
DtTø_món
, 
xx0
, 
yy0
, 
zz0
);

517 
ffs
 = 
	`f›í
("frames.cor", "w");

518 
	`Ârötf
(
ffs
, ".atomRad: 0.475, 0.5\n");

519 
t
 = 
tBeg
 + 
DtTø_món
;Å < 
tTŸ
 - DtTø_món;ÅÒ+
tg≠
)

521 
	`gëMónPosôi⁄s
(
mfd
, 
numP¨ts
, 
t
, 
xx
, 
yy
, 
zz
);

522 
	`Ârötf
(
ffs
, ".newframe\n");

524 
jj
=0; jj<
numP¨ts
; ++jj)

526 
n
 = 
≈
[
jj
];

527 
	`Ârötf
(
ffs
, "%‡%‡%f\n", 
rx
[0][
n
], 
ry
[0][n], 
rz
[0][n]);

528 
	`Ârötf
(
ffs
, "%‡%‡%f\n", 
rx
[1][
n
], 
ry
[1][n], 
rz
[1][n]);

532 
sqπdr2
[
jj
][
t
] = 
	`sqπ
(
	`Sqr
(
xx
[jj]-
xx0
[jj]Ë+ Sqr(
yy
[jj]-
yy0
[jj])

533 + 
	`Sqr
(
zz
[
jj
]-
zz0
[jj]));

539 
jj
 = 0; jj < 
numP¨ts
; ++jj)

541 
	`•rötf
(
wp°rög
, "_%d", 
≈
[
jj
]);

543 
	`°r˝y
(
‚am
, 
sqπdr2Fûe
);

544 
	`°rˇt
(
‚am
, 
wp°rög
);

545 
	`ßveFunc
(
‚am
, 
sqπdr2
[
jj
], 
DtTø_món
);

550 
	`˛o£
(
mfd
);\

551 
	`f˛o£
(
ffs
);\

552 
	`exô
(-1);

556 
	`gëMónAngPos
(
mfd
, 
numP¨ts
, 
tBeg
+
DtAng_món
, 
ux0
, 
uy0
, 
uz0
);

558 
t
 = 
tBeg
 + 
DtAng_món
;Å < 
tTŸ
 - DtAng_món;ÅÒ+
tg≠
)

561 
	`gëMónAngPos
(
mfd
, 
numP¨ts
, 
tBeg
+
DtAng_món
, 
ux
, 
uy
, 
uz
);

563 
jj
=0; jj<
numP¨ts
; ++jj)

565 
dŸu
 = 
ux0
[
jj
] * 
ux
[jj] + 
uy0
[jj] * 
uy
[jj] +

566 
uz0
[
jj
] * 
uz
[jj];

567 
ãè
[
jj
][
t
] = 180.0*
	`acos
(
dŸu
)/
pi
;

573 
jj
 = 0; jj < 
numP¨ts
; ++jj)

575 
	`•rötf
(
wp°rög
, "_%d", 
≈
[
jj
]);

577 
	`°r˝y
(
‚am
, 
ãèFûe
);

578 
	`°rˇt
(
‚am
, 
wp°rög
);

579 
	`ßveFunc
(
‚am
, 
ãè
[
jj
], 
DtAng_món
);

584 
	`˛o£
(
mfd
);

585 
	`f˛o£
(
ffs
);

586 
	`¥ötf
("Files with orientationsánd displacements saved\n");

587 
	}
}

	@jumps.h

1 
	#MP
 500

	)

2 
COORD_TYPE
 
	gxvadt
, 
	gdt
;

3 
COORD_TYPE
 
	gm0
, 
	gm1
, 
	gd
, 
	gVﬁ
, 
	gMtŸ
;

4 
	göputFûe
[
NAME_LENGTH
], 
	gxv≠¨sFûe
[NAME_LENGTH], 
	gsqπdr2Fûe
[255],

5 
	gãèFûe
[255];

6 
COORD_TYPE
 
	gpi
;

10 
	gwp
[1024];

11 
	g¥ecisi⁄
[64];

12 
	gNm
;

14 
	gtTŸ
, 
	g¥ötEvîy
, 
	gtBeg
 = 0, 
	gtg≠
, 
	gnumP¨ts
, 
	g≈
[
MP
],

15 
	gDtTø_món
 = 0, 
	gDtAng_món
 = 0;

18 
sögÀP¨
 
	gOxvaP¨
[] = {

33 {"öputFûe", &
öputFûe
, 
STR
},

34 {"sqπdr2Fûe",&
sqπdr2Fûe
, 
STR
},

35 {"DtTø_món", &
DtTø_món
, 
INT
},

36 {"DtAng_món", &
DtAng_món
, 
INT
},

37 {"ãèFûe", &
ãèFûe
, 
STR
},

38 {"wp", &
wp
, 
STR
},

39 {"m0", &
m0
, 
CT
},

40 {"m1", &
m1
, 
CT
},

41 {"d", &
d
, 
CT
},

42 {"dt", &
dt
, 
CT
},

43 {"Vﬁ", &
Vﬁ
, 
CT
},

44 {"tg≠", &
tg≠
, 
INT
},

45 {"¥ec", 
¥ecisi⁄
, 
STR
},

46 {"tBeg", &
tBeg
, 
INT
},

47 {"tTŸ", &
tTŸ
, 
INT
},

50 {"", 
NULL
, 0}

	@laponite.h

11 
	#MDSIMUL
 "/home/demichñ/sh¨ed/simul/mdsimul"

	)

14 
	#XTERM
 "/u§/X11R6/bö/nxãrm"

	)

15 
	#MD_HOME
 "/home/demichñ"

	)

17 
	#MD_SIMDAT
 
MD_HOME
 "/simd©"

	)

19 #ifde‡
MD_LOADMESH


20 
	#MD_MESHDIR
 
MD_HOME
 "/simd©"

	)

23 
	#MD_HD_TMP
 
MD_SIMDAT
 "/mdtmp/"

	)

26 
	#MD_HD_MIS
 
MD_SIMDAT
 "/mósuªs/"

	)

29 
	#MD_TAPE_TMP
 "/iomega/mdtmp/"

	)

33 
	#MD_TAPE_MIS
 "/iomega/mósuªs/"

	)

37 
	#MD_HD_XVA
 "/w‹k2/xvafûes/"

	)

38 
	#MD_TAPE_XVA
 "/iomega/xvafûes/"

	)

41 
	#NUM_MISURE
 30

	)

48 
	#NA
 3

	)

50 
	#MAXPAR
 1500

	)

52 
	#NUM_PAR
 500

	)

53 
	#NUMK
 100

	)

55 
	#MAXBIN
 150

	)

57 
	#NUMV
 150

	)

58 
	#GSRMAX
 2.0

	)

59 
	#GSPOINT
 30

	)

60 
	#GSANGPOINT
 30

	)

62 
	#FSPOINT
 30

	)

64 
	#FSKMAX
 15.0

	)

80 
	#SAVE_LIST
 
rx
[0], 
ry
[0], 
rz
[0],Ñx[1],Ñy[1],Ñz[1],Ñx[2],Ñy[2],Ñz[2],\

81 
vx
[0], 
vy
[0], 
vz
[0], vx[1], vy[1], vz[1], vx[2], vy[2], vz[2],\

82 
Fx
[0], 
Fy
[0], 
Fz
[0], Fx[1], Fy[1], Fz[1], Fx[2], Fy[2], Fz[2],\

83 
vxo1
[0], 
vyo1
[0], 
vzo1
[0], vxo1[1], vyo1[1], vzo1[1], vxo1[2], vyo1[2], vzo1[2],\

84 
vxo2
[0], 
vyo2
[0], 
vzo2
[0], vxo2[1], vyo2[1], vzo2[1],vxo2[2], vyo2[2], vzo2[2]

	)

85 #unde‡
EXT_SLST


86 
	#EXT_SLST
 &
s
, &
s1
, &
s2
, &
Vﬁ
, &
Vﬁ1
, &
Vﬁ2
, &
Vﬁ1o1
, &
s1o1
, &
Vﬁ1o2
,\

87 &
s1o2


	)

90 
	#XVA_LIST
 
rx
[0], 
ry
[0], 
rz
[0],Ñx[1],Ñy[1],Ñz[1],Ñx[2],Ñy[2],Ñz[2],\

91 
vx
[0], 
vy
[0], 
vz
[0], vx[1], vy[1], vz[1], vx[2], vy[2], vz[2],\

92 
Dphix
, 
Dphiy
, 
Dphiz


	)

94 
	#XVA_NUM
 15

	)

96 
	#XVA_ALST
 &
rx
[0], &
ry
[0], &
rz
[0], &rx[1], &ry[1], &rz[1], &rx[2], &ry[2], &rz[2],\

97 &
vx
[0], &
vy
[0], &
vz
[0], &vx[1], &vy[1], &vz[1], &vx[2], &vy[2], &vz[2],\

98 &
Dphix
, &
Dphiy
, &
Dphiz


	)

100 
	#XVA_DLST
 *
rx
[
NA
], *
ry
[NA], *
rz
[NA],\

101 *
vx
[
NA
], *
vy
[NA], *
vz
[NA],\

102 *
Dphix
, *
Dphiy
, *
Dphiz


	)

114 
	#ALLOC_LIST
 &
rx
[0], &
ry
[0], &
rz
[0], &rx[1], &ry[1], &rz[1], &rx[2], &ry[2], &rz[2],\

115 &
vx
[0], &
vy
[0], &
vz
[0], &vx[1], &vy[1], &vz[1], &vx[2], &vy[2], &vz[2],\

116 &
Fx
[0], &
Fy
[0], &
Fz
[0], &Fx[1], &Fy[1], &Fz[1], &Fx[2], &Fy[2], &Fz[2],\

117 &
vxt
[0], &
vyt
[0], &
vzt
[0], &vxt[1], &vyt[1], &vzt[1], &vxt[2], &vyt[2], &vzt[2],\

118 &
FxLJ
[0], &
FyLJ
[0], &
FzLJ
[0],\

119 &
FxLJ
[1], &
FyLJ
[1], &
FzLJ
[1],\

120 &
FxLJ
[2], &
FyLJ
[2], &
FzLJ
[2],\

121 &
vxo1
[0], &
vyo1
[0], &
vzo1
[0],\

122 &
vxo1
[1], &
vyo1
[1], &
vzo1
[1],\

123 &
vxo1
[2], &
vyo1
[2], &
vzo1
[2],\

124 &
vxo2
[0], &
vyo2
[0], &
vzo2
[0],\

125 &
vxo2
[1], &
vyo2
[1], &
vzo2
[1],\

126 &
vxo2
[2], &
vyo2
[2], &
vzo2
[2],\

127 &
vxg
[0], &
vyg
[0], &
vzg
[0],\

128 &
vxg
[1], &
vyg
[1], &
vzg
[1],\

129 &
vxg
[2], &
vyg
[2], &
vzg
[2],\

130 &
vxt2
[0], &
vyt2
[0], &
vzt2
[0],\

131 &
vxt2
[1], &
vyt2
[1], &
vzt2
[1],\

132 &
vxt2
[2], &
vyt2
[2], &
vzt2
[2],\

133 &
Rx
, &
Ry
, &
Rz


	)

142 
	#DECL_LIST
 *
rx
[
NA
], *
ry
[NA], *
rz
[NA],\

143 *
vx
[
NA
], *
vy
[NA], *
vz
[NA],\

144 *
vxt
[
NA
], *
vyt
[NA], *
vzt
[NA],\

145 *
Fx
[
NA
], *
Fy
[NA], *
Fz
[NA],\

146 *
FxLJ
[
NA
], *
FyLJ
[NA], *
FzLJ
[NA],\

147 *
vxo1
[
NA
], *
vyo1
[NA], *
vzo1
[NA],\

148 *
vxg
[
NA
], *
vyg
[NA], *
vzg
[NA],\

149 *
vxt2
[
NA
], *
vyt2
[NA], *
vzt2
[NA],\

150 *
vxo2
[
NA
], *
vyo2
[NA], *
vzo2
[NA],\

151 *
Rx
, *
Ry
, *
Rz


	)

153 #unde‡
EXT_DLST


154 
	#EXT_DLST
 
s
, 
s1
, 
s2
, 
Vﬁ
, 
Vﬁ1
, 
Vﬁ2
, 
Vﬁ1o1
, 
s1o1
, 
Vﬁ1o2
, 
s1o2


	)

157 
	s¥ogSètus


164 
	mxvafûe
[
NAME_LENGTH
];

167 
	möifûe
[
NAME_LENGTH
];

168 
	mídfûe
[
NAME_LENGTH
];

169 
	mídF‹m©
;

175 
	md©aFûes
[
NUM_MISURE
][
NAME_LENGTH
];

180 
	mè≥Times
;

184 
	mxvaSãps
;

185 
	mbakSãps
;

186 
	mbakSãpsAscii
;

188 
	m°aSãps
;

190 
	mmósSãps
[
NUM_MISURE
];

192 
	mmósCÆc
[
NUM_MISURE
];

194 
	möôCÆc
[
NUM_MISURE
];

198 
	mtmpP©h
[
NAME_LENGTH
];

199 
	mmisP©h
[
NAME_LENGTH
];

201 
	möôSãp
[
NUM_MISURE
];

208 
COORD_TYPE
 
	msumEè
;

211 
COORD_TYPE
 
	mDQxy
;

212 
COORD_TYPE
 
	mDQyz
;

213 
COORD_TYPE
 
	mDQzx
;

215 
COORD_TYPE
 
	mPxyAº
[5];

216 
COORD_TYPE
 
	mPyzAº
[5];

217 
COORD_TYPE
 
	mPzxAº
[5];

220 
	mhi°
[
MAXBIN
];

223 
COORD_TYPE
 
	msumS
[
NUMK
];

226 
	mhi°MB
[
NUMV
];

228 
COORD_TYPE
 
	msumTemp
;

229 
COORD_TYPE
 
	msumPªss
;

230 
	mmd£ed
;

232 
COORD_TYPE
 
	msumox
[
MAXPAR
];

233 
COORD_TYPE
 
	msumoy
[
MAXPAR
];

234 
COORD_TYPE
 
	msumoz
[
MAXPAR
];

236 
COORD_TYPE
 
	mvcmx0
[
MAXPAR
];

237 
COORD_TYPE
 
	mvcmy0
[
MAXPAR
];

238 
COORD_TYPE
 
	mvcmz0
[
MAXPAR
];

239 
COORD_TYPE
 
	mux0
[
MAXPAR
];

240 
COORD_TYPE
 
	muy0
[
MAXPAR
];

241 
COORD_TYPE
 
	muz0
[
MAXPAR
];

242 
COORD_TYPE
 
	mox0
[
MAXPAR
];

243 
COORD_TYPE
 
	moy0
[
MAXPAR
];

244 
COORD_TYPE
 
	moz0
[
MAXPAR
];

246 
COORD_TYPE
 
	mrxCMi
[
MAXPAR
];

247 
COORD_TYPE
 
	mryCMi
[
MAXPAR
];

248 
COORD_TYPE
 
	mrzCMi
[
MAXPAR
];

249 
	mù¨t
;

250 
COORD_TYPE
 
	mQ
;

251 
COORD_TYPE
 
	mW
;

252 
	mNo£
;

253 
	msRe£tSãps
;

254 
	mßvedXva
;

255 
	mCMª£t
;

256 
	m√brTabFac
;

259 
COORD_TYPE
 
	mrNebrShñl
;

261 
	mnoLökedLi°
;

263 
COORD_TYPE
 
	mavVﬁ
;

264 
COORD_TYPE
 
	mavs
;

265 
COORD_TYPE
 
	mavVﬁ1
;

266 
COORD_TYPE
 
	mtﬁVﬁ
;

267 
COORD_TYPE
 
	mtﬁs
;

268 
COORD_TYPE
 
	mtﬁVﬁ1
;

269 
	m¢≠Sãps
;

270 
	m¢≠mode
;

271 
	mHNBOX
;

272 
	mavngS
;

273 
	mavnggr
;

274 
	mavngEè
;

275 
	mavngTemp
;

276 
	mavngPªss
;

277 
	mavngMB
;

278 
	mbakSaveMode
;

279 
	mchkeq°ps
;

280 
	mequûibøãd
;

281 
	mnRun
[132];

285 
	mxvaSaveMode
;

286 
	mba£
;

287 
	mNN
;

288 
	mf°ps
;

295 #ifde‡
MAIN


296 
¥ogSètus
 
	gO¥ogSètus
;

298 
¥ogSètus
 
O¥ogSètus
;

303 
	s∑øms


311 
	m∑∫um
;

312 
COORD_TYPE
 
	m°ïÀngth
;

313 
	mtŸSãp
;

315 
	mcurSãp
;

320 
COORD_TYPE
 
	md
;

322 
COORD_TYPE
 
	mP
;

323 
COORD_TYPE
 
	mT
;

324 
COORD_TYPE
 
	mm
[3];

325 
	mnsôes
;

326 
COORD_TYPE
 
	mrcut
;

327 
	mœmbdaD
;

329 
	mz∂us
;

330 
	mzmöus
;

331 
	m≈lus
;

332 
	mnmöus
;

334 
	mch¨gîim
;

335 
	mch¨geÁ˚
;

336 
	mïsû⁄
;

337 
	mchsi
;

338 
	mDüm
;

339 
	möv•
;

340 
	m¸ï
;

341 
	mequûibøt
;

342 
	mM
;

345 
COORD_TYPE
 
	mtﬁ
;

353 #i‚de‡
MAIN


354 
∑øms
 
	gO∑øms
;

356 
∑øms
 
O∑øms
;

363 #ifde‡
MAIN


364 
COORD_TYPE
 
	gDECL_LIST
;

365 
COORD_TYPE
 
	gEXT_DLST
;

367 
COORD_TYPE
 
DECL_LIST
;

368 
COORD_TYPE
 
EXT_DLST
;

372 #ifde‡
MAIN


373 
	gmass
;

375 
mass
;

379 #ifde‡
MAIN


380 
sögÀP¨
 
	gOsögÀP¨
[] = {

395 {"∑∫um" , &
O∑øms
.
∑∫um
, 
INT
},

396 {"°ïÀngth", &
O∑øms
.
°ïÀngth
, 
CT
},

397 {"°ïnum", &
O∑øms
.
tŸSãp
, 
INT
},

398 {"öifûe" , &
O¥ogSètus
.
öifûe
, 
STR
},

399 {"ídfûe" , &
O¥ogSètus
.
ídfûe
, 
STR
},

400 {"xvafûe" , &
O¥ogSètus
.
xvafûe
, 
STR
},

401 {"mós0«me", &
O¥ogSètus
.
d©aFûes
[0], 
STR
},

403 {"öi°ï" , &
O∑øms
.
curSãp
, 
INT
},

404 {"è≥Times", &
O¥ogSètus
.
è≥Times
, 
INT
},

405 {"ídF‹m©", &
O¥ogSètus
.
ídF‹m©
, 
INT
},

406 {"œmbdaD", &
O∑øms
.
œmbdaD
, 
CT
},

407 {"xvaSaveMode",&
O¥ogSètus
.
xvaSaveMode
, 
INT
},

408 {"bakSaveMode", &
O¥ogSètus
.
bakSaveMode
, 
INT
},

409 {"bakSãps", &
O¥ogSètus
.
bakSãps
, 
INT
},

410 {"bakSãpsAscii",&
O¥ogSètus
.
bakSãpsAscii
, 
INT
},

411 {"°aSãps", &
O¥ogSètus
.
°aSãps
, 
INT
},

412 {"tmpP©h", 
O¥ogSètus
.
tmpP©h
, 
STR
},

413 {"misP©h", 
O¥ogSètus
.
misP©h
, 
STR
},

414 {"xvaSãps", &
O¥ogSètus
.
xvaSãps
, 
INT
},

415 {"íîgySãps",&
O¥ogSètus
.
mósSãps
[0], 
INT
},

416 {"íîgyCÆc", &
O¥ogSètus
.
mósCÆc
[0], 
INT
},

417 {"íîgyName", &
O¥ogSètus
.
d©aFûes
[0], 
STR
},

418 {"DåSãps", &
O¥ogSètus
.
mósSãps
[1], 
INT
},

420 {"DåCÆc", &
O¥ogSètus
.
mósCÆc
[1], 
INT
},

422 {"DåName", &
O¥ogSètus
.
d©aFûes
[1], 
STR
},

423 {"ãmpSãps", &
O¥ogSètus
.
mósSãps
[2], 
INT
},

424 {"ãmpCÆc", &
O¥ogSètus
.
mósCÆc
[2], 
INT
},

425 {"ãmpName", &
O¥ogSètus
.
d©aFûes
[2], 
STR
},

426 {"grSãps", &
O¥ogSètus
.
mósSãps
[3], 
INT
},

427 {"grCÆc", &
O¥ogSètus
.
mósCÆc
[3], 
INT
},

428 {"grName", &
O¥ogSètus
.
d©aFûes
[3], 
STR
},

429 {"MBSãps", &
O¥ogSètus
.
mósSãps
[4], 
INT
},

430 {"MBCÆc", &
O¥ogSètus
.
mósCÆc
[4], 
INT
},

431 {"MBName", &
O¥ogSètus
.
d©aFûes
[4], 
STR
},

432 {"DrŸSãps", &
O¥ogSètus
.
mósSãps
[5], 
INT
},

433 {"DrŸCÆc", &
O¥ogSètus
.
mósCÆc
[5], 
INT
},

434 {"DrŸName", &
O¥ogSètus
.
d©aFûes
[5], 
STR
},

435 {"ëaSãps", &
O¥ogSètus
.
mósSãps
[6], 
INT
},

436 {"ëaCÆc", &
O¥ogSètus
.
mósCÆc
[6], 
INT
},

437 {"ëaName", &
O¥ogSètus
.
d©aFûes
[6], 
STR
},

438 {"SSãps", &
O¥ogSètus
.
mósSãps
[7], 
INT
},

439 {"SCÆc", &
O¥ogSètus
.
mósCÆc
[7], 
INT
},

440 {"SName", &
O¥ogSètus
.
d©aFûes
[7], 
STR
},

441 {"¥essSãps", &
O¥ogSètus
.
mósSãps
[8], 
INT
},

442 {"¥essCÆc", &
O¥ogSètus
.
mósCÆc
[8], 
INT
},

443 {"¥essName", &
O¥ogSètus
.
d©aFûes
[8], 
STR
},

444 {"VﬁSãps", &
O¥ogSètus
.
mósSãps
[9], 
INT
},

445 {"VﬁCÆc", &
O¥ogSètus
.
mósCÆc
[9], 
INT
},

446 {"VﬁName", &
O¥ogSètus
.
d©aFûes
[9], 
STR
},

447 {"sSãps", &
O¥ogSètus
.
mósSãps
[10], 
INT
},

448 {"sName", &
O¥ogSètus
.
d©aFûes
[10], 
STR
},

449 {"sCÆc", &
O¥ogSètus
.
mósCÆc
[10], 
INT
},

450 {"PãnsSãps", &
O¥ogSètus
.
mósSãps
[11], 
INT
},

451 {"PãnsCÆc", &
O¥ogSètus
.
mósCÆc
[11], 
INT
},

452 {"PãnsName", &
O¥ogSètus
.
d©aFûes
[11], 
STR
},

453 {"DQãnsSãps",&
O¥ogSètus
.
mósSãps
[12], 
INT
},

454 {"DQãnsCÆc", &
O¥ogSètus
.
mósCÆc
[12], 
INT
},

455 {"DQãnsName", &
O¥ogSètus
.
d©aFûes
[12], 
STR
},

456 {"DphiSqName", &
O¥ogSètus
.
d©aFûes
[13], 
STR
},

457 {"DphiSqSãps",&
O¥ogSètus
.
mósSãps
[13], 
INT
},

458 {"VSãps", &
O¥ogSètus
.
mósSãps
[14], 
INT
},

459 {"VName", &
O¥ogSètus
.
d©aFûes
[14], 
STR
},

460 {"VCÆc", &
O¥ogSètus
.
mósCÆc
[14], 
INT
},

462 {"C1Name", &
O¥ogSètus
.
d©aFûes
[14], 
STR
},

463 {"C1Sãps", &
O¥ogSètus
.
mósSãps
[14], 
INT
},

464 {"C2Name", &
O¥ogSètus
.
d©aFûes
[15], 
STR
},

465 {"C2Sãps", &
O¥ogSètus
.
mósSãps
[15], 
INT
},

466 {"C3Name", &
O¥ogSètus
.
d©aFûes
[16], 
STR
},

467 {"C3Sãps", &
O¥ogSètus
.
mósSãps
[16], 
INT
},

468 {"C4Name", &
O¥ogSètus
.
d©aFûes
[17], 
STR
},

469 {"C4Sãps", &
O¥ogSètus
.
mósSãps
[17], 
INT
},

470 {"psi1Name", &
O¥ogSètus
.
d©aFûes
[18], 
STR
},

471 {"psi1Sãps", &
O¥ogSètus
.
mósSãps
[18], 
INT
},

472 {"psi2Name", &
O¥ogSètus
.
d©aFûes
[19], 
STR
},

473 {"psi2Sãps", &
O¥ogSètus
.
mósSãps
[19], 
INT
},

474 {"vñacfName", &
O¥ogSètus
.
d©aFûes
[20], 
STR
},

475 {"vñacfSãps",&
O¥ogSètus
.
mósSãps
[20], 
INT
},

477 {"ù¨t", &
O¥ogSètus
.
ù¨t
, 
INT
},

479 {"n⁄GaussName",&
O¥ogSètus
.
d©aFûes
[21], 
STR
},

480 {"n⁄GaussSãps",&
O¥ogSètus
.
mósSãps
[21],
INT
},

481 {"DrSqName", &
O¥ogSètus
.
d©aFûes
[22], 
STR
},

482 {"DrSqSãps", &
O¥ogSètus
.
mósSãps
[22], 
INT
},

483 {"sqπdr2Name", &
O¥ogSètus
.
d©aFûes
[23], 
STR
},

484 {"sqπdr2Sãps", &
O¥ogSètus
.
mósSãps
[23], 
INT
},

485 {"GsName", &
O¥ogSètus
.
d©aFûes
[24], 
STR
},

486 {"GsSãps", &
O¥ogSètus
.
mósSãps
[24], 
INT
},

487 {"GsAngName", &
O¥ogSètus
.
d©aFûes
[25], 
STR
},

488 {"GsAngSãps", &
O¥ogSètus
.
mósSãps
[25], 
INT
},

489 {"FsName", &
O¥ogSètus
.
d©aFûes
[26], 
STR
},

490 {"FsSãps", &
O¥ogSètus
.
mósSãps
[26], 
INT
},

491 {"GsGsgName", &
O¥ogSètus
.
d©aFûes
[27], 
STR
},

492 {"GsGsgSãps", &
O¥ogSètus
.
mósSãps
[27], 
INT
},

494 {"öôSãp6", &
O¥ogSètus
.
öôSãp
[6], 
INT
},

495 {"öôCÆc6", &
O¥ogSètus
.
öôCÆc
[6], 
INT
},

496 {"Q", &
O¥ogSètus
.
Q
, 
CT
},

497 {"No£", &
O¥ogSètus
.
No£
, 
INT
},

498 {"sRe£tSãps",&
O¥ogSètus
.
sRe£tSãps
, 
INT
},

499 {"¢≠Sãps", &
O¥ogSètus
.
¢≠Sãps
, 
INT
},

500 {"¢≠mode", &
O¥ogSètus
.
¢≠mode
, 
INT
},

501 {"CMª£t", &
O¥ogSètus
.
CMª£t
, 
INT
},

502 {"noLökedLi°",&
O¥ogSètus
.
noLökedLi°
, 
INT
},

503 {"rNebrShñl", &
O¥ogSètus
.
rNebrShñl
, 
CT
},

504 {"√brTabFac", &
O¥ogSètus
.
√brTabFac
, 
INT
},

505 {"W", &
O¥ogSètus
.
W
, 
CT
},

506 {"P", &
O∑øms
.
P
, 
CT
},

508 {"nsôes", &
O∑øms
.
nsôes
, 
INT
},

510 {"Vﬁ", &
Vﬁ
, 
CT
},

511 {"avVﬁ", &
O¥ogSètus
.
avVﬁ
, 
CT
},

512 {"avs", &
O¥ogSètus
.
avs
, 
CT
},

513 {"tﬁVﬁ", &
O¥ogSètus
.
tﬁVﬁ
, 
CT
},

514 {"tﬁs", &
O¥ogSètus
.
tﬁs
, 
CT
},

515 {"tﬁVﬁ1", &
O¥ogSètus
.
tﬁVﬁ1
, 
CT
},

516 {"avVﬁ1", &
O¥ogSètus
.
avVﬁ1
, 
CT
},

517 {"avngEè", &
O¥ogSètus
.
avngEè
, 
INT
},

518 {"avngTemp", &
O¥ogSètus
.
avngTemp
, 
INT
},

519 {"avngPªss", &
O¥ogSètus
.
avngPªss
, 
INT
},

520 {"avngS", &
O¥ogSètus
.
avngS
, 
INT
},

521 {"avnggr", &
O¥ogSètus
.
avnggr
, 
INT
},

522 {"avngMB", &
O¥ogSètus
.
avngMB
, 
INT
},

527 {"z∂us", &
O∑øms
.
z∂us
, 
CT
},

528 {"zmöus", &
O∑øms
.
zmöus
, 
CT
},

529 {"≈lus", &
O∑øms
.
≈lus
, 
CT
},

530 {"nmöus", &
O∑øms
.
nmöus
, 
CT
},

532 {"£ed", &
O¥ogSètus
.
md£ed
, 
INT
},

533 {"m0", &
O∑øms
.
m
[0], 
CT
},

534 {"m1", &
O∑øms
.
m
[1], 
CT
},

535 {"m2", &
O∑øms
.
m
[2], 
CT
},

536 {"ch¨gîim", &
O∑øms
.
ch¨gîim
, 
CT
},

537 {"ch¨geÁ˚", &
O∑øms
.
ch¨geÁ˚
, 
CT
},

538 {"Düm", &
O∑øms
.
Düm
, 
CT
},

539 {"öv•", &
O∑øms
.
öv•
, 
INT
},

540 {"¸ï", &
O∑øms
.
¸ï
, 
CT
},

541 {"chsi", &
O∑øms
.
chsi
, 
CT
},

542 {"˚ŒNum", &
O∑øms
.
M
, 
INT
},

543 {"ïsû⁄", &
O∑øms
.
ïsû⁄
, 
CT
},

544 {"rcut", &
O∑øms
.
rcut
, 
CT
},

546 {"©omsDi°", &
O∑øms
.
d
, 
CT
},

548 {"equûibøt", &
O∑øms
.
equûibøt
, 
INT
},

549 {"ãm≥øt", &
O∑øms
.
T
, 
CT
},

550 {"tﬁ", &
O∑øms
.
tﬁ
, 
CT
},

553 {"xvaSaveMode",&
O¥ogSètus
.
xvaSaveMode
, 
INT
},

554 {"ba£", &
O¥ogSètus
.
ba£
, 
CT
},

555 {"NN", &
O¥ogSètus
.
NN
, 
INT
},

557 {"nRun", 
O¥ogSètus
.
nRun
, 
STR
},

559 {"", 
NULL
, 0}

562 
sögÀP¨
 
OsögÀP¨
[];

565 
	#OS
(
_A_
Ë
O¥ogSètus
.
	)
_A_

566 
	#OP
(
_A_
Ë
O∑øms
.
	)
_A_

569 #ifde‡
MAIN


570 
∑scii
 
	g›ro_ascii
[] =

574 {"xvafûe", 
OS
(
xvafûe
), 1, 
NAME_LENGTH
, "%s"},

575 {"öifûe", 
OS
(
öifûe
), 1, 
NAME_LENGTH
, "%s"},

576 {"ídFûe", 
OS
(
ídfûe
), 1, 
NAME_LENGTH
, "%s"},

577 {"ídF‹m©", &
OS
(
ídF‹m©
), 1, 1, "%d"},

578 {"d©aFûes", 
OS
(
d©aFûes
), 
NUM_MISURE
, 
NAME_LENGTH
, "%s"},

579 {"xvaSãps", &
OS
(
xvaSãps
), 1, 1, "%d"},

580 {"bakSãps", &
OS
(
bakSãps
), 1, 1, "%d"},

581 {"bakSãpsAscii",&
OS
(
bakSãpsAscii
), 1, 1, "%d"},

582 {"°aSãps", &
OS
(
°aSãps
), 1, 1, "%d"},

583 {"mósSãps", 
OS
(
mósSãps
), 
NUM_MISURE
, 1, "%d"},

584 {"mósCÆc", 
OS
(
mósCÆc
), 
NUM_MISURE
, 1, "%d"},

585 {"öôCÆc", 
OS
(
öôCÆc
), 
NUM_MISURE
, 1, "%d"},

586 {"tmpP©h", 
OS
(
tmpP©h
), 1, 
NAME_LENGTH
, "%s"},

587 {"misP©h", 
OS
(
misP©h
), 1, 
NAME_LENGTH
, "%s"},

588 {"öôSãp", 
OS
(
öôSãp
), 
NUM_MISURE
, 1, "%d"},

589 {"sumEè", &
OS
(
sumEè
), 1, 1, "%.10G"},

590 {"DQxy", &
OS
(
DQxy
), 1, 1, "%.10G"},

591 {"DQzx", &
OS
(
DQzx
), 1, 1, "%.10G"},

592 {"DQzx", &
OS
(
DQzx
), 1, 1, "%.10G"},

593 {"PxyAº", 
OS
(
PxyAº
), 5, 1, "%.10G"},

594 {"PyzAº", 
OS
(
PyzAº
), 5, 1, "%.10G"},

595 {"PzxAº", 
OS
(
PzxAº
), 5, 1, "%.10G"},

596 {"hi°", 
OS
(
hi°
), 
MAXBIN
, 1, "%d"},

597 {"sumS", 
OS
(
sumS
), 
NUMK
, 1, "%.6G"},

598 {"hi°MB", 
OS
(
hi°MB
), 
NUMV
, 1, "%d"},

599 {"sumTemp", &
OS
(
sumTemp
), 1, 1, "%.6G"},

601 {"sumPªss", &
OS
(
sumPªss
), 1, 1, "%.6G"},

602 {"sumox", 
OS
(
sumox
), 
MAXPAR
, 1, "%.15G"},

603 {"sumoy", 
OS
(
sumoy
), 
MAXPAR
, 1, "%.15G"},

604 {"sumoz", 
OS
(
sumoz
), 
MAXPAR
, 1, "%.15G"},

605 {"rxCMi", 
OS
(
rxCMi
), 
MAXPAR
, 1, "%.15G"},

606 {"ryCMi", 
OS
(
ryCMi
), 
MAXPAR
, 1, "%.15G"},

607 {"rzCMi", 
OS
(
rzCMi
), 
MAXPAR
, 1, "%.15G"},

609 {"vcmx0", 
OS
(
vcmx0
), 
MAXPAR
, 1, "%.15G"},

610 {"vcmy0", 
OS
(
vcmy0
), 
MAXPAR
, 1, "%.15G"},

611 {"vcmz0", 
OS
(
vcmz0
), 
MAXPAR
, 1, "%.15G"},

613 {"Q", &
OS
(
Q
), 1, 1 , "%.6G"},

614 {"W", &
OS
(
W
), 1, 1, "%.6G"},

615 {"No£", &
OS
(
No£
), 1, 1, "%d"},

617 {"sRe£tSãps", &
OS
(
sRe£tSãps
), 1, 1, "%d"},

618 {"¢≠Sãps", &
OS
(
¢≠Sãps
), 1, 1, "%d"},

619 {"Cmª£t", &
OS
(
CMª£t
), 1, 1, "%d"},

620 {"√brTabFac", &
OS
(
√brTabFac
), 1, 1, "%d"},

621 {"rNebrShñl", &
OS
(
rNebrShñl
), 1, 1, "%.6G"},

622 {"noLökedLi°", &
OS
(
noLökedLi°
), 1, 1, "%d"},

623 {"avVﬁ", &
OS
(
avVﬁ
), 1, 1, "%.8G"},

624 {"avVﬁ1", &
OS
(
avVﬁ1
), 1, 1, "%.8G"},

625 {"tﬁVﬁ", &
OS
(
tﬁVﬁ
), 1, 1, "%.8G"},

626 {"tﬁVﬁ1", &
OS
(
tﬁVﬁ1
), 1, 1, "%.8G"},

627 {"avs", &
OS
(
avs
), 1, 1, "%.8G"},

628 {"tﬁs", &
OS
(
tﬁs
), 1, 1, "%.8G"},

629 {"HNBOX", &
OS
(
HNBOX
), 1, 1, "%d"},

630 {"avngTemp", &
OS
(
avngTemp
), 1, 1, "%d"},

631 {"avngPªss", &
OS
(
avngPªss
), 1, 1, "%d"},

632 {"avngEè", &
OS
(
avngEè
), 1, 1, "%d"},

633 {"avnggr", &
OS
(
avnggr
), 1, 1, "%d"},

634 {"avngS", &
OS
(
avngS
), 1, 1, "%d"},

636 {"xvaSavedMode", &
OS
(
xvaSaveMode
), 1, 1, "%d"},

637 {"bakSaveMode", &
OS
(
bakSaveMode
), 1, 1, "%d"},

638 {"chkeq°ps", &
OS
(
chkeq°ps
), 1, 1, "%d" },

639 {"equûibøãd", &
OS
(
equûibøãd
), 1, 1, "%d"},

640 {"bakSavedMode", &
OS
(
bakSaveMode
), 1, 1, "%d"},

641 {"ba£", &
OS
(
ba£
), 1, 1, "%.6G"},

642 {"NN", &
OS
(
NN
), 1, 1, "%d"},

643 {"f°ps", &
OS
(
f°ps
), 1, 1, "%.15G"},

644 {"nRun", 
OS
(
nRun
), 1, 1, "%s"},

645 {"", 
NULL
, 0, 0, ""}

648 
∑scii
 
›ro_ascii
[];

651 #ifde‡
MAIN


653 
∑scii
 
	g›¨_ascii
[]=

655 {"∑∫um", &
OP
(
∑∫um
), 1, 1, "%d"},

656 {"°ïÀngth", &
OP
(
°ïÀngth
), 1, 1, "%.6G"},

657 {"nsôes", &
OP
(
nsôes
), 1, 1, "%d"},

658 {"tŸSãp", &
OP
(
tŸSãp
), 1, 1, "%d"},

659 {"curSãp", &
OP
(
curSãp
), 1, 1, "%d"},

660 {"P", &
OP
(
P
), 1, 1, "%.6G"},

661 {"T", &
OP
(
T
), 1, 1, "%.6G"},

662 {"m", 
OP
(
m
), 3, 1, "%.6G"},

663 #ifde‡
SOFT_SPHERE


664 {"PP", &
OP
(
PP
), 1, 1, "%d"},

666 {"rcut", &
OP
(
rcut
), 1, 1, "%.8G"},

667 {"œmbdaD", &
OP
(
œmbdaD
), 1, 1, "%.20G"},

669 {"z∂us", &
OP
(
z∂us
), 1, 1, "%.10G"},

670 {"zmöus", &
OP
(
zmöus
), 1, 1, "%.10G"},

671 {"≈lus", &
OP
(
≈lus
), 1, 1, "%.10G"},

672 {"nmöus", &
OP
(
nmöus
), 1, 1, "%.10G"},

674 {"ch¨gîim", &
OP
(
ch¨gîim
), 1, 1, "%.10G"},

675 {"ch¨geÁ˚", &
OP
(
ch¨geÁ˚
), 1, 1, "%.10G"},

676 {"ïsû⁄", &
OP
(
ïsû⁄
), 1, 1, "%.10G"},

677 {"chsi", &
OP
(
chsi
), 1, 1, "%.10G"},

678 {"Düm", &
OP
(
Düm
), 1, 1, "%.10G"},

679 {"öv•", &
OP
(
öv•
), 1, 1, "%d"},

680 {"¸ï", &
OP
(
¸ï
), 1, 1, "%.10G"},

682 {"sigma", 
OP
(
sigab
), 2, 2, "%.8G"},

683 {"ïsû⁄", 
OP
(
ïßb
), 2, 2, "%.8G"},

685 {"equûibøt", &
OP
(
equûibøt
), 1, 1, "%d"},

686 {"M", &
OP
(
M
), 1, 1, "%d"},

687 {"tﬁ", &
OP
(
tﬁ
), 1, 1, "%.15G"},

688 {"", 
NULL
, 0, 0, ""}

691 
∑scii
 
›¨_ascii
[];

709 
	#VBEG
 0.0

	)

710 
	#VEND
 6.5

	)

711 
	#KBEG
 0.63

	)

712 
	#KEND
 25.0

	)

713 
	#RBEG
 0.2

	)

714 
	#REND
 57.0

	)

715 
	#HNBOX
 0

	)

716 
	#NUMK2AV
 150

	)

719 #ifde‡
MAIN


720 
COORD_TYPE
 
	gVc
, 
	gV
, 
	gE
, 
	gDå™s
, 
	gãmp
, 
	gS
[
NUMK
], 
	gdummy
, 
	gëa
, 
	gDrŸ
, 
	ggr
[
MAXBIN
], 
	gövs
, 
	g¥ess
,

721 
	ggr23
[
MAXBIN
], 
	ggr33
[MAXBIN], 
	g¥ess_m
, 
	g¥ess_©
;

722 
COORD_TYPE
 
	gPãns
[3], 
	gDQãns
[3], 
	gC1c
, 
	gC2c
, 
	gC3c
, 
	gC4c
, 
	gvñc
, 
	gGs
[
GSPOINT
],

723 
	gpsi1c
, 
	gpsi2c
, 
	gsqπdr2
, 
	gAa
, 
	gDrSqTŸ
, 
	gDphiSq
, 
	gGsAng
[
GSANGPOINT
], 
	gFs
[
FSPOINT
],

724 
	gGsGsg
[
GSPOINT
], 
	gãmp_å™¶
;

725 
	gMB
[
NUMV
];

726 
COORD_TYPE
 *
	gDphix
, *
	gDphiy
, *
	gDphiz
;

729 
COORD_TYPE
 
Vc
, 
V
, 
E
, 
Då™s
, 
ãmp
, 
S
[
NUMK
], 
dummy
, 
ëa
, 
DrŸ
, 
gr
[
MAXBIN
],

730 
gr23
[
MAXBIN
], 
gr33
[MAXBIN], 
övs
,

731 
¥ess
, 
¥ess_m
, 
¥ess_©
, 
C1c
, 
C2c
, 
C3c
, 
C4c
, 
vñc
, 
psi1c
, 
psi2c
,

732 
Gs
[
GSPOINT
],

733 
GsAng
[
GSANGPOINT
], 
Fs
[
FSPOINT
], 
GsGsg
[
GSPOINT
], 
ãmp_å™¶
;

734 
COORD_TYPE
 
Pãns
[3], 
DQãns
[3], 
sqπdr2
, 
Aa
, 
DrSqTŸ
,

735 
DphiSq
;

736 
MB
[
NUMV
];

737 
COORD_TYPE
 *
Dphix
, *
Dphiy
, *
Dphiz
;

743 
íîgy
();

744 
å™sDiff
();

745 
ãm≥øt
();

746 
SkCM
();

747 
maxwñl
();

748 
rŸDiff
();

749 
viscosôy
();

750 
ødDís
();

751 
Pãns‹
();

752 
DQãns‹
();

753 
c‹rFuncs
();

754 
v™HoveSñf
();

755 
v™HoveAng
();

756 
öãrmSˇâ
();

757 
gausßµrox
();

758 
ødDís23
();

759 
ødDís33
();

761 #ifde‡
MAIN


762 
mósuª
 
	gOmósuª
[
NUM_MISURE
]=

772 {&
E
, (
COORD_TYPE
), 
íîgy
 },

773 {&
Då™s
, (
COORD_TYPE
), 
å™sDiff
 },

774 {&
ãmp
, (
COORD_TYPE
), 
ãm≥øt
 },

775 {
gr
, (
COORD_TYPE
)*
MAXBIN
, 
ødDís
 },

776 {
MB
, ()*
NUMV
, 
maxwñl
 },

777 {&
DrŸ
, (
COORD_TYPE
), 
rŸDiff
 },

778 {&
ëa
, (
COORD_TYPE
), 
viscosôy
 },

779 {
S
, (
COORD_TYPE
)*
NUMK
, 
SkCM
 },

780 {&
¥ess
, (
COORD_TYPE
), 
NULL
 },

781 {&
Vﬁ
, (
COORD_TYPE
), 
NULL
 },

782 {&
s
, (
COORD_TYPE
), 
NULL
 },

783 {
Pãns
, (
COORD_TYPE
)*3, 
Pãns‹
 },

784 {
DQãns
, (
COORD_TYPE
)*3, 
DQãns‹
 },

785 {&
DphiSq
, (
COORD_TYPE
), 
NULL
 },

786 {&
Vc
, (
COORD_TYPE
), 
NULL
},

787 {
gr23
, (
COORD_TYPE
)*
MAXBIN
,
ødDís23
 },

788 {
gr33
, (
COORD_TYPE
)*
MAXBIN
,
ødDís33
 },

804 {
NULL
, 0, NULL}

807 
mósuª
 
Omósuª
[];

811 
	smósHód


815 
	mßveSãps
;

816 
	msize
;

818 
	mdt
;

819 
	mT
;

820 
	mVﬁ
;

821 
	mN
;

826 #ifde‡
MAIN


827 
mósHód
 
	gOmósHód
[
NUM_MISURE
];

829 
mósHód
 
OmósHód
[
NUM_MISURE
];

834 
	sxvaHód


838 
	msize
 ;

840 
	m∑∫um
;

841 
	mßveSãps
;

843 
	mmode
;

844 
	mNN
;

845 
	mT
;

846 
	mVﬁ
;

847 
	mba£
;

848 
	mdt
;

849 
	mN
;

854 #ifde‡
MAIN


855 
xvaHód
 
	gOxvaHód
;

857 
xvaHód
 
OxvaHód
;

862 #ifde‡
MD2ASCII


867 
	g¥ecisi⁄
[64];

870 * 
	gmis
;

874 
wrôeVec
(
FILE
* 
afs
, 
°ï
, 
size
);

875 
wrôeFp
(
FILE
* 
afs
, 
°ï
, 
size
);

876 
wrôeI¡
(
FILE
* 
afs
, 
°ï
, 
size
);

877 
wrôeS
(
FILE
*
afs
, 
°ï
, 
size
);

878 
wrôeg
(
FILE
* 
afs
, 
°ï
, 
size
);

879 
wrôeGs
(
FILE
* 
afs
, 
°ï
, 
size
);

880 
wrôeGsAng
(
FILE
* 
afs
, 
°ï
, 
size
);

881 
wrôeMB
(
FILE
* 
afs
, 
°ï
, 
size
);

884 
c⁄vSåu˘
 
	gOc⁄vSåu˘
[]=

887 {"Êﬂt", 
wrôeFp
 },

888 {"ve˘‹", 
wrôeVec
 },

889 {"öt", 
wrôeI¡
 },

890 {"doubÀ", 
wrôeFp
 },

891 {"S", 
wrôeS
 },

892 {"g", 
wrôeg
 },

895 {"MB", 
wrôeMB
 },

905 {
NULL
, NULL}

911 
m≠s
();

	@measures.c

1 
	~<mdsimul.h
>

2 
	#SIMUL


	)

11 
	gTXT
[
MSG_LEN
], 
	gTXTA
[10][MSG_LEN];

12 
ENDSIM
;

13 
msgSåA
[
MSG_LEN
];

16 
CoM
(
i
, 
COORD_TYPE
* 
rxcm
, COORD_TYPE* 
rycm
, COORD_TYPE* 
rzcm
);

17 
CoMV
(
i
, 
COORD_TYPE
* 
vxcm
, COORD_TYPE* 
vycm
, COORD_TYPE* 
vzcm
);

23 
COORD_TYPE
 
pi
, 
s1t
, 
Vﬁ1t
, 
L
, 
övL
, 
s1p
, 
EÃc
, 
PÃc
;

24 
COORD_TYPE
 
W
, 
K
, 
WC
, 
T1xx
, 
T1yy
, 
T1zz
,

25 
T1xx
, 
T1yy
, 
T1zz
, 
T1xy
, 
T1yz
, 
T1zx
, 
WCxy
, 
WCyz
, 
WCzx
,

26 
WCxx
, 
WCyy
, 
WCzz
, 
Wxx
, 
Wyy
, 
Wzz
,

27 
Wxy
, 
Wyz
, 
Wzx
, 
Pxx
, 
Pyy
, 
Pzz
, 
Pxy
, 
Pyz
, 
Pzx
, 
Wm
, 
Wmxx
, 
Wmyy
, 
Wmzz
,

28 
Wmxy
, 
Wmyz
, 
Wmzx
, 
Pmxx
, 
Pmyy
, 
Pmzz
, 
Pmxy
, 
Pmyz
, 
Pmzx
, 
T1mxy
,

29 
P©xy
, 
P©yz
, 
P©zx
, 
P©xx
, 
P©yy
, 
P©zz
,

30 
T1myz
, 
T1mzx
, 
T1mxx
, 
T1myy
, 
T1mzz
;

32 
COORD_TYPE
 
MtŸ
;

34 *
hód
, *
li°
, *
m≠
;

35 
NCñl
, 
m≠Size
, 
M
;

38 
COORD_TYPE
 
di•Hi
;

39 **
√brTab
, 
√brNow
, 
√brTabLí
, 
√brTabMax
;

42 
COORD_TYPE
 *
FxL
[
NA
], *
FyL
[NA], *
FzL
[NA];

45 
COORD_TYPE
 *
ox
, *
oy
, *
oz
;

47 
COORD_TYPE
 *
ux
, *
uy
, *
uz
;

48 
COORD_TYPE
 *
Rmx
, *
Rmy
, *
Rmz
;

51 
ve˘Prod
(
COORD_TYPE
 
r1x
, COORD_TYPE 
r1y
, COORD_TYPE 
r1z
,

52 
COORD_TYPE
 
r2x
, COORD_TYPE 
r2y
, COORD_TYPE 
r2z
,

53 
COORD_TYPE
* 
r3x
, COORD_TYPE* 
r3y
, COORD_TYPE* 
r3z
);

56 
	$íîgy
()

60 
COORD_TYPE
 
di°
, 
Px
, 
Py
, 
Pz
, 
co°
, 
Rx
, 
Ry
, 
Rz
, 
RCMx
, 
RCMy
, 
RCMz
, 
MtŸ
;

61 
mﬁ
, 
Nm
, 
i
, 
a
;

62 
COORD_TYPE
 
px
, 
py
, 
pz
, 
lx
, 
ly
, 
lz
, 
Lx
, 
Ly
, 
Lz
;

63 
COORD_TYPE
 
Rx_sˇl
, 
Ry_sˇl
, 
Rz_sˇl
;

64 
COORD_TYPE
 
L
, 
övL
;

66 
Nm
 = 
O∑øms
.
∑∫um
;

67 
	`mdShow
("SHIFTED POTENTIAL ENERGY: %.10f", 
Vc
);

68 
	`mdShow
("POTENTIAL ENERGY: %.10f", 
V
);

69 
	`¥ötf
("KINETIC ENERGY: %.10f\n", 
K
);

70 
	`¥ötf
("s: %.10‡s1: %.10‡Vﬁ: %.10‡Vﬁ1: %.10f\n", 
s
, 
s1
, 
Vﬁ
, 
Vﬁ1
);

71 
E
 = 
K
 + 
Vc
;

73 i‡(
O¥ogSètus
.
No£
 > 0)

75 i‡(
O¥ogSètus
.
No£
 == 2 || OprogStatus.Nose == 1)

77 
E
 = E + 0.5 * 
	`Sqr
(
s1
Ë* 
O¥ogSètus
.
Q
 / Sqr(
s
) +

78 (6.0 * ((
COORD_TYPE
Ë
Nm
Ë- 3.0Ë* 
O∑øms
.
T
 * 
	`log
(
s
);

80 i‡(
O¥ogSètus
.
No£
 == 1)

81 
E
 = E +

82 0.5 * 
	`Sqr
(
Vﬁ1
Ë* 
O¥ogSètus
.
W
 / Sqr(
s
Ë+ 
O∑øms
.
P
 * 
Vﬁ
;

86 i‡(
O¥ogSètus
.
No£
 == -2)

89 
E
 = E + 
O∑øms
.
P
 * 
Vﬁ
 + 0.5 * 
	`Sqr
(
Vﬁ1
Ë* 
O¥ogSètus
.
W
;

91 
	`¥ötf
("TOTAL ENERGY: %.10f\n", 
E
);

92 
	`¥ötf
("EÃc:: %.6‡PÃc: %.6f\n", 
EÃc
, 
PÃc
);

93 
mﬁ
 = 10;

94 
di°
 = 
	`sqπ
–
	`Sqr
(
rx
[0][
mﬁ
] -Ñx[1][mﬁ]Ë+ Sqr(
ry
[0][mol] -Ñy[1][mol]) +

95 
	`Sqr
(
rz
[0][
mﬁ
] -Ñz[1][mol]) );

96 
	`¥ötf
("AtomÖosôi⁄: %.15f\n", 
rx
[0][
mﬁ
]);

97 
	`¥ötf
("MﬁecuÀátom†di°™˚: %.15f\n", 
di°
);

98 
di°
 = ((
rx
[0][
mﬁ
] -Ñx[1][mﬁ]Ë* (
vx
[0][mol] - vx[1][mol]) +

99 (
ry
[0][
mﬁ
] -Ñy[1][mﬁ]Ë* (
vy
[0][mol] - vy[1][mol]) +

100 (
rz
[0][
mﬁ
] -Ñz[1][mﬁ]Ë* (
vz
[0][mﬁ] - vz[1][mﬁ]))/
di°
;

101 
	`¥ötf
("MﬁecuÀÑñ©ivêvñocôyál⁄g b⁄d: %.15f\n", 
di°
);

103 
Px
 = 0.0;

104 
Py
 = 0.0;

105 
Pz
 = 0.0;

106 
Lx
 = 0.0;

107 
Ly
 = 0.0;

108 
Lz
 = 0.0;

109 
MtŸ
 = 
O∑øms
.
m
[0] + Oparams.m[1] + Oparams.m[2];

110 
co°
 = 
Vﬁ1
 / 
Vﬁ
 / 3.0;

111 
L
 = 
	`cbπ
(
Vﬁ
);

112 
övL
 = 1.0 / 
L
;

114 
i
=0; i < 
Nm
; i++)

116 
	`CoM
(
i
, &
Rx
, &
Ry
, &
Rz
);

118 
px
 = 0.0;

119 
py
 = 0.0;

120 
pz
 = 0.0;

122 
a
=0;á < 
NA
;á++)

124 
px
 +
O∑øms
.
m
[
a
] * (
vx
[a][
i
] -

125 
co°
 * 
Rx
);

126 
py
 +
O∑øms
.
m
[
a
] * (
vy
[a][
i
] -

127 
co°
 * 
Ry
);

128 
pz
 +
O∑øms
.
m
[
a
] * (
vz
[a][
i
] -

129 
co°
 * 
Rz
);

137 
Rx_sˇl
 = 
Rx
 - 
L
*
	`röt
(
övL
 * Rx);

138 
Ry_sˇl
 = 
Ry
 - 
L
*
	`röt
(
övL
 * Ry);

139 
Rz_sˇl
 = 
Rz
 - 
L
*
	`röt
(
övL
 * Rz);

140 
	`ve˘Prod
(
Rx_sˇl
, 
Ry_sˇl
, 
Rz_sˇl
, 
px
, 
py
, 
pz
, &
lx
, &
ly
, &
lz
);

143 
Px
 +
px
;

144 
Py
 +
py
;

145 
Pz
 +
pz
;

146 
Lx
 +
lx
;

147 
Ly
 +
ly
;

148 
Lz
 +
lz
;

150 
	`¥ötf
("Px: %.15‡Py: %.15‡Pz: %.15f\n", 
Px
, 
Py
, 
Pz
);

151 
	`¥ötf
("Lx: %.10‡Ly: %.10‡Lz: %.10f\n", 
Lx
, 
Ly
, 
Lz
);

153 
RCMx
 = 0.0;

154 
RCMy
 = 0.0;

155 
RCMz
 = 0.0;

157 
i
=0; i < 
Nm
; i++)

159 
	`CoM
(
i
, &
Rx
, &
Ry
, &
Rz
);

160 
RCMx
 +
Rx
;

161 
RCMy
 +
Ry
;

162 
RCMz
 +
Rz
;

164 
	`¥ötf
("Box CoM RCMx: %.15‡RCMy: %.15‡RCMz: %.15f\n", 
RCMx
, 
RCMy
, 
RCMz
);

165 
	}
}

168 
	$å™sDiff
()

173 
COORD_TYPE
 
Drx
, 
Dry
, 
Drz
, 
MtŸ
, 
övMtŸ
, 
Dr4
;

174 
COORD_TYPE
 
m0
, 
m1
, 
m2
;

175 
COORD_TYPE
 
rxCM
, 
ryCM
, 
rzCM
;

176 
i
;

178 
m0
 = 
O∑øms
.
m
[0];

179 
m1
 = 
O∑øms
.
m
[1];

180 
m2
 = 
O∑øms
.
m
[2];

181 
MtŸ
 = 
m0
 + 
m1
 + 
m2
;

182 
övMtŸ
 = 1.0 / 
MtŸ
;

184 
DrSqTŸ
 = 0.0;

185 
Dr4
 = 0.0;

187 
i
=0; i < 
O∑øms
.
∑∫um
; i++)

189 
rxCM
 = (
m0
 * 
rx
[0][
i
] + 
m1
 *Ñx[1][i] + 
m2
 *Ñx[2][i]Ë* 
övMtŸ
;

190 
ryCM
 = (
m0
 * 
ry
[0][
i
] + 
m1
 *Ñy[1][i] + 
m2
 *Ñy[2][i]Ë* 
övMtŸ
;

191 
rzCM
 = (
m0
 * 
rz
[0][
i
] + 
m1
 *Ñz[1][i] + 
m2
 *Ñz[2][i]Ë* 
övMtŸ
;

192 
Drx
 = 
rxCM
 - 
O¥ogSètus
.
rxCMi
[
i
];

193 
Dry
 = 
ryCM
 - 
O¥ogSètus
.
ryCMi
[
i
];

194 
Drz
 = 
rzCM
 - 
O¥ogSètus
.
rzCMi
[
i
];

195 i‡(
O¥ogSètus
.
ù¨t
 =
i
)

197 
	`¥ötf
("ò%d\n", 
i
);

199 
sqπdr2
 = 
	`sqπ
(
	`Sqr
(
Drx
Ë+ Sqr(
Dry
Ë+ Sqr(
Drz
));

201 
DrSqTŸ
 = DrSqTŸ + 
	`Sqr
(
Drx
Ë+ Sqr(
Dry
Ë+ Sqr(
Drz
);

202 
Dr4
 +
	`Sqr
(Sqr(
Drx
Ë+ Sqr(
Dry
Ë+ Sqr(
Drz
));

207 
Då™s
 = 
DrSqTŸ
 / ( 6.0 * ((
COORD_TYPE
Ë
O∑øms
.
°ïÀngth
) *

208 ((
COORD_TYPE
Ë
O∑øms
.
curSãp
) *

209 ((
COORD_TYPE
Ë
O∑øms
.
∑∫um
 ) );

210 
Aa
 = ((
COORD_TYPE
Ë
O∑øms
.
∑∫um
 ) * 3.0 *

211 
Dr4
 / 
	`Sqr
(
DrSqTŸ
) / 5.0 - 1.0;

213 
DrSqTŸ
 /((
COORD_TYPE
Ë
O∑øms
.
∑∫um
);

215 
	`¥ötf
("Diffusi⁄ c€ffi˚¡: %.15f\n", 
Då™s
);

216 
	}
}

219 
	$ãm≥øt
()

223 
i
;

224 
COORD_TYPE
 
övMtŸ
,
MtŸ
, 
Kå™¶
, 
vxCM
, 
vyCM
, 
vzCM
, 
m0
, 
m1
, 
m2
;

225 i‡(
O¥ogSètus
.
No£
 >= 0)

226 
ãmp
 = 2.0 * 
K
 / (6.0 * 
O∑øms
.
∑∫um
 - 3.0);

228 
ãmp
 = 2.0 * 
K
 / (6.0 * 
O∑øms
.
∑∫um
);

230 
Kå™¶
 = 0.0;

231 
m0
 = 
O∑øms
.
m
[0];

232 
m1
 = 
O∑øms
.
m
[1];

233 
m2
 = 
O∑øms
.
m
[2];

246 i‡(
O¥ogSètus
.
avngTemp
 == 1)

248 
O¥ogSètus
.
sumTemp
 +
ãmp
;

249 
ãmp
 = 
O¥ogSètus
.
sumTemp
 / 
NUMCALCS
;

253 i‡(
O¥ogSètus
.
avngPªss
 == 1)

255 
O¥ogSètus
.
sumPªss
 +
¥ess
;

256 
¥ess
 = 
O¥ogSètus
.
sumPªss
 / 
NUMCALCS
;

258 
	`¥ötf
("In°™è√ou†ãm≥øtuª:%.15f\n", 
ãmp
);

259 
	`¥ötf
("Wm: %‡WC: %.15‡W: %.15f\n", 
Wm
, 
W
, 
WC
);

263 #ifde‡
MOLPTENS


264 
	`¥ötf
("MOLECULAR PressureÅensor\n");

265 
	`¥ötf
("Mﬁecuœ∏¥essuª: %.15f\n", 
¥ess
);

267 #ifde‡
ATPTENS


268 
	`¥ötf
("ATOMIC PressureÅensor\n");

270 #i‡!
	`deföed
(
MOLPTENS
Ë|| deföed(
ATPRESS
Ë|| deföed(
ATPTENS
)

271 
	`¥ötf
("Atomi¯¥essuª: %.15f\n", 
¥ess_©
);

274 
	`¥ötf
("Vﬁ: %.15f\n", 
Vﬁ
);

275 
	}
}

276 #ifde‡
MD_LOADMESH


277 
mesh
[100][150][3];

278 
¡rùl
[100];

282 
	$SkCM
()

287 
COORD_TYPE
 
ªRho
, 
imRho
, 
pi2
;

288 
COORD_TYPE
 
övNm
, 
sˇlFa˘
;

289 
COORD_TYPE
 
rCMk
, 
sumRho
, 
RCMx
, 
RCMy
, 
RCMz
;

290 
COORD_TYPE
 *
sumS
, 
kbeg
;

291 #i‚de‡
MD_LOADMESH


292 
mesh
[][150][3]=

293 
	~"../bimix/kmesh.d©
"

294 
¡rùl
[]=

295 
	~"../bimix/¡rùl.d©
"

297 
mp
, 
i
, 
Nm
, 
n
;

298 c⁄° 
numk
 = 98;

300 
sumS
 = 
O¥ogSètus
.sumS;

301 
L
 = 
	`cbπ
(
Vﬁ
);

302 
övL
 = 1.0 / 
L
;

305 
pi2
 = 2.0 * 
pi
;

306 
kbeg
 = 0.0;

307 
sˇlFa˘
 = 
pi2
 * 
övL
;

308 
Nm
 = 
O∑øms
.
∑∫um
;

309 
övNm
 = 1.0 / 
Nm
;

311 
n
 = 0;Ç < 
numk
;Ç++)

313 
sumRho
 = 0.0;

314 
mp
 = 0; m∞< 
¡rùl
[
n
]; mp++)

316 
ªRho
 = 0.0;

317 
imRho
 = 0.0;

318 
i
=0; i < 
Nm
; i++)

321 i‡(
mesh
[
n
][
mp
][0]==0 && mesh[n][mp][1] == 0 &&

322 
mesh
[
n
][
mp
][2] == 0)

324 
	`¥ötf
("ERROREÇñœ MESH!!!!!!!!Ç=%d mp=%dÇåùl[n]:%d\n", 
n
,

325 
mp
, 
¡rùl
[
n
]);

326 
	`exô
(-1);

329 
	`CoM
(
i
, &
RCMx
, &
RCMy
, &
RCMz
);

330 
rCMk
 = 
kbeg
 + 
sˇlFa˘
 *

331 (
RCMx
 * 
mesh
[
n
][
mp
][0] + 
RCMy
 * mesh[n][mp][1] +

332 
RCMz
 * 
mesh
[
n
][
mp
][2]);

333 
ªRho
 =ÑeRhÿ+ 
	`cos
(
rCMk
) ;

334 
imRho
 = imRhÿ+ 
	`sö
(
rCMk
);

337 
sumRho
 = sumRhÿ+ 
	`Sqr
(
ªRho
Ë+ Sqr(
imRho
);

340 
S
[
n
] = 
sumRho
 * 
övNm
 / ((
COORD_TYPE
Ë
¡rùl
[n]);

342 i‡(
O¥ogSètus
.
avngS
 == 1)

344 
n
 = 0;Ç < 
numk
;Ç++)

346 
sumS
[
n
] +
S
[n];

348 
S
[
n
] = 
sumS
[n] / 
NUMCALCS
;

353 
	}
}

356 
	$maxwñl
()

358 
n
, 
i
, 
Nm
, 
avîages
;

359 * 
hi°MB
;

361 
COORD_TYPE
 
vMod
, 
vSq
, 
vxCM
, 
vyCM
, 
vzCM
, 
m0
, 
m1
, 
m2
, 
övMtŸ
;

363 
Nm
 = 
O∑øms
.
∑∫um
;

364 
m0
 = 
O∑øms
.
m
[0];

365 
m1
 = 
O∑øms
.
m
[1];

366 
m2
 = 
O∑øms
.
m
[2];

367 
övMtŸ
 = 1.0 / (
m0
 + 
m1
 + 
m2
);

369 
hi°MB
 = 
O¥ogSètus
.histMB;

371 i‡(
O¥ogSètus
.
avngMB
 == 0)

373 
i
=0; i < 
NUMV
; i++)

375 
hi°MB
[
i
] = 0;

379 
i
=0; i < 
Nm
; i++)

381 
vxCM
 = (
vx
[0][
i
]*
m0
 + vx[1][i]*
m1
 + 
vy
[2][i]*
m2
Ë* 
övMtŸ
;

382 
vyCM
 = (
vy
[0][
i
]*
m0
 + vy[1][i]*
m1
 + vy[2][i]*
m2
Ë* 
övMtŸ
;

383 
vzCM
 = (
vz
[0][
i
]*
m0
 + vz[1][i]*
m1
 + vz[2][i]*
m2
Ë* 
övMtŸ
;

384 
vSq
 = 
	`Sqr
(
vxCM
Ë+ Sqr(
vyCM
Ë+ Sqr(
vzCM
);

385 
vMod
 = 
	`sqπ
(
vSq
);

386 
n
 = ( 
NUMV
 - 1Ë* (
vMod
 - 
VBEG
)/ (
VEND
 - VBEG);

389 if–
n
 < 
NUMV
 ) ++
hi°MB
[n];

392 
i
=0; i < 
NUMV
; i++)

394 
MB
[
i
] = 
hi°MB
[i];

395 i‡(
O¥ogSètus
.
avngMB
 == 1)

396 
MB
[
i
] /
NUMCALCS
;

398 
	}
}

401 
	$rŸDiff
()

403 
i
, 
Nm
;

404 
COORD_TYPE
 
DoSqTŸ
, 
dt
;

405 
Nm
 = 
O∑øms
.
∑∫um
;

406 
dt
 = 
O∑øms
.
°ïÀngth
;

407 
DoSqTŸ
 = 0.0;

408 
i
=0; i < 
Nm
; i++)

410 
DoSqTŸ
 = DoSqTŸ + 
	`Sqr
(
O¥ogSètus
.
sumox
[
i
]) +

411 
	`Sqr
(
O¥ogSètus
.
sumoy
[
i
]Ë+ Sqr(O¥ogSètus.
sumoz
[i]);

417 
DrŸ
 = 
DoSqTŸ
 / ( 4.0 * 
dt
 * ((
COORD_TYPE
Ë
O∑øms
.
curSãp
) *

418 ((
COORD_TYPE
Ë
Nm
) );

419 
DoSqTŸ
 /((
COORD_TYPE
Ë
Nm
);

420 
DphiSq
 = 
DoSqTŸ
;

421 
	`mdShow
("DrŸ: %.15f", 
DrŸ
);

422 
	}
}

425 
	$viscosôy
()

429 
COORD_TYPE
 
dt
;

430 
dt
 = 
O∑øms
.
°ïÀngth
;

432 
ëa
 = (
	`Sqr
(
O¥ogSètus
.
DQxy
Ë+ Sqr(O¥ogSètus.
DQyz
Ë+ Sqr(O¥ogSètus.
DQzx
))

433 / ( 3.0 * 
dt
 * 2.0 * ((
COORD_TYPE
Ë
O∑øms
.
curSãp
) );

435 
ëa
 = 
Vﬁ
 *Éè / 
O∑øms
.
T
;

437 i‡(
O¥ogSètus
.
avngEè
 == 1)

439 
O¥ogSètus
.
sumEè
 +
ëa
;

443 
ëa
 = 
O¥ogSètus
.
sumEè
 / 
NUMCALCS
;

448 
	`mdShow
("ëa: %.15f", 
ëa
);

449 
	}
}

452 
	$ødDís
()

454 
bö
, 
Nm
, 
i
, 
j
;

455 * 
hi°
;

456 
COORD_TYPE
 
rij
, 
rxij
, 
ryij
, 
rzij
, 
rijSq
, 
rxCMi
, 
ryCMi
, 
rzCMi
, 
rxCMj
, 
ryCMj
,

457 
rzCMj
;

458 
COORD_TYPE
 
æowî
, 
ruµî
, 
co°
, 
nIdól
;

459 
COORD_TYPE
 
rhoAv
, 
m0
, 
m1
, 
m2
, 
övMtŸ
, 
DELR
;

460 
ªnd
, 
rbeg
;

461 
L
 = 
	`cbπ
(
Vﬁ
);

462 
övL
 = 1.0 / 
L
;

463 
Nm
 = 
O∑øms
.
∑∫um
;

464 
rhoAv
 = (
COORD_TYPE
Ë
Nm
;

465 
m0
 = 
O∑øms
.
m
[0];

466 
m1
 = 
O∑øms
.
m
[1];

467 
m2
 = 
O∑øms
.
m
[2];

469 
övMtŸ
 = 1.0 / (
m0
 + 
m1
 + 
m2
);

471 
rbeg
 = 0.2;

472 
ªnd
 = 
L
 * 0.5;

473 
DELR
 = (
ªnd
 - 
rbeg
Ë/ 
MAXBIN
;

475 
hi°
 = 
O¥ogSètus
.hist;

477 i‡(
O¥ogSètus
.
avnggr
 == 0)

479 
i
=0; i < 
MAXBIN
; i++)

481 
hi°
[
i
] = 0;

485 
i
=0; i < 
Nm
 - 1; i++)

487 
j
=
i
+1; j < 
Nm
; j++)

489 
rxCMi
 = (
m0
*
rx
[0][
i
] + 
m1
*rx[1][i] + 
m2
*rx[2][i]Ë* 
övMtŸ
;

490 
ryCMi
 = (
m0
*
ry
[0][
i
] + 
m1
*ry[1][i] + 
m2
*ry[2][i]Ë* 
övMtŸ
;

491 
rzCMi
 = (
m0
*
rz
[0][
i
] + 
m1
*rz[1][i] + 
m2
*rz[2][i]Ë* 
övMtŸ
;

492 
rxCMj
 = (
m0
*
rx
[0][
j
] + 
m1
*rx[1][j] + 
m2
*rx[2][j]Ë* 
övMtŸ
;

493 
ryCMj
 = (
m0
*
ry
[0][
j
] + 
m1
*ry[1][j] + 
m2
*ry[2][j]Ë* 
övMtŸ
;

494 
rzCMj
 = (
m0
*
rz
[0][
j
] + 
m1
*rz[1][j] + 
m2
*rz[2][j]Ë* 
övMtŸ
;

495 
rxij
 = 
rxCMi
 - 
rxCMj
;

496 
ryij
 = 
ryCMi
 - 
ryCMj
;

497 
rzij
 = 
rzCMi
 - 
rzCMj
;

498 
rxij
 =Ñxij - 
L
 * 
	`röt
(
övL
 *Ñxij);

499 
ryij
 =Ñyij - 
L
 * 
	`röt
(
övL
 *Ñyij);

500 
rzij
 =Ñzij - 
L
 * 
	`röt
(
övL
 *Ñzij);

501 
rijSq
 = 
	`Sqr
(
rxij
Ë+ Sqr(
ryij
Ë+ Sqr(
rzij
);

502 
rij
 = 
	`sqπ
(
rijSq
);

503 
bö
 = ( (Ë–(
rij
 - 
rbeg
Ë/ 
DELR
) );

504 i‡–(
bö
 < 
MAXBIN
) && (bin >= 0) )

506 
hi°
[
bö
] = hist[bin] + 2;

511 
co°
 = 4.0 * 
pi
 * 
Nm
 / 3.0 / 
Vﬁ
;

512 
bö
=0; bö < 
MAXBIN
; bin++)

514 
æowî
 = 
rbeg
 + ( (
COORD_TYPE
Ë
bö
Ë* 
DELR
;

515 
ruµî
 = 
æowî
 + 
DELR
;

516 
nIdól
 = 
co°
 * (
	`Sqr
(
ruµî
)*ruµî - Sqr(
æowî
)*rlower);

517 
gr
[
bö
] = ((
COORD_TYPE
Ë
hi°
[bö]Ë/ ((COORD_TYPEË
Nm
Ë/ 
nIdól
;

518 i‡(
O¥ogSètus
.
avnggr
 == 1)

521 
gr
[
bö
] /
NUMCALCS
;

524 
	}
}

525 
	$ødDís23
()

528 
	}
}

530 
	$ødDís33
()

533 
	}
}

536 
	$Pãns‹
()

541 
Pãns
[0] = 
Pxy
;

542 
Pãns
[1] = 
Pyz
;

543 
Pãns
[2] = 
Pzx
;

545 
	}
}

548 
	$DQãns‹
()

550 
DQãns
[0] = 
O¥ogSètus
.
DQxy
;

551 
DQãns
[1] = 
O¥ogSètus
.
DQyz
;

552 
DQãns
[2] = 
O¥ogSètus
.
DQzx
;

553 
	}
}

557 
	$c‹rFuncs
()

562 
COORD_TYPE
 
o0
, 
Ÿt0
, *
ox0
, *
oy0
, *
oz0
, 
dŸu
, 
MtŸ
, 
m0
, 
m1
, 
m2
;

563 
COORD_TYPE
 
vcmx
, 
vcmy
,
vcmz
, *
ux0
, *
uy0
, *
uz0
, *
vcmx0
, *
vcmy0
, *
vcmz0
, 
dŸo
;

564 
i
, 
Nm
;

566 
m0
 = 
O∑øms
.
m
[0];

567 
m1
 = 
O∑øms
.
m
[1];

568 
m2
 = 
O∑øms
.
m
[2];

569 
MtŸ
 = 
m0
 + 
m1
 + 
m2
;

571 
ox0
 = 
O¥ogSètus
.ox0;

572 
oy0
 = 
O¥ogSètus
.oy0;

573 
oz0
 = 
O¥ogSètus
.
oy0
;

574 
ux0
 = 
O¥ogSètus
.ux0;

575 
uy0
 = 
O¥ogSètus
.uy0;

576 
uz0
 = 
O¥ogSètus
.uz0;

577 
vcmx0
 = 
O¥ogSètus
.vcmx0;

578 
vcmy0
 = 
O¥ogSètus
.vcmy0;

579 
vcmz0
 = 
O¥ogSètus
.vcmz0;

581 
Nm
 = 
O∑øms
.
∑∫um
;

584 
psi1c
 = 0.0;

585 
psi2c
 = 0.0;

586 
C1c
 = 0.0;

587 
C2c
 = 0.0;

588 
C3c
 = 0.0;

589 
C4c
 = 0.0;

590 
vñc
 = 0.0;

592 
i
 = 0; i < 
Nm
; i++)

595 
o0
 = 
	`sqπ
(
	`Sqr
(
ox0
[
i
]Ë+ Sqr(
oy0
[i]Ë+ Sqr(
oz0
[i]));

596 
Ÿt0
 = 
	`sqπ
(
	`Sqr
(
ox
[
i
]Ë+ Sqr(
oy
[i]Ë+ Sqr(
oz
[i]));

597 
dŸo
 = 
ox0
[
i
] * 
ox
[i] + 
oy0
[i] * 
oy
[i] +

598 
oz0
[
i
] * 
oz
[i];

599 
dŸo
 /
o0
 * 
Ÿt0
;

600 
psi1c
 +
dŸo
;

601 
psi2c
 +0.5 * ( 3.0 * 
	`Sqr
(
dŸo
) - 1.0);

604 
dŸu
 = 
ux0
[
i
] * 
ux
[i] + 
uy0
[i] * 
uy
[i] +

605 
uz0
[
i
] * 
uz
[i];

606 
C1c
 +
dŸu
;

607 
C2c
 +0.5 * (3.0 * 
	`Sqr
(
dŸu
) - 1.0);

608 
C3c
 +0.5 * (5.0 * 
	`Sqr
(
dŸu
) * dotu -

609 3.0 * 
dŸu
);

610 
C4c
 +0.125 * (35.0 * 
	`Sqr
(
dŸu
) * Sqr(dotu) -

611 30.0 * 
	`Sqr
(
dŸu
) + 3.0);

614 
vcmx
 = (
m0
*
vx
[0][
i
] + 
m1
*vx[1][i] + 
m2
*vx[2][i]Ë/ 
MtŸ
;

615 
vcmy
 = (
m0
*
vy
[0][
i
] + 
m1
*vy[1][i] + 
m2
*vy[2][i]) / 3.0;

616 
vcmz
 = (
m0
*
vz
[0][
i
] + 
m1
*vz[1][i] + 
m2
*vz[2][i]) / 3.0;

618 
vñc
 +
vcmx0
[
i
] * 
vcmx
 + 
vcmy0
[i] * 
vcmy
 +

619 
vcmz0
[
i
] * 
vcmz
;

622 
psi1c
 /(
COORD_TYPE
Ë
Nm
;

623 
psi2c
 /(
COORD_TYPE
Ë
Nm
;

624 
C1c
 /(
COORD_TYPE
Ë
Nm
;

625 
C2c
 /(
COORD_TYPE
Ë
Nm
;

626 
C3c
 /(
COORD_TYPE
Ë
Nm
;

627 
C4c
 /(
COORD_TYPE
Ë
Nm
;

628 
vñc
 /(
COORD_TYPE
Ë
Nm
;

629 
	}
}

632 
	$v™HoveSñf
()

634 
i
, 
j
, 
Nm
;

635 
COORD_TYPE
 
rxcm
, 
rycm
, 
rzcm
, 
dñèr
, 
r
;

636 
COORD_TYPE
 *
rxcm0
, *
rycm0
, *
rzcm0
;

637 
Gsöt
[
GSPOINT
];

639 
rxcm0
 = 
O¥ogSètus
.
rxCMi
;

640 
rycm0
 = 
O¥ogSètus
.
ryCMi
;

641 
rzcm0
 = 
O¥ogSètus
.
rzCMi
;

643 
Nm
 = 
O∑øms
.
∑∫um
;

646 
j
=0; j < 
GSPOINT
; j++)

648 
Gsöt
[
j
] = 0;

652 
i
=0; i < 
Nm
; i++)

654 
	`CoM
(
i
, &
rxcm
, &
rycm
, &
rzcm
);

657 
dñèr
 = 
	`sqπ
(
	`Sqr
(
rxcm
 - 
rxcm0
[
i
]Ë+ Sqr(
rycm
 - 
rycm0
[i]) +

658 
	`Sqr
(
rzcm
 - 
rzcm0
[
i
]));

659 
j
 = (Ë(
GSPOINT
 * 
dñèr
 / 
GSRMAX
);

660 i‡(
j
 < 
GSPOINT
Ë++
Gsöt
[j];

664 
j
=0; j < 
GSPOINT
; j++)

666 
Gs
[
j
] = ((
COORD_TYPE
)
Gsöt
[j]Ë/ 
Nm
;

668 
r
 = ((
COORD_TYPE
Ë
j
 + 0.5Ë* (
GSRMAX
 / 
GSPOINT
);

669 
Gs
[
j
] *
GSPOINT
 / 
GSRMAX
;

670 
Gs
[
j
] /
	`Sqr
(
r
Ë* 4.0 * 
pi
;

672 
	}
}

674 
	$v™HoveAng
()

676 
COORD_TYPE
 
dŸu
, 
ãè
;

677 
COORD_TYPE
 *
ux0
, *
uy0
, *
uz0
;

678 
i
, 
ãèi
, 
Nm
;

679 c⁄° 
COORD_TYPE
 
dãè
 = 0.0000001;

681 
ux0
 = 
O¥ogSètus
.ux0;

682 
uy0
 = 
O¥ogSètus
.uy0;

683 
uz0
 = 
O¥ogSètus
.uz0;

684 
Nm
 = 
O∑øms
.
∑∫um
;

687 
i
=0; i < 
GSANGPOINT
; i++)

689 
GsAng
[
i
] = 0.0;

692 
i
=0; i < 
Nm
; i++)

694 
dŸu
 = 
ux0
[
i
] * 
ux
[i] + 
uy0
[i] * 
uy
[i] +

695 
uz0
[
i
] * 
uz
[i];

697 
ãè
 = 
	`acos
(
dŸu
);

699 i‡–(
ãè
 > 
dãè
Ë&& (ãè < (
pi
 - dteta)) )

703 
ãèi
 = (Ë(
GSANGPOINT
 * 
	`acos
(
dŸu
Ë/ 
pi
);

704 
GsAng
[
ãèi
] += 1.0;

709 
i
 = 0; i < 
GSANGPOINT
; ++i)

714 
ãè
 = ((
COORD_TYPE
)
i
 + 0.5Ë* (
pi
 / 
GSANGPOINT
);

716 
GsAng
[
i
] /((
COORD_TYPE
Ë
Nm
Ë* 
	`sö
(
ãè
);

719 
GsAng
[
i
] *2 * 
GSANGPOINT
 / 
pi
;

721 
	}
}

723 
	$öãrmSˇâ
()

725 
kI¡
, 
rI¡
;

726 
COORD_TYPE
 
k
, 
r
;

729 
kI¡
=0; kI¡ < 
FSPOINT
; kInt++)

731 
Fs
[
kI¡
] = 0.0;

732 
k
 = ( ((
COORD_TYPE
)
kI¡
Ë+ 0.5Ë* ( 
FSKMAX
 / ((COORD_TYPE)
FSPOINT
) );

733 
rI¡
=0;ÑI¡ < 
GSPOINT
;ÑInt++)

735 
r
 = ( ((
COORD_TYPE
Ë
rI¡
Ë+ 0.5Ë* (
GSRMAX
 / ((COORD_TYPE)
GSPOINT
));

736 
Fs
[
kI¡
] +4.0 * 
pi
 * 
	`sö
(
k
*
r
Ë* 
Gs
[
rI¡
] *Ñ / k;

739 
	}
}

741 
	$gausßµrox
()

750 
i
;

751 
COORD_TYPE
 
Gsg
, 
r
, 
¥eÁ˘
;

752 
¥eÁ˘
 = 
	`pow
(3.0 / 
DrSqTŸ
 / 
pi
 / 2.0, 1.5);

753 
i
=0; i < 
GSPOINT
; i++)

755 
r
 = ((
COORD_TYPE
Ë
i
 + 0.5Ë* (
GSRMAX
 / 
GSPOINT
);

756 
Gsg
 = 
¥eÁ˘
 * 
	`exp
(-3.0*
	`Sqr
(
r
)/(2.0*
DrSqTŸ
));

758 
GsGsg
[
i
] = (
Gs
[i] - 
Gsg
) / Gsg;

760 
	}
}

	@move.c

1 
	~<mdsimul.h
>

2 
	#SIMUL


	)

13 **
øŒx
, **
øŒy
, **
øŒz
, **
FÆlx
, **
FÆly
, **
FÆlz
,

14 **
øŒx_ﬁd
, **
øŒy_ﬁd
, **
øŒz_ﬁd
, **
vxﬁd
, **
vyﬁd
, **
vzﬁd
;

16 
ENDSIM
;

17 
msgSåA
[
MSG_LEN
];

18 
löks
(
Nm
, 
COORD_TYPE
 
rcut
);

19 
BuûdNebrLi°NoLöked
(
Nm
, 
COORD_TYPE
 
rCut
);

20 
BuûdNebrLi°
(
Nm
, 
COORD_TYPE
 
rCut
);

21 
CoMB
(
a
, 
i
, 
COORD_TYPE
* 
rxcm
, COORD_TYPE* 
rycm
, COORD_TYPE* 
rzcm
);

22 
CoM
(
i
, 
COORD_TYPE
* 
rxcm
, COORD_TYPE* 
rycm
, COORD_TYPE* 
rzcm
);

23 
CoMV
(
i
, 
COORD_TYPE
* 
vxcm
, COORD_TYPE* 
vycm
, COORD_TYPE* 
vzcm
);

24 
checkNebrRebuûd
();

25 
LJF‹˚
(
Nm
, 
COORD_TYPE
 
rcut
);

26 
ª£tCM
(
Nm
);

27 
ve˘Prod
(
COORD_TYPE
 
r1x
, COORD_TYPE 
r1y
, COORD_TYPE 
r1z
,

28 
COORD_TYPE
 
r2x
, COORD_TYPE 
r2y
, COORD_TYPE 
r2z
,

29 
COORD_TYPE
* 
r3x
, COORD_TYPE* 
r3y
, COORD_TYPE* 
r3z
);

30 
köë
(
Nm
, 
COORD_TYPE
** 
vñx
, COORD_TYPE** 
vñy
,

31 
COORD_TYPE
** 
vñz
, COORD_TYPE 
VOL1
);

37 
COORD_TYPE
 
	gpi
, 
	gs1t
, 
	gVﬁ1t
, 
	gL
, 
	gövL
, 
	gs1p
, 
	gEÃc
, 
	gPÃc
;

38 
COORD_TYPE
 
	gW
, 
	gK
, 
	gWC
, 
	gT1xx
, 
	gT1yy
, 
	gT1zz
,

39 
	gT1xx
, 
	gT1yy
, 
	gT1zz
, 
	gT1xy
, 
	gT1yz
, 
	gT1zx
, 
	gWCxy
, 
	gWCyz
, 
	gWCzx
,

40 
	gWCxx
, 
	gWCyy
, 
	gWCzz
, 
	gWxx
, 
	gWyy
, 
	gWzz
,

41 
	gWxy
, 
	gWyz
, 
	gWzx
, 
	gPxx
, 
	gPyy
, 
	gPzz
, 
	gPxy
, 
	gPyz
, 
	gPzx
, 
	gWm
, 
	gWmxx
, 
	gWmyy
, 
	gWmzz
,

42 
	gWmxy
, 
	gWmyz
, 
	gWmzx
, 
	gPmxx
, 
	gPmyy
, 
	gPmzz
, 
	gPmxy
, 
	gPmyz
, 
	gPmzx
, 
	gT1mxy
,

43 
	gP©xy
, 
	gP©yz
, 
	gP©zx
, 
	gP©xx
, 
	gP©yy
, 
	gP©zz
,

44 
	gT1myz
, 
	gT1mzx
, 
	gT1mxx
, 
	gT1myy
, 
	gT1mzz
;

45 
COORD_TYPE
 
	gDrSq
 = 0.0, 
	gMtŸ
;

47 *
	ghód
, *
	gli°
, *
	gm≠
;

48 
	gNCñl
, 
	gm≠Size
, 
	gM
;

51 
COORD_TYPE
 
	gdi•Hi
;

52 **
	g√brTab
, 
	g√brNow
, 
	g√brTabLí
, 
	g√brTabMax
;

55 
COORD_TYPE
 *
	gox
, *
	goy
, *
	goz
;

57 
COORD_TYPE
 *
	gux
, *
	guy
, *
	guz
;

58 
COORD_TYPE
 *
	gRmx
, *
	gRmy
, *
	gRmz
;

60 
check_di°™˚s
();

61 *
©ch¨ge
;

63 
	$movó
(
COORD_TYPE
 
dt
, COORD_TYPE 
tﬁ
, 
maxIt
, 
NB
, COORD_TYPE 
d
,

64 
COORD_TYPE
 
m
[
NA
], 
Nm
)

66 
COORD_TYPE
 
dSq
;

67 
d⁄e
;

68 
movög
[
NA
], 
moved
[NA];

69 
COORD_TYPE
 
tﬁ2
, 
pxab
, 
pyab
, 
pzab
, 
∑bSq
, 
dt2
, 
dtSq2
;

70 
COORD_TYPE
 
øbSq
, 
diffSq
, 
rxab
, 
ryab
, 
rzab
, 
Ωab
, 
gab
;

71 
COORD_TYPE
 
dx
, 
dy
, 
dz
, 
rma
, 
rmb
;

72 
COORD_TYPE
 
axü
, 
ayü
, 
azü
;

73 
COORD_TYPE
 
rxi
[
NA
], 
ryi
[NA], 
rzi
[NA], 
pxi
[NA], 
pyi
[NA], 
pzi
[NA],

74 
vxi
[
NA
], 
vyi
[NA], 
vzi
[NA];

75 
i
, 
a
, 
b
, 
ô
;

76 c⁄° 
COORD_TYPE
 
Ωtﬁ
 = 1.0E-6;

78 i‡––
NB
 !
NA
 ) && ( NB != NA-1 ) )

80 
	`mdMsg
(
ALL
, 
NOSYS
, 
NULL
, "ERROR", NULL,

82 
NULL
);

83 
	`exô
(-1);

85 
L
 = 
	`cbπ
(
Vﬁ
);

86 
övL
 = 1.0 / 
L
;

88 
	`¥ötf
("d=%.15‡NB=%d NA=%d m[0]=%‡m[1]=%‡m[2]=%f\n",
d
,
NB
,
NA
,
m
[0], m[1], m[2]);

89 
	`¥ötf
("tﬁ=%.20f\n", 
tﬁ
);

90 
	`¥ötf
("L=%‡Vﬁ=%.‡dt=%f\n", 
L
, 
Vﬁ
, 
dt
);

92 
tﬁ2
 = 2.0 * 
tﬁ
;

93 
dt2
 = 
dt
 / 2.0;

94 
dtSq2
 = 
dt
 * 
dt2
;

95 
dSq
 = 
	`Sqr
(
d
);

98 
i
=0; i < 
Nm
; i++)

101 
a
=0;á < 
NA
;á++)

103 
axü
 = 
Fx
[
a
][
i
] / 
m
[a];

104 
ayü
 = 
Fy
[
a
][
i
] / 
m
[a];

105 
azü
 = 
Fz
[
a
][
i
] / 
m
[a];

106 
rxi
[
a
] = 
rx
[a][
i
];

107 
ryi
[
a
] = 
ry
[a][
i
];

108 
rzi
[
a
] = 
rz
[a][
i
];

109 
pxi
[
a
] = 
rx
[a][
i
] + 
dt
 * 
vx
[a][i] + 
dtSq2
 * 
axü
;

110 
pyi
[
a
] = 
ry
[a][
i
] + 
dt
 * 
vy
[a][i] + 
dtSq2
 * 
ayü
;

111 
pzi
[
a
] = 
rz
[a][
i
] + 
dt
 * 
vz
[a][i] + 
dtSq2
 * 
azü
;

113 
	`¥ötf
("[%d-%d] v=(%f,%f,%fËa=(%f,%f,%fË¥=(%f,%f,%fËr=(%f,%f,%f)\n", 
a
, 
i
,

114 
vx
[
a
][
i
], 
vy
[a][i], 
vz
[a][i],

115 
axü
, 
ayü
, 
azü
, 
pxi
[
a
], 
pyi
[a], 
pzi
[a],

116 
rxi
[
a
], 
ryi
[a], 
rzi
[a]);

118 
vxt
[
a
][
i
] = 
vx
[a][i];

119 
vyt
[
a
][
i
] = 
vy
[a][i];

120 
vzt
[
a
][
i
] = 
vz
[a][i];

122 
vxi
[
a
] = 
vx
[a][
i
] + 
dt2
 * 
axü
;

123 
vyi
[
a
] = 
vy
[a][
i
] + 
dt2
 * 
ayü
;

124 
vzi
[
a
] = 
vz
[a][
i
] + 
dt2
 * 
azü
;

125 
movög
[
a
] = 0;

126 
moved
[
a
] = 1;

128 
ô
 = 0;

129 
d⁄e
 = 0;

132  (
d⁄e
 =0Ë&& (
ô
 <
maxIt
) )

134 
d⁄e
 = 1;

136 
a
=0;á < 
NB
;á++)

138 
b
 = 
a
 + 1;

139 i‡(
b
 >
NA
) b = 0;

141 i‡–(
moved
[
a
]==1Ë|| (moved[
b
] == 1))

143 
pxab
 = 
pxi
[
a
] -Öxi[
b
];

144 
pyab
 = 
pyi
[
a
] -Öyi[
b
];

145 
pzab
 = 
pzi
[
a
] -Özi[
b
];

146 
pxab
 =Öxab - 
L
 * 
	`röt
(
övL
 *Öxab);

147 
pyab
 =Öyab - 
L
 * 
	`röt
(
övL
 *Öyab);

148 
pzab
 =Özab - 
L
 * 
	`röt
(
övL
 *Özab);

149 
∑bSq
 = 
	`Sqr
(
pxab
Ë+ Sqr(
pyab
Ë+ Sqr(
pzab
);

150 
øbSq
 = 
dSq
;

151 
diffSq
 = 
øbSq
 - 
∑bSq
;

153 
	`¥ötf
("a=%d b=%dÑabSq: %‡∑bSq: %f\n", 
a
, 
b
, 
øbSq
, 
∑bSq
);

154 
	`¥ötf
("a=%d (%f,%f,%fËb=%d (%f,%f,%f)\n", 
a
, 
pxi
[a], 
pyi
[a], 
pzi
[a],

155 
b
, 
pxi
[b], 
pyi
[b], 
pzi
[b]);

157 i‡–
	`Ábs
(
diffSq
Ë> ( 
øbSq
 * 
tﬁ2
 ) )

159 
rxab
 = 
rxi
[
a
] -Ñxi[
b
];

160 
ryab
 = 
ryi
[
a
] -Ñyi[
b
];

161 
rzab
 = 
rzi
[
a
] -Ñzi[
b
];

162 
rxab
 =Ñxab - 
L
 * 
	`röt
(
övL
 *Ñxab);

163 
ryab
 =Ñyab - 
L
 * 
	`röt
(
övL
 *Ñyab);

164 
rzab
 =Ñzab - 
L
 * 
	`röt
(
övL
 *Ñzab);

165 
Ωab
 = 
rxab
 * 
pxab
 + 
ryab
 * 
pyab
 + 
rzab
 * 
pzab
;

167 i‡–
Ωab
 < (
øbSq
 * 
Ωtﬁ
) )

170 
	`mdMsg
(
ALL
, 
NOSYS
, 
NULL
, "ERROR", NULL,

172 
NULL
);

173 
	`¥ötf
("i=%d bëwì¿%dánd %dÖab=%‡øb=%f\n", 
i
, 
a
, 
b
, 
∑bSq
,

174 
	`Sqr
(
rxab
)+Sqr(
ryab
)+Sqr(
rzab
));

175 
	`¥ötf
("øb(%f,%f,%fË∑b(%f,%f,%f)\n", 
rxab
, 
ryab
, 
rzab
,

176 
pxab
, 
pyab
, 
pzab
);

177 
	`¥ötf
("[%d-%d] v=(%f,%f,%fËa=(%f,%f,%fË¥=(%f,%f,%fËr=(%f,%f,%f)\n", 
a
, 
i
,

178 
vx
[
a
][
i
], 
vy
[a][i], 
vz
[a][i],

179 
axü
, 
ayü
, 
azü
, 
pxi
[
a
], 
pyi
[a], 
pzi
[a],

180 
rxi
[
a
], 
ryi
[a], 
rzi
[a]);

182 
	`exô
(-1);

185 
rma
 = 1.0 / 
m
[
a
];

186 
rmb
 = 1.0 / 
m
[
b
];

187 
gab
 = 
diffSq
 / ( 2.0 * ( 
rma
 + 
rmb
 ) * 
Ωab
 );

188 
dx
 = 
rxab
 * 
gab
;

189 
dy
 = 
ryab
 * 
gab
;

190 
dz
 = 
rzab
 * 
gab
;

192 
pxi
[
a
] =Öxi[a] + 
rma
 * 
dx
;

193 
pyi
[
a
] =Öyi[a] + 
rma
 * 
dy
;

194 
pzi
[
a
] =Özi[a] + 
rma
 * 
dz
;

195 
pxi
[
b
] =Öxi[b] - 
rmb
 * 
dx
;

196 
pyi
[
b
] =Öyi[b] - 
rmb
 * 
dy
;

197 
pzi
[
b
] =Özi[b] - 
rmb
 * 
dz
;

199 
dx
 = dx / 
dt
;

200 
dy
 = dy / 
dt
;

201 
dz
 = dz / 
dt
;

203 
vxi
[
a
] = vxi[a] + 
rma
 * 
dx
;

204 
vyi
[
a
] = vyi[a] + 
rma
 * 
dy
;

205 
vzi
[
a
] = vzi[a] + 
rma
 * 
dz
;

206 
vxi
[
b
] = vxi[b] - 
rmb
 * 
dx
;

207 
vyi
[
b
] = vyi[b] - 
rmb
 * 
dy
;

208 
vzi
[
b
] = vzi[b] - 
rmb
 * 
dz
;

210 
movög
[
a
] = 1;

211 
movög
[
b
] = 1;

212 
d⁄e
 = 0;

220 
a
=0;á < 
NA
;á++)

222 
moved
[
a
] = 
movög
[a];

223 
movög
[
a
] = 0;

225 
ô
 = it + 1;

228 i‡(
d⁄e
 == 0)

230 
	`•rötf
(
msgSåA
, "MOLECULE N. %d", 
i
);

231 
	`mdMsg
(
ALL
, 
NOSYS
, 
NULL
, "ERROR", NULL,

233 
msgSåA
,

234 
NULL
);

235 
	`exô
(-1);

239 
a
=0;á < 
NA
;á++)

241 
rx
[
a
][
i
] = 
pxi
[a];

242 
ry
[
a
][
i
] = 
pyi
[a];

243 
rz
[
a
][
i
] = 
pzi
[a];

245 
vx
[
a
][
i
] = 
vxi
[a];

246 
vy
[
a
][
i
] = 
vyi
[a];

247 
vz
[
a
][
i
] = 
vzi
[a];

253 i‡(
O¥ogSètus
.
No£
 == 0) ;

256 
s
 = s + 
dt
 * 
s1
 + 
dtSq2
 * 
s2
;

257 
s1t
 = 
s1
;

258 
s1
 = s1 + 
dt2
 * 
s2
;

260 i‡(
O¥ogSètus
.
No£
 == 2) ;

261 
Vﬁ
 = Vﬁ + 
dt
 * 
Vﬁ1
 + 
dtSq2
 * 
Vﬁ2
;

262 
Vﬁ1t
 = 
Vﬁ1
;

263 
Vﬁ1
 = Vﬁ1 + 
dt2
 * 
Vﬁ2
;

265 
	}
}

268 
	$movó_Brownün
(
COORD_TYPE
 
dt
, COORD_TYPE 
tﬁ
, 
maxIt
, 
NB
, COORD_TYPE 
d
,

269 
COORD_TYPE
 
m
[
NA
], 
Nm
)

271 
COORD_TYPE
 
dSq
;

272 
d⁄e
;

273 
movög
[
NA
], 
moved
[NA];

274 
COORD_TYPE
 
tﬁ2
, 
pxab
, 
pyab
, 
pzab
, 
∑bSq
, 
dtSq
, 
dtSq2
, 
dt2
;

275 
COORD_TYPE
 
øbSq
, 
diffSq
, 
rxab
, 
ryab
, 
rzab
, 
Ωab
, 
gab
;

276 
COORD_TYPE
 
dx
, 
dy
, 
dz
, 
rma
, 
rmb
;

277 
COORD_TYPE
 
axü
, 
ayü
, 
azü
, 
sigm¨
, 
sigmav
;

278 
COORD_TYPE
 
rxi
[
NA
], 
ryi
[NA], 
rzi
[NA], 
pxi
[NA], 
pyi
[NA], 
pzi
[NA],

279 
vxi
[
NA
], 
vyi
[NA], 
vzi
[NA];

280 
drx
, 
dry
, 
drz
, 
dvx
, 
dvy
, 
dvz
, 
kTm
, 
echsidt
, 
e2chsidt
, 
chsi
, 
chsidt
, 
¸v
;

281 
c0
, 
c1
, 
c2
, 
c1mc2
;

282 
i
, 
a
, 
b
, 
ô
;

283 c⁄° 
COORD_TYPE
 
Ωtﬁ
 = 1.0E-6;

285 i‡––
NB
 !
NA
 ) && ( NB != NA-1 ) )

287 
	`mdMsg
(
ALL
, 
NOSYS
, 
NULL
, "ERROR", NULL,

289 
NULL
);

290 
	`exô
(-1);

293 
L
 = 
	`cbπ
(
Vﬁ
);

294 
övL
 = 1.0 / 
L
;

296 
tﬁ2
 = 2.0 * 
tﬁ
;

297 
dtSq
 = 
dt
 * dt;

298 
dt2
 = 
dt
 / 2.0;

299 
dtSq2
 = 
dt
 * 
dt2
;

301 
dSq
 = 
	`Sqr
(
d
);

303 
kTm
 = 
O∑øms
.
T
 / O∑øms.
m
[0];

304 
chsidt
 = 
O∑øms
.
chsi
 * O∑øms.
°ïÀngth
;

305 
echsidt
 = 
	`exp
(-
O∑øms
.
chsi
*O∑øms.
°ïÀngth
);

306 
e2chsidt
 = 
	`exp
(-2.0*
O∑øms
.
chsi
*O∑øms.
°ïÀngth
);

307 
dt
 = 
O∑øms
.
°ïÀngth
;

308 
chsi
 = 
O∑øms
.chsi;

309 
c0
 = 
	`exp
(-
chsi
*
dt
);

310 
c1
 = (1-
c0
)/(
chsi
*
dt
);

311 
c2
 = (1-
c1
)/(
chsi
*
dt
);

312 
c1mc2
 = 
c1
 - 
c2
;

314 
sigm¨
 = 
	`sqπ
–
dt
 * (
kTm
 / 
chsi
) *

315 (2.0 - ( 3.0 - 4.0 * 
echsidt
 + 
e2chsidt
Ë/ 
chsidt
) );

316 
sigmav
 = 
	`sqπ
(
kTm
 * ( 1.0 - 
e2chsidt
 ) );

317 
¸v
 = 
dt
 * 
kTm
 * 
	`Sqr
–1.0 - 
echsidt
Ë/ 
chsidt
 / 
sigm¨
 / 
sigmav
;

320 
i
=0; i < 
Nm
; i++)

323 
a
=0;á < 
NA
;á++)

325 
axü
 = 
Fx
[
a
][
i
] / 
m
[a];

326 
ayü
 = 
Fy
[
a
][
i
] / 
m
[a];

327 
azü
 = 
Fz
[
a
][
i
] / 
m
[a];

329 
	`bigauss
(
sigm¨
, 
sigmav
, 
¸v
, &
drx
, &
dvx
);

330 
	`bigauss
(
sigm¨
, 
sigmav
, 
¸v
, &
dry
, &
dvy
);

331 
	`bigauss
(
sigm¨
, 
sigmav
, 
¸v
, &
drz
, &
dvz
);

333 
rxi
[
a
] = 
rx
[a][
i
];

334 
ryi
[
a
] = 
ry
[a][
i
];

335 
rzi
[
a
] = 
rz
[a][
i
];

336 
pxi
[
a
] = 
rx
[a][
i
] + 
c1
 * 
dt
 * 
vx
[a][i] + 
c2
 * 
dtSq
 * 
axü
 + 
drx
;

337 
pyi
[
a
] = 
ry
[a][
i
] + 
c1
 * 
dt
 * 
vy
[a][i] + 
c2
 * 
dtSq
 * 
ayü
 + 
dry
;

338 
pzi
[
a
] = 
rz
[a][
i
] + 
c1
 * 
dt
 * 
vz
[a][i] + 
c2
 * 
dtSq
 * 
azü
 + 
drz
;

340 
vxt
[
a
][
i
] = 
vx
[a][i];

341 
vyt
[
a
][
i
] = 
vy
[a][i];

342 
vzt
[
a
][
i
] = 
vz
[a][i];

344 
vxi
[
a
] = 
c0
*
vx
[a][
i
] + 
c1mc2
 * 
dt
 * 
axü
 + 
dvx
;

345 
vyi
[
a
] = 
c0
*
vy
[a][
i
] + 
c1mc2
 * 
dt
 * 
ayü
 + 
dvy
;

346 
vzi
[
a
] = 
c0
*
vz
[a][
i
] + 
c1mc2
 * 
dt
 * 
azü
 + 
dvz
;

348 
movög
[
a
] = 0;

349 
moved
[
a
] = 1;

352 
ô
 = 0;

353 
d⁄e
 = 0;

356  (
d⁄e
 =0Ë&& (
ô
 <
maxIt
) )

358 
d⁄e
 = 1;

360 
a
=0;á < 
NB
;á++)

362 
b
 = 
a
 + 1;

363 i‡(
b
 >
NA
) b = 0;

365 i‡–(
moved
[
a
]==1Ë|| (moved[
b
] == 1))

367 
pxab
 = 
pxi
[
a
] -Öxi[
b
];

368 
pyab
 = 
pyi
[
a
] -Öyi[
b
];

369 
pzab
 = 
pzi
[
a
] -Özi[
b
];

370 
pxab
 =Öxab - 
L
 * 
	`röt
(
övL
 *Öxab);

371 
pyab
 =Öyab - 
L
 * 
	`röt
(
övL
 *Öyab);

372 
pzab
 =Özab - 
L
 * 
	`röt
(
övL
 *Özab);

374 
∑bSq
 = 
	`Sqr
(
pxab
Ë+ Sqr(
pyab
Ë+ Sqr(
pzab
);

375 
øbSq
 = 
dSq
;

376 
diffSq
 = 
øbSq
 - 
∑bSq
;

378 i‡–
	`Ábs
(
diffSq
Ë> ( 
øbSq
 * 
tﬁ2
 ) )

380 
rxab
 = 
rxi
[
a
] -Ñxi[
b
];

381 
ryab
 = 
ryi
[
a
] -Ñyi[
b
];

382 
rzab
 = 
rzi
[
a
] -Ñzi[
b
];

383 
rxab
 =Ñxab - 
L
 * 
	`röt
(
övL
 *Ñxab);

384 
ryab
 =Ñyab - 
L
 * 
	`röt
(
övL
 *Ñyab);

385 
rzab
 =Ñzab - 
L
 * 
	`röt
(
övL
 *Ñzab);

386 
Ωab
 = 
rxab
 * 
pxab
 + 
ryab
 * 
pyab
 + 
rzab
 * 
pzab
;

388 i‡–
Ωab
 < (
øbSq
 * 
Ωtﬁ
) )

391 
	`mdMsg
(
ALL
, 
NOSYS
, 
NULL
, "ERROR", NULL,

393 
NULL
);

394 
	`exô
(-1);

397 
rma
 = 1.0 / 
m
[
a
];

398 
rmb
 = 1.0 / 
m
[
b
];

399 
gab
 = 
diffSq
 / ( 2.0 * ( 
rma
 + 
rmb
 ) * 
Ωab
 );

400 
dx
 = 
rxab
 * 
gab
;

401 
dy
 = 
ryab
 * 
gab
;

402 
dz
 = 
rzab
 * 
gab
;

404 
pxi
[
a
] =Öxi[a] + 
rma
 * 
dx
;

405 
pyi
[
a
] =Öyi[a] + 
rma
 * 
dy
;

406 
pzi
[
a
] =Özi[a] + 
rma
 * 
dz
;

407 
pxi
[
b
] =Öxi[b] - 
rmb
 * 
dx
;

408 
pyi
[
b
] =Öyi[b] - 
rmb
 * 
dy
;

409 
pzi
[
b
] =Özi[b] - 
rmb
 * 
dz
;

411 
dx
 = dx / 
dt
;

412 
dy
 = dy / 
dt
;

413 
dz
 = dz / 
dt
;

415 
vxi
[
a
] = vxi[a] + 
rma
 * 
dx
;

416 
vyi
[
a
] = vyi[a] + 
rma
 * 
dy
;

417 
vzi
[
a
] = vzi[a] + 
rma
 * 
dz
;

418 
vxi
[
b
] = vxi[b] - 
rmb
 * 
dx
;

419 
vyi
[
b
] = vyi[b] - 
rmb
 * 
dy
;

420 
vzi
[
b
] = vzi[b] - 
rmb
 * 
dz
;

422 
movög
[
a
] = 1;

423 
movög
[
b
] = 1;

424 
d⁄e
 = 0;

432 
a
=0;á < 
NA
;á++)

434 
moved
[
a
] = 
movög
[a];

435 
movög
[
a
] = 0;

437 
ô
 = it + 1;

440 i‡(
d⁄e
 == 0)

442 
	`•rötf
(
msgSåA
, "MOLECULE N. %d", 
i
);

443 
	`mdMsg
(
ALL
, 
NOSYS
, 
NULL
, "ERROR", NULL,

445 
msgSåA
,

446 
NULL
);

447 
	`exô
(-1);

451 
a
=0;á < 
NA
;á++)

453 
rx
[
a
][
i
] = 
pxi
[a];

454 
ry
[
a
][
i
] = 
pyi
[a];

455 
rz
[
a
][
i
] = 
pzi
[a];

457 
vx
[
a
][
i
] = 
vxi
[a];

458 
vy
[
a
][
i
] = 
vyi
[a];

459 
vz
[
a
][
i
] = 
vzi
[a];

466 i‡(
O¥ogSètus
.
No£
 == -1) ;

467 
Vﬁ
 = Vﬁ + 
dt
 * 
Vﬁ1
 + 
dtSq2
 * 
Vﬁ2
;

468 
Vﬁ1t
 = 
Vﬁ1
;

469 
Vﬁ1
 = Vﬁ1 + 
dt2
 * 
Vﬁ2
;

471 
	}
}

475 
	$shakeVñ
(
Nm
, 
COORD_TYPE
 
dt
, COORD_TYPE 
m
[
NA
], 
maxIt
, 
NB
,

476 
COORD_TYPE
 
d
, COORD_TYPE 
tﬁ
, COORD_TYPE **
v2sx
,

477 
COORD_TYPE
** 
v2sy
, COORD_TYPE** 
v2sz
 )

479 
COORD_TYPE
 
DRx
, 
DRy
, 
DRz
;

480 
COORD_TYPE
 
rxi
[
NA
], 
ryi
[NA], 
rzi
[NA], 
vxi
[NA], 
vyi
[NA], 
vzi
[NA];

481 
COORD_TYPE
 
rxab
, 
ryab
, 
rzab
, 
rvab
, 
gab
, 
dSq
;

482 
COORD_TYPE
 
vxab
, 
vyab
, 
vzab
;

483 
COORD_TYPE
 
dx
, 
dy
, 
dz
, 
dt2
, 
rma
, 
rmb
;

484 
i
, 
a
, 
b
, 
ô
;

485 
d⁄e
;

486 
movög
[
NA
], 
moved
[NA];

488 
dSq
 = 
	`Sqr
(
d
);

490 
WC
 = 0.0;

491 #i‡!
	`deföed
(
MOLPTENS
Ë|| deföed(
ATPTENS
)

492 
WCxy
 = 0.0;

493 
WCyz
 = 0.0;

494 
WCzx
 = 0.0;

495 
WCxx
 = 0.0;

496 
WCyy
 = 0.0;

497 
WCzz
 = 0.0;

499 
dt2
 = 
dt
 * 0.5;

500 
i
=0; i < 
Nm
; i++)

503 
a
=0;á < 
NA
;á++)

505 
rxi
[
a
] = 
rx
[a][
i
];

506 
ryi
[
a
] = 
ry
[a][
i
];

507 
rzi
[
a
] = 
rz
[a][
i
];

509 
vxi
[
a
] = 
v2sx
[a][
i
];

510 
vyi
[
a
] = 
v2sy
[a][
i
];

511 
vzi
[
a
] = 
v2sz
[a][
i
];

513 
movög
[
a
] = 0;

514 
moved
[
a
] = 1;

518 
ô
 = 0;

519 
d⁄e
 = 0;

520 (
d⁄e
 =0 ) && ( 
ô
 <
maxIt
 ))

522 
d⁄e
 = 1;

523 
a
=0;á < 
NB
;á++)

525 
b
 = 
a
 + 1;

526 i‡(
b
 >
NA
) b = 0;

528 i‡–(
moved
[
a
] =1Ë|| (moved[
b
] == 1) )

530 
rxab
 = 
rxi
[
a
] -Ñxi[
b
];

531 
ryab
 = 
ryi
[
a
] -Ñyi[
b
];

532 
rzab
 = 
rzi
[
a
] -Ñzi[
b
];

538 
DRx
 = - 
L
 * 
	`röt
(
övL
*
rxab
);

539 
DRy
 = - 
L
 * 
	`röt
(
övL
*
ryab
);

540 
DRz
 = - 
L
 * 
	`röt
(
övL
*
rzab
);

542 
rxab
 =Ñxab + 
DRx
;

543 
ryab
 =Ñyab + 
DRy
;

544 
rzab
 =Ñzab + 
DRz
;

546 
vxab
 = 
vxi
[
a
] - vxi[
b
];

547 
vyab
 = 
vyi
[
a
] - vyi[
b
];

548 
vzab
 = 
vzi
[
a
] - vzi[
b
];

550 
rvab
 = 
rxab
 * 
vxab
 + 
ryab
 * 
vyab
 + 
rzab
 * 
vzab
;

551 
rma
 = 1.0 / 
m
[
a
];

552 
rmb
 = 1.0 / 
m
[
b
];

553 
gab
 = (-
rvab
Ë/ ( ( 
rma
 + 
rmb
 ) * 
dSq
 );

555 i‡–
	`Ábs
(
gab
Ë> 
tﬁ
 )

557 
WC
 = WC + 
gab
 * 
dSq
;

559 
dx
 = 
rxab
 * 
gab
;

560 
dy
 = 
ryab
 * 
gab
;

561 
dz
 = 
rzab
 * 
gab
;

565 #i‡!
	`deföed
(
MOLPTENS
Ë|| deföed(
ATPTENS
)

566 
WCxx
 +
rxab
 * 
dx
;

567 
WCyy
 +
ryab
 * 
dy
;

568 
WCzz
 +
rzab
 * 
dz
;

569 
WCxy
 = WCxy + 
rxab
 * 
dy
;

570 
WCyz
 = WCyz + 
ryab
 * 
dz
;

571 
WCzx
 = WCzx + 
rzab
 * 
dx
;

573 
vxi
[
a
] = vxi[a] + 
rma
 * 
dx
;

574 
vyi
[
a
] = vyi[a] + 
rma
 * 
dy
;

575 
vzi
[
a
] = vzi[a] + 
rma
 * 
dz
;

576 
vxi
[
b
] = vxi[b] - 
rmb
 * 
dx
;

577 
vyi
[
b
] = vyi[b] - 
rmb
 * 
dy
;

578 
vzi
[
b
] = vzi[b] - 
rmb
 * 
dz
;

579 
movög
[
a
] = 1;

580 
movög
[
b
] = 1;

581 
d⁄e
 = 0;

585 
a
=0;á < 
NA
;á++)

587 
moved
[
a
] = 
movög
[a];

588 
movög
[
a
] = 0;

590 
ô
 = it + 1;

595 i‡(
d⁄e
 == 0)

597 
	`•rötf
(
msgSåA
, "MOLECULE N. %d", 
i
);

598 
	`mdMsg
(
ALL
, 
NOSYS
, 
NULL
, "ERROR", NULL,

600 
msgSåA
,

601 
NULL
);

602 
	`exô
(-1);

606 
a
=0;á < 
NA
;á++)

608 
v2sx
[
a
][
i
] = 
vxi
[a];

609 
v2sy
[
a
][
i
] = 
vyi
[a];

610 
v2sz
[
a
][
i
] = 
vzi
[a];

615 
WC
 = WC / 
dt2
 / 3.0;

616 #i‡!
	`deföed
(
MOLPTENS
Ë|| deföed(
ATPTENS
)

617 
WCxy
 = WCxy / 
dt2
;

619 
WCyz
 = WCyz / 
dt2
;

620 
WCzx
 = WCzx / 
dt2
;

622 
WCxx
 = WCxx / 
dt2
;

623 
WCyy
 = WCyy / 
dt2
;

624 
WCzz
 = WCzz / 
dt2
;

626 
	}
}

629 
COORD_TYPE
 
	$ˇlcT1dügMﬁ
(
Nm
, 
COORD_TYPE
 
VOL1
)

633 
i
;

634 
COORD_TYPE
 
kö
, 
d V
;

635 
COORD_TYPE
 
Vx
, 
Vy
, 
Vz
;

637 
kö
 = 0.0;

638 
d V
 = 
VOL1
 / 
Vﬁ
 / 3.0;

639 
i
=0; i < 
Nm
; i++)

641 
	`CoMV
(
i
, &
Vx
, &
Vy
, &
Vz
);

642 
kö
 +
	`Sqr
(
Vx
 - 
d V
 * 
Rx
[
i
]Ë+ Sqr(
Vy
 - d V * 
Ry
[i]) +

643 
	`Sqr
(
Vz
 - 
d V
 * 
Rz
[
i
]);

646 
kö
 *
MtŸ
;

647 
kö
 /3.0 * 
Vﬁ
;

648  
kö
;

650 
	}
}

652 
COORD_TYPE
 
	$ˇlcT1dügAt
(
Nm
, 
COORD_TYPE
 
VOL1
)

656 
i
, 
a
;

657 
COORD_TYPE
 
kö
, 
d V
, *
m
;

659 
m
 = 
O∑øms
.m;

660 
kö
 = 0.0;

661 
d V
 = 
VOL1
 / 
Vﬁ
 / 3.0;

662 
i
=0; i < 
Nm
; i++)

664 
a
=0;á < 
NA
;á++)

666 
kö
 +
m
[
a
]*(
	`Sqr
(
vx
[a][
i
] - 
d V
 * 
Rx
[i]) +

667 
	`Sqr
(
vy
[
a
][
i
] - 
d V
 * 
Ry
[i]) +

668 
	`Sqr
(
vz
[
a
][
i
] - 
d V
 * 
Rz
[i]));

671 
kö
 /3.0 * 
Vﬁ
;

672  
kö
;

673 
	}
}

675 
	$ˇlcPãnsMﬁ
(
Nm
, 
COORD_TYPE
 
VOL1
)

677 
i
, 
a
;

678 
COORD_TYPE
 
vmx
, 
vmy
, 
vmz
, 
d V
, 
Px
, 
Py
, 
Pz
, *
m
;

680 
T1mxy
 = 0.0;

681 
T1myz
 = 0.0;

682 
T1mzx
 = 0.0;

683 
T1mxx
 = 0.0;

684 
T1myy
 = 0.0;

685 
T1mzz
 = 0.0;

686 
m
 = 
O∑øms
.m;

687 
d V
 = 
VOL1
 / 
Vﬁ
 / 3.0;

688 
i
=0; i < 
Nm
; i++)

690 
vmx
 = 
vmy
 = 
vmz
 = 0.0;

691 
a
=0;á < 
NA
;á++)

693 
vmx
 +
vx
[
a
][
i
] * 
m
[a];

694 
vmy
 +
vy
[
a
][
i
] * 
m
[a];

695 
vmz
 +
vz
[
a
][
i
] * 
m
[a];

698 
Px
 = 
vmx
 - 
d V
 * 
Rx
[
i
];

699 
Py
 = 
vmy
 - 
d V
 * 
Ry
[
i
];

700 
Pz
 = 
vmz
 - 
d V
 * 
Rz
[
i
];

702 
T1mxy
 +
Px
 * 
Py
 / 
MtŸ
;

703 
T1myz
 +
Py
 * 
Pz
 / 
MtŸ
;

704 
T1mzx
 +
Pz
 * 
Px
 / 
MtŸ
;

705 
T1mxx
 +
Px
 * Px / 
MtŸ
;

706 
T1myy
 +
Py
 * Py / 
MtŸ
;

707 
T1mzz
 +
Pz
 * Pz / 
MtŸ
;

711 
Pmxy
 = 
T1mxy
 + 
Wmxy
;

712 
Pmyz
 = 
T1myz
 + 
Wmyz
;

713 
Pmzx
 = 
T1mzx
 + 
Wmzx
;

714 
Pmxx
 = 
T1mxx
 + 
Wmxx
;

715 
Pmyy
 = 
T1myy
 + 
Wmyy
;

716 
Pmzz
 = 
T1mzz
 + 
Wmzz
;

719 
Pmxx
 /
Vﬁ
;

720 
Pmyy
 /
Vﬁ
;

721 
Pmzz
 /
Vﬁ
;

722 
Pmxy
 /
Vﬁ
;

723 
Pmyz
 /
Vﬁ
;

724 
Pmzx
 /
Vﬁ
;

725 
	}
}

728 
	$ˇlcPãnsAt
(
Nm
, 
COORD_TYPE
 
VOL1
)

731 
i
, 
a
;

732 
COORD_TYPE
 
d V
, 
px
, 
py
, 
pz
, *
m
;

734 
m
 = 
O∑øms
.m;

735 
T1xy
 = 0.0;

736 
T1yz
 = 0.0;

737 
T1zx
 = 0.0;

738 
T1xx
 = 0.0;

739 
T1yy
 = 0.0;

740 
T1zz
 = 0.0;

742 
d V
 = 
VOL1
 / 
Vﬁ
 / 3.0;

743 
i
=0; i < 
Nm
; i++)

745 
a
=0;á < 
NA
;á++)

747 
px
 = 
vx
[
a
][
i
] - 
d V
 * 
Rx
[i];

748 
py
 = 
vy
[
a
][
i
] - 
d V
 * 
Ry
[i];

749 
pz
 = 
vz
[
a
][
i
] - 
d V
 * 
Rz
[i];

751 
T1xy
 +
px
 * 
py
 * 
m
[
a
];

752 
T1yz
 +
py
 * 
pz
 * 
m
[
a
];

753 
T1zx
 +
pz
 * 
px
 * 
m
[
a
] ;

754 
T1xx
 +
px
 *Öx * 
m
[
a
];

755 
T1yy
 +
py
 *Öy * 
m
[
a
];

756 
T1zz
 +
pz
 *Öz * 
m
[
a
];

761 
P©xy
 = 
T1xy
 + 
Wxy
 + 
WCxy
;

762 
P©yz
 = 
T1yz
 + 
Wyz
 + 
WCyz
;

763 
P©zx
 = 
T1zx
 + 
Wzx
 + 
WCzx
;

764 
P©xx
 = 
T1xx
 + 
Wxx
 + 
WCxx
;

765 
P©yy
 = 
T1yy
 + 
Wyy
 + 
WCyy
;

766 
P©zz
 = 
T1zz
 + 
Wzz
 + 
WCzz
;

769 
P©xx
 /
Vﬁ
;

770 
P©yy
 /
Vﬁ
;

771 
P©zz
 /
Vﬁ
;

772 
P©xy
 /
Vﬁ
;

773 
P©yz
 /
Vﬁ
;

774 
P©zx
 /
Vﬁ
;

775 
	}
}

777 c⁄° 
	gôtﬁ
 = 1E-20;

778 
movebBrownAnd
(
dt
, 
tﬁ
, 
maxIt
, 
NB
, 
m
[3], 
d
,

779 
Nm
)

782 
COORD_TYPE
 
	gFxNo£
, 
	gFyNo£
, 
	gFzNo£
, 
	gFxAnd
, 
	gFyAnd
, 
	gFzAnd
, 
	gcfAnd
, 
	gd s
, 
	gd V
,

783 
	gd VSq
;

784 
COORD_TYPE
 
	gVﬁ1g
, 
	gs1i
, 
	gVﬁ1i
;

785 
COORD_TYPE
 
	gDT
, 
	gA
, 
	gB
, 
	gDP
, 
	gc0
, 
	gc1
, 
	gc2
, 
	gchsi
;

786 
	gi
, 
	ga
, 
	gk
, 
	gnumok
;

787 c⁄° 
	gMAXNUMIT
 = 20;

790 
	gchsi
 = 
O∑øms
.
chsi
;

791 
	gc0
 = 
exp
(-
chsi
*
dt
);

792 
	gc1
 = (1-
c0
)/(
chsi
*
dt
);

793 
	gc2
 = (1-
c1
)/(
chsi
*
dt
);

795 
	gi
=0; i < 
	gNm
; i++)

797 
CoM
(
i
, &
Rx
[i], &
Ry
[i], &
Rz
[i]);

798 
	ga
=0;á < 
	gNA
;á++)

800 
	gvxt2
[
a
][
i
] = 
vx
[a][i];

801 
	gvyt2
[
a
][
i
] = 
vy
[a][i];

802 
	gvzt2
[
a
][
i
] = 
vz
[a][i];

804 
	gFxLJ
[
a
][
i
] = 
Fx
[a][i];

805 
	gFyLJ
[
a
][
i
] = 
Fy
[a][i];

806 
	gFzLJ
[
a
][
i
] = 
Fz
[a][i];

820 
	gvx
[
a
][
i
] = 5.0 * 
vxt
[a][i] / 2.0 - 2.0 * 
vxo1
[a][i] +

821 
vxo2
[
a
][
i
] / 2.0;

822 
	gvy
[
a
][
i
] = 5.0 * 
vyt
[a][i] / 2.0 - 2.0 * 
vyo1
[a][i] +

823 
vyo2
[
a
][
i
] / 2.0;

824 
	gvz
[
a
][
i
] = 5.0 * 
vzt
[a][i] / 2.0 - 2.0 * 
vzo1
[a][i] +

825 
vzo2
[
a
][
i
] / 2.0;

829 
	gs1i
 = 
s1
;

831 
	gVﬁ1i
 = 
Vﬁ1
;

838 
	gVﬁ1
 = 5.0 * 
Vﬁ1t
 / 2.0 - 2.0 * 
Vﬁ1o1
 + 
Vﬁ1o2
 / 2.0;

840 
shakeVñ
(
Nm
, 
dt
, 
m
, 
maxIt
, 
NB
, 
d
, 
tﬁ
, 
vx
, 
vy
, 
vz
);

841 
	gk
=0; k < 
	gMAXNUMIT
; k++)

844 
köë
(
Nm
, 
vx
, 
vy
, 
vz
, 
Vﬁ1
);

846 
	gDT
 = 
s
 * (2.0 * 
K
 - (5.0 * 
Nm
 - 3.0Ë* 
O∑øms
.
T
) /

847 
O¥ogSètus
.
Q
;

848 
	gA
 = 
s1i
 + 0.5 * 
dt
 * 
DT
;

850 
	gs1
 = 
A
 + 0.5 * 
Sqr
(AË* 
dt
 / 
s
 + Sqr(dt) * 0.5 * Sqr(A) * A / Sqr(s);

851 
	gd s
 = 
s1
 / 
s
 ;

852 
	gs2
 = 
Sqr
(
s1
Ë/ 
s
 + 
DT
;

856 #ifde‡
MOLPTENS


857 
	g¥ess_m
 = 
ˇlcT1dügMﬁ
(
Nm
, 
Vﬁ1
Ë+ 
	gWm
 / 3.0 / 
	gVﬁ
;

860 
	gDP
 = 
Sqr
(
s
Ë* (
¥ess_m
 - 
O∑øms
.
P
Ë/ 
O¥ogSètus
.
W
;

862 
	g¥ess_©
 = 
ˇlcT1dügAt
(
Nm
, 
Vﬁ1
Ë+ (
	gW
 + 
	gWC
Ë/ 
	gVﬁ
;

864 
	gDP
 = 
Sqr
(
s
Ë* (
¥ess_©
 - 
O∑øms
.
P
Ë/ 
O¥ogSètus
.
W
;

866 
	gB
 = 
Vﬁ1i
 + 0.5 * 
dt
 * 
DP
;

867 
	gVﬁ1
 = 
B
 / (1.0 - 0.5 * 
dt
 * 
s1
 / 
s
);

868 
	gVﬁ2
 = 
DP
 + 
s1
 * 
Vﬁ1
 / 
s
;

871 
	gd V
 = 
Vﬁ1
 / 
Vﬁ
;

872 
	gd VSq
 = 
Sqr
(
d V
);

873 
	gcfAnd
 = - 2.0 * 
d VSq
 / 9.0;

874 
	gcfAnd
 +
Vﬁ2
 / 
Vﬁ
 / 3.0;

876 
	gcfAnd
 +
d s
 * 
d V
 / 3.0;

878 
	gi
=0; i < 
	gNm
; i++)

880 
	ga
=0;á < 
	gNA
;á++)

887 
	gFxAnd
 = 
cfAnd
 * 
Rx
[
i
] * 
m
[
a
];

888 
	gFyAnd
 = 
cfAnd
 * 
Ry
[
i
] * 
m
[
a
];

889 
	gFzAnd
 = 
cfAnd
 * 
Rz
[
i
] * 
m
[
a
];

890 
	gFx
[
a
][
i
] = 
FxLJ
[a][i] + 
FxAnd
;

891 
	gFy
[
a
][
i
] = 
FyLJ
[a][i] + 
FyAnd
;

892 
	gFz
[
a
][
i
] = 
FzLJ
[a][i] + 
FzAnd
;

894 
	gvxﬁd
[
a
][
i
] = 
vx
[a][i];

895 
	gvyﬁd
[
a
][
i
] = 
vy
[a][i];

896 
	gvzﬁd
[
a
][
i
] = 
vz
[a][i];

898 
	gvx
[
a
][
i
] = 
vxt2
[a][i] + 
c2
 * 
dt
 * 
Fx
[a][i] / 
m
[a];

899 
	gvy
[
a
][
i
] = 
vyt2
[a][i] + 
c2
 * 
dt
 * 
Fy
[a][i] / 
m
[a];

900 
	gvz
[
a
][
i
] = 
vzt2
[a][i] + 
c2
 * 
dt
 * 
Fz
[a][i] / 
m
[a];

902 
	gvx
[
a
][
i
] /1.0 + 0.5 * 
dt
 * 
d s
;

903 
	gvy
[
a
][
i
] /1.0 + 0.5 * 
dt
 * 
d s
;

904 
	gvz
[
a
][
i
] /1.0 + 0.5 * 
dt
 * 
d s
;

907 
	gFxNo£
 = - 
d s
 * 
vx
[
a
][
i
] * 
m
[a];

908 
	gFyNo£
 = - 
d s
 * 
vy
[
a
][
i
] * 
m
[a];

909 
	gFzNo£
 = - 
d s
 * 
vz
[
a
][
i
] * 
m
[a];

911 
	gFx
[
a
][
i
] = 
Fx
[a][i] + 
FxNo£
;

912 
	gFy
[
a
][
i
] = 
Fy
[a][i] + 
FyNo£
;

913 
	gFz
[
a
][
i
] = 
Fz
[a][i] + 
FzNo£
;

917 
shakeVñ
(
Nm
, 
dt
, 
m
, 
maxIt
, 
NB
, 
d
, 
tﬁ
, 
vx
, 
vy
, 
vz
);

921 
	gnumok
 = 0;

922 
	gi
=0; i < 
	gO∑øms
.
	g∑∫um
; i++)

924 
	ga
 = 0;á < 
	gNA
;á++)

927 i‡(
Ábs
(
vx
[
a
][
i
]- 
vxﬁd
[a][i]Ë< 
	gôtﬁ
 &&

928 
Ábs
(
vy
[
a
][
i
]- 
vyﬁd
[a][i]Ë< 
	gôtﬁ
 &&

929 
Ábs
(
vz
[
a
][
i
]- 
vzﬁd
[a][i]Ë< 
	gôtﬁ
)

930 
	gnumok
++;

933 i‡(
	gnumok
 =
NA
*
O∑øms
.
∑∫um
)

945 
köë
(
Nm
, 
vx
, 
vy
, 
vz
, 
Vﬁ1
);

948 #ifde‡
MOLPTENS


950 
ˇlcPãnsMﬁ
(
Nm
, 
Vﬁ1
);

951 
	g¥ess_m
 = (
Pmxx
 + 
Pmyy
 + 
Pmzz
) / 3.0;

954 #i‡!
deföed
(
MOLPTENS
Ë|| deföed(
ATPTENS
)

956 
ˇlcPãnsAt
(
Nm
, 
Vﬁ1
);

957 
	g¥ess_©
 = (
P©xx
 + 
P©yy
 + 
P©zz
) / 3.0;

960 #i‡!
deföed
(
MOLPTENS
Ë&& !deföed(
ATPTENS
Ë&& deföed(
ATPRESS
)

962 
	g¥ess_©
 = 
ˇlcT1dügAt
(
Nm
, 
Vﬁ1
Ë+ (
	gW
 + 
	gWC
Ë/ 
	gVﬁ
;

966 #ifde‡
MOLPTENS


968 
	g¥ess
 = 
¥ess_m
;

969 
	gPxy
 = 
Pmxy
;

970 
	gPyz
 = 
Pmyz
;

971 
	gPzx
 = 
Pmzx
;

973 
	g¥ess
 = 
¥ess_©
;

974 
	gPxy
 = 
P©xy
;

975 
	gPyz
 = 
P©yz
;

976 
	gPzx
 = 
P©zx
;

981 
	gVﬁ1o2
 = 
Vﬁ1o1
;

983 
	gs1o2
 = 
s1o1
;

985 
	gVﬁ1o1
 = 
Vﬁ1t
;

987 
	gs1o1
 = 
s1t
;

989 
	gi
=0; i < 
	gNm
; i++)

991 
	ga
=0;á < 
	gNA
;á++)

993 
	gvxo2
[
a
][
i
] = 
vxo1
[a][i];

994 
	gvyo2
[
a
][
i
] = 
vyo1
[a][i];

995 
	gvzo2
[
a
][
i
] = 
vzo1
[a][i];

996 
	gvxo1
[
a
][
i
] = 
vxt
[a][i];

997 
	gvyo1
[
a
][
i
] = 
vyt
[a][i];

998 
	gvzo1
[
a
][
i
] = 
vzt
[a][i];

1006 
movebNTV
(
COORD_TYPE
 
dt
, COORD_TYPE 
tﬁ
, 
maxIt
, 
NB
,

1007 
COORD_TYPE
 
m
[3], COORD_TYPE 
d
, 
Nm
)

1012 
COORD_TYPE
 
	gFxNo£
, 
	gFyNo£
, 
	gFzNo£
, 
	gd s
;

1013 
COORD_TYPE
 
	gs1i
;

1014 
COORD_TYPE
 
	gDT
, 
	gA
, 
	gdt2
;

1015 
	gi
, 
	ga
, 
	gk
, 
	gnumok
;

1016 c⁄° 
	gMAXNUMIT
 = 40;

1018 
	gdt2
 = 
dt
 * 0.5;

1020 
	gi
=0; i < 
	gNm
; i++)

1022 
CoM
(
i
, &
Rx
[i], &
Ry
[i], &
Rz
[i]);

1023 
	ga
=0;á < 
	gNA
;á++)

1025 
	gvxt2
[
a
][
i
] = 
vx
[a][i];

1026 
	gvyt2
[
a
][
i
] = 
vy
[a][i];

1027 
	gvzt2
[
a
][
i
] = 
vz
[a][i];

1029 
	gFxLJ
[
a
][
i
] = 
Fx
[a][i];

1030 
	gFyLJ
[
a
][
i
] = 
Fy
[a][i];

1031 
	gFzLJ
[
a
][
i
] = 
Fz
[a][i];

1045 
	gvx
[
a
][
i
] = 5.0 * 
vxt
[a][i] / 2.0 - 2.0 * 
vxo1
[a][i] +

1046 
vxo2
[
a
][
i
] / 2.0;

1047 
	gvy
[
a
][
i
] = 5.0 * 
vyt
[a][i] / 2.0 - 2.0 * 
vyo1
[a][i] +

1048 
vyo2
[
a
][
i
] / 2.0;

1049 
	gvz
[
a
][
i
] = 5.0 * 
vzt
[a][i] / 2.0 - 2.0 * 
vzo1
[a][i] +

1050 
vzo2
[
a
][
i
] / 2.0;

1053 
	gs1i
 = 
s1
;

1055 
shakeVñ
(
Nm
, 
dt
, 
m
, 
maxIt
, 
NB
, 
d
, 
tﬁ
, 
vx
, 
vy
, 
vz
);

1058 
	gk
=0; k < 
	gMAXNUMIT
; k++)

1060 
köë
(
Nm
, 
vx
, 
vy
, 
vz
, 0.0);

1062 
	gDT
 = 
s
 * (2.0 * 
K
 - (6.0 * 
Nm
 - 3.0Ë* 
O∑øms
.
T
) /

1063 
O¥ogSètus
.
Q
;

1065 
¥ötf
("K guess: %.20‡s1=%.15‡s2=%.15‡O∑øms.T=%‡DT=%f\n", 
K
, 
s1
, 
s2
, 
O∑øms
.
T
, 
DT
);

1067 
	gA
 = 
s1i
 + 0.5 * 
dt
 * 
DT
;

1069 
	gs1
 = 
A
 + 0.5 * 
Sqr
(AË* 
dt
 / 
s
 + Sqr(dt) * 0.5 * Sqr(A) * A / Sqr(s);

1070 
	gd s
 = 
s1
 / 
s
 ;

1071 
	gs2
 = 
Sqr
(
s1
Ë/ 
s
 + 
DT
;

1072 
	gnumok
=0;

1073 
	gi
=0; i < 
	gNm
; i++)

1075 
	ga
=0;á < 
	gNA
;á++)

1081 
	gFx
[
a
][
i
] = 
FxLJ
[a][i];

1082 
	gFy
[
a
][
i
] = 
FyLJ
[a][i];

1083 
	gFz
[
a
][
i
] = 
FzLJ
[a][i];

1086 
	gvxﬁd
[
a
][
i
] = 
vx
[a][i];

1087 
	gvyﬁd
[
a
][
i
] = 
vy
[a][i];

1088 
	gvzﬁd
[
a
][
i
] = 
vz
[a][i];

1090 
	gvx
[
a
][
i
] = 
vxt2
[a][i] + 
dt2
 * 
Fx
[a][i] / 
m
[a];

1091 
	gvy
[
a
][
i
] = 
vyt2
[a][i] + 
dt2
 * 
Fy
[a][i] / 
m
[a];

1092 
	gvz
[
a
][
i
] = 
vzt2
[a][i] + 
dt2
 * 
Fz
[a][i] / 
m
[a];

1093 
	gvx
[
a
][
i
] /1.0 + 0.5 * 
dt
 * 
d s
;

1094 
	gvy
[
a
][
i
] /1.0 + 0.5 * 
dt
 * 
d s
;

1095 
	gvz
[
a
][
i
] /1.0 + 0.5 * 
dt
 * 
d s
;

1098 
	gFxNo£
 = - 
d s
 * 
vx
[
a
][
i
] * 
m
[a];

1099 
	gFyNo£
 = - 
d s
 * 
vy
[
a
][
i
] * 
m
[a];

1100 
	gFzNo£
 = - 
d s
 * 
vz
[
a
][
i
] * 
m
[a];

1101 
	gFx
[
a
][
i
] = 
FxLJ
[a][i] + 
FxNo£
;

1102 
	gFy
[
a
][
i
] = 
FyLJ
[a][i] + 
FyNo£
;

1103 
	gFz
[
a
][
i
] = 
FzLJ
[a][i] + 
FzNo£
;

1106 
shakeVñ
(
Nm
, 
dt
, 
m
, 
maxIt
, 
NB
, 
d
, 
tﬁ
, 
vx
, 
vy
, 
vz
);

1107 
	gi
=0; i < 
	gO∑øms
.
	g∑∫um
; i++)

1109 
	ga
 = 0;á < 
	gNA
;á++)

1112 i‡(
Ábs
(
vx
[
a
][
i
]- 
vxﬁd
[a][i]Ë< 
	gôtﬁ
 &&

1113 
Ábs
(
vy
[
a
][
i
]- 
vyﬁd
[a][i]Ë< 
	gôtﬁ
 &&

1114 
Ábs
(
vz
[
a
][
i
]- 
vzﬁd
[a][i]Ë< 
	gôtﬁ
)

1115 
	gnumok
++;

1118 i‡(
	gnumok
 =
NA
*
O∑øms
.
∑∫um
)

1128 
köë
(
Nm
, 
vx
, 
vy
, 
vz
, 0.0);

1130 #ifde‡
MOLPTENS


1132 
ˇlcPãnsMﬁ
(
Nm
, 0.0);

1134 
	g¥ess_m
 = (
Pmxx
 + 
Pmyy
 + 
Pmzz
) / 3.0;

1138 #i‡!
deföed
(
MOLPTENS
Ë|| deföed(
ATPTENS
)

1139 
ˇlcPãnsAt
(
Nm
, 0.0);

1140 
	g¥ess_©
 = (
P©xx
 + 
P©yy
 + 
P©zz
) / 3.0;

1142 #i‡!
deföed
(
MOLPTENS
Ë&& !deföed(
ATPTENS
Ë&& deföed(
ATPRESS
)

1144 
	g¥ess_©
 = 
ˇlcT1dügAt
(
Nm
, 0.0Ë+ (
	gW
 + 
	gWC
Ë/ 
	gVﬁ
;

1151 #ifde‡
MOLPTENS


1152 
	g¥ess
 = 
¥ess_m
;

1153 
	gPxy
 = 
Pmxy
;

1154 
	gPyz
 = 
Pmyz
;

1155 
	gPzx
 = 
Pmzx
;

1157 
	g¥ess
 = 
¥ess_©
;

1158 
	gPxy
 = 
P©xy
;

1159 
	gPyz
 = 
P©yz
;

1160 
	gPzx
 = 
P©zx
;

1165 
	gs1o2
 = 
s1o1
;

1166 
	gs1o1
 = 
s1t
;

1167 
	gi
=0; i < 
	gNm
; i++)

1169 
	ga
=0;á < 
	gNA
;á++)

1171 
	gvxo2
[
a
][
i
] = 
vxo1
[a][i];

1172 
	gvyo2
[
a
][
i
] = 
vyo1
[a][i];

1173 
	gvzo2
[
a
][
i
] = 
vzo1
[a][i];

1174 
	gvxo1
[
a
][
i
] = 
vxt
[a][i];

1175 
	gvyo1
[
a
][
i
] = 
vyt
[a][i];

1176 
	gvzo1
[
a
][
i
] = 
vzt
[a][i];

1184 
	$movebNPT
(
COORD_TYPE
 
dt
, COORD_TYPE 
tﬁ
, 
maxIt
, 
NB
,

1185 
COORD_TYPE
 
m
[
NA
], COORD_TYPE 
d
, 
Nm
)

1190 
COORD_TYPE
 
FxNo£
, 
FyNo£
, 
FzNo£
, 
FxAnd
, 
FyAnd
, 
FzAnd
, 
cfAnd
, 
d s
, 
d V
,

1191 
d VSq
;

1192 
COORD_TYPE
 
Vﬁ1g
, 
s1i
, 
Vﬁ1i
;

1193 
COORD_TYPE
 
DT
, 
A
, 
B
, 
DP
, 
dt2
;

1194 
i
, 
a
, 
k
, 
numok
;

1195 c⁄° 
MAXNUMIT
 = 20;

1198 
dt2
 = 
dt
 / 2.0;

1200 
i
=0; i < 
Nm
; i++)

1202 
	`CoM
(
i
, &
Rx
[i], &
Ry
[i], &
Rz
[i]);

1203 
a
=0;á < 
NA
;á++)

1205 
vxt2
[
a
][
i
] = 
vx
[a][i];

1206 
vyt2
[
a
][
i
] = 
vy
[a][i];

1207 
vzt2
[
a
][
i
] = 
vz
[a][i];

1209 
FxLJ
[
a
][
i
] = 
Fx
[a][i];

1210 
FyLJ
[
a
][
i
] = 
Fy
[a][i];

1211 
FzLJ
[
a
][
i
] = 
Fz
[a][i];

1225 
vx
[
a
][
i
] = 5.0 * 
vxt
[a][i] / 2.0 - 2.0 * 
vxo1
[a][i] +

1226 
vxo2
[
a
][
i
] / 2.0;

1227 
vy
[
a
][
i
] = 5.0 * 
vyt
[a][i] / 2.0 - 2.0 * 
vyo1
[a][i] +

1228 
vyo2
[
a
][
i
] / 2.0;

1229 
vz
[
a
][
i
] = 5.0 * 
vzt
[a][i] / 2.0 - 2.0 * 
vzo1
[a][i] +

1230 
vzo2
[
a
][
i
] / 2.0;

1233 
s1i
 = 
s1
;

1234 
Vﬁ1i
 = 
Vﬁ1
;

1241 
Vﬁ1
 = 5.0 * 
Vﬁ1t
 / 2.0 - 2.0 * 
Vﬁ1o1
 + 
Vﬁ1o2
 / 2.0;

1243 
	`shakeVñ
(
Nm
, 
dt
, 
m
, 
maxIt
, 
NB
, 
d
, 
tﬁ
, 
vx
, 
vy
, 
vz
);

1244 
k
=0; k < 
MAXNUMIT
; k++)

1246 
	`köë
(
Nm
, 
vx
, 
vy
, 
vz
, 
Vﬁ1
);

1248 
DT
 = 
s
 * (2.0 * 
K
 - (6.0 * 
Nm
 - 3.0Ë* 
O∑øms
.
T
) /

1249 
O¥ogSètus
.
Q
;

1250 
A
 = 
s1i
 + 0.5 * 
dt
 * 
DT
;

1252 
s1
 = 
A
 + 0.5 * 
	`Sqr
(AË* 
dt
 / 
s
 + Sqr(dt) * 0.5 * Sqr(A) * A / Sqr(s);

1253 
d s
 = 
s1
 / 
s
 ;

1254 
s2
 = 
	`Sqr
(
s1
Ë/ 
s
 + 
DT
;

1258 #ifde‡
MOLPTENS


1259 
¥ess_m
 = 
	`ˇlcT1dügMﬁ
(
Nm
, 
Vﬁ1
Ë+ 
Wm
 / 3.0 / 
Vﬁ
;

1262 
DP
 = 
	`Sqr
(
s
Ë* (
¥ess_m
 - 
O∑øms
.
P
Ë/ 
O¥ogSètus
.
W
;

1264 
¥ess_©
 = 
	`ˇlcT1dügAt
(
Nm
, 
Vﬁ1
Ë+ (
W
 + 
WC
Ë/ 
Vﬁ
;

1266 
DP
 = 
	`Sqr
(
s
Ë* (
¥ess_©
 - 
O∑øms
.
P
Ë/ 
O¥ogSètus
.
W
;

1268 
B
 = 
Vﬁ1i
 + 0.5 * 
dt
 * 
DP
;

1269 
Vﬁ1
 = 
B
 / (1.0 - 0.5 * 
dt
 * 
s1
 / 
s
);

1270 
Vﬁ2
 = 
DP
 + 
s1
 * 
Vﬁ1
 / 
s
;

1273 
d V
 = 
Vﬁ1
 / 
Vﬁ
;

1274 
d VSq
 = 
	`Sqr
(
d V
);

1275 
cfAnd
 = - 2.0 * 
d VSq
 / 9.0;

1276 
cfAnd
 +
Vﬁ2
 / 
Vﬁ
 / 3.0;

1277 
cfAnd
 +
d s
 * 
d V
 / 3.0;

1279 
i
=0; i < 
Nm
; i++)

1281 
a
=0;á < 
NA
;á++)

1288 
FxAnd
 = 
cfAnd
 * 
Rx
[
i
] * 
m
[
a
];

1289 
FyAnd
 = 
cfAnd
 * 
Ry
[
i
] * 
m
[
a
];

1290 
FzAnd
 = 
cfAnd
 * 
Rz
[
i
] * 
m
[
a
];

1291 
Fx
[
a
][
i
] = 
FxLJ
[a][i] + 
FxAnd
;

1292 
Fy
[
a
][
i
] = 
FyLJ
[a][i] + 
FyAnd
;

1293 
Fz
[
a
][
i
] = 
FzLJ
[a][i] + 
FzAnd
;

1295 
vxﬁd
[
a
][
i
] = 
vx
[a][i];

1296 
vyﬁd
[
a
][
i
] = 
vy
[a][i];

1297 
vzﬁd
[
a
][
i
] = 
vz
[a][i];

1299 
vx
[
a
][
i
] = 
vxt2
[a][i] + 
dt2
 * 
Fx
[a][i] / 
m
[a];

1300 
vy
[
a
][
i
] = 
vyt2
[a][i] + 
dt2
 * 
Fy
[a][i] / 
m
[a];

1301 
vz
[
a
][
i
] = 
vzt2
[a][i] + 
dt2
 * 
Fz
[a][i] / 
m
[a];

1302 
vx
[
a
][
i
] /1.0 + 0.5 * 
dt
 * 
d s
;

1303 
vy
[
a
][
i
] /1.0 + 0.5 * 
dt
 * 
d s
;

1304 
vz
[
a
][
i
] /1.0 + 0.5 * 
dt
 * 
d s
;

1307 
FxNo£
 = - 
d s
 * 
vx
[
a
][
i
] * 
m
[a];

1308 
FyNo£
 = - 
d s
 * 
vy
[
a
][
i
] * 
m
[a];

1309 
FzNo£
 = - 
d s
 * 
vz
[
a
][
i
] * 
m
[a];

1311 
Fx
[
a
][
i
] = Fx[a][i] + 
FxNo£
;

1312 
Fy
[
a
][
i
] = Fy[a][i] + 
FyNo£
;

1313 
Fz
[
a
][
i
] = Fz[a][i] + 
FzNo£
;

1316 
	`shakeVñ
(
Nm
, 
dt
, 
m
, 
maxIt
, 
NB
, 
d
, 
tﬁ
, 
vx
, 
vy
, 
vz
);

1320 
numok
=0;

1321 
i
=0; i < 
O∑øms
.
∑∫um
; i++)

1323 
a
 = 0;á < 
NA
;á++)

1326 i‡(
	`Ábs
(
vx
[
a
][
i
]- 
vxﬁd
[a][i]Ë< 
ôtﬁ
 &&

1327 
	`Ábs
(
vy
[
a
][
i
]- 
vyﬁd
[a][i]Ë< 
ôtﬁ
 &&

1328 
	`Ábs
(
vz
[
a
][
i
]- 
vzﬁd
[a][i]Ë< 
ôtﬁ
)

1329 
numok
++;

1332 i‡(
numok
 =
NA
*
O∑øms
.
∑∫um
)

1342 
	`köë
(
Nm
, 
vx
, 
vy
, 
vz
, 
Vﬁ1
);

1345 #ifde‡
MOLPTENS


1347 
	`ˇlcPãnsMﬁ
(
Nm
, 
Vﬁ1
);

1348 
¥ess_m
 = (
Pmxx
 + 
Pmyy
 + 
Pmzz
) / 3.0;

1351 #i‡!
	`deföed
(
MOLPTENS
Ë|| deföed(
ATPTENS
)

1353 
	`ˇlcPãnsAt
(
Nm
, 
Vﬁ1
);

1354 
¥ess_©
 = (
P©xx
 + 
P©yy
 + 
P©zz
) / 3.0;

1357 #i‡!
	`deföed
(
MOLPTENS
Ë&& !deföed(
ATPTENS
Ë&& deföed(
ATPRESS
)

1359 
¥ess_©
 = 
	`ˇlcT1dügAt
(
Nm
, 
Vﬁ1
Ë+ (
W
 + 
WC
Ë/ 
Vﬁ
;

1363 #ifde‡
MOLPTENS


1365 
¥ess
 = 
¥ess_m
;

1366 
Pxy
 = 
Pmxy
;

1367 
Pyz
 = 
Pmyz
;

1368 
Pzx
 = 
Pmzx
;

1370 
¥ess
 = 
¥ess_©
;

1371 
Pxy
 = 
P©xy
;

1372 
Pyz
 = 
P©yz
;

1373 
Pzx
 = 
P©zx
;

1378 
Vﬁ1o2
 = 
Vﬁ1o1
;

1379 
s1o2
 = 
s1o1
;

1380 
Vﬁ1o1
 = 
Vﬁ1t
;

1381 
s1o1
 = 
s1t
;

1382 
i
=0; i < 
Nm
; i++)

1384 
a
=0;á < 
NA
;á++)

1386 
vxo2
[
a
][
i
] = 
vxo1
[a][i];

1387 
vyo2
[
a
][
i
] = 
vyo1
[a][i];

1388 
vzo2
[
a
][
i
] = 
vzo1
[a][i];

1389 
vxo1
[
a
][
i
] = 
vxt
[a][i];

1390 
vyo1
[
a
][
i
] = 
vyt
[a][i];

1391 
vzo1
[
a
][
i
] = 
vzt
[a][i];

1395 
	}
}

1400 
	$moveb
(
COORD_TYPE
 
dt
, COORD_TYPE 
tﬁ
, 
maxIt
, 
NB
,

1401 
COORD_TYPE
 
m
[
NA
], COORD_TYPE 
d
, 
Nm
)

1406 
d⁄e
;

1407 
movög
[
NA
], 
moved
[NA];

1408 
COORD_TYPE
 
Ka
[
NA
], 
MtŸ
, 
vmx
, 
vmy
, 
vmz
;

1409 
COORD_TYPE
 
rxab
, 
ryab
, 
rzab
, 
rvab
, 
gab
, 
dSq
;

1410 
COORD_TYPE
 
vxab
, 
vyab
, 
vzab
;

1411 
COORD_TYPE
 
dx
, 
dy
, 
dz
, 
dt2
, 
rma
, 
rmb
, 
c2dt
;

1412 
COORD_TYPE
 
rxi
[
NA
], 
ryi
[NA], 
rzi
[NA], 
vxi
[NA], 
vyi
[NA], 
vzi
[NA];

1413 
c0
, 
c1
, 
c2
, 
chsi
;

1414 
i
, 
a
, 
b
, 
ô
;

1418 
dt2
 = 
dt
*0.5;

1419 i‡(
O¥ogSètus
.
No£
 == -1)

1421 
chsi
 = 
O∑øms
.chsi;

1422 
c0
 = 
	`exp
(-
chsi
*
dt
);

1423 
c1
 = (1-
c0
)/(
chsi
*
dt
);

1424 
c2
 = (1-
c1
)/(
chsi
*
dt
);

1425 
c2dt
 = 
dt
 * 
c2
;

1429 
c2dt

dt
 / 2.0;

1431 
K
 = 0.0;

1432 
L
 = 
	`cbπ
(
Vﬁ
);

1433 
övL
 = 1.0 / 
L
;

1434 
MtŸ
 = 0.0;

1435 
a
=0;á < 
NA
;á++)

1437 
MtŸ
 +
m
[
a
];

1438 
Ka
[
a
] = 0.0;

1441 
WC
 = 0.0;

1442 #i‡!
	`deföed
(
MOLPTENS
Ë|| deföed(
ATPTENS
)

1443 
WCxy
 = 0.0;

1444 
WCyz
 = 0.0;

1445 
WCzx
 = 0.0;

1447 
WCxx
 = 0.0;

1448 
WCyy
 = 0.0;

1449 
WCzz
 = 0.0;

1450 
T1xy
 = 0.0;

1451 
T1yz
 = 0.0;

1452 
T1zx
 = 0.0;

1453 
T1xx
 = 0.0;

1454 
T1yy
 = 0.0;

1455 
T1zz
 = 0.0;

1458 #ifde‡
MOLPTENS


1459 
T1mxy
 = 0.0;

1460 
T1myz
 = 0.0;

1461 
T1mzx
 = 0.0;

1462 
T1mxx
 = 0.0;

1463 
T1myy
 = 0.0;

1464 
T1mzz
 = 0.0;

1467 
dSq
 = 
	`Sqr
(
d
);

1469 
i
=0; i < 
Nm
; i++)

1472 
a
=0;á < 
NA
;á++)

1474 
rxi
[
a
] = 
rx
[a][
i
];

1475 
ryi
[
a
] = 
ry
[a][
i
];

1476 
rzi
[
a
] = 
rz
[a][
i
];

1477 
vxi
[
a
] = 
vx
[a][
i
] + 
c2dt
 * 
Fx
[a][i] / 
m
[a];

1478 
vyi
[
a
] = 
vy
[a][
i
] + 
c2dt
 * 
Fy
[a][i] / 
m
[a];

1479 
vzi
[
a
] = 
vz
[a][
i
] + 
c2dt
 * 
Fz
[a][i] / 
m
[a];

1481 
movög
[
a
] = 0;

1482 
moved
[
a
] = 1;

1486 
ô
 = 0;

1487 
d⁄e
 = 0;

1488 (
d⁄e
 =0 ) && ( 
ô
 <
maxIt
 ))

1490 
d⁄e
 = 1;

1491 
a
=0;á < 
NB
;á++)

1493 
b
 = 
a
 + 1;

1494 i‡(
b
 >
NA
) b = 0;

1496 i‡–(
moved
[
a
] =1Ë|| (moved[
b
] == 1) )

1498 
vxab
 = 
vxi
[
a
] - vxi[
b
];

1499 
vyab
 = 
vyi
[
a
] - vyi[
b
];

1500 
vzab
 = 
vzi
[
a
] - vzi[
b
];

1501 
rxab
 = 
rxi
[
a
] -Ñxi[
b
];

1502 
ryab
 = 
ryi
[
a
] -Ñyi[
b
];

1503 
rzab
 = 
rzi
[
a
] -Ñzi[
b
];

1504 
rxab
 =Ñxab - 
L
*
	`röt
(
övL
*rxab);

1505 
ryab
 =Ñyab - 
L
*
	`röt
(
övL
*ryab);

1506 
rzab
 =Ñzab - 
L
*
	`röt
(
övL
*rzab);

1507 
rvab
 = 
rxab
 * 
vxab
 + 
ryab
 * 
vyab
 + 
rzab
 * 
vzab
;

1508 
rma
 = 1.0 / 
m
[
a
];

1509 
rmb
 = 1.0 / 
m
[
b
];

1510 
gab
 = (-
rvab
Ë/ ( ( 
rma
 + 
rmb
 ) * 
dSq
 );

1512 i‡–
	`Ábs
(
gab
Ë> 
tﬁ
 )

1514 
WC
 = WC + 
gab
 * 
dSq
;

1515 
dx
 = 
rxab
 * 
gab
;

1516 
dy
 = 
ryab
 * 
gab
;

1517 
dz
 = 
rzab
 * 
gab
;

1521 #i‡!
	`deföed
(
MOLPTENS
Ë|| deföed(
ATPTENS
)

1522 
WCxx
 +
rxab
 * 
dx
;

1523 
WCyy
 +
ryab
 * 
dy
;

1524 
WCzz
 +
rzab
 * 
dz
;

1525 
WCxy
 = WCxy + 
rxab
 * 
dy
;

1526 
WCyz
 = WCyz + 
ryab
 * 
dz
;

1527 
WCzx
 = WCzx + 
rzab
 * 
dx
;

1533 
vxi
[
a
] = vxi[a] + 
rma
 * 
dx
;

1534 
vyi
[
a
] = vyi[a] + 
rma
 * 
dy
;

1535 
vzi
[
a
] = vzi[a] + 
rma
 * 
dz
;

1536 
vxi
[
b
] = vxi[b] - 
rmb
 * 
dx
;

1537 
vyi
[
b
] = vyi[b] - 
rmb
 * 
dy
;

1538 
vzi
[
b
] = vzi[b] - 
rmb
 * 
dz
;

1539 
movög
[
a
] = 1;

1540 
movög
[
b
] = 1;

1541 
d⁄e
 = 0;

1545 
a
=0;á < 
NA
;á++)

1547 
moved
[
a
] = 
movög
[a];

1548 
movög
[
a
] = 0;

1550 
ô
 = it + 1;

1553 i‡(
d⁄e
 == 0)

1555 
	`•rötf
(
msgSåA
, "MOLECULE N. %d", 
i
);

1556 
	`mdMsg
(
ALL
, 
NOSYS
, 
NULL
, "ERROR", NULL,

1558 
msgSåA
,

1559 
NULL
);

1560 
	`exô
(-1);

1563 #ifde‡
MOLPTENS


1564 
vmx
 = 
vmy
 = 
vmz
 = 0.0;

1566 
a
=0;á < 
NA
;á++)

1568 
vx
[
a
][
i
] = 
vxi
[a];

1569 
vy
[
a
][
i
] = 
vyi
[a];

1570 
vz
[
a
][
i
] = 
vzi
[a];

1571 #ifde‡
MOLPTENS


1572 
vmx
 +
vxi
[
a
] * 
m
[a];

1573 
vmy
 +
vyi
[
a
] * 
m
[a];

1574 
vmz
 +
vzi
[
a
] * 
m
[a];

1576 #i‡!
	`deföed
(
MOLPTENS
Ë|| deföed(
ATPTENS
)

1578 
T1xy
 +
vx
[
a
][
i
] * 
vy
[a][i] * 
m
[a];

1579 
T1yz
 +
vy
[
a
][
i
] * 
vz
[a][i] * 
m
[a];

1580 
T1zx
 +
vz
[
a
][
i
] * 
vx
[a][i] * 
m
[a];

1581 
T1xx
 +
vx
[
a
][
i
] * vx[a][i] * 
m
[a];

1582 
T1yy
 +
vy
[
a
][
i
] * vy[a][i] * 
m
[a];

1583 
T1zz
 +
vz
[
a
][
i
] * vz[a][i] * 
m
[a];

1585 
Ka
[
a
] = Ka[a] + 
	`Sqr
(
vxi
[a]Ë+ Sqr(
vyi
[a]Ë+ Sqr(
vzi
[a]);

1587 #ifde‡
MOLPTENS


1589 
T1mxy
 +
vmx
 * 
vmy
 / 
MtŸ
;

1590 
T1myz
 +
vmy
 * 
vmz
 / 
MtŸ
;

1591 
T1mzx
 +
vmz
 * 
vmx
 / 
MtŸ
;

1592 
T1mxx
 +
vmx
 * vmx / 
MtŸ
;

1593 
T1myy
 +
vmy
 * vmy / 
MtŸ
;

1594 
T1mzz
 +
vmz
 * vmz / 
MtŸ
;

1599 
i
=0; i < 
Nm
; i++)

1601 
a
=0;á < 
NA
;á++)

1603 
vxo2
[
a
][
i
] = 
vxo1
[a][i];

1604 
vyo2
[
a
][
i
] = 
vyo1
[a][i];

1605 
vzo2
[
a
][
i
] = 
vzo1
[a][i];

1606 
vxo1
[
a
][
i
] = 
vxt
[a][i];

1607 
vyo1
[
a
][
i
] = 
vyt
[a][i];

1608 
vzo1
[
a
][
i
] = 
vzt
[a][i];

1612 
a
=0;á < 
NA
;á++)

1614 
K
 = K + 
Ka
[
a
] * 
m
[a] * 0.5;

1617 
WC
 = WC / 
dt2
 / 3.0;

1619 #i‡!
	`deföed
(
MOLPTENS
Ë|| deföed(
ATPTENS
)

1620 
WCxy
 = WCxy / 
dt2
;

1622 
WCyz
 = WCyz / 
dt2
;

1623 
WCzx
 = WCzx / 
dt2
;

1627 #ifde‡
MOLPTENS


1629 
¥ess_m
 = 
T1mxx
 + 
T1myy
 + 
T1mzz
 + 
Wm
;

1630 
¥ess_m
 /
Vﬁ
 * 3.0;

1634 #i‡!
	`deföed
(
MOLPTENS
Ë|| deföed(
ATPTENS
)

1636 
P©xy
 = 
T1xy
 + 
Wxy
 + 
WCxy
;

1637 
P©yz
 = 
T1yz
 + 
Wyz
 + 
WCyz
;

1638 
P©zx
 = 
T1zx
 + 
Wzx
 + 
WCzx
;

1639 
P©xy
 /
Vﬁ
;

1640 
P©yz
 /
Vﬁ
;

1641 
P©zx
 /
Vﬁ
;

1642 
¥ess_©
 = (
T1xx
 + 
T1yy
 + 
T1zz
)/3.0 + 
WC
 + 
W
;

1643 
¥ess_©
 /
Vﬁ
;

1644 #ñi‡
	`deföed
(
ATPRESS
)

1646 
¥ess_©
 = 
	`ˇlcT1dügAt
(
Nm
, 0.0Ë+ (
W
 + 
WC
Ë/ 
Vﬁ
;

1650 #ifde‡
MOLPTENS


1653 
Pmxy
 = 
T1mxy
 + 
Wmxy
;

1654 
Pmyz
 = 
T1myz
 + 
Wmyz
;

1655 
Pmzx
 = 
T1mzx
 + 
Wmzx
;

1656 
Pmxy
 /
Vﬁ
;

1657 
Pmyz
 /
Vﬁ
;

1658 
Pmzx
 /
Vﬁ
;

1660 
¥ess_m
 = 
T1mxx
 + 
T1myy
 + 
T1mzz
 + 
Wm
;

1661 
¥ess_m
 /
Vﬁ
 * 3.0;

1664 #ifde‡
MOLPTENS


1665 
Pxy
 = 
Pmxy
;

1666 
Pyz
 = 
Pmyz
;

1667 
Pzx
 = 
Pmzx
;

1668 
¥ess
 = 
¥ess_m
;

1670 
Pxy
 = 
P©xy
;

1671 
Pyz
 = 
P©yz
;

1672 
Pzx
 = 
P©zx
;

1673 
¥ess
 = 
¥ess_©
;

1676 
	}
}

1689 
	$sˇlC‹
(
Nm
)

1691 
i
, 
a
;

1692 
COORD_TYPE
 
co°
, 
co°o1
, 
co°o2
, 
DRx
, 
DRy
, 
DRz
, 
Rx
, 
Ry
, 
Rz
;

1694 
L
 = 
	`cbπ
(
Vﬁ
);

1695 
övL
 = 1.0 / 
L
;

1696 
co°
 = 
Vﬁ1
 / 
Vﬁ
 / 3.0;

1697 
co°o1
 = 
Vﬁ1o1
 / 
Vﬁ
 / 3.0;

1698 
co°o2
 = 
Vﬁ1o2
 / 
Vﬁ
 / 3.0;

1701 
i
=0; i < 
O∑øms
.
∑∫um
; i++)

1703 
	`CoM
(
i
, &
Rx
, &
Ry
, &
Rz
);

1706 
DRx
 = - 
L
 * 
	`röt
(
övL
 * 
Rx
);

1707 
DRy
 = - 
L
 * 
	`röt
(
övL
 * 
Ry
);

1708 
DRz
 = - 
L
 * 
	`röt
(
övL
 * 
Rz
);

1710 
a
=0;á < 
NA
;á++)

1712 
rx
[
a
][
i
] +
DRx
;

1713 
ry
[
a
][
i
] +
DRy
;

1714 
rz
[
a
][
i
] +
DRz
;

1720 
vx
[
a
][
i
] +
co°
*
DRx
;

1721 
vy
[
a
][
i
] +
co°
*
DRy
;

1722 
vz
[
a
][
i
] +
co°
*
DRz
;

1723 
vxo1
[
a
][
i
] +
co°o1
*
DRx
;

1724 
vyo1
[
a
][
i
] +
co°o1
*
DRy
;

1725 
vzo1
[
a
][
i
] +
co°o1
*
DRz
;

1726 
vxo2
[
a
][
i
] +
co°o2
*
DRx
;

1727 
vyo2
[
a
][
i
] +
co°o2
*
DRy
;

1728 
vzo2
[
a
][
i
] +
co°o2
*
DRz
;

1731 
	}
}

1733 c⁄° 
COORD_TYPE
 
	gbc1
 = 14.0/45.0, 
	gbc2
 = 64.0/45.0, 
	gbc3
 = 24.0/45.0;

1736 
COORD_TYPE
 
	$BodeTîm
(
COORD_TYPE
 
dt
, COORD_TYPE* 
fi
)

1738  
dt
 * (
bc1
 * 
fi
[0] + 
bc2
 * fi[1] + 
bc3
 * fi[2] + bc2 * fi[3] +

1739 
bc1
 * 
fi
[4]);

1740 
	}
}

1743 
	#TINY
 1E-20

	)

1744 
ludcmp
(
a
[3][3], * 
ödx
, * 
d
)

1749 
	gi
,
	gimax
=0,
	gj
,
	gk
;

1750 c⁄° 
	gn
 = 3;

1751 
	gbig
,
	gdum
,
	gsum
,
	gãmp
;

1752 
	gvv
[3];

1755 *
	gd
=1.0;

1756 
	gi
=1;i<=
n
;i++)

1759 
	gbig
=0.0;

1760 
	gj
=1;j<=
n
;j++)

1761 i‡((
	gãmp
=
Ábs
(
a
[
i
][
j
])Ë> 
big
Ëbig=
ãmp
;

1762 i‡(
	gbig
 == 0.0)

1764 
¥ötf
("ERROR: Singular matrix inÑoutineÜudcmp\n");

1765 
exô
(-1);

1768 
	gvv
[
i
]=1.0/
big
;

1770 
	gj
=1;j<=
n
;j++)

1772 
	gi
=1;i<
	gj
;i++)

1775 
	gsum
=
a
[
i
][
j
];

1776 
	gk
=1;k<
	gi
;k++)

1777 
	gsum
 -
a
[
i
][
k
]*a[k][
j
];

1778 
	ga
[
i
][
j
]=
sum
;

1780 
	gbig
=0.0;

1781 
	gi
=
j
;i<=
n
;i++)

1784 
	gsum
=
a
[
i
][
j
];

1785 
	gk
=1;k<
	gj
;k++)

1786 
	gsum
 -
a
[
i
][
k
]*a[k][
j
];

1787 
	ga
[
i
][
j
]=
sum
;

1788 i‡–(
	gdum
=
vv
[
i
]*
Ábs
(
sum
)Ë>
big
)

1791 
big
=
dum
; 
	gimax
=
i
;

1794 i‡(
	gj
 !
imax
)

1797 
k
=1;
	gk
<=
n
;k++)

1800 
	gdum
=
a
[
imax
][
k
];

1801 
	ga
[
imax
][
k
]=
a
[
j
][k];

1802 
	ga
[
j
][
k
]=
dum
;

1804 *
	gd
 = -(*
d
);

1806 
	gvv
[
imax
]=
vv
[
j
];

1809 
	gödx
[
j
]=
imax
;

1810 i‡(
	ga
[
j
][j] == 0.0)

1811 
a
[
j
][j]=
TINY
;

1816 i‡(
	gj
 !
n
)

1819 
dum
=1.0/(
a
[
j
][j]);

1820 
	gi
=
j
+1;i<=
n
;i++Ë
	ga
[
i
][j] *
dum
;

1827 
lubksb
(
a
[3][3], * 
ödx
, * 
b
)

1829 
	gi
,
	gii
=0,
	gù
,
	gj
;

1830 
	gsum
;

1831 c⁄° 
	gn
=3;

1832 
	gi
=1;i<=
n
;i++)

1837 
	gù
=
ödx
[
i
];

1838 
	gsum
=
b
[
ù
];

1839 
	gb
[
ù
]=
b
[
i
];

1840 i‡(
	gii
)

1841 
	gj
=
ii
;j<=
i
-1;j++)

1842 
	gsum
 -
a
[
i
][
j
]*
b
[j];

1843 i‡(
	gsum
)

1844 
	gii
=
i
;

1847 
	gb
[
i
]=
sum
;

1849 
	gi
=
n
;i>=1;i--)

1852 
	gsum
=
b
[
i
];

1853 
	gj
=
i
+1;j<=
n
;j++)

1854 
	gsum
 -
a
[
i
][
j
]*
b
[j]; 
	gb
[i]=
sum
/a[i][i];

1860 
	$upd©eAng
(
Nm
)

1862 
i
, 
a
, 
b
, 
ödx
[3];

1863 
rcmx
[3], 
rcmy
[3], 
rcmz
[3],

1864 
vcmx
[3], 
vcmy
[3], 
vcmz
[3], 
RCMx
, 
RCMy
, 
RCMz
, 
VCMx
, 
VCMy
, 
VCMz
, 
dt
;

1865 
L
[3], 
rvx
, 
rvy
, 
rvz
, 
Iãns
[3][3], 
d
;

1867 
Iãns
 = 
	`mÆloc
((*)*3);

1868 
a
=0;á < 3;á++)

1869 
Iãns
[
a
] = 
mÆl


1871 
dt
 = 
O∑øms
.
°ïÀngth
;

1872 
i
=0; i < 
O∑øms
.
∑∫um
; i++)

1874 
L
[0] = L[1] = L[3] = 0;

1875 
a
=0;á < 3;á++)

1876 
b
=0; b < 3; b++)

1877 
Iãns
[
a
][
b
] = 0.0;

1878 
	`CoM
(
i
, &
RCMx
, &
RCMy
, &
RCMz
);

1879 
	`CoMV
(
i
, &
VCMx
, &
VCMy
, &
VCMz
);

1880 
a
=0;á < 3;á++)

1882 
rcmx
[
a
] = 
rx
[a][
i
] - 
RCMx
;

1883 
rcmy
[
a
] = 
ry
[a][
i
] - 
RCMy
;

1884 
rcmz
[
a
] = 
rz
[a][
i
] - 
RCMz
;

1885 
vcmx
[
a
] = 
vx
[a][
i
] - 
VCMx
;

1886 
vcmy
[
a
] = 
vy
[a][
i
] - 
VCMy
;

1887 
vcmz
[
a
] = 
vz
[a][
i
] - 
VCMz
;

1888 
	`ve˘Prod
(
rcmx
[
a
], 
rcmy
[a],Ñcmy[a], 
vcmx
[a], 
vcmy
[a], 
vcmz
[a], &
rvx
, &
rvy
, &
rvz
);

1889 
L
[0] +
rvx
 * 
O∑øms
.
m
[
a
];

1890 
L
[1] +
rvy
 * 
O∑øms
.
m
[
a
];

1891 
L
[2] +
rvz
 * 
O∑øms
.
m
[
a
];

1894 
Iãns
[0][0] +
O∑øms
.
m
[
a
]*(
	`Sqr
(
rcmy
[a]Ë+ Sqr(
rcmz
[a]));

1895 
Iãns
[1][1] +
O∑øms
.
m
[
a
]*(
	`Sqr
(
rcmz
[a]Ë+ Sqr(
rcmx
[a]));

1896 
Iãns
[2][2] +
O∑øms
.
m
[
a
]*(
	`Sqr
(
rcmx
[a]Ë+ Sqr(
rcmy
[a]));

1897 
Iãns
[0][1] +-
O∑øms
.
m
[
a
]*
rcmx
[a]*
rcmy
[a];

1898 
Iãns
[0][2] +-
O∑øms
.
m
[
a
]*
rcmx
[a]*
rcmz
[a];

1899 
Iãns
[1][2] +-
O∑øms
.
m
[
a
]*
rcmy
[a]*
rcmz
[a];

1901 
Iãns
[1][0] = Itens[0][1];

1902 
Iãns
[2][0] = Itens[0][2];

1903 
Iãns
[2][1] = Itens[1][2];

1906 
	`ludcmp
(
Iãns
, 
ödx
, &
d
);

1908 
	`lubksb
(
Iãns
, 
ödx
, 
L
);

1909 
ox
[
a
] = 
L
[0];

1910 
oy
[
a
] = 
L
[1];

1911 
oz
[
a
] = 
L
[2];

1913 
oz
[
a
] = 
Lz
 / 
Iãns
[2][2];

1914 
oy
[
a
] = (
Ly
 - 
Iãns
[1][2] * 
oz
[a]) / Itens[1][1];

1915 
ox
[
a
] = (
Lx
 - 
Iãns
[0][1] * 
oy
[a] - Iãns[0][2] * 
oz
[a] ) / Itens[0][0];

1922 
O¥ogSètus
.
sumox
[
i
] +
ox
[i] * 
dt
;

1923 
O¥ogSètus
.
sumoy
[
i
] +
oy
[i] * 
dt
;

1924 
O¥ogSètus
.
sumoz
[
i
] +
oz
[i] * 
dt
;

1927 
Dphix
[
i
] = 
O¥ogSètus
.
sumox
[i];

1928 
Dphiy
[
i
] = 
O¥ogSètus
.
sumoy
[i];

1929 
Dphiz
[
i
] = 
O¥ogSètus
.
sumoz
[i];

1931 
	}
}

1933 
	$upd©eDQ
(
COORD_TYPE
 
dt
)

1938 
curSãp
 = 
O∑øms
.curSãp, 
i1
;

1939 
COORD_TYPE
 *
PxyAº
 = 
O¥ogSètus
.PxyArr,

1940 *
PyzAº
 = 
O¥ogSètus
.PyzArr,

1941 *
PzxAº
 = 
O¥ogSètus
.PzxArr;

1946 i‡(
curSãp
 == 1)

1951 
PxyAº
[4] = 
Pxy
;

1952 
PyzAº
[4] = 
Pyz
;

1953 
PzxAº
[4] = 
Pzx
;

1957 
i1
 = (
curSãp
 - 1) % 4;

1959 i‡(
i1
 != 0)

1961 
PxyAº
[
i1
] = 
Pxy
;

1962 
PyzAº
[
i1
] = 
Pyz
;

1963 
PzxAº
[
i1
] = 
Pzx
;

1966 i‡(
i1
 == 0)

1969 
PxyAº
[0] = PxyArr[4];

1970 
PyzAº
[0] = PyzArr[4];

1971 
PzxAº
[0] = PzxArr[4];

1973 
PxyAº
[4] = 
Pxy
;

1974 
PyzAº
[4] = 
Pyz
;

1975 
PzxAº
[4] = 
Pzx
;

1977 
O¥ogSètus
.
DQxy
 +
	`BodeTîm
(
dt
, 
PxyAº
);

1978 
O¥ogSètus
.
DQyz
 +
	`BodeTîm
(
dt
, 
PyzAº
);

1979 
O¥ogSètus
.
DQzx
 +
	`BodeTîm
(
dt
, 
PzxAº
);

1990 
	}
}

1994 
	$chksVﬁ
()

2001 
COORD_TYPE
 
DVﬁ
, 
ªls
, 
ªlVﬁ
, 
Ds
;

2002 
COORD_TYPE
 
tﬁVﬁ
;

2003 
COORD_TYPE
 
tﬁs
;

2005 
tﬁVﬁ
 = 
O¥ogSètus
.tolVol;

2006 
tﬁs
 = 
O¥ogSètus
.tols;

2007 i‡–(
O¥ogSètus
.
avVﬁ
 > 0.0Ë&& (O¥ogSètus.
avs
 > 0.0))

2009 
DVﬁ
 = 
	`Ábs
(
Vﬁ
 - 
O¥ogSètus
.
avVﬁ
);

2010 
ªlVﬁ
 = 
DVﬁ
 / 
Vﬁ
;

2011 
Ds
 = 
	`Ábs
(
s
 - 
O¥ogSètus
.
avs
);

2012 
ªls
 = 
Ds
 / 
s
;

2013 i‡–(
ªlVﬁ
 < 
tﬁVﬁ
Ë&& (
ªls
 < 
tﬁs
) )

2017 
	`¥ötf
("Volumeánd s withinÅolerance,Éxit...\n");

2020 
ENDSIM
 = 1;

2024 
	}
}

2026 
	$chks
()

2033 
COORD_TYPE
 
ªls
, 
Ds
;

2034 
COORD_TYPE
 
tﬁs
, 
ªlT
, 
DT
, 
ãmp
;

2036 
tﬁs
 = 
O¥ogSètus
.tols;

2037 i‡(
O¥ogSètus
.
avs
 > 0.0)

2039 
ãmp
 = 2.0 * 
K
 / (5.0 * 
O∑øms
.
∑∫um
 - 3.0);

2040 
DT
 = 
	`Ábs
(
ãmp
 - 
O∑øms
.
T
);

2041 
Ds
 = 
	`Ábs
(
s
 - 
O¥ogSètus
.
avs
);

2042 
ªlT
 = 
DT
 / 
O∑øms
.
T
;

2043 
ªls
 = 
Ds
 / 
s
;

2046 i‡(
ªls
 < 
tﬁs
)

2050 
	`¥ötf
("s withinÅolerance,Éxit...\n");

2053 
ENDSIM
 = 1;

2057 
	}
}

2058 
	#HALFSQRT3
 0.86602540378443864676

	)

2059 
	gHP
[6][2] = {{-0.5,
HALFSQRT3
},{0.5,HALFSQRT3},{1.0,0.0},

2060 {0.5,-
HALFSQRT3
},{-0.5,-HALFSQRT3},{-1.0,0.0}};

2061 
	$buûdhexag⁄
(
düm
, 
n
, *
rx
, *
ry
, *
≈
)

2066 
nvît
, 
nöt
, 
√xtvît
;

2067 
di•lx
, 
di•ly
;

2068 
hÆfdüm
;

2071 
hÆfdüm
 = 0.5*
düm
;

2073 
nvît
 = 0;Çvert < 6;Çvert++)

2075 
√xtvît
 = 
nvît
+1;

2076 i‡(
√xtvît
 == 6)

2077 
√xtvît
 = 0;

2078 
di•lx
 = 
HP
[
√xtvît
][0] - HP[
nvît
][0];

2079 
di•ly
 = 
HP
[
√xtvît
][1] - HP[
nvît
][1];

2080 
nöt
 = 0;Çöà<
n
;Çint++)

2082 
rx
[*
≈
] = 
hÆfdüm
*(
HP
[
nvît
][0] + ((Ë
nöt
)*
di•lx
 / (()
n
+1));

2083 
ry
[*
≈
] = 
hÆfdüm
*(
HP
[
nvît
][1] + ((Ë
nöt
)*
di•ly
 / (()
n
+1));

2085 (*
≈
)++;

2090 
	}
}

2091 
	$ßve¢≠
()

2093 
i
, 
a
;

2094 
FILE
 *
f
;

2095 
fûe›2
[1024], 
fûe›
[1024];

2096 
L
, 
ºx
, 
ºy
, 
ºz
, 
RCMx
, 
RCMy
, 
RCMz
, 
nx
, 
ny
, 
nz
;

2097 
d1x
, 
d1y
, 
d1z
, 
d2x
, 
d2y
, 
d2z
;

2098 #ifde‡
MDLLINT


2099 
	`•rötf
(
fûe›2
 ,"SnaT%.6G_%s_%lld",

2100 
O∑øms
.
T
,

2101 
O¥ogSètus
.
nRun
, 
O∑øms
.
curSãp
);

2103 
	`•rötf
(
fûe›2
 ,"SnaT%.6G_%s_%d",

2104 
O∑øms
.
T
,

2105 
O¥ogSètus
.
nRun
, 
O∑øms
.
curSãp
);

2107 
	`°r˝y
(
fûe›
, 
	`absTmpAsciiHD
(
fûe›2
));

2109 i‡–(
f
 = 
	`f›í
(
fûe›
, "w")Ë=
NULL
)

2111 
	`mdPrötf
(
STD
, "Eº‹ê√Œ®f›í i¿ßveBakAscii!\n", 
NULL
);

2112 
	`exô
(-1);

2114 
L
 = 
	`cbπ
(
Vﬁ
);

2115 
	`Ârötf
(
f
, ".Vﬁ: %f\n", 
Vﬁ
);

2116 
i
=0; i < 
O∑øms
.
∑∫um
; i++)

2118 
	`CoM
(
i
, &
RCMx
, &
RCMy
, &
RCMz
);

2119 i‡(
O¥ogSètus
.
¢≠mode
==1)

2121 
RCMx
 = RCMx - 
L
 * 
	`röt
( RCMx / L);

2122 
RCMy
 = RCMy - 
L
 * 
	`röt
( RCMy / L);

2123 
RCMz
 = RCMz - 
L
 * 
	`röt
( RCMz / L);

2124 
d1x
 = 
rx
[0][
i
] -Ñx[1][i];

2125 
d1y
 = 
ry
[0][
i
] -Ñy[1][i];

2126 
d1z
 = 
rz
[0][
i
] -Ñz[1][i];

2127 
d2x
 = 
rx
[1][
i
] -Ñx[2][i];

2128 
d2y
 = 
ry
[1][
i
] -Ñy[2][i];

2129 
d2z
 = 
rz
[1][
i
] -Ñz[2][i];

2130 
	`ve˘Prod
(
d1x
, 
d1y
, 
d1z
, 
d2x
, 
d2y
, 
d2z
, &
nx
, &
ny
, &
nz
);

2131 
	`Ârötf
(
f
, "%.15G %.15G %.15G %.15G %.15G %.15G @ %f %f\n",

2132 
RCMx
, 
RCMy
, 
RCMz
, 
nx
, 
ny
, 
nz
, 
O∑øms
.
Düm
/2.0, 1.0);

2136 
a
=0;á < 
O∑øms
.
nsôes
;á++)

2138 
ºx
 = 
øŒx
[
a
][
i
] - 
L
 * 
	`röt
–
RCMx
 / L);

2139 
ºy
 = 
øŒy
[
a
][
i
] - 
L
 * 
	`röt
–
RCMy
 / L);

2140 
ºz
 = 
øŒz
[
a
][
i
] - 
L
 * 
	`röt
–
RCMz
 / L);

2141 
	`Ârötf
(
f
, "%.15G %.15G %.15G\n", 
ºx
, 
ºy
, 
ºz
);

2145 
	`f˛o£
(
f
);

2146 
	}
}

2147 
	$buûdAtomsPosôi⁄s
()

2149 
i
, 
a
, 
n
, 
•e
, 
≈
=0, 
ù
;

2150 
RCMx
, 
RCMy
, 
RCMz
;

2151 
hÆfD
, 
övhÆfD
, 
qu¨tD
, 
övqu¨tD
, 
övsRoŸ3
, 
öv§3D
, 
§3D
;

2152 
sRoŸ3
, 
tmpx
, 
tmpy
, 
e1x
, 
e1y
, 
e1z
, 
e2x
, 
e2y
, 
e2z
, 
øcmx
, 
øcmy
;

2153 *
rhexagx
, *
rhexagy
;

2154 
FILE
* 
f
;

2155 
sRoŸ3
 = 
	`sqπ
(3);

2156 
hÆfD
 = 
O∑øms
.
Düm
 * 0.5;

2157 
qu¨tD
 = 
O∑øms
.
Düm
 *0.25;

2158 
övhÆfD
 = 1.0 / 
hÆfD
;

2159 
övqu¨tD
 = 1.0 / 
qu¨tD
;

2160 
övsRoŸ3
 = 1.0 / 
sRoŸ3
;

2161 
öv§3D
 = 
övsRoŸ3
 * 
övqu¨tD
;

2162 
§3D
 = 
qu¨tD
 * 
sRoŸ3
;

2164 i‡(
O∑øms
.
curSãp
==1)

2165 
f
=
	`f›í
("lapo.pos","w");

2167 
rhexagx
 = 
	`mÆloc
(()*
O∑øms
.
nsôes
);

2168 
rhexagy
 = 
	`mÆloc
(()*
O∑øms
.
nsôes
);

2170 
i
 = 0; i < 
O∑øms
.
∑∫um
; i++)

2173 
	`CoM
(
i
, &
RCMx
, &
RCMy
, &
RCMz
);

2177 
e1x
 = -(
rx
[2][
i
] - 
RCMx
Ë* 
övhÆfD
;

2178 
e1y
 = -(
ry
[2][
i
] - 
RCMy
Ë* 
övhÆfD
;

2179 
e1z
 = -(
rz
[2][
i
] - 
RCMz
Ë* 
övhÆfD
;

2181 
e2x
 = (
rx
[0][
i
] - 
RCMx
 - 
qu¨tD
 * 
e1x
Ë* 
öv§3D
;

2182 
e2y
 = (
ry
[0][
i
] - 
RCMy
 - 
qu¨tD
 * 
e1y
Ë* 
öv§3D
;

2183 
e2z
 = (
rz
[0][
i
] - 
RCMz
 - 
qu¨tD
 * 
e1z
Ë* 
öv§3D
;

2187 
≈
=0;

2188 i‡(
O∑øms
.
öv•
 >= 2)

2189 
n
=(
O∑øms
.
öv•
/2)-1;Ç >= 0;Ç--)

2190 
	`buûdhexag⁄
(2*(
n
+1)*(
O∑øms
.
Düm
 / O∑øms.
öv•
),Ç, 
rhexagx
, 
rhexagy
, &
≈
);

2193 
•e
 = 
O∑øms
.
öv•
 / 2;

2195 
a
 = 0;á < 3;á++)

2199 
øŒx
[
i
][
a
] =ÑÆlx[i][1 +á*
•e
];

2200 
øŒy
[
i
][
a
] =ÑÆly[i][1 +á*
•e
];

2202 
ù
 = (
a
*2+1)*
•e
;

2203 
tmpx
 = 
rhexagx
[
ù
];

2204 
tmpy
 = 
rhexagy
[
ù
];

2206 i‡(
O∑øms
.
curSãp
==1)

2207 
	`Ârötf
(
f
, "%.15‡%.15‡%.15f\n", 
rhexagx
[1+
a
*
•e
], 
rhexagy
[1+a*spe], 0.0);

2209 
rhexagx
[
ù
] =Ñhexagx[
a
];

2210 
rhexagy
[
ù
] =Ñhexagy[
a
];

2211 
rhexagx
[
a
] = 
tmpx
;

2212 
rhexagy
[
a
] = 
tmpy
;

2215 
øŒx
[
O∑øms
.
nsôes
-1][
i
] = 
RCMx
;

2216 
øŒy
[
O∑øms
.
nsôes
-1][
i
] = 
RCMy
;

2217 
øŒz
[
O∑øms
.
nsôes
-1][
i
] = 
RCMz
;

2219 i‡(
O∑øms
.
curSãp
==1)

2220 
	`Ârötf
(
f
,"%.15f %.15f %.15f\n", 0.0, 0.0, 0.0);

2223 
a
 = 0;á < 3;á++)

2225 
	`Ârötf
(
f
,"%.15‡%.15‡%.15‡@ 2.0\n", 
rx
[
a
][
i
], 
ry
[a][i], 
rz
[a][i]);

2228 
a
 = 0;á < 
O∑øms
.
nsôes
-1;á++)

2231 
øcmx
 = 
øŒx
[
a
][
i
];

2232 
øcmy
 = 
øŒy
[
a
][
i
];

2234 
øŒx
[
a
][
i
] = 
RCMx
 + 
e1x
*
rhexagx
[a] + 
e2x
*
rhexagy
[a];

2235 
øŒy
[
a
][
i
] = 
RCMy
 + 
e1y
*
rhexagx
[a] + 
e2y
*
rhexagy
[a];

2236 
øŒz
[
a
][
i
] = 
RCMz
 + 
e1z
*
rhexagx
[a] + 
e2z
*
rhexagy
[a];

2238 i‡(
O∑øms
.
curSãp
==1)

2240 i‡(
a
 < 3)

2241 
	`Ârötf
(
f
, "%.15‡%.15‡%.15‡C[blue]\n", 
rhexagx
[
a
], 
rhexagy
[a], 0.0);

2242 i‡(
a
 < 6*(
O∑øms
.
öv•
 / 2))

2243 
	`Ârötf
(
f
, "%.15‡%.15‡%.15‡C[gªí]\n", 
rhexagx
[
a
], 
rhexagy
[a], 0.0);

2245 
	`Ârötf
(
f
, "%.15‡%.15‡%.15f\n", 
rhexagx
[
a
], 
rhexagy
[a], 0.0);

2252 i‡(
O∑øms
.
curSãp
==1)

2253 
	`f˛o£
(
f
);

2255 
	`‰ì
(
rhexagx
);

2256 
	`‰ì
(
rhexagy
);

2257 
	}
}

2258 **
ncut
;

2261 
	$move
()

2265 
di°™˚
;

2270 
di°™˚
 = 
	`sqπ
(3)*0.5*
O∑øms
.
Düm
;

2274 i‡(
O¥ogSètus
.
No£
 < 0)

2276 
	`movó_Brownün
(
O∑øms
.
°ïÀngth
, 0.0000000001, 30, 3, 
di°™˚
, O∑øms.
m
,

2277 
O∑øms
.
∑∫um
);

2281 
	`movó
(
O∑øms
.
°ïÀngth
, 0.000000000001, 30, 3, 
di°™˚
, O∑øms.
m
,

2282 
O∑øms
.
∑∫um
);

2284 
	`buûdAtomsPosôi⁄s
();

2285 i‡(
√brNow
)

2287 
√brNow
 = 0;

2288 
di•Hi
 = 0.0;

2291 i‡(
O¥ogSètus
.
noLökedLi°
)

2293 
	`BuûdNebrLi°NoLöked
(
O∑øms
.
∑∫um
, O∑øms.
rcut
);

2297 
	`löks
(
O∑øms
.
∑∫um
, O∑øms.
rcut
);

2299 
	`BuûdNebrLi°
(
O∑øms
.
∑∫um
, O∑øms.
rcut
);

2303 
	`LJF‹˚
(
O∑øms
.
∑∫um
, O∑øms.
rcut
);

2309 
	`F‹˚On123
();

2310 
	`köë
(
O∑øms
.
∑∫um
, 
vx
, 
vy
, 
vz
, 
Vﬁ1
);

2313 i‡(
O¥ogSètus
.
No£
 == 1)

2316 
	`movebNPT
(
O∑øms
.
°ïÀngth
, 0.0000000001, 30, 3, O∑øms.
m
, 
di°™˚
,

2317 
O∑øms
.
∑∫um
);

2319 i‡(
O¥ogSètus
.
No£
 == 2)

2324 
	`movebNTV
(
O∑øms
.
°ïÀngth
, 0.000000000001, 30, 3, O∑øms.
m
, 
di°™˚
,

2325 
O∑øms
.
∑∫um
); }

2326 i‡(
O¥ogSètus
.
No£
 == -2)

2328 
	`movebBrownAnd
(
O∑øms
.
°ïÀngth
, 0.0000000001, 30, 3, O∑øms.
m
, 
di°™˚
,

2329 
O∑øms
.
∑∫um
);

2335 
	`moveb
(
O∑øms
.
°ïÀngth
, 0.0000000001, 30, 3, O∑øms.
m
, 
di°™˚
,

2336 
O∑øms
.
∑∫um
);

2340 
	`köë
(
O∑øms
.
∑∫um
, 
vx
, 
vy
, 
vz
, 
Vﬁ1
);

2342 
	`checkNebrRebuûd
();

2343 i‡–(
O¥ogSètus
.
No£
 == 1) || (OprogStatus.Nose == 2))

2346 i‡––(
O¥ogSètus
.
sRe£tSãps
 > 0) &&

2347 (
O∑øms
.
curSãp
 =
O¥ogSètus
.
sRe£tSãps
) )

2348 || ( 
O¥ogSètus
.
sRe£tSãps
 < 0 &&

2349 
O∑øms
.
curSãp
 % 
	`abs
(
O¥ogSètus
.
sRe£tSãps
) == 0) )

2356 
s
 = 1.0;

2357 
s1
 = 0.0;

2358 
s2
 = 0.0;

2360 i‡(
O¥ogSètus
.
No£
 == 1)

2362 
	`chksVﬁ
();

2366 
	`chks
();

2370 i‡––
O¥ogSètus
.
¢≠Sãps
 < 0 && (
	`abs
(O¥ogSètus.¢≠SãpsË=
O∑øms
.
curSãp
) ) ||

2371 –
O¥ogSètus
.
¢≠Sãps
 > 0 && (
O∑øms
.
curSãp
 % OprogStatus.snapSteps == 0) ) )

2372 
	`ßve¢≠
();

2375 
	`upd©eAng
(
O∑øms
.
∑∫um
);

2378 
	`upd©eDQ
(
O∑øms
.
°ïÀngth
);

2380 i‡–(
O¥ogSètus
.
CMª£t
 != 0) &&

2382 (
O∑øms
.
curSãp
 =
O¥ogSètus
.
CMª£t
) )

2383 
	`ª£tCM
(
O∑øms
.
∑∫um
);

2385 
	`check_di°™˚s
();

2387 
	}
}

	@wtd.c

1 
	~<mdsimul.h
>

2 
	~<wtdc⁄°r.h
>

4 
xvaHód
 
	gOxvaH
;

6 
COORD_TYPE
 
	gXVA_DLST
;

9 
	$xvaP¨sög
(
°rögA
[
NAME_LENGTH
], 
°rögB
[NAME_LENGTH])

11 
i
;

12 
msgSåA
[512];

15 
i
=0; 
OxvaP¨
[i].
±r
 !
NULL
; ++i)

17 i‡(!
	`°rcmp
(
OxvaP¨
[
i
].
∑rName
, 
°rögA
))

19 
OxvaP¨
[
i
].
ty≥
)

21 
STR
 :

22 
	`°r˝y
((*Ë
OxvaP¨
[
i
].
±r
, 
°rögB
);

24 
INT
 :

25 *((*Ë
OxvaP¨
[
i
].
±r
Ë
	`©oi
(
°rögB
);

27 
CT
 :

28 –*((
COORD_TYPE
*)
OxvaP¨
[
i
].
±r
) ) =

29 (
COORD_TYPE
Ë
	`©of
(
°rögB
);

32 
	`¥ötf
("Not validÖarameterÅype in singleParárray(in mdsimdep.h).");

33 
	`exô
(-1);

41 
	`•rötf
(
msgSåA
, "P¨am©î %†i†nŸ vÆid", 
°rögA
);

42 
	`¥ötf
–"%s\n", 
msgSåA
);

43 
	`exô
(-1);

44 
	}
}

47 
	$ªadP¨s
(* 
fûeName
)

49 
FILE
* 
pfs
;

50 
°r1
[255], 
°r2
[255];

51 
löe
[2048];

53 i‡–(
pfs
 = 
	`f›í
(
fûeName
, "r")Ë=
NULL
)

55 
	`¥ötf
("ERROR: U«bÀÅÿ›íÅhê∑ømëî†fûê%s\n", 
fûeName
);

56 
	`exô
(-1);

59 
	`°r˝y
(
°r1
, "");

60 
	`°r˝y
(
°r2
, "");

62 !
	`„of
(
pfs
))

64 
	`fsˇnf
(
pfs
, "%[^\n] ", 
löe
);

66 i‡(!
	`°rcmp
(
löe
, ""))

69 i‡(
	`ssˇnf
(
löe
, "%[^:# ] : %[^\n# ] ", 
°r1
, 
°r2
) < 2)

73 i‡(!
	`°rcmp
(
°r2
, "*")) ;

74 
	`xvaP¨sög
(
°r1
, 
°r2
);

76 
	`f˛o£
(
pfs
);

77 
	}
}

80 
	$ve˘Prod
(
COORD_TYPE
 
r1x
, COORD_TYPE 
r1y
, COORD_TYPE 
r1z
,

81 
COORD_TYPE
 
r2x
, COORD_TYPE 
r2y
, COORD_TYPE 
r2z
,

82 
COORD_TYPE
* 
r3x
, COORD_TYPE* 
r3y
, COORD_TYPE* 
r3z
)

86 *
r3x
 = 
r1y
 * 
r2z
 - 
r1z
 * 
r2y
;

87 *
r3y
 = 
r1z
 * 
r2x
 - 
r1x
 * 
r2z
;

88 *
r3z
 = 
r1x
 * 
r2y
 - 
r1y
 * 
r2x
;

89 
	}
}

92 
	$£tFœgs
()

94 i‡(!
	`°rcmp
(
wtdTøFûe
, "!"))

95 
wtdTøFœg
 = 0;

96 i‡(!
	`°rcmp
(
wtdAngFûe
, "!"))

97 
wtdAngFœg
 = 0;

98 
	}
}

101 
	$övÆArg
()

105 
	`¥ötf
("Syntax: wtdCalc [-p <precision>] -f <wtd_parameters_file>\n");

106 
	`¥ötf
("Invalidárgument!\n");

107 
	`exô
(-1);

108 
	}
}

111 
	$deÁu…s
()

113 
pi
 = 
	`acos
(-1);

114 
	`°r˝y
(
xv≠¨sFûe
, "xva.par");

115 
m0
 = 1.0;

116 
m1
 = 1.0;

117 
d
 = 0.5;

118 
T
 = 1.0;

119 
¥ötEvîy
 = 10;

120 
	`°r˝y
(
wtdTøFûe
, "!");

121 
	`°r˝y
(
wtdAngFûe
, "!");

122 
	`°r˝y
(
¥ecisi⁄
,"6");

123 
	}
}

126 
	$¨gs
(
¨gc
,**
¨gv
)

128 
i
;

131 
i
 = 0;

134 i‡(
i
+1 =
¨gc
)

136 
	`övÆArg
();

139 ++
i
;

141 i‡(!
	`°rcmp
(
¨gv
[
i
], "-p"))

143 i‡–
i
+1 =
¨gc
 )

145 
	`övÆArg
();

147 ++
i
;

148 
	`°r˝y
(
¥ecisi⁄
, 
¨gv
[
i
]);

151 if(!
	`°rcmp
(
¨gv
[
i
], "-f"))

153 i‡–(
i
+1Ë=
¨gc
 )

155 
	`övÆArg
();

157 ++
i
;

158 
	`°r˝y
(
xv≠¨sFûe
, 
¨gv
[
i
]);

162 
	`övÆArg
();

164 }  
i
 < (
¨gc
 - 1) );

169 i‡(++
i
 =
¨gc
)

171 
	`övÆArg
();

175 
	`°r˝y
(
öputFûe
, 
¨gv
[
i
]);

176 
	}
}

179 
	$›íMósFûe
(* 
FûeName
)

181 
mfd
;

185 i‡–(
mfd
 = 
	`›í
(
FûeName
,
O_RDONLY
)) == -1 )

187 
	`≥º‹
("open measures file");

188 
	`¥ötf
("ERROR: U«bÀÅÿ›í i≈uàfûê%s\n", 
FûeName
);

189 
	`exô
(-1);

193 i‡(
	`ªad
(
mfd
, &
OxvaH
, (
xvaHód
)) == -1)

195 
	`≥º‹
("read header");

196 
	`exô
(-1);

199  
mfd
;

200 
	}
}

203 
	$˛o£MósFûe
(
fd
)

205 
	`˛o£
(
fd
);

206 
	}
}

209 
	$ªadMós
(
fd
, 
nmós
, 
COORD_TYPE
* 
fú°På
, ...)

213 
begByã
, 
rs
;

214 
COORD_TYPE
* 
•å
;

215 
va_li°
 
≠
;

216 
	`va_°¨t
(
≠
, 
fú°På
);

218 
begByã
 = (
xvaHód
);

219 
	`l£ek
(
fd
, 
begByã
 + 
nmós
 * 
OxvaH
.
size
, 
SEEK_SET
);

221 
rs
 = 
	`ªad
(
fd
, 
fú°På
, 
OxvaH
.
size
 / 
XVA_NUM
);

223 i‡(
rs
 == -1)

225 
	`¥ötf
("ERROR: UnableÅoÑead xva file\n");

226 
	`≥º‹
("read");

227 
	`exô
(-1);

229 i‡(
rs
 < (
OxvaH
.
size
 / 
XVA_NUM
))

234  (
•å
 = 
	`va_¨g
(
≠
, 
COORD_TYPE
*)Ë!
NULL
 )

236 
rs
 = 
	`ªad
(
fd
, 
•å
, 
OxvaH
.
size
 / 
XVA_NUM
);

238 i‡(
rs
 == -1)

240 
	`¥ötf
("ERROR: UnableÅoÑead xva file\n");

241 
	`≥º‹
("read");

242 
	`exô
(-1);

244 i‡(
rs
 < (
OxvaH
.
size
 / 
XVA_NUM
))

250 
	`va_íd
(
≠
);

252 
	}
}

255 
	$AŒoˇã
(
tŸSize
, 
COORD_TYPE
** 
poöãr
, ...)

257 
va_li°
 
≠
;

258 
COORD_TYPE
** 
•å
;

259 
size
;

261 
size
 = 
tŸSize
 / 
XVA_NUM
;

265 
	`va_°¨t
(
≠
, 
poöãr
);

266 *
poöãr
 = 
	`mÆloc
(
size
);

268 (
•å
 = 
	`va_¨g
(
≠
, 
COORD_TYPE
**)Ë!
NULL
)

270 *
•å
 = 
	`mÆloc
(
size
);

272 
	`va_íd
(
≠
);

273 
	}
}

276 
FILE
* 
	$a›í
(*
fûeName
)

278 
FILE
 *
ofs
;

279 i‡–(
ofs
 = 
	`f›í
(
fûeName
, "w")Ë=
NULL
)

281 
	`≥º‹
("open file");

282 
	`¥ötf
("ERROR: u«bÀÅÿ›í %†fûe\n", 
fûeName
);

283 
	`exô
(-1);

285  
ofs
;

286 
	}
}

289 
	$a˛o£
(
FILE
* 
ofs
)

291 
	`f˛o£
(
ofs
);

292 
	}
}

295 
	$ˇlcCMVñ
(
COORD_TYPE
 *
vxCM
, COORD_TYPE *
vyCM
, COORD_TYPE *
vzCM
)

297 
i
;

299 
i
 = 0; i < 
Nm
; ++i)

301 
vxCM
[
i
] = (
m0
 * 
vx
[0][i] + 
m1
 * vx[1][i]Ë/ 
MtŸ
;

302 
vyCM
[
i
] = (
m0
 * 
vy
[0][i] + 
m1
 * vy[1][i]Ë/ 
MtŸ
;

303 
vzCM
[
i
] = (
m0
 * 
vz
[0][i] + 
m1
 * vz[1][i]Ë/ 
MtŸ
;

305 
	}
}

308 
	$ˇlcAngVñ
(
COORD_TYPE
* 
ox
, COORD_TYPE* 
oy
, COORD_TYPE *
oz
)

310 
i
;

311 
COORD_TYPE
 
r01x
, 
r01y
, 
r01z
, 
v01x
, 
v01y
, 
v01z
, 
r01Sq
, 
dSq
;

313 
dSq
 = 
	`Sqr
(
d
);

315 
i
 = 0; i < 
Nm
; ++i)

318 
r01x
 = 
rx
[0][
i
] -Ñx[1][i];

319 
r01y
 = 
ry
[0][
i
] -Ñy[1][i];

320 
r01z
 = 
rz
[0][
i
] -Ñz[1][i];

327 
v01x
 = 
vx
[0][
i
] - vx[1][i];

328 
v01y
 = 
vy
[0][
i
] - vy[1][i];

329 
v01z
 = 
vz
[0][
i
] - vz[1][i];

331 
	`ve˘Prod
(
r01x
, 
r01y
, 
r01z
, 
v01x
, 
v01y
, 
v01z
, &
ox
[
i
], &
oy
[i], &
oz
[i]);

336 
ox
[
i
] = ox[i] / 
dSq
;

337 
oy
[
i
] = oy[i] / 
dSq
;

338 
oz
[
i
] = oz[i] / 
dSq
;

341 
	}
}

344 
	$ˇlcOrõ¡Ve˘
(
COORD_TYPE
* 
u01x
, COORD_TYPE* 
u01y
, COORD_TYPE *
u01z
)

348 
COORD_TYPE
 
r01
;

349 
i
;

351 
i
 = 0; i < 
Nm
; ++i)

353 
u01x
[
i
] = 
rx
[0][i] -Ñx[1][i];

354 
u01y
[
i
] = 
ry
[0][i] -Ñy[1][i];

355 
u01z
[
i
] = 
rz
[0][i] -Ñz[1][i];

363 
u01x
[
i
] /
d
;

364 
u01y
[
i
] /
d
;

365 
u01z
[
i
] /
d
;

367 
	}
}

369 
	$ˇlcCM
(
COORD_TYPE
* 
rCMx
, COORD_TYPE* 
rCMy
, COORD_TYPE* 
rCMz
)

374 
i
;

375 
i
 = 0; i < 
Nm
; ++i)

377 
rCMx
[
i
] = 
m0
 * 
rx
[0][i] + 
m1
 *Ñx[1][i];

378 
rCMy
[
i
] = 
m0
 * 
ry
[0][i] + 
m1
 *Ñy[1][i];

379 
rCMz
[
i
] = 
m0
 * 
rz
[0][i] + 
m1
 *Ñz[1][i];

380 
rCMx
[
i
] /
MtŸ
;

381 
rCMy
[
i
] /
MtŸ
;

382 
rCMz
[
i
] /
MtŸ
;

384 
	}
}

386 
	$ˇlcCMi
(
i
, 
COORD_TYPE
 *
Rx
, COORD_TYPE *
Ry
, COORD_TYPE *
Rz
)

388 *
Rx
 = 
m0
 * 
rx
[0][
i
] + 
m1
 *Ñx[1][i];

389 *
Ry
 = 
m0
 * 
ry
[0][
i
] + 
m1
 *Ñy[1][i];

390 *
Rz
 = 
m0
 * 
rz
[0][
i
] + 
m1
 *Ñz[1][i];

391 *
Rx
 /
MtŸ
;

392 *
Ry
 /
MtŸ
;

393 *
Rz
 /
MtŸ
;

394 
	}
}

397 
	$gëPhii
(
i
, 
COORD_TYPE
* 
fix
, COORD_TYPE* 
fiy
, COORD_TYPE* 
fiz
)

399 *
fix
 = 
Dphix
[
i
];

400 *
fiy
 = 
Dphiy
[
i
];

401 *
fiz
 = 
Dphiz
[
i
];

402 
	}
}

405 
	$mkF‹m©
(* 
fmtSå
)

407 
	`°r˝y
(
fmtSå
, "%.");

408 
	`°rˇt
(
fmtSå
, 
¥ecisi⁄
);

409 
	`°rˇt
(
fmtSå
, "f");

410 
	`°rˇt
(
fmtSå
, " ");

411 
	`°rˇt
(
fmtSå
, "%d\n");

412 
	}
}

415 
	$ßve_wtd
(* 
fûeName
, * 
wtdAº
, 
tBeg
)

417 
t
;

418 
fmtSå
[128];

419 
FILE
* 
afs
;

421 
	`¥ötf
("fûeName:%s\n", 
fûeName
);

422 
	`¥ötf
("tBeg: %d\n", 
tBeg
);

424 i‡(!
	`°rcmp
(
fûeName
, "!") || !strcmp(fileName, ""))

429 
	`mkF‹m©
(
fmtSå
);

434 
afs
 = 
	`a›í
(
fûeName
);

435 
t
 = 
tBeg
;Å < 
tRun
; ++t)

440 i‡(
wtdAº
[
t
])

441 
	`Ârötf
(
afs
, 
fmtSå
, ((
COORD_TYPE
)
t
 + 0.5)*
xvadt
, 
wtdAº
[t]);

444 
	`a˛o£
(
afs
);

446 
	}
}

449 
	$gëMónPosôi⁄
(
mfd
, 
Nm
, 
t_cur
,

450 
COORD_TYPE
* 
Rx
, COORD_TYPE* 
Ry
, COORD_TYPE* 
Rz
)

456 
i
, 
¬
;

457 
COORD_TYPE
 
Rxtmp
, 
Rytmp
, 
Rztmp
;

458 
NMP
 = 2*
DtTø_món
 + 1;

460 
	`lo›
(
i
, 1, 
Nm
)

462 
Rx
[
i
] = 0.0;

463 
Ry
[
i
] = 0.0;

464 
Rz
[
i
] = 0.0;

467 
¬
 = 
t_cur
 - 
DtTø_món
;Çn <=Å_cur + DtTra_mean; ++nn)

471 i‡(
	`ªadMós
(
mfd
, 
¬
, 
XVA_LIST
, 
NULL
) == 0)

473 
	`¥ötf
("ERROR: UnexpectedÉnd of file\n");

474 
	`¥ötf
("¬:%dÅ_cur: %d\n", 
¬
, 
t_cur
);

475 
	`exô
(-1);

477 
	`lo›
(
i
, 1, 
Nm
)

479 
	`ˇlcCMi
(
i
, &
Rxtmp
, &
Rytmp
, &
Rztmp
);

483 
Rx
[
i
] +
Rxtmp
;

484 
Ry
[
i
] +
Rytmp
;

485 
Rz
[
i
] +
Rztmp
;

489 
	`lo›
(
i
, 1, 
Nm
)

491 
Rx
[
i
] /
NMP
;

492 
Ry
[
i
] /
NMP
;

493 
Rz
[
i
] /
NMP
;

497 
	}
}

500 
	$gëMónAngPos
(
mfd
, 
Nm
, 
t_cur
,

501 
COORD_TYPE
* 
phix
, COORD_TYPE* 
phiy
, COORD_TYPE* 
phiz
)

507 
i
, 
¬
;

508 
COORD_TYPE
 
phixtmp
, 
phiytmp
, 
phiztmp
;

509 
NMP
 = 2*
DtAng_món
 + 1;

511 
	`lo›
(
i
, 1, 
Nm
)

513 
phix
[
i
] = 0.0;

514 
phiy
[
i
] = 0.0;

515 
phiz
[
i
] = 0.0;

518 
¬
 = 
t_cur
 - 
DtAng_món
;Çn <=Å_cur + DtAng_mean; ++nn)

522 i‡(
	`ªadMós
(
mfd
, 
¬
, 
XVA_LIST
, 
NULL
) == 0)

524 
	`¥ötf
("ERROR: UnexpectedÉnd of file\n");

525 
	`¥ötf
("¬:%dÅ_cur: %d\n", 
¬
, 
t_cur
);

526 
	`exô
(-1);

528 
	`lo›
(
i
, 1, 
Nm
)

530 
	`gëPhii
(
i
, &
phixtmp
, &
phiytmp
, &
phiztmp
);

534 
phix
[
i
] +
phixtmp
;

535 
phiy
[
i
] +
phiytmp
;

536 
phiz
[
i
] +
phiztmp
;

540 
	`lo›
(
i
, 1, 
Nm
)

542 
phix
[
i
] /
NMP
;

543 
phiy
[
i
] /
NMP
;

544 
phiz
[
i
] /
NMP
;

548 
	}
}

553 
	$zîoJump
()

555 
i
;

556 
i
 = 0; i < 
Nm
; ++i)

557 
œ°Jump
[
i
] = 0;

558 
	}
}

561 
	$maö
(
¨gc
, ** 
¨gv
)

563 
mfd
, 
wtdbyãs
, 
nmbyãs
;

564 
i
, 
t
, 
t0
, 
t1
;

565 
jumpTøCou¡î
 = 0, 
jumpAngCou¡î
 = 0;

567 
COORD_TYPE
 *
uxt0
, *
uyt0
, *
uzt0
, *
uxt1
, *
uyt1
, *
uzt1
, *
rCMt0x
, *
rCMt0y
,

568 *
rCMt0z
, *
rCMt1x
, *
rCMt1y
, *
rCMt1z
;

569 
COORD_TYPE
 *
phô0x
, *
phô0y
, *
phô0z
, *
phô1x
, *
phô1y
, *
phô1z
;

570 
COORD_TYPE
 
DR
, 
dphi
;

574 
	`deÁu…s
();

577 
	`¨gs
(
¨gc
,
¨gv
);

579 
	`ªadP¨s
(
xv≠¨sFûe
);

581 
	`¥ötf
("Ród fﬁlowög vÆue†‰om %s:\n", 
xv≠¨sFûe
);

582 
	`¥ötf
("m0:%‡m1:%‡d:%f\n", 
m0
, 
m1
, 
d
);

583 
	`¥ötf
("Vﬁ:%‡T:%f\n", 
Vﬁ
, 
T
);

584 
	`¥ötf
("Usög %†a†xv®fûe\n", 
öputFûe
);

586 
	`£tFœgs
();

588 
mfd
 = 
	`›íMósFûe
(
öputFûe
);

590 
	`¥ötf
("dt: %‡xva°ïs: %d\n", 
dt
, 
OxvaH
.
ßveSãps
);

593 
	`¥ötf
("size: %d\n", 
OxvaH
.
size
);

594 
Nm
 = 
OxvaH
.
size
 / 
XVA_NUM
 / (
COORD_TYPE
);

595 
MtŸ
 = 
m0
 + 
m1
;

596 
xvadt
 = 
OxvaH
.
ßveSãps
 * 
dt
;

598 
	`¥ötf
("Nm: %d MtŸ: %f\n", 
Nm
, 
MtŸ
);

599 
	`¥ötf
("DR_°¨:%‡Dphi_°¨: %f\n", 
DR_°¨
, 
Dphi_°¨
);

601 
	`AŒoˇã
(
OxvaH
.
size
, 
XVA_ALST
, 
NULL
);

605 
tRun
 = 0;

606 
	`ªadMós
(
mfd
, 
tRun
, 
XVA_LIST
, 
NULL
) > 0)

608 ++
tRun
;

619 
nmbyãs
 = (
COORD_TYPE
)*
Nm
;

622 
wtdbyãs
 = ()*
tRun
;

625 
wtdTø
 = (*Ë
	`mÆloc
(
wtdbyãs
);

627 
wtdAng
 = (*Ë
	`mÆloc
(
wtdbyãs
);

630 
uxt0
 = 
	`mÆloc
(
nmbyãs
);

631 
uyt0
 = 
	`mÆloc
(
nmbyãs
);

632 
uzt0
 = 
	`mÆloc
(
nmbyãs
);

633 
uxt1
 = 
	`mÆloc
(
nmbyãs
);

634 
uyt1
 = 
	`mÆloc
(
nmbyãs
);

635 
uzt1
 = 
	`mÆloc
(
nmbyãs
);

638 
œ°Jump
 = 
	`mÆloc
(
nmbyãs
);

641 
rCMt0x
 = 
	`mÆloc
(
nmbyãs
);

642 
rCMt0y
 = 
	`mÆloc
(
nmbyãs
);

643 
rCMt0z
 = 
	`mÆloc
(
nmbyãs
);

644 
rCMt1x
 = 
	`mÆloc
(
nmbyãs
);

645 
rCMt1y
 = 
	`mÆloc
(
nmbyãs
);

646 
rCMt1z
 = 
	`mÆloc
(
nmbyãs
);

649 
phô0x
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

650 
phô0y
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

651 
phô0z
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

652 
phô1x
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

653 
phô1y
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

654 
phô1z
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

658 
t
=0;Å < 
tRun
; ++t)

660 
wtdTø
[
t
] = 0;

661 
wtdAng
[
t
] = 0;

664 
	`¥ötf
("Begin...\n");

665 
	`¥ötf
("t0 u∞tÿ%d\n", 
tRun
);

670 
	`zîoJump
();

673 i‡(
wtdTøFœg
)

677 
t0
 = 
DtTø_món
;Å0 < 
tRun
 - DtTra_mean; ++t0)

681 i‡–(
t0
 % 
¥ötEvîy
) == 0)

682 
	`¥ötf
("Cuºíàt0: %d (u∞tÿ%d)\n", 
t0
, 
tRun
);

689 
	`gëMónPosôi⁄
(
mfd
, 
Nm
, 
t0
, 
rCMt0x
, 
rCMt0y
, 
rCMt0z
);

691 
t1
 = 
t0
 + 
DtTø_°¨
;

693 i‡(
t1
 + 
DtTø_món
 >
tRun
)

694 
t1
 = 
tRun
 - 
DtTø_món
 - 1;

698 
	`gëMónPosôi⁄
(
mfd
, 
Nm
, 
t1
, 
rCMt1x
, 
rCMt1y
, 
rCMt1z
);

702 
i
 = 0; i < 
Nm
; ++i)

705 
DR
 = 
	`sqπ
(
	`Sqr
(
rCMt0x
[
i
] - 
rCMt1x
[i]) +

706 
	`Sqr
(
rCMt0y
[
i
] - 
rCMt1y
[i]) +

707 
	`Sqr
(
rCMt0z
[
i
] - 
rCMt1z
[i]));

710 i‡(
DR
 > 
DR_°¨
)

714 i‡(
œ°Jump
[
i
] && (
t0
 >=ÜastJump[i]))

720 i‡(
i
 >= 20 && i <= 50)

723 
	`¥ötf
("t1=%d [%d] DR:%f\n", 
t1
, 
i
, 
DR
);

724 
	`¥ötf
("t1-..:%d La°Jump[%d]:%d\n", 
t1
-
œ°Jump
[
i
],

725 
i
, 
œ°Jump
[i]);

727 ++
jumpTøCou¡î
;

728 ++
wtdTø
[
t1
 - 
œ°Jump
[
i
]];

729 
œ°Jump
[
i
] = 
t1
;

731 i‡(
œ°Jump
[
i
]==0)

733 
œ°Jump
[
i
] = 
t1
;

740 
	`¥ötf
("n. sÆtòåa.: %d DtTøs: %d\n",
jumpTøCou¡î
, 
DtTø_°¨
);

741 
	`ßve_wtd
(
wtdTøFûe
, 
wtdTø
, 
DtTø_°¨
);

746 
	`zîoJump
();

748 i‡(
wtdAngFœg
)

751 
t0
 = 
DtAng_món
;Å0 < 
tRun
 - DtAng_mean ; ++t0)

755 i‡–(
t0
 % 
¥ötEvîy
) == 0)

756 
	`¥ötf
("Cuºíàt0: %d (u∞tÿ%d)\n", 
t0
, 
tRun
);

758 
	`gëMónAngPos
(
mfd
, 
Nm
, 
t0
, 
phô0x
, 
phô0y
, 
phô0z
);

761 
t1
 = 
t0
 + 
DtAng_°¨
;

762 i‡(
t1
 + 
DtAng_món
 >
tRun
)Å1 =ÅRun - DtAng_mean - 1;

764 
	`gëMónAngPos
(
mfd
, 
Nm
, 
t1
, 
phô1x
, 
phô1y
, 
phô1z
);

766 
i
 = 0; i < 
Nm
; ++i)

769 
dphi
 = (180.0/
pi
)*
	`sqπ
(
	`Sqr
(
phô0x
[
i
] - 
phô1x
[i]) +

770 
	`Sqr
(
phô0y
[
i
] - 
phô1y
[i]) +

771 
	`Sqr
(
phô0z
[
i
] - 
phô1z
[i]));

774 i‡(
dphi
 > 
Dphi_°¨
)

777 i‡(
œ°Jump
[
i
] && (
t0
 >=ÜastJump[i]))

783 ++
wtdAng
[
t1
 - 
œ°Jump
[
i
]];

784 
œ°Jump
[
i
] = 
t1
;

785 ++
jumpAngCou¡î
;

787 i‡(
œ°Jump
[
i
]==0)

789 
œ°Jump
[
i
] = 
t1
;

809 
	`¥ötf
("n. sÆtòrŸ.: %d DtAngs: %d\n",
jumpAngCou¡î
, 
DtAng_°¨
);

810 
	`ßve_wtd
(
wtdAngFûe
, 
wtdAng
, 
DtAng_°¨
);

812 
	`˛o£
(
mfd
);

813 
	}
}

	@wtd.h

2 
	gwtdAngFûe
[128], 
	gwtdTøFûe
[128];

4 
	gwtdTøFœg
 = 1, 
	gwtdAngFœg
 = 1;

6 
	g¥ötEvîy
, 
	gtRun
, 
	gDtTø_°¨
, 
	gDtAng_°¨
, 
	gDtTø_món
 = 0, 
	gDtAng_món
 = 0;

8 
COORD_TYPE
 
	gm0
, 
	gm1
, 
	gd
, 
	gVﬁ
, 
	gDR_°¨
, 
	gDphi_°¨
;

9 
COORD_TYPE
 
	gMtŸ
, 
	gxvadt
, 
	gdt
, 
	gdãè
, 
	gT
;

12 
	göputFûe
[
NAME_LENGTH
], 
	gxv≠¨sFûe
[NAME_LENGTH];

15 * 
	gœ°Jump
;

16 
	g¥ecisi⁄
[64];

17 
	gNm
;

19 *
	gwtdTø
, *
	gwtdAng
;

20 
COORD_TYPE
 
	gpi
;

23 
sögÀP¨
 
	gOxvaP¨
[] = {

38 {"öputFûe", &
öputFûe
, 
STR
},

39 {"wtdAng", 
wtdAngFûe
, 
STR
},

40 {"DtAng_°¨",&
DtAng_°¨
, 
INT
},

41 {"DtTø_°¨",&
DtTø_°¨
, 
INT
},

42 {"Dphi_°¨", &
Dphi_°¨
, 
CT
},

43 {"wtdTø", 
wtdTøFûe
, 
STR
},

44 {"DR_°¨", &
DR_°¨
, 
CT
},

46 {"DtTø_món", &
DtTø_món
, 
INT
},

47 {"DtAng_món", &
DtAng_món
, 
INT
},

48 {"¥ec", 
¥ecisi⁄
, 
STR
},

49 {"m0", &
m0
, 
CT
},

50 {"m1", &
m1
, 
CT
},

51 {"d", &
d
, 
CT
},

52 {"dt", &
dt
, 
CT
},

53 {"Vﬁ", &
Vﬁ
, 
CT
},

54 {"¥ötEvîy", &
¥ötEvîy
, 
INT
},

57 {"", 
NULL
, 0}

	@xvautil.c

1 
	~<mdsimul.h
>

2 
	~<c⁄°rxva.h
>

4 
xvaHód
 
	gOxvaH
;

6 
COORD_TYPE
 
	gXVA_DLST
;

9 
	$xvaP¨sög
(
°rögA
[
NAME_LENGTH
], 
°rögB
[NAME_LENGTH])

11 
i
;

12 
msgSåA
[512];

15 
i
=0; 
OxvaP¨
[i].
±r
 !
NULL
; ++i)

17 i‡(!
	`°rcmp
(
OxvaP¨
[
i
].
∑rName
, 
°rögA
))

19 
OxvaP¨
[
i
].
ty≥
)

21 
STR
 :

22 
	`°r˝y
((*Ë
OxvaP¨
[
i
].
±r
, 
°rögB
);

24 
INT
 :

25 *((*Ë
OxvaP¨
[
i
].
±r
Ë
	`©oi
(
°rögB
);

27 
CT
 :

28 –*((
COORD_TYPE
*)
OxvaP¨
[
i
].
±r
) ) =

29 (
COORD_TYPE
Ë
	`©of
(
°rögB
);

32 
	`¥ötf
("Not validÖarameterÅype in singleParárray(in mdsimdep.h).");

33 
	`exô
(-1);

41 
	`•rötf
(
msgSåA
, "P¨am©î %†i†nŸ vÆid", 
°rögA
);

42 
	`¥ötf
–"%s\n", 
msgSåA
);

43 
	`exô
(-1);

44 
	}
}

47 
	$ªadP¨s
(* 
fûeName
)

49 
FILE
* 
pfs
;

50 
°r1
[255], 
°r2
[255];

51 
löe
[2048];

53 i‡–(
pfs
 = 
	`f›í
(
fûeName
, "r")Ë=
NULL
)

55 
	`¥ötf
("ERROR: U«bÀÅÿ›íÅhê∑ømëî†fûê%s\n", 
fûeName
);

56 
	`exô
(-1);

59 
	`°r˝y
(
°r1
, "");

60 
	`°r˝y
(
°r2
, "");

62 !
	`„of
(
pfs
))

64 
	`fsˇnf
(
pfs
, "%[^\n] ", 
löe
);

66 i‡(!
	`°rcmp
(
löe
, ""))

69 i‡(
	`ssˇnf
(
löe
, "%[^:# ] : %[^\n# ] ", 
°r1
, 
°r2
) < 2)

73 i‡(!
	`°rcmp
(
°r2
, "*")) ;

74 
	`xvaP¨sög
(
°r1
, 
°r2
);

76 
	`f˛o£
(
pfs
);

77 
	}
}

80 
	$ve˘Prod
(
COORD_TYPE
 
r1x
, COORD_TYPE 
r1y
, COORD_TYPE 
r1z
,

81 
COORD_TYPE
 
r2x
, COORD_TYPE 
r2y
, COORD_TYPE 
r2z
,

82 
COORD_TYPE
* 
r3x
, COORD_TYPE* 
r3y
, COORD_TYPE* 
r3z
)

86 *
r3x
 = 
r1y
 * 
r2z
 - 
r1z
 * 
r2y
;

87 *
r3y
 = 
r1z
 * 
r2x
 - 
r1x
 * 
r2z
;

88 *
r3z
 = 
r1x
 * 
r2y
 - 
r1y
 * 
r2x
;

89 
	}
}

92 
	$£tFœgs
()

95 i‡(!
	`°rcmp
(
vñFûe
, "!"))

96 
vñFœg
 = 0;

97 i‡(!
	`°rcmp
(
psi1Fûe
, "!"))

98 
psi1Fœg
 = 0;

99 i‡(!
	`°rcmp
(
vhFûe
, "!"))

100 
vhFœg
 = 0;

101 i‡(!
	`°rcmp
(
psi2Fûe
, "!"))

102 
psi2Fœg
 = 0;

103 i‡(!
	`°rcmp
(
C1Fûe
, "!"))

104 
C1Fœg
 = 0;

105 i‡(!
	`°rcmp
(
C2Fûe
, "!"))

106 
C2Fœg
 = 0;

107 i‡(!
	`°rcmp
(
C3Fûe
, "!"))

108 
C3Fœg
 = 0;

109 i‡(!
	`°rcmp
(
C4Fûe
, "!"))

110 
C4Fœg
 = 0;

111 i‡(!
	`°rcmp
(
dphiSqFûe
, "!"))

112 
dphiSqFœg
 = 0;

113 i‡(!
	`°rcmp
(
phiFûe
, "!"))

114 
phiFœg
 = 0;

115 i‡(!
	`°rcmp
(
drSqFûe
, "!"))

116 
drSqFœg
 = 0;

117 i‡(!
	`°rcmp
(
DtFûe
, "!"))

118 
DtFœg
 = 0;

119 i‡(!
	`°rcmp
(
DrFûe
, "!"))

120 
DrFœg
 = 0;

121 i‡(!
	`°rcmp
(
AÆphaFûe
, "!"))

122 
AÆphaFœg
 = 0;

123 i‡(!
	`°rcmp
(
G£lfFûe
, "!"))

124 
G£lfFœg
 = 0;

125 i‡(!
	`°rcmp
(
wtdFûe
, "!"))

126 
wtdFœg
 = 0;

127 i‡(!
	`°rcmp
(
GsGsgaussFûe
, "!"))

128 
GsGsgaussFœg
 = 0;

129 i‡(!
	`°rcmp
(
F£lfFûe
, "!"))

130 
F£lfFœg
 = 0;

131 
	}
}

134 
	$övÆArg
()

138 
	`¥ötf
("Syntax: xvautil [-p <precision>] -f <xva_parameters_file>\n");

139 
	`¥ötf
("Invalidárgument!\n");

140 
	`exô
(-1);

141 
	}
}

144 
	$deÁu…s
()

146 
pi
 = 
	`acos
(-1);

147 
	`°r˝y
(
xv≠¨sFûe
, "xva.par");

148 
m0
 = 1.0;

149 
m1
 = 1.0;

150 
d
 = 0.5;

151 
T
 = 1.0;

152 
tC‹
 = 10;

153 
tg≠
 = 1;

154 
vhg≠
 = 1;

155 
tBeg
 = 0;

156 
nTëa
 = 30;

157 
dãè
 = 0.05;

158 
¥ötEvîy
 = 10;

159 
G¢r
 = 50;

160 
G§Max
 = 1.5;

161 
kMax
 = 5.0;

180 
	`°r˝y
(
vñFûe
, "!");

181 
	`°r˝y
(
psi1Fûe
, "!");

182 
	`°r˝y
(
psi2Fûe
, "!");

183 
	`°r˝y
(
vhFûe
, "!");

184 
	`°r˝y
(
C1Fûe
, "!");

185 
	`°r˝y
(
C2Fûe
, "!");

186 
	`°r˝y
(
C3Fûe
, "!");

187 
	`°r˝y
(
C4Fûe
, "!");

188 
	`°r˝y
(
dphiSqFûe
, "!");

189 
	`°r˝y
(
drSqFûe
, "!");

190 
	`°r˝y
(
ddtdrFûe
, "!");

191 
	`°r˝y
(
ddtdphiFûe
, "!");

192 
	`°r˝y
(
DtFûe
, "!");

193 
	`°r˝y
(
DrFûe
, "!");

194 
	`°r˝y
(
AÆphaFûe
, "!");

195 
	`°r˝y
(
G£lfFûe
, "!");

196 
	`°r˝y
(
wtdFûe
, "!");

197 
	`°r˝y
(
GsGsgaussFûe
, "!");

198 
	`°r˝y
(
F£lfFûe
, "!");

199 
	`°r˝y
(
¥ecisi⁄
,"6");

200 
	}
}

203 
	$¨gs
(
¨gc
,**
¨gv
)

205 
i
;

208 
i
 = 0;

211 i‡(
i
+1 =
¨gc
)

213 
	`övÆArg
();

216 ++
i
;

218 i‡(!
	`°rcmp
(
¨gv
[
i
], "-p"))

220 i‡–
i
+1 =
¨gc
 )

222 
	`övÆArg
();

224 ++
i
;

225 
	`°r˝y
(
¥ecisi⁄
, 
¨gv
[
i
]);

228 if(!
	`°rcmp
(
¨gv
[
i
], "-f"))

230 i‡–(
i
+1Ë=
¨gc
 )

232 
	`övÆArg
();

234 ++
i
;

235 
	`°r˝y
(
xv≠¨sFûe
, 
¨gv
[
i
]);

239 
	`övÆArg
();

241 }  
i
 < (
¨gc
 - 1) );

246 i‡(++
i
 =
¨gc
)

248 
	`övÆArg
();

252 
	`°r˝y
(
öputFûe
, 
¨gv
[
i
]);

253 
	}
}

256 
	$›íMósFûe
(* 
FûeName
)

258 
mfd
;

262 i‡–(
mfd
 = 
	`›í
(
FûeName
,
O_RDONLY
)) == -1 )

264 
	`≥º‹
("open measures file");

265 
	`¥ötf
("ERROR: U«bÀÅÿ›í i≈uàfûê%s\n", 
FûeName
);

266 
	`exô
(-1);

270 i‡(
	`ªad
(
mfd
, &
OxvaH
, (
xvaHód
)) == -1)

272 
	`≥º‹
("read header");

273 
	`exô
(-1);

276  
mfd
;

277 
	}
}

280 
	$˛o£MósFûe
(
fd
)

282 
	`˛o£
(
fd
);

283 
	}
}

286 
	$ªadMós
(
fd
, 
nmós
, 
COORD_TYPE
* 
fú°På
, ...)

290 
begByã
, 
rs
;

291 
COORD_TYPE
* 
•å
;

292 
va_li°
 
≠
;

293 
	`va_°¨t
(
≠
, 
fú°På
);

295 
begByã
 = (
xvaHód
);

296 
	`l£ek
(
fd
, 
begByã
 + 
nmós
 * 
OxvaH
.
size
, 
SEEK_SET
);

298 
rs
 = 
	`ªad
(
fd
, 
fú°På
, 
OxvaH
.
size
 / 
XVA_NUM
);

300 i‡(
rs
 == -1)

302 
	`¥ötf
("ERROR: UnableÅoÑead xva file\n");

303 
	`≥º‹
("read");

304 
	`exô
(-1);

306 i‡(
rs
 < (
OxvaH
.
size
 / 
XVA_NUM
))

311  (
•å
 = 
	`va_¨g
(
≠
, 
COORD_TYPE
*)Ë!
NULL
 )

313 
rs
 = 
	`ªad
(
fd
, 
•å
, 
OxvaH
.
size
 / 
XVA_NUM
);

315 i‡(
rs
 == -1)

317 
	`¥ötf
("ERROR: UnableÅoÑead xva file\n");

318 
	`≥º‹
("read");

319 
	`exô
(-1);

321 i‡(
rs
 < (
OxvaH
.
size
 / 
XVA_NUM
))

327 
	`va_íd
(
≠
);

329 
	}
}

332 
	$AŒoˇã
(
tŸSize
, 
COORD_TYPE
** 
poöãr
, ...)

334 
va_li°
 
≠
;

335 
COORD_TYPE
** 
•å
;

336 
size
;

338 
size
 = 
tŸSize
 / 
XVA_NUM
;

342 
	`va_°¨t
(
≠
, 
poöãr
);

343 *
poöãr
 = 
	`mÆloc
(
size
);

345 (
•å
 = 
	`va_¨g
(
≠
, 
COORD_TYPE
**)Ë!
NULL
)

347 *
•å
 = 
	`mÆloc
(
size
);

349 
	`va_íd
(
≠
);

350 
	}
}

353 
FILE
* 
	$a›í
(*
fûeName
)

355 
FILE
 *
ofs
;

356 i‡–(
ofs
 = 
	`f›í
(
fûeName
, "w")Ë=
NULL
)

358 
	`≥º‹
("open file");

359 
	`¥ötf
("ERROR: u«bÀÅÿ›í %†fûe\n", 
fûeName
);

360 
	`exô
(-1);

362  
ofs
;

363 
	}
}

366 
	$a˛o£
(
FILE
* 
ofs
)

368 
	`f˛o£
(
ofs
);

369 
	}
}

372 
	$ˇlcCMVñ
(
COORD_TYPE
 *
vxCM
, COORD_TYPE *
vyCM
, COORD_TYPE *
vzCM
)

374 
i
;

376 
i
 = 0; i < 
Nm
; ++i)

378 
vxCM
[
i
] = (
m0
 * 
vx
[0][i] + 
m1
 * vx[1][i]Ë/ 
MtŸ
;

379 
vyCM
[
i
] = (
m0
 * 
vy
[0][i] + 
m1
 * vy[1][i]Ë/ 
MtŸ
;

380 
vzCM
[
i
] = (
m0
 * 
vz
[0][i] + 
m1
 * vz[1][i]Ë/ 
MtŸ
;

382 
	}
}

385 
	$ˇlcAngVñ
(
COORD_TYPE
* 
ox
, COORD_TYPE* 
oy
, COORD_TYPE *
oz
)

387 
i
;

388 
COORD_TYPE
 
r01x
, 
r01y
, 
r01z
, 
v01x
, 
v01y
, 
v01z
, 
r01Sq
, 
dSq
;

390 
dSq
 = 
	`Sqr
(
d
);

392 
i
 = 0; i < 
Nm
; ++i)

395 
r01x
 = 
rx
[0][
i
] -Ñx[1][i];

396 
r01y
 = 
ry
[0][
i
] -Ñy[1][i];

397 
r01z
 = 
rz
[0][
i
] -Ñz[1][i];

404 
v01x
 = 
vx
[0][
i
] - vx[1][i];

405 
v01y
 = 
vy
[0][
i
] - vy[1][i];

406 
v01z
 = 
vz
[0][
i
] - vz[1][i];

408 
	`ve˘Prod
(
r01x
, 
r01y
, 
r01z
, 
v01x
, 
v01y
, 
v01z
, &
ox
[
i
], &
oy
[i], &
oz
[i]);

413 
ox
[
i
] = ox[i] / 
dSq
;

414 
oy
[
i
] = oy[i] / 
dSq
;

415 
oz
[
i
] = oz[i] / 
dSq
;

418 
	}
}

421 
	$ˇlcOrõ¡Ve˘
(
COORD_TYPE
* 
u01x
, COORD_TYPE* 
u01y
, COORD_TYPE *
u01z
)

425 
COORD_TYPE
 
r01
;

426 
i
;

428 
i
 = 0; i < 
Nm
; ++i)

430 
u01x
[
i
] = 
rx
[0][i] -Ñx[1][i];

431 
u01y
[
i
] = 
ry
[0][i] -Ñy[1][i];

432 
u01z
[
i
] = 
rz
[0][i] -Ñz[1][i];

440 
u01x
[
i
] /
d
;

441 
u01y
[
i
] /
d
;

442 
u01z
[
i
] /
d
;

444 
	}
}

446 
	$ˇlcCM
(
COORD_TYPE
* 
rCMx
, COORD_TYPE* 
rCMy
, COORD_TYPE* 
rCMz
)

451 
i
;

452 
i
 = 0; i < 
Nm
; ++i)

454 
rCMx
[
i
] = 
m0
 * 
rx
[0][i] + 
m1
 *Ñx[1][i];

455 
rCMy
[
i
] = 
m0
 * 
ry
[0][i] + 
m1
 *Ñy[1][i];

456 
rCMz
[
i
] = 
m0
 * 
rz
[0][i] + 
m1
 *Ñz[1][i];

457 
rCMx
[
i
] /
MtŸ
;

458 
rCMy
[
i
] /
MtŸ
;

459 
rCMz
[
i
] /
MtŸ
;

461 
	}
}

464 
	$gëPhi
(
COORD_TYPE
* 
fix
, COORD_TYPE* 
fiy
, COORD_TYPE* 
fiz
)

466 
i
;

467 
i
 = 0; i < 
Nm
; ++i)

469 
fix
[
i
] = 
Dphix
[i];

470 
fiy
[
i
] = 
Dphiy
[i];

471 
fiz
[
i
] = 
Dphiz
[i];

473 
	}
}

475 
	$mkF‹m©
(* 
fmtSå
)

477 
	`°r˝y
(
fmtSå
, "%.");

478 
	`°rˇt
(
fmtSå
, 
¥ecisi⁄
);

479 
	`°rˇt
(
fmtSå
, "f");

480 
	`°rˇt
(
fmtSå
, " ");

481 
	`°rˇt
(
fmtSå
, "%.");

482 
	`°rˇt
(
fmtSå
, 
¥ecisi⁄
);

483 
	`°rˇt
(
fmtSå
, "f\n");

484 
	}
}

487 
	$ßveAcf
(* 
fûeName
, 
COORD_TYPE
* 
acf
)

489 
t
;

490 
fmtSå
[128];

491 
FILE
* 
afs
;

494 i‡(!
	`°rcmp
(
fûeName
, "!") || !strcmp(fileName, ""))

499 
	`mkF‹m©
(
fmtSå
);

503 
afs
 = 
	`a›í
(
fûeName
);

504 
t
 = 
tBeg
;Å < 
tC‹
; ++t)

506 
	`Ârötf
(
afs
, 
fmtSå
, ((
COORD_TYPE
)
t
)*
xvadt
, 
acf
[t]);

509 
	`a˛o£
(
afs
);

510 
	}
}

512 
	$ßveVH
(*
fûeName
, 
COORD_TYPE
** 
vh
)

514 
FILE
* 
afs
;

515 
i
, 
t
;

516 
COORD_TYPE
 
ãè
;

517 
fmtSå
[128];

520 i‡(!
	`°rcmp
(
fûeName
, "!") || !strcmp(fileName, ""))

525 
	`mkF‹m©
(
fmtSå
);

527 
afs
 = 
	`a›í
(
fûeName
);

529 
t
 = 
tBeg
;Å < 
tC‹
;Å +
vhg≠
 )

531 i‡(
t
 == 0) ;

533 
i
 = 0; i < 
nTëa
; ++i)

535 
ãè
 = ((
COORD_TYPE
)
i
 + 0.5Ë* (180.0 / 
nTëa
);

538 
	`Ârötf
(
afs
, 
fmtSå
, 
ãè
, 
vh
[
i
][
t
]);

540 
	`Ârötf
(
afs
, "&\n");

542 
	`f˛o£
(
afs
);

543 
	}
}

546 
	$ßveG£lf
(* 
fûeName
, 
COORD_TYPE
** 
gs
)

548 
FILE
* 
afs
;

549 
j
, 
t
;

550 
COORD_TYPE
 
r
;

551 
fmtSå
[128];

554 i‡(!
	`°rcmp
(
fûeName
, "!") || !strcmp(fileName, ""))

559 
	`mkF‹m©
(
fmtSå
);

561 
afs
 = 
	`a›í
(
fûeName
);

563 
t
 = 
tBeg
;Å < 
tC‹
;Å +
vhg≠
 )

565 i‡(
t
 == 0) ;

567 
j
 = 0; j < 
G¢r
; ++j)

569 
r
 = ((
COORD_TYPE
)
j
 + 0.5Ë* (
G§Max
 / 
G¢r
);

570 
	`Ârötf
(
afs
, 
fmtSå
, 
r
, 
gs
[
j
][
t
]);

572 
	`Ârötf
(
afs
, "&\n");

574 
	`f˛o£
(
afs
);

576 
	}
}

579 
	$ßveF£lf
(* 
fûeName
, 
COORD_TYPE
* 
fs
)

581 
FILE
* 
afs
;

582 
j
, 
t
;

583 
fmtSå
[128];

586 i‡(!
	`°rcmp
(
fûeName
, "!") || !strcmp(fileName, ""))

591 
	`mkF‹m©
(
fmtSå
);

592 
afs
 = 
	`a›í
(
fûeName
);

593 
t
 = 
tBeg
;Å < 
tC‹
;Å +
vhg≠
 )

595 i‡(
t
 == 0) ;

596 
	`Ârötf
(
afs
, 
fmtSå
, ((
COORD_TYPE
)
t
)*
xvadt
, 
fs
[t]);

600 
	`f˛o£
(
afs
);

601 
	}
}

604 
	$maö
(
¨gc
, ** 
¨gv
)

606 
mfd
, 
acfbyãs
, 
nmbyãs
;

607 
i
, 
j
, 
t
, 
t0
, 
â0
, 
â0Max
, 
tRun
, 
rI¡
;

608 
ãèi
;

609 
FILE
 *
phifs
;

610 
COORD_TYPE
 
N‹mv
, 
o0
, 
Ÿt0
, 
dŸo
, 
ãè
, 
r
, 
dñèr
, 
Gsg
, 
¥eÁ˘
, 
k
;

612 
COORD_TYPE
 *
vx0
, *
vy0
, *
vz0
, *
ox0
, *
oy0
, *
oz0
,

613 *
vxâ0
, *
vyâ0
, *
vzâ0
, *
oxâ0
, *
oyâ0
, *
ozâ0
;

614 
COORD_TYPE
 *
ux0
, *
uy0
, *
uz0
, *
uxâ0
, *
uyâ0
, *
uzâ0
, *
rCM0x
, *
rCM0y
,

615 *
rCM0z
, *
rCMâ0x
, *
rCMâ0y
, *
rCMâ0z
;

616 
COORD_TYPE
 
dŸu
, 
drx
, 
dry
, 
drz
, 
dphix
, 
dphiz
, 
dphiy
, 
dr2i
;

619 
	`deÁu…s
();

622 
	`¨gs
(
¨gc
,
¨gv
);

624 
	`ªadP¨s
(
xv≠¨sFûe
);

626 
	`¥ötf
("Ród fﬁlowög vÆue†‰om %s:\n", 
xv≠¨sFûe
);

627 
	`¥ötf
("m0:%‡m1:%‡d:%f\n", 
m0
, 
m1
, 
d
);

628 
	`¥ötf
("tC‹:%d Vﬁ:%‡T:%f\n", 
tC‹
, 
Vﬁ
, 
T
);

629 
	`¥ötf
("phiFûe: %s\n", 
phiFûe
);

630 
	`¥ötf
("vhg≠: %dÅBeg:%d\n", 
vhg≠
, 
tBeg
);

631 
	`¥ötf
("Usög %†a†xv®fûe\n", 
öputFûe
);

633 
	`£tFœgs
();

635 
mfd
 = 
	`›íMósFûe
(
öputFûe
);

637 
	`¥ötf
("dt: %‡xva°ïs: %d\n", 
dt
, 
OxvaH
.
ßveSãps
);

640 
	`¥ötf
("size: %d\n", 
OxvaH
.
size
);

641 
Nm
 = 
OxvaH
.
size
 / 
XVA_NUM
 / (
COORD_TYPE
);

642 
MtŸ
 = 
m0
 + 
m1
;

643 
xvadt
 = 
OxvaH
.
ßveSãps
 * 
dt
;

645 
	`¥ötf
("Nm: %d MtŸ: %f\n", 
Nm
, 
MtŸ
);

647 
	`AŒoˇã
(
OxvaH
.
size
, 
XVA_ALST
, 
NULL
);

651 
tRun
 = 0;

652 
	`ªadMós
(
mfd
, 
tRun
, 
XVA_LIST
, 
NULL
) > 0)

654 ++
tRun
;

665 
nmbyãs
 = (
COORD_TYPE
)*
Nm
;

668 
acfbyãs
 = (
COORD_TYPE
)*
tC‹
;

672 
vx0
 = 
	`mÆloc
(
nmbyãs
);

673 
vy0
 = 
	`mÆloc
(
nmbyãs
);

674 
vz0
 = 
	`mÆloc
(
nmbyãs
);

675 
vxâ0
 = 
	`mÆloc
(
nmbyãs
);

676 
vyâ0
 = 
	`mÆloc
(
nmbyãs
);

677 
vzâ0
 = 
	`mÆloc
(
nmbyãs
);

679 
vñacf
 = 
	`mÆloc
(
acfbyãs
);

682 
ox0
 = 
	`mÆloc
(
nmbyãs
);

683 
oy0
 = 
	`mÆloc
(
nmbyãs
);

684 
oz0
 = 
	`mÆloc
(
nmbyãs
);

685 
oxâ0
 = 
	`mÆloc
(
nmbyãs
);

686 
oyâ0
 = 
	`mÆloc
(
nmbyãs
);

687 
ozâ0
 = 
	`mÆloc
(
nmbyãs
);

689 
psi1acf
 = 
	`mÆloc
(
acfbyãs
);

690 
psi2acf
 = 
	`mÆloc
(
acfbyãs
);

692 
v™Hove
 = (
COORD_TYPE
**Ë
	`mÆloc
(
nTëa
*(COORD_TYPE**));

693 
i
 = 0; i < 
nTëa
; ++i)

694 
v™Hove
[
i
] = (
COORD_TYPE
*Ë
	`mÆloc
(
acfbyãs
);

696 
wtd
 = (
COORD_TYPE
*Ë
	`mÆloc
(
acfbyãs
);

697 
G£lf
 = (
COORD_TYPE
**Ë
	`mÆloc
(
G¢r
*(COORD_TYPE*));

698 
GsGsgauss
 = (
COORD_TYPE
**Ë
	`mÆloc
(
G¢r
*(COORD_TYPE*));

699 
F£lf
 = (
COORD_TYPE
*Ë
	`mÆloc
(
acfbyãs
);

700 
j
 = 0; j < 
G¢r
; ++j)

702 
G£lf
[
j
] = (
COORD_TYPE
*Ë
	`mÆloc
(
acfbyãs
);

703 
GsGsgauss
[
j
] = (
COORD_TYPE
*Ë
	`mÆloc
(
acfbyãs
);

710 
ux0
 = 
	`mÆloc
(
nmbyãs
);

711 
uy0
 = 
	`mÆloc
(
nmbyãs
);

712 
uz0
 = 
	`mÆloc
(
nmbyãs
);

713 
uxâ0
 = 
	`mÆloc
(
nmbyãs
);

714 
uyâ0
 = 
	`mÆloc
(
nmbyãs
);

715 
uzâ0
 = 
	`mÆloc
(
nmbyãs
);

718 
C1acf
 = 
	`mÆloc
(
acfbyãs
);

719 
C2acf
 = 
	`mÆloc
(
acfbyãs
);

720 
C3acf
 = 
	`mÆloc
(
acfbyãs
);

721 
C4acf
 = 
	`mÆloc
(
acfbyãs
);

724 
rCM0x
 = 
	`mÆloc
(
nmbyãs
);

725 
rCM0y
 = 
	`mÆloc
(
nmbyãs
);

726 
rCM0z
 = 
	`mÆloc
(
nmbyãs
);

727 
rCMâ0x
 = 
	`mÆloc
(
nmbyãs
);

728 
rCMâ0y
 = 
	`mÆloc
(
nmbyãs
);

729 
rCMâ0z
 = 
	`mÆloc
(
nmbyãs
);

732 
phix
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

733 
phiy
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

734 
phiz
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

735 
phi0x
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

736 
phi0y
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

737 
phi0z
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

738 
phôt0x
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

739 
phôt0y
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

740 
phôt0z
 = 
	`mÆloc
(
Nm
*(
COORD_TYPE
));

743 
Dr
 = 
	`mÆloc
(
acfbyãs
);

744 
Dt
 = 
	`mÆloc
(
acfbyãs
);

745 
ddtdrSq
 = 
	`mÆloc
(
acfbyãs
);

746 
ddtdphiSq
 = 
	`mÆloc
(
acfbyãs
);

749 
drSq
 = 
	`mÆloc
(
acfbyãs
);

750 
dphiSq
 = 
	`mÆloc
(
acfbyãs
);

751 
AÆpha
 = 
	`mÆloc
(
acfbyãs
);

752 
dr4
 = 
	`mÆloc
(
acfbyãs
);

755 
n‹m
 = 
	`mÆloc
(()*
tC‹
);

756 
n‹mv
 = 
	`mÆloc
(()*
tC‹
);

761 
t
=0;Å < 
tC‹
; ++t)

763 
vñacf
[
t
] = 0.0;

764 
psi1acf
[
t
] = 0.0;

765 
psi2acf
[
t
] = 0.0;

767 
i
 = 0; i < 
nTëa
; ++iË
v™Hove
[i][
t
] = 0.0;

768 
j
 = 0; j < 
G¢r
; ++j)

770 
G£lf
[
j
][
t
] = 0.0;

772 
C1acf
[
t
] = 0.0;

773 
C2acf
[
t
] = 0.0;

774 
C3acf
[
t
] = 0.0;

775 
C4acf
[
t
] = 0.0;

776 
Dt
[
t
] = 0.0;

777 
Dr
[
t
] = 0.0;

778 
ddtdrSq
[
t
] = 0.0;

779 
ddtdphiSq
[
t
] = 0.0;

780 
drSq
[
t
] = 0.0;

781 
dr4
[
t
] = 0.0;

782 
dphiSq
[
t
]= 0.0;

783 
n‹mv
[
t
] = 0;

784 
n‹m
[
t
] = 0;

787 
	`¥ötf
("Begin...\n");

788 
	`¥ötf
("%dÖoöt†f‹Éacháutoc‹ªœti⁄ fun˘i⁄.\n", 
tC‹
);

789 
	`¥ötf
("t0 u∞tÿ%d\n", 
tRun
);

794 i‡(
tg≠
 <= 0)

796 
	`¥ötf
("ERROR:Ågap should be > 0!\n");

797 
	`exô
(-1);

800 
t0
 = 0;Å0 < 
tRun
 ;Å0 =Å0 + 
tg≠
)

804 i‡–((
t0
 / 
tg≠
Ë% 
¥ötEvîy
) == 0)

805 
	`¥ötf
("Cuºíàt0: %d (u∞tÿ%d)\n", 
t0
, 
tRun
);

808 i‡(
	`ªadMós
(
mfd
, 
t0
, 
XVA_LIST
, 
NULL
) == 0)

810 
	`¥ötf
("ERROR: UnexpectedÉnd of file\n");

811 
	`exô
(-1);

815 i‡(
tRun
 < 
t0
 + 
tC‹
)

818 
â0Max
 = 
tRun
;

823 
â0Max
 = 
t0
 + 
tC‹
;

829 i‡(
vñFœg
)

830 
	`ˇlcCMVñ
(
vx0
, 
vy0
, 
vz0
);

833 i‡(
psi1Fœg
 || 
psi2Fœg
Ë
	`ˇlcAngVñ
(
ox0
, 
oy0
, 
oz0
);

836 i‡(
C1Fœg
 || 
C2Fœg
 || 
C3Fœg
 || 
C4Fœg
 || 
vhFœg
)

837 
	`ˇlcOrõ¡Ve˘
(
ux0
, 
uy0
, 
uz0
);

840 i‡(
DtFœg
 || 
drSqFœg
 || 
AÆphaFœg
 || 
G£lfFœg
 || 
GsGsgaussFœg
||

841 
F£lfFœg
)

842 
	`ˇlcCM
(
rCM0x
, 
rCM0y
, 
rCM0z
);

844 if–
DrFœg
 || 
dphiSqFœg
)

845 
	`gëPhi
(
phi0x
, 
phi0y
, 
phi0z
);

848  
â0
 = 
t0
;Åt0 < 
â0Max
; ++tt0)

851 
t
 = 
â0
 - 
t0
;

852 i‡(
t
 < 
tBeg
) ;

858 i‡(
	`ªadMós
(
mfd
, 
â0
, 
XVA_LIST
, 
NULL
) == 0)

860 
	`¥ötf
("ERROR: UnexpectedÉnd of file\n");

861 
	`exô
(-1);

864 i‡(
vñFœg
Ë
	`ˇlcCMVñ
(
vxâ0
, 
vyâ0
, 
vzâ0
);

865 i‡(
psi1Fœg
 || 
psi2Fœg
Ë
	`ˇlcAngVñ
(
oxâ0
, 
oyâ0
, 
ozâ0
);

866 i‡(
C1Fœg
 || 
C2Fœg
 || 
C3Fœg
 || 
C4Fœg
 || 
vhFœg
)

867 
	`ˇlcOrõ¡Ve˘
(
uxâ0
, 
uyâ0
, 
uzâ0
);

868 i‡(
drSqFœg
 || 
DtFœg
 || 
AÆphaFœg
 || 
G£lfFœg
 || 
GsGsgaussFœg
||

869 
F£lfFœg
 || 
wtdFœg
)

870 
	`ˇlcCM
(
rCMâ0x
, 
rCMâ0y
, 
rCMâ0z
);

871 if–
DrFœg
 || 
dphiSqFœg
 )

872 
	`gëPhi
(
phôt0x
, 
phôt0y
, 
phôt0z
);

876 
i
 = 0; i < 
Nm
; ++i)

879 i‡(
vñFœg
)

880 
vñacf
[
t
] +
vx0
[
i
] * 
vxâ0
[i] + 
vy0
[i] * 
vyâ0
[i] +

881 
vz0
[
i
] * 
vzâ0
[i];

884 i‡(
psi1Fœg
 || 
psi2Fœg
)

887 
o0
 = 
	`sqπ
(
	`Sqr
(
ox0
[
i
]Ë+ Sqr(
oy0
[i]Ë+ Sqr(
oz0
[i]));

888 
Ÿt0
 = 
	`sqπ
(
	`Sqr
(
oxâ0
[
i
]Ë+ Sqr(
oyâ0
[i]Ë+ Sqr(
ozâ0
[i]));

889 
dŸo
 = 
ox0
[
i
] * 
oxâ0
[i] + 
oy0
[i] * 
oyâ0
[i] +

890 
oz0
[
i
] * 
ozâ0
[i];

891 
dŸo
 /
o0
 * 
Ÿt0
;

894 i‡(
psi1Fœg
)

896 
psi1acf
[
t
] +
dŸo
;

898 i‡(
psi2Fœg
)

900 
psi2acf
[
t
] +0.5 * ( 3.0 * 
	`Sqr
(
dŸo
) - 1.0);

903 i‡(
C1Fœg
 || 
C2Fœg
 || 
C3Fœg
 || 
C4Fœg
 || 
vhFœg
)

904 
dŸu
 = 
ux0
[
i
] * 
uxâ0
[i] + 
uy0
[i] * 
uyâ0
[i] +

905 
uz0
[
i
] * 
uzâ0
[i];

907 i‡(
vhFœg
)

909 
ãè
 = 
	`acos
(
dŸu
);

911 i‡–(
ãè
 > 
dãè
Ë&& (ãè < (
pi
 - dteta)) )

915 
ãèi
 = (Ë(
nTëa
 * 
	`acos
(
dŸu
Ë/ 
pi
);

916 
v™Hove
[
ãèi
][
t
] += 1.0;

919 i‡(
wtdFœg
 || 
G£lfFœg
 || 
GsGsgaussFœg
||
F£lfFœg
)

921 
dñèr
 = 
	`sqπ
(
	`Sqr
(
rCMâ0x
[
i
] - 
rCM0x
[i]) +

922 
	`Sqr
(
rCMâ0y
[
i
] - 
rCM0y
[i]) +

923 
	`Sqr
(
rCMâ0z
[
i
] - 
rCM0z
[i]));

924 
j
 = (Ë(
G¢r
 * 
dñèr
 / 
G§Max
);

925 i‡(
j
 < 
G¢r
Ë
G£lf
[j][
t
] += 1.0;

928 i‡(
C1Fœg
Ë
C1acf
[
t
] +
dŸu
;

929 i‡(
C2Fœg
Ë
C2acf
[
t
] +0.5 * (3.0 * 
	`Sqr
(
dŸu
) - 1.0);

930 i‡(
C3Fœg
Ë
C3acf
[
t
] +0.5 * (5.0 * 
	`Sqr
(
dŸu
) * dotu -

931 3.0 * 
dŸu
);

932 i‡(
C4Fœg
Ë
C4acf
[
t
] +0.125 * (35.0 * 
	`Sqr
(
dŸu
) * Sqr(dotu) -

933 30.0 * 
	`Sqr
(
dŸu
) + 3.0);

936 i‡(
drSqFœg
 || 
DtFœg
 || 
AÆpha
 || 
GsGsgaussFœg
)

938 
drx
 = 
rCMâ0x
[
i
] - 
rCM0x
[i];

939 
dry
 = 
rCMâ0y
[
i
] - 
rCM0y
[i];

940 
drz
 = 
rCMâ0z
[
i
] - 
rCM0z
[i];

941 
dr2i
 = 
	`Sqr
(
drx
Ë+ Sqr(
dry
Ë+ Sqr(
drz
);

942 
drSq
[
t
] +
dr2i
;

943 
dr4
[
t
] +
	`Sqr
(
dr2i
);

946 i‡(
dphiSqFœg
 || 
DrFœg
)

948 
dphix
 = 
phi0x
[
i
] - 
phôt0x
[i];

949 
dphiy
 = 
phi0y
[
i
] - 
phôt0y
[i];

950 
dphiz
 = 
phi0z
[
i
] - 
phôt0z
[i];

951 
dphiSq
[
t
] +
	`Sqr
(
dphix
Ë+ Sqr(
dphiy
Ë+ Sqr(
dphiz
);

953 ++
n‹mv
[
t
];

956 ++
n‹m
[
t
];

963 
t
 = 
tBeg
;Å < 
tC‹
; ++t)

965 
N‹mv
 = (
COORD_TYPE
Ë(
n‹mv
[
t
]);

966 i‡(
N‹mv
 == 0.0) Normv += 0.000000001;

967 
vñacf
[
t
] /
N‹mv
;

968 
psi1acf
[
t
] /
N‹mv
;

969 
psi2acf
[
t
] /
N‹mv
;

970 
i
 = 0; i < 
nTëa
; ++i)

975 
ãè
 = ((
COORD_TYPE
)
i
 + 0.5Ë* (
pi
 / 
nTëa
);

977 
v™Hove
[
i
][
t
] /
N‹mv
 * 
	`sö
(
ãè
);

980 
v™Hove
[
i
][
t
] *2 * 
nTëa
 / 
pi
;

982 
j
 = 0; j < 
G¢r
; ++j)

984 
r
 = ((
COORD_TYPE
Ë
j
 + 0.5Ë* (
G§Max
 / 
G¢r
);

985 
G£lf
[
j
][
t
] *
G¢r
/ 
G§Max
;

986 
G£lf
[
j
][
t
] /
N‹mv
 * 
	`Sqr
(
r
Ë* 4.0 * 
pi
;

989 
C1acf
[
t
] /
N‹mv
;

990 
C2acf
[
t
] /
N‹mv
;

991 
C3acf
[
t
] /
N‹mv
;

992 
C4acf
[
t
] /
N‹mv
;

993 
drSq
[
t
] /
N‹mv
;

994 
dr4
[
t
] /
N‹mv
;

995 
dphiSq
[
t
]/
N‹mv
;

996 i‡(
n‹m
[
t
] == 0.0)Çorm[t] += 0.000000001;

1003 
	`ßveAcf
(
vñFûe
, 
vñacf
);

1006 
	`ßveAcf
(
psi1Fûe
, 
psi1acf
);

1007 
	`ßveAcf
(
psi2Fûe
, 
psi2acf
);

1010 
	`ßveVH
(
vhFûe
, 
v™Hove
);

1013 
	`ßveAcf
(
C1Fûe
, 
C1acf
);

1014 
	`ßveAcf
(
C2Fûe
, 
C2acf
);

1015 
	`ßveAcf
(
C3Fûe
, 
C3acf
);

1016 
	`ßveAcf
(
C4Fûe
, 
C4acf
);

1019 
	`ßveAcf
(
dphiSqFûe
, 
dphiSq
);

1020 
	`ßveAcf
(
drSqFûe
, 
drSq
);

1023 
t
 = 
tBeg
;Å < 
tC‹
; ++t)

1025 
wtd
[
t
] = 0.0;

1026 
i
 = 0; i < 
wtdRmax
 * 
G¢r
 / 
G§Max
; ++i)

1028 
wtd
[
t
] +
G£lf
[
i
][t] * 
	`Sqr
((ò+ 0.5Ë* 
G§Max
 / 
G¢r
);

1030 
wtd
[
t
] *4 * 
pi
 * 
G§Max
 / 
G¢r
;

1033 
t
 = 
tBeg
;Å < 
tC‹
; ++t)

1036 i‡(
t
 > 
tBeg
)

1038 i‡(
ddtdphiFœg
Ë
ddtdphiSq
[
t
] = (
dphiSq
[t] - dphiSq[t-1])

1039 / 
xvadt
 / 4.0;

1040 i‡(
ddtdrFœg
Ë
ddtdrSq
[
t
] = (
drSq
[t] - drSq[t-1]Ë/ 
xvadt
 / 6.0;

1043 
Dt
[
t
] = 
drSq
[t] /

1044 (6.0 * 
xvadt
 * ((
COORD_TYPE
)
t
));

1046 i‡(
DrFœg
)

1048 
Dr
[
t
] = 
dphiSq
[t] /

1049 (4.0 * 
xvadt
 * ((
COORD_TYPE
)
t
));

1051 i‡(
AÆphaFœg
)

1053 
AÆpha
[
t
] = 3.0 * 
dr4
[t] / 5.0 / 
	`Sqr
(
drSq
[t]) - 1.0;

1056 i‡(
GsGsgaussFœg
)

1058 
¥eÁ˘
 = 
	`pow
(3.0 / 
drSq
[
t
] / 
pi
 / 2.0, 1.5);

1059 
i
 = 0; i < 
G¢r
; ++i)

1061 
r
 = ((
COORD_TYPE
Ë
i
 + 0.5Ë* (
G§Max
 / 
G¢r
);

1062 
Gsg
 = 
¥eÁ˘
 * 
	`exp
(-3.0*
	`Sqr
(
r
)/(2.0*
drSq
[
t
]));

1064 
GsGsgauss
[
i
][
t
] = (
G£lf
[i][t] - 
Gsg
) / Gsg;

1067 i‡(
F£lfFœg
)

1069 
F£lf
[
t
] = 0.0;

1070 
k
 = 
kMax
;

1071 
rI¡
 = 0;ÑI¡ < 
G¢r
; ++rInt)

1073 
r
 = ( ((
COORD_TYPE
Ë
rI¡
) +

1074 0.5Ë* (
G§Max
 / ((
COORD_TYPE
)
G¢r
));

1075 
F£lf
[
t
] +4.0 * 
pi
 * 
	`sö
(
k
*
r
Ë* 
G£lf
[
rI¡
][t]

1076 * 
r
 / 
k
;

1078 
F£lf
[
t
] *
G§Max
 / 
G¢r
;

1083 
	`ßveAcf
(
DtFûe
, 
Dt
);

1084 
	`ßveAcf
(
DrFûe
, 
Dr
);

1085 
	`ßveAcf
(
ddtdrFûe
, 
ddtdrSq
);

1086 
	`ßveAcf
(
ddtdphiFûe
, 
ddtdphiSq
);

1087 
	`ßveAcf
(
AÆphaFûe
, 
AÆpha
);

1088 
	`ßveAcf
(
wtdFûe
, 
wtd
);

1089 
	`ßveG£lf
(
G£lfFûe
, 
G£lf
);

1090 
	`ßveG£lf
(
GsGsgaussFûe
, 
GsGsgauss
);

1091 
	`ßveF£lf
(
F£lfFûe
, 
F£lf
);

1093 
	`˛o£
(
mfd
);

1094 
	}
}

	@xvautil.h

2 
	gvñFûe
[128], 
	gpsi1Fûe
[128], 
	gpsi2Fûe
[128], 
	gC1Fûe
[128], 
	gC2Fûe
[128],

3 
	gC3Fûe
[128], 
	gC4Fûe
[128], 
	gdphiSqFûe
[128], 
	gdrSqFûe
[128], 
	gDtFûe
[128],

4 
	gDrFûe
[128], 
	gvhFûe
[128], 
	gddtdrFûe
[128], 
	gddtdphiFûe
[128],

5 
	gAÆphaFûe
[128], 
	gG£lfFûe
[128], 
	gGsGsgaussFûe
[128], 
	gF£lfFûe
[128],

6 
	gwtdFûe
[128];

8 
	gvñFœg
=1, 
	gpsi1Fœg
=1, 
	gpsi2Fœg
=1, 
	gvhFœg
=1, 
	gC1Fœg
=1, 
	gC2Fœg
=1, 
	gC3Fœg
=1,

9 
	gphiFœg
=1, 
	gC4Fœg
=1, 
	gdphiSqFœg
=1, 
	gdrSqFœg
=1, 
	gDtFœg
=1, 
	gDrFœg
=1,

10 
	gddtdrFœg
 = 1, 
	gddtdphiFœg
 = 1, 
	gAÆphaFœg
 = 1, 
	gG£lfFœg
 = 1,

11 
	gGsGsgaussFœg
 = 1, 
	gF£lfFœg
 = 1, 
	gwtdFœg
 = 1;

13 
	gphiFûe
[128];

14 
	gtC‹
, 
	g¥ötEvîy
, 
	gnTëa
, 
	gtBeg
, 
	gG¢r
;

18 
COORD_TYPE
 
	gm0
, 
	gm1
, 
	gd
, 
	gVﬁ
, 
	gG§Max
, 
	gwtdRmax
, 
	gkMax
;

19 
COORD_TYPE
 
	gMtŸ
, 
	gxvadt
, 
	gdt
, 
	gdãè
, 
	gT
;

20 
COORD_TYPE
 *
	gphix
, *
	gphiy
, *
	gphiz
, *
	gphi0x
, *
	gphi0y
, *
	gphi0z
,

21 *
	gphôt0x
, *
	gphôt0y
, *
	gphôt0z
;

23 
	göputFûe
[
NAME_LENGTH
], 
	gxv≠¨sFûe
[NAME_LENGTH];

26 
	g¥ecisi⁄
[64];

27 
	gNm
;

29 
	gtg≠
;

30 
	gvhg≠
;

31 
COORD_TYPE
 *
	gvñacf
, *
	gpsi1acf
, *
	gpsi2acf
, *
	gC1acf
, *
	gC2acf
, *
	gC3acf
,

32 *
	gC4acf
, *
	gwtd
;

33 
COORD_TYPE
 **
	gv™Hove
;

34 *
	gn‹mv
, *
	gn‹m
;

35 
COORD_TYPE
 *
	gdrSq
, *
	gdphiSq
, *
	gDr
, *
	gDt
, *
	gddtdrSq
, *
	gddtdphiSq
, *
	gAÆpha
, *
	gdr4
,

36 **
	gG£lf
, **
	gGsGsgauss
, *
	gF£lf
;

37 
COORD_TYPE
 
	gpi
;

40 
sögÀP¨
 
	gOxvaP¨
[] = {

55 {"öputFûe", &
öputFûe
, 
STR
},

56 {"tC‹", &
tC‹
, 
INT
},

57 {"vñ" , 
vñFûe
, 
STR
},

58 {"psi1", 
psi1Fûe
, 
STR
},

59 {"psi2", 
psi2Fûe
, 
STR
},

60 {"v™Hove", 
vhFûe
, 
STR
},

61 {"vhg≠", &
vhg≠
, 
INT
},

62 {"nTëa", &
nTëa
, 
INT
},

63 {"dãè", &
dãè
, 
CT
},

64 {"C1", 
C1Fûe
, 
STR
},

65 {"C2", 
C2Fûe
, 
STR
},

66 {"C3", 
C3Fûe
, 
STR
},

67 {"C4", 
C4Fûe
, 
STR
},

68 {"Dt", 
DtFûe
, 
STR
},

69 {"Dr", 
DrFûe
, 
STR
},

70 {"drSq", 
drSqFûe
, 
STR
},

71 {"AÆpha", 
AÆphaFûe
, 
STR
},

72 {"dphiSq", 
dphiSqFûe
, 
STR
},

73 {"ddtdrSq", 
ddtdrFûe
, 
STR
},

74 {"ddtdphiSq", 
ddtdphiFûe
, 
STR
},

75 {"G£lf", 
G£lfFûe
, 
STR
},

76 {"wtd", 
wtdFûe
, 
STR
},

77 {"wtdRmax", &
wtdRmax
, 
CT
},

79 {"GsGsgauss",
GsGsgaussFûe
, 
STR
},

80 {"G¢r", &
G¢r
, 
INT
},

81 {"G§Max", &
G§Max
, 
CT
},

82 {"F£lf", 
F£lfFûe
, 
STR
},

83 {"kMax", &
kMax
, 
CT
},

84 {"¥ec", 
¥ecisi⁄
, 
STR
},

85 {"m0", &
m0
, 
CT
},

86 {"m1", &
m1
, 
CT
},

87 {"d", &
d
, 
CT
},

88 {"dt", &
dt
, 
CT
},

89 {"Vﬁ", &
Vﬁ
, 
CT
},

90 {"¥ötEvîy", &
¥ötEvîy
, 
INT
},

91 {"tg≠", &
tg≠
, 
INT
},

92 {"tBeg", &
tBeg
, 
INT
},

93 {"T", &
T
, 
CT
},

96 {"", 
NULL
, 0}

	@../bimix/kmesh.dat

	@../bimix/ntripl.dat

	@
1
.
1
/usr/include
16
160
corutil.c
forces.c
hetero.c
hetero.h
init.c
jumps.c
jumps.h
laponite.h
measures.c
move.c
wtd.c
wtd.h
xvautil.c
xvautil.h
../bimix/kmesh.dat
../bimix/ntripl.dat
